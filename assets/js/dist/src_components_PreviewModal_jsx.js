/*! For license information please see src_components_PreviewModal_jsx.js.LICENSE.txt */
"use strict";(self.webpackChunkwp_pdf_builder_pro=self.webpackChunkwp_pdf_builder_pro||[]).push([["src_components_PreviewModal_jsx"],{"./src/components/PreviewModal.jsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ \"./node_modules/react/index.js\");\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_0__);\nfunction _regenerator() { /*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/babel/babel/blob/main/packages/babel-helpers/LICENSE */ var e, t, r = \"function\" == typeof Symbol ? Symbol : {}, n = r.iterator || \"@@iterator\", o = r.toStringTag || \"@@toStringTag\"; function i(r, n, o, i) { var c = n && n.prototype instanceof Generator ? n : Generator, u = Object.create(c.prototype); return _regeneratorDefine2(u, \"_invoke\", function (r, n, o) { var i, c, u, f = 0, p = o || [], y = !1, G = { p: 0, n: 0, v: e, a: d, f: d.bind(e, 4), d: function d(t, r) { return i = t, c = 0, u = e, G.n = r, a; } }; function d(r, n) { for (c = r, u = n, t = 0; !y && f && !o && t < p.length; t++) { var o, i = p[t], d = G.p, l = i[2]; r > 3 ? (o = l === n) && (u = i[(c = i[4]) ? 5 : (c = 3, 3)], i[4] = i[5] = e) : i[0] <= d && ((o = r < 2 && d < i[1]) ? (c = 0, G.v = n, G.n = i[1]) : d < l && (o = r < 3 || i[0] > n || n > l) && (i[4] = r, i[5] = n, G.n = l, c = 0)); } if (o || r > 1) return a; throw y = !0, n; } return function (o, p, l) { if (f > 1) throw TypeError(\"Generator is already running\"); for (y && 1 === p && d(p, l), c = p, u = l; (t = c < 2 ? e : u) || !y;) { i || (c ? c < 3 ? (c > 1 && (G.n = -1), d(c, u)) : G.n = u : G.v = u); try { if (f = 2, i) { if (c || (o = \"next\"), t = i[o]) { if (!(t = t.call(i, u))) throw TypeError(\"iterator result is not an object\"); if (!t.done) return t; u = t.value, c < 2 && (c = 0); } else 1 === c && (t = i[\"return\"]) && t.call(i), c < 2 && (u = TypeError(\"The iterator does not provide a '\" + o + \"' method\"), c = 1); i = e; } else if ((t = (y = G.n < 0) ? u : r.call(n, G)) !== a) break; } catch (t) { i = e, c = 1, u = t; } finally { f = 1; } } return { value: t, done: y }; }; }(r, o, i), !0), u; } var a = {}; function Generator() {} function GeneratorFunction() {} function GeneratorFunctionPrototype() {} t = Object.getPrototypeOf; var c = [][n] ? t(t([][n]())) : (_regeneratorDefine2(t = {}, n, function () { return this; }), t), u = GeneratorFunctionPrototype.prototype = Generator.prototype = Object.create(c); function f(e) { return Object.setPrototypeOf ? Object.setPrototypeOf(e, GeneratorFunctionPrototype) : (e.__proto__ = GeneratorFunctionPrototype, _regeneratorDefine2(e, o, \"GeneratorFunction\")), e.prototype = Object.create(u), e; } return GeneratorFunction.prototype = GeneratorFunctionPrototype, _regeneratorDefine2(u, \"constructor\", GeneratorFunctionPrototype), _regeneratorDefine2(GeneratorFunctionPrototype, \"constructor\", GeneratorFunction), GeneratorFunction.displayName = \"GeneratorFunction\", _regeneratorDefine2(GeneratorFunctionPrototype, o, \"GeneratorFunction\"), _regeneratorDefine2(u), _regeneratorDefine2(u, o, \"Generator\"), _regeneratorDefine2(u, n, function () { return this; }), _regeneratorDefine2(u, \"toString\", function () { return \"[object Generator]\"; }), (_regenerator = function _regenerator() { return { w: i, m: f }; })(); }\nfunction _regeneratorDefine2(e, r, n, t) { var i = Object.defineProperty; try { i({}, \"\", {}); } catch (e) { i = 0; } _regeneratorDefine2 = function _regeneratorDefine(e, r, n, t) { function o(r, n) { _regeneratorDefine2(e, r, function (e) { return this._invoke(r, n, e); }); } r ? i ? i(e, r, { value: n, enumerable: !t, configurable: !t, writable: !t }) : e[r] = n : (o(\"next\", 0), o(\"throw\", 1), o(\"return\", 2)); }, _regeneratorDefine2(e, r, n, t); }\nfunction ownKeys(e, r) { var t = Object.keys(e); if (Object.getOwnPropertySymbols) { var o = Object.getOwnPropertySymbols(e); r && (o = o.filter(function (r) { return Object.getOwnPropertyDescriptor(e, r).enumerable; })), t.push.apply(t, o); } return t; }\nfunction _objectSpread(e) { for (var r = 1; r < arguments.length; r++) { var t = null != arguments[r] ? arguments[r] : {}; r % 2 ? ownKeys(Object(t), !0).forEach(function (r) { _defineProperty(e, r, t[r]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys(Object(t)).forEach(function (r) { Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r)); }); } return e; }\nfunction asyncGeneratorStep(n, t, e, r, o, a, c) { try { var i = n[a](c), u = i.value; } catch (n) { return void e(n); } i.done ? t(u) : Promise.resolve(u).then(r, o); }\nfunction _asyncToGenerator(n) { return function () { var t = this, e = arguments; return new Promise(function (r, o) { var a = n.apply(t, e); function _next(n) { asyncGeneratorStep(a, r, o, _next, _throw, \"next\", n); } function _throw(n) { asyncGeneratorStep(a, r, o, _next, _throw, \"throw\", n); } _next(void 0); }); }; }\nfunction _defineProperty(e, r, t) { return (r = _toPropertyKey(r)) in e ? Object.defineProperty(e, r, { value: t, enumerable: !0, configurable: !0, writable: !0 }) : e[r] = t, e; }\nfunction _toPropertyKey(t) { var i = _toPrimitive(t, \"string\"); return \"symbol\" == _typeof(i) ? i : i + \"\"; }\nfunction _toPrimitive(t, r) { if (\"object\" != _typeof(t) || !t) return t; var e = t[Symbol.toPrimitive]; if (void 0 !== e) { var i = e.call(t, r || \"default\"); if (\"object\" != _typeof(i)) return i; throw new TypeError(\"@@toPrimitive must return a primitive value.\"); } return (\"string\" === r ? String : Number)(t); }\nfunction _typeof(o) { \"@babel/helpers - typeof\"; return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (o) { return typeof o; } : function (o) { return o && \"function\" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? \"symbol\" : typeof o; }, _typeof(o); }\nfunction _slicedToArray(r, e) { return _arrayWithHoles(r) || _iterableToArrayLimit(r, e) || _unsupportedIterableToArray(r, e) || _nonIterableRest(); }\nfunction _nonIterableRest() { throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); }\nfunction _unsupportedIterableToArray(r, a) { if (r) { if (\"string\" == typeof r) return _arrayLikeToArray(r, a); var t = {}.toString.call(r).slice(8, -1); return \"Object\" === t && r.constructor && (t = r.constructor.name), \"Map\" === t || \"Set\" === t ? Array.from(r) : \"Arguments\" === t || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t) ? _arrayLikeToArray(r, a) : void 0; } }\nfunction _arrayLikeToArray(r, a) { (null == a || a > r.length) && (a = r.length); for (var e = 0, n = Array(a); e < a; e++) n[e] = r[e]; return n; }\nfunction _iterableToArrayLimit(r, l) { var t = null == r ? null : \"undefined\" != typeof Symbol && r[Symbol.iterator] || r[\"@@iterator\"]; if (null != t) { var e, n, i, u, a = [], f = !0, o = !1; try { if (i = (t = t.call(r)).next, 0 === l) { if (Object(t) !== t) return; f = !1; } else for (; !(f = (e = i.call(t)).done) && (a.push(e.value), a.length !== l); f = !0); } catch (r) { o = !0, n = r; } finally { try { if (!f && null != t[\"return\"] && (u = t[\"return\"](), Object(u) !== u)) return; } finally { if (o) throw n; } } return a; } }\nfunction _arrayWithHoles(r) { if (Array.isArray(r)) return r; }\n\n\n// Nouveau système d'aperçu côté serveur avec TCPDF\n\nvar PreviewModal = function PreviewModal(_ref) {\n  var isOpen = _ref.isOpen,\n    onClose = _ref.onClose,\n    _ref$elements = _ref.elements,\n    elements = _ref$elements === void 0 ? [] : _ref$elements,\n    _ref$canvasWidth = _ref.canvasWidth,\n    canvasWidth = _ref$canvasWidth === void 0 ? 595 : _ref$canvasWidth,\n    _ref$canvasHeight = _ref.canvasHeight,\n    canvasHeight = _ref$canvasHeight === void 0 ? 842 : _ref$canvasHeight,\n    _ref$zoom = _ref.zoom,\n    zoom = _ref$zoom === void 0 ? 1 : _ref$zoom,\n    ajaxurl = _ref.ajaxurl,\n    pdfBuilderNonce = _ref.pdfBuilderNonce,\n    _ref$onOpenPDFModal = _ref.onOpenPDFModal,\n    onOpenPDFModal = _ref$onOpenPDFModal === void 0 ? null : _ref$onOpenPDFModal,\n    _ref$useServerPreview = _ref.useServerPreview,\n    useServerPreview = _ref$useServerPreview === void 0 ? false : _ref$useServerPreview;\n  var _useState = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(null),\n    _useState2 = _slicedToArray(_useState, 2),\n    previewData = _useState2[0],\n    setPreviewData = _useState2[1];\n  var _useState3 = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(false),\n    _useState4 = _slicedToArray(_useState3, 2),\n    loading = _useState4[0],\n    setLoading = _useState4[1];\n  var _useState5 = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(null),\n    _useState6 = _slicedToArray(_useState5, 2),\n    error = _useState6[0],\n    setError = _useState6[1];\n\n  // Fonction pour nettoyer les éléments avant sérialisation JSON\n  var cleanElementsForJSON = function cleanElementsForJSON(elements) {\n    if (!Array.isArray(elements)) {\n      throw new Error('Les éléments doivent être un tableau');\n    }\n    return elements.map(function (element) {\n      if (!element || _typeof(element) !== 'object') {\n        throw new Error('Chaque élément doit être un objet valide');\n      }\n\n      // Créer une copie profonde de l'élément\n      var cleaned = JSON.parse(JSON.stringify(element));\n\n      // S'assurer que les propriétés numériques sont des nombres\n      var numericProps = ['x', 'y', 'width', 'height', 'fontSize', 'padding', 'zIndex', 'borderWidth'];\n      numericProps.forEach(function (prop) {\n        if (cleaned[prop] !== undefined) {\n          var numValue = parseFloat(cleaned[prop]);\n          if (isNaN(numValue)) {\n            throw new Error(\"Propri\\xE9t\\xE9 \".concat(prop, \" doit \\xEAtre un nombre valide\"));\n          }\n          cleaned[prop] = numValue;\n        }\n      });\n\n      // Valider les propriétés requises\n      if (typeof cleaned.type !== 'string') {\n        throw new Error('Chaque élément doit avoir un type string');\n      }\n\n      // Nettoyer les propriétés potentiellement problématiques\n      delete cleaned.tempId; // Supprimer les IDs temporaires si présents\n      delete cleaned.isDragging; // Supprimer les états d'interaction\n      delete cleaned.isResizing; // Supprimer les états d'interaction\n\n      return cleaned;\n    });\n  };\n\n  // Fonction de validation des éléments avant envoi\n  var validateElementsBeforeSend = function validateElementsBeforeSend(elements) {\n    try {\n      var cleanedElements = cleanElementsForJSON(elements);\n      var jsonString = JSON.stringify(cleanedElements);\n\n      // Vérifier que le JSON est valide\n      JSON.parse(jsonString);\n\n      // Vérifier la longueur raisonnable\n      if (jsonString.length > 10000000) {\n        // 10MB max\n        throw new Error('JSON trop volumineux');\n      }\n      return {\n        success: true,\n        jsonString: jsonString,\n        cleanedElements: cleanedElements\n      };\n    } catch (error) {\n      console.error('Client-side validation failed:', error);\n      return {\n        success: false,\n        error: error.message\n      };\n    }\n  };\n\n  // Fonction pour rendre le contenu du canvas en HTML\n  var renderCanvasContent = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(function (elements) {\n    // Réduire les logs pour éviter la boucle infinie - n'afficher que les erreurs importantes\n    if (!elements || elements.length === 0) {\n      return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n        style: {\n          padding: '20px',\n          textAlign: 'center',\n          color: '#666'\n        }\n      }, \"Aucun \\xE9l\\xE9ment \\xE0 afficher\");\n    }\n\n    // Vérifier que zoom est valide\n    var validZoom = typeof zoom === 'number' && !isNaN(zoom) && zoom > 0 ? zoom : 1;\n    return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n      style: {\n        position: 'relative',\n        width: canvasWidth * validZoom,\n        height: canvasHeight * validZoom,\n        backgroundColor: 'white',\n        border: '1px solid #e2e8f0',\n        borderRadius: '4px',\n        overflow: 'hidden',\n        margin: '0 auto'\n      }\n    }, elements.map(function (element, index) {\n      // Vérifier que les propriétés essentielles existent\n      if (typeof element.x !== 'number' || typeof element.y !== 'number' || typeof element.width !== 'number' || typeof element.height !== 'number') {\n        console.error('❌ Element missing required properties:', element);\n        return null;\n      }\n      var elementPadding = element.padding || 0;\n      var baseStyle = {\n        position: 'absolute',\n        left: (element.x + elementPadding) * validZoom,\n        top: (element.y + elementPadding) * validZoom,\n        width: Math.max(1, element.width - elementPadding * 2) * validZoom,\n        height: Math.max(1, element.height - elementPadding * 2) * validZoom,\n        zIndex: element.zIndex || index + 1\n      };\n      return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n        key: index,\n        style: baseStyle\n      }, renderSpecialElement(element, validZoom));\n    }));\n  }, [zoom, canvasWidth, canvasHeight]);\n\n  // Fonction pour rendre un élément spécial (basée sur CanvasElement.jsx)\n  var renderSpecialElement = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(function (element, zoom) {\n    // Réduire les logs - n'afficher que les erreurs importantes\n    switch (element.type) {\n      case 'text':\n        return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n          style: {\n            width: '100%',\n            height: '100%',\n            fontSize: (element.fontSize || 16) * zoom,\n            color: element.color || '#000000',\n            fontWeight: element.fontWeight === 'bold' ? 'bold' : 'normal',\n            fontStyle: element.fontStyle === 'italic' ? 'italic' : 'normal',\n            textDecoration: element.textDecoration || 'none',\n            textAlign: element.textAlign || 'left',\n            lineHeight: element.lineHeight || '1.2',\n            whiteSpace: 'pre-wrap',\n            overflow: 'hidden',\n            padding: \"\".concat(4 * zoom, \"px\"),\n            boxSizing: 'border-box'\n          }\n        }, element.content || element.text || 'Texte');\n      case 'rectangle':\n        return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n          style: {\n            width: '100%',\n            height: '100%',\n            backgroundColor: element.fillColor || 'transparent',\n            border: element.borderWidth ? \"\".concat(element.borderWidth * zoom, \"px \").concat(element.borderStyle || 'solid', \" \").concat(element.borderColor || '#000000') : 'none',\n            borderRadius: (element.borderRadius || 0) * zoom\n          }\n        });\n      case 'image':\n        return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"img\", {\n          src: element.src || element.imageUrl || '',\n          alt: element.alt || 'Image',\n          style: {\n            width: '100%',\n            height: '100%',\n            objectFit: element.objectFit || 'cover',\n            borderRadius: (element.borderRadius || 0) * zoom\n          },\n          onError: function onError(e) {\n            e.target.style.display = 'none';\n          }\n        });\n      case 'line':\n        return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n          style: _defineProperty({\n            width: '100%',\n            height: (element.height || element.strokeWidth || 1) * zoom,\n            borderTop: \"\".concat((element.strokeWidth || 1) * zoom, \"px solid \").concat(element.strokeColor || '#000000')\n          }, \"height\", 0)\n        });\n      case 'divider':\n        return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n          style: _defineProperty(_defineProperty(_defineProperty({\n            width: '100%',\n            height: '100%',\n            backgroundColor: element.color || element.fillColor || '#cccccc'\n          }, \"height\", \"\".concat((element.thickness || element.height || 2) * zoom, \"px\")), \"margin\", \"\".concat((element.margin || 10) * zoom, \"px 0\")), \"borderRadius\", (element.borderRadius || 0) * zoom)\n        });\n      case 'product_table':\n        // Rendu dynamique du tableau de produits utilisant les propriétés de l'élément\n        var getTableStyles = function getTableStyles() {\n          var tableStyle = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 'default';\n          var baseStyles = {\n            \"default\": {\n              headerBg: '#f8fafc',\n              headerBorder: '#e2e8f0',\n              rowBorder: '#f1f5f9',\n              altRowBg: '#fafbfc',\n              borderWidth: 1,\n              headerTextColor: '#334155',\n              rowTextColor: '#334155',\n              headerFontWeight: '600',\n              headerFontSize: '11px',\n              rowFontSize: '10px',\n              shadow: '0 1px 3px rgba(0, 0, 0, 0.1)',\n              borderRadius: '4px'\n            },\n            classic: {\n              headerBg: '#1e293b',\n              headerBorder: '#334155',\n              rowBorder: '#334155',\n              altRowBg: '#ffffff',\n              borderWidth: 1.5,\n              headerTextColor: '#ffffff',\n              rowTextColor: '#1e293b',\n              headerFontWeight: '700',\n              headerFontSize: '11px',\n              rowFontSize: '10px',\n              shadow: '0 2px 8px rgba(0, 0, 0, 0.15)',\n              borderRadius: '0px'\n            },\n            striped: {\n              headerBg: '#3b82f6',\n              headerBorder: '#2563eb',\n              rowBorder: '#e2e8f0',\n              altRowBg: '#f8fafc',\n              borderWidth: 1,\n              headerTextColor: '#ffffff',\n              rowTextColor: '#334155',\n              headerFontWeight: '600',\n              headerFontSize: '11px',\n              rowFontSize: '10px',\n              shadow: '0 1px 4px rgba(59, 130, 246, 0.2)',\n              borderRadius: '6px'\n            },\n            bordered: {\n              headerBg: '#ffffff',\n              headerBorder: '#374151',\n              rowBorder: '#d1d5db',\n              altRowBg: '#ffffff',\n              borderWidth: 2,\n              headerTextColor: '#111827',\n              rowTextColor: '#111827',\n              headerFontWeight: '600',\n              headerFontSize: '11px',\n              rowFontSize: '10px',\n              shadow: '0 4px 12px rgba(0, 0, 0, 0.1), inset 0 0 0 1px #e5e7eb',\n              borderRadius: '8px'\n            },\n            minimal: {\n              headerBg: '#ffffff',\n              headerBorder: '#d1d5db',\n              rowBorder: '#f3f4f6',\n              altRowBg: '#ffffff',\n              borderWidth: 0.5,\n              headerTextColor: '#6b7280',\n              rowTextColor: '#6b7280',\n              headerFontWeight: '500',\n              headerFontSize: '10px',\n              rowFontSize: '9px',\n              shadow: 'none',\n              borderRadius: '0px'\n            },\n            modern: {\n              gradient: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',\n              headerBorder: '#5b21b6',\n              rowBorder: '#e9d5ff',\n              altRowBg: '#faf5ff',\n              borderWidth: 1,\n              headerTextColor: '#ffffff',\n              rowTextColor: '#6b21a8',\n              headerFontWeight: '600',\n              headerFontSize: '11px',\n              rowFontSize: '10px',\n              shadow: '0 4px 20px rgba(102, 126, 234, 0.25)',\n              borderRadius: '8px'\n            },\n            // Nouveaux styles colorés\n            blue_ocean: {\n              gradient: 'linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%)',\n              headerBorder: '#1e40af',\n              rowBorder: '#dbeafe',\n              altRowBg: '#eff6ff',\n              borderWidth: 1.5,\n              headerTextColor: '#ffffff',\n              rowTextColor: '#1e3a8a',\n              headerFontWeight: '600',\n              headerFontSize: '11px',\n              rowFontSize: '10px',\n              shadow: '0 4px 16px rgba(59, 130, 246, 0.3)',\n              borderRadius: '6px'\n            },\n            emerald_forest: {\n              gradient: 'linear-gradient(135deg, #064e3b 0%, #10b981 100%)',\n              headerBorder: '#065f46',\n              rowBorder: '#d1fae5',\n              altRowBg: '#ecfdf5',\n              borderWidth: 1.5,\n              headerTextColor: '#ffffff',\n              rowTextColor: '#064e3b',\n              headerFontWeight: '600',\n              headerFontSize: '11px',\n              rowFontSize: '10px',\n              shadow: '0 4px 16px rgba(16, 185, 129, 0.3)',\n              borderRadius: '6px'\n            },\n            sunset_orange: {\n              gradient: 'linear-gradient(135deg, #9a3412 0%, #f97316 100%)',\n              headerBorder: '#c2410c',\n              rowBorder: '#fed7aa',\n              altRowBg: '#fff7ed',\n              borderWidth: 1.5,\n              headerTextColor: '#ffffff',\n              rowTextColor: '#9a3412',\n              headerFontWeight: '600',\n              headerFontSize: '11px',\n              rowFontSize: '10px',\n              shadow: '0 4px 16px rgba(249, 115, 22, 0.3)',\n              borderRadius: '6px'\n            },\n            royal_purple: {\n              gradient: 'linear-gradient(135deg, #581c87 0%, #a855f7 100%)',\n              headerBorder: '#7c3aed',\n              rowBorder: '#e9d5ff',\n              altRowBg: '#faf5ff',\n              borderWidth: 1.5,\n              headerTextColor: '#ffffff',\n              rowTextColor: '#581c87',\n              headerFontWeight: '600',\n              headerFontSize: '11px',\n              rowFontSize: '10px',\n              shadow: '0 4px 16px rgba(168, 85, 247, 0.3)',\n              borderRadius: '6px'\n            },\n            rose_pink: {\n              gradient: 'linear-gradient(135deg, #be185d 0%, #f472b6 100%)',\n              headerBorder: '#db2777',\n              rowBorder: '#fce7f3',\n              altRowBg: '#fdf2f8',\n              borderWidth: 1.5,\n              headerTextColor: '#ffffff',\n              rowTextColor: '#be185d',\n              headerFontWeight: '600',\n              headerFontSize: '11px',\n              rowFontSize: '10px',\n              shadow: '0 4px 16px rgba(244, 114, 182, 0.3)',\n              borderRadius: '6px'\n            },\n            teal_aqua: {\n              gradient: 'linear-gradient(135deg, #0f766e 0%, #14b8a6 100%)',\n              headerBorder: '#0d9488',\n              rowBorder: '#ccfbf1',\n              altRowBg: '#f0fdfa',\n              borderWidth: 1.5,\n              headerTextColor: '#ffffff',\n              rowTextColor: '#0f766e',\n              headerFontWeight: '600',\n              headerFontSize: '11px',\n              rowFontSize: '10px',\n              shadow: '0 4px 16px rgba(20, 184, 166, 0.3)',\n              borderRadius: '6px'\n            },\n            crimson_red: {\n              gradient: 'linear-gradient(135deg, #991b1b 0%, #ef4444 100%)',\n              headerBorder: '#dc2626',\n              rowBorder: '#fecaca',\n              altRowBg: '#fef2f2',\n              borderWidth: 1.5,\n              headerTextColor: '#ffffff',\n              rowTextColor: '#991b1b',\n              headerFontWeight: '600',\n              headerFontSize: '11px',\n              rowFontSize: '10px',\n              shadow: '0 4px 16px rgba(239, 68, 68, 0.3)',\n              borderRadius: '6px'\n            },\n            amber_gold: {\n              gradient: 'linear-gradient(135deg, #92400e 0%, #f59e0b 100%)',\n              headerBorder: '#d97706',\n              rowBorder: '#fef3c7',\n              altRowBg: '#fffbeb',\n              borderWidth: 1.5,\n              headerTextColor: '#ffffff',\n              rowTextColor: '#92400e',\n              headerFontWeight: '600',\n              headerFontSize: '11px',\n              rowFontSize: '10px',\n              shadow: '0 4px 16px rgba(245, 158, 11, 0.3)',\n              borderRadius: '6px'\n            },\n            indigo_night: {\n              gradient: 'linear-gradient(135deg, #312e81 0%, #6366f1 100%)',\n              headerBorder: '#4338ca',\n              rowBorder: '#e0e7ff',\n              altRowBg: '#eef2ff',\n              borderWidth: 1.5,\n              headerTextColor: '#ffffff',\n              rowTextColor: '#312e81',\n              headerFontWeight: '600',\n              headerFontSize: '11px',\n              rowFontSize: '10px',\n              shadow: '0 4px 16px rgba(99, 102, 241, 0.3)',\n              borderRadius: '6px'\n            },\n            slate_gray: {\n              gradient: 'linear-gradient(135deg, #374151 0%, #6b7280 100%)',\n              headerBorder: '#4b5563',\n              rowBorder: '#f3f4f6',\n              altRowBg: '#f9fafb',\n              borderWidth: 1.5,\n              headerTextColor: '#ffffff',\n              rowTextColor: '#374151',\n              headerFontWeight: '600',\n              headerFontSize: '11px',\n              rowFontSize: '10px',\n              shadow: '0 4px 16px rgba(107, 114, 128, 0.3)',\n              borderRadius: '6px'\n            },\n            coral_sunset: {\n              gradient: 'linear-gradient(135deg, #c2410c 0%, #fb7185 100%)',\n              headerBorder: '#ea580c',\n              rowBorder: '#fed7d7',\n              altRowBg: '#fef7f7',\n              borderWidth: 1.5,\n              headerTextColor: '#ffffff',\n              rowTextColor: '#c2410c',\n              headerFontWeight: '600',\n              headerFontSize: '11px',\n              rowFontSize: '10px',\n              shadow: '0 4px 16px rgba(251, 113, 133, 0.3)',\n              borderRadius: '6px'\n            },\n            mint_green: {\n              gradient: 'linear-gradient(135deg, #065f46 0%, #34d399 100%)',\n              headerBorder: '#047857',\n              rowBorder: '#d1fae5',\n              altRowBg: '#ecfdf5',\n              borderWidth: 1.5,\n              headerTextColor: '#ffffff',\n              rowTextColor: '#065f46',\n              headerFontWeight: '600',\n              headerFontSize: '11px',\n              rowFontSize: '10px',\n              shadow: '0 4px 16px rgba(52, 211, 153, 0.3)',\n              borderRadius: '6px'\n            },\n            violet_dream: {\n              gradient: 'linear-gradient(135deg, #6d28d9 0%, #c084fc 100%)',\n              headerBorder: '#8b5cf6',\n              rowBorder: '#ede9fe',\n              altRowBg: '#f5f3ff',\n              borderWidth: 1.5,\n              headerTextColor: '#ffffff',\n              rowTextColor: '#6d28d9',\n              headerFontWeight: '600',\n              headerFontSize: '11px',\n              rowFontSize: '10px',\n              shadow: '0 4px 16px rgba(192, 132, 252, 0.3)',\n              borderRadius: '6px'\n            },\n            sky_blue: {\n              gradient: 'linear-gradient(135deg, #0369a1 0%, #0ea5e9 100%)',\n              headerBorder: '#0284c7',\n              rowBorder: '#bae6fd',\n              altRowBg: '#f0f9ff',\n              borderWidth: 1.5,\n              headerTextColor: '#ffffff',\n              rowTextColor: '#0369a1',\n              headerFontWeight: '600',\n              headerFontSize: '11px',\n              rowFontSize: '10px',\n              shadow: '0 4px 16px rgba(14, 165, 233, 0.3)',\n              borderRadius: '6px'\n            },\n            forest_green: {\n              gradient: 'linear-gradient(135deg, #14532d 0%, #22c55e 100%)',\n              headerBorder: '#15803d',\n              rowBorder: '#bbf7d0',\n              altRowBg: '#f0fdf4',\n              borderWidth: 1.5,\n              headerTextColor: '#ffffff',\n              rowTextColor: '#14532d',\n              headerFontWeight: '600',\n              headerFontSize: '11px',\n              rowFontSize: '10px',\n              shadow: '0 4px 16px rgba(34, 197, 94, 0.3)',\n              borderRadius: '6px'\n            },\n            ruby_red: {\n              gradient: 'linear-gradient(135deg, #b91c1c 0%, #f87171 100%)',\n              headerBorder: '#dc2626',\n              rowBorder: '#fecaca',\n              altRowBg: '#fef2f2',\n              borderWidth: 1.5,\n              headerTextColor: '#ffffff',\n              rowTextColor: '#b91c1b',\n              headerFontWeight: '600',\n              headerFontSize: '11px',\n              rowFontSize: '10px',\n              shadow: '0 4px 16px rgba(248, 113, 113, 0.3)',\n              borderRadius: '6px'\n            },\n            golden_yellow: {\n              gradient: 'linear-gradient(135deg, #a16207 0%, #eab308 100%)',\n              headerBorder: '#ca8a04',\n              rowBorder: '#fef08a',\n              altRowBg: '#fefce8',\n              borderWidth: 1.5,\n              headerTextColor: '#ffffff',\n              rowTextColor: '#a16207',\n              headerFontWeight: '600',\n              headerFontSize: '11px',\n              rowFontSize: '10px',\n              shadow: '0 4px 16px rgba(234, 179, 8, 0.3)',\n              borderRadius: '6px'\n            },\n            navy_blue: {\n              gradient: 'linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%)',\n              headerBorder: '#1e40af',\n              rowBorder: '#dbeafe',\n              altRowBg: '#eff6ff',\n              borderWidth: 1.5,\n              headerTextColor: '#ffffff',\n              rowTextColor: '#1e3a8a',\n              headerFontWeight: '600',\n              headerFontSize: '11px',\n              rowFontSize: '10px',\n              shadow: '0 4px 16px rgba(59, 130, 246, 0.3)',\n              borderRadius: '6px'\n            },\n            burgundy_wine: {\n              gradient: 'linear-gradient(135deg, #7f1d1d 0%, #dc2626 100%)',\n              headerBorder: '#991b1b',\n              rowBorder: '#fecaca',\n              altRowBg: '#fef2f2',\n              borderWidth: 1.5,\n              headerTextColor: '#ffffff',\n              rowTextColor: '#7f1d1d',\n              headerFontWeight: '600',\n              headerFontSize: '11px',\n              rowFontSize: '10px',\n              shadow: '0 4px 16px rgba(220, 38, 38, 0.3)',\n              borderRadius: '6px'\n            },\n            lavender_purple: {\n              gradient: 'linear-gradient(135deg, #7c2d12 0%, #a855f7 100%)',\n              headerBorder: '#9333ea',\n              rowBorder: '#e9d5ff',\n              altRowBg: '#faf5ff',\n              borderWidth: 1.5,\n              headerTextColor: '#ffffff',\n              rowTextColor: '#7c2d12',\n              headerFontWeight: '600',\n              headerFontSize: '11px',\n              rowFontSize: '10px',\n              shadow: '0 4px 16px rgba(168, 85, 247, 0.3)',\n              borderRadius: '6px'\n            },\n            ocean_teal: {\n              gradient: 'linear-gradient(135deg, #134e4a 0%, #14b8a6 100%)',\n              headerBorder: '#0f766e',\n              rowBorder: '#ccfbf1',\n              altRowBg: '#f0fdfa',\n              borderWidth: 1.5,\n              headerTextColor: '#ffffff',\n              rowTextColor: '#134e4a',\n              headerFontWeight: '600',\n              headerFontSize: '11px',\n              rowFontSize: '10px',\n              shadow: '0 4px 16px rgba(20, 184, 166, 0.3)',\n              borderRadius: '6px'\n            },\n            cherry_blossom: {\n              gradient: 'linear-gradient(135deg, #be185d 0%, #fb7185 100%)',\n              headerBorder: '#db2777',\n              rowBorder: '#fce7f3',\n              altRowBg: '#fdf2f8',\n              borderWidth: 1.5,\n              headerTextColor: '#ffffff',\n              rowTextColor: '#be185d',\n              headerFontWeight: '600',\n              headerFontSize: '11px',\n              rowFontSize: '10px',\n              shadow: '0 4px 16px rgba(251, 113, 133, 0.3)',\n              borderRadius: '6px'\n            },\n            autumn_orange: {\n              gradient: 'linear-gradient(135deg, #9a3412 0%, #fb923c 100%)',\n              headerBorder: '#ea580c',\n              rowBorder: '#fed7aa',\n              altRowBg: '#fff7ed',\n              borderWidth: 1.5,\n              headerTextColor: '#ffffff',\n              rowTextColor: '#9a3412',\n              headerFontWeight: '600',\n              headerFontSize: '11px',\n              rowFontSize: '10px',\n              shadow: '0 4px 16px rgba(251, 146, 60, 0.3)',\n              borderRadius: '6px'\n            }\n          };\n          return baseStyles[tableStyle] || baseStyles[\"default\"];\n        };\n        var tableStyles = getTableStyles(element.tableStyle);\n        var showHeaders = element.showHeaders !== false;\n        var showBorders = element.showBorders !== false;\n        var columns = element.columns || {\n          image: false,\n          name: true,\n          sku: false,\n          quantity: true,\n          price: true,\n          total: true\n        };\n        var headers = element.headers || ['Produit', 'Qté', 'Prix'];\n\n        // Fonction pour obtenir l'en-tête d'une colonne\n        var getColumnHeader = function getColumnHeader(columnType) {\n          var defaultHeaders = {\n            image: 'Img',\n            name: headers[0] || 'Produit',\n            sku: 'SKU',\n            quantity: headers[1] || 'Qté',\n            price: headers[2] || 'Prix',\n            total: 'Total'\n          };\n          return defaultHeaders[columnType] || columnType;\n        };\n\n        // Données d'exemple pour l'aperçu\n        var products = [{\n          name: 'Produit A - Description',\n          sku: 'SKU001',\n          quantity: 2,\n          price: 19.99,\n          total: 39.98\n        }, {\n          name: 'Produit B - Article',\n          sku: 'SKU002',\n          quantity: 1,\n          price: 29.99,\n          total: 29.99\n        }];\n\n        // Calcul des totaux\n        var subtotal = products.reduce(function (sum, product) {\n          return sum + product.total;\n        }, 0);\n        var shipping = element.showShipping ? 5.00 : 0;\n        var tax = element.showTaxes ? 2.25 : 0;\n        var discount = element.showDiscount ? -5.00 : 0;\n        var total = subtotal + shipping + tax + discount;\n\n        // Déterminer la dernière colonne visible pour les totaux\n        var getLastVisibleColumn = function getLastVisibleColumn() {\n          var columnKeys = ['image', 'name', 'sku', 'quantity', 'price', 'total'];\n          for (var i = columnKeys.length - 1; i >= 0; i--) {\n            if (columns[columnKeys[i]] !== false) {\n              return columnKeys[i];\n            }\n          }\n          return 'total';\n        };\n        var lastVisibleColumn = getLastVisibleColumn();\n        return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n          style: {\n            width: '100%',\n            height: '100%',\n            display: 'flex',\n            flexDirection: 'column',\n            fontSize: \"\".concat((element.fontSize || 10) * zoom, \"px\"),\n            fontFamily: element.fontFamily || 'Arial, sans-serif',\n            border: showBorders ? \"\".concat(tableStyles.borderWidth * zoom, \"px solid \").concat(tableStyles.headerBorder) : element.borderWidth && element.borderWidth > 0 ? \"\".concat(Math.max(1, element.borderWidth * 0.5) * zoom, \"px solid \").concat(element.borderColor || '#e5e7eb') : 'none',\n            borderRadius: \"\".concat((element.borderRadius || 2) * zoom, \"px\"),\n            overflow: 'hidden',\n            backgroundColor: element.backgroundColor || 'transparent',\n            boxSizing: 'border-box',\n            boxShadow: tableStyles.shadow && element.tableStyle === 'modern' ? \"0 4px 8px \".concat(tableStyles.shadow) : 'none'\n          }\n        }, showHeaders && /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n          style: {\n            display: 'flex',\n            background: tableStyles.gradient || tableStyles.headerBg,\n            borderBottom: showBorders ? \"\".concat(tableStyles.borderWidth * zoom, \"px solid \").concat(tableStyles.headerBorder) : 'none',\n            fontWeight: 'bold',\n            color: tableStyles.headerTextColor || (element.tableStyle === 'modern' ? '#ffffff' : '#000000'),\n            boxShadow: tableStyles.shadow ? \"0 2px 4px \".concat(tableStyles.shadow) : 'none'\n          }\n        }, columns.image && /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n          style: {\n            flex: \"0 0 \".concat(40 * zoom, \"px\"),\n            padding: \"\".concat(4 * zoom, \"px\"),\n            textAlign: 'center',\n            borderRight: showBorders ? \"\".concat(tableStyles.borderWidth * zoom, \"px solid \").concat(tableStyles.headerBorder) : 'none'\n          }\n        }, getColumnHeader('image')), columns.name && /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n          style: {\n            flex: 1,\n            padding: \"\".concat(4 * zoom, \"px \").concat(6 * zoom, \"px\"),\n            textAlign: 'left',\n            borderRight: showBorders ? \"\".concat(tableStyles.borderWidth * zoom, \"px solid \").concat(tableStyles.headerBorder) : 'none'\n          }\n        }, getColumnHeader('name')), columns.sku && /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n          style: {\n            flex: \"0 0 \".concat(80 * zoom, \"px\"),\n            padding: \"\".concat(4 * zoom, \"px \").concat(6 * zoom, \"px\"),\n            textAlign: 'left',\n            borderRight: showBorders ? \"\".concat(tableStyles.borderWidth * zoom, \"px solid \").concat(tableStyles.headerBorder) : 'none'\n          }\n        }, getColumnHeader('sku')), columns.quantity && /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n          style: {\n            flex: \"0 0 \".concat(60 * zoom, \"px\"),\n            padding: \"\".concat(4 * zoom, \"px \").concat(6 * zoom, \"px\"),\n            textAlign: 'center',\n            borderRight: showBorders ? \"\".concat(tableStyles.borderWidth * zoom, \"px solid \").concat(tableStyles.headerBorder) : 'none'\n          }\n        }, getColumnHeader('quantity')), columns.price && /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n          style: {\n            flex: \"0 0 \".concat(80 * zoom, \"px\"),\n            padding: \"\".concat(4 * zoom, \"px \").concat(6 * zoom, \"px\"),\n            textAlign: 'right',\n            borderRight: showBorders ? \"\".concat(tableStyles.borderWidth * zoom, \"px solid \").concat(tableStyles.headerBorder) : 'none'\n          }\n        }, getColumnHeader('price')), columns.total && /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n          style: {\n            flex: '0 0 80px',\n            padding: \"\".concat(4 * zoom, \"px \").concat(6 * zoom, \"px\"),\n            textAlign: 'right'\n          }\n        }, getColumnHeader('total'))), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n          style: {\n            flex: 1,\n            display: 'flex',\n            flexDirection: 'column'\n          }\n        }, products.map(function (product, index) {\n          return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n            key: index,\n            style: {\n              display: 'flex',\n              borderBottom: showBorders ? \"\".concat(tableStyles.borderWidth, \"px solid \").concat(tableStyles.rowBorder) : 'none',\n              backgroundColor: element.tableStyle === 'striped' && index % 2 === 1 ? tableStyles.altRowBg : 'transparent',\n              color: tableStyles.rowTextColor || '#000000',\n              boxShadow: tableStyles.shadow ? \"0 1px 2px \".concat(tableStyles.shadow) : 'none'\n            }\n          }, columns.image && /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n            style: {\n              flex: \"0 0 \".concat(40 * zoom, \"px\"),\n              padding: \"\".concat(4 * zoom, \"px\"),\n              textAlign: 'center',\n              borderRight: showBorders ? \"\".concat(tableStyles.borderWidth * zoom, \"px solid \").concat(tableStyles.rowBorder) : 'none'\n            }\n          }, \"\\uD83D\\uDCF7\"), columns.name && /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n            style: {\n              flex: 1,\n              padding: \"\".concat(4 * zoom, \"px \").concat(6 * zoom, \"px\"),\n              borderRight: showBorders ? \"\".concat(tableStyles.borderWidth * zoom, \"px solid \").concat(tableStyles.rowBorder) : 'none'\n            }\n          }, product.name), columns.sku && /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n            style: {\n              flex: \"0 0 \".concat(80 * zoom, \"px\"),\n              padding: \"\".concat(4 * zoom, \"px \").concat(6 * zoom, \"px\"),\n              borderRight: showBorders ? \"\".concat(tableStyles.borderWidth * zoom, \"px solid \").concat(tableStyles.rowBorder) : 'none'\n            }\n          }, product.sku), columns.quantity && /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n            style: {\n              flex: \"0 0 \".concat(60 * zoom, \"px\"),\n              padding: \"\".concat(4 * zoom, \"px \").concat(6 * zoom, \"px\"),\n              textAlign: 'center',\n              borderRight: showBorders ? \"\".concat(tableStyles.borderWidth * zoom, \"px solid \").concat(tableStyles.rowBorder) : 'none'\n            }\n          }, product.quantity), columns.price && /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n            style: {\n              flex: \"0 0 \".concat(80 * zoom, \"px\"),\n              padding: \"\".concat(4 * zoom, \"px \").concat(6 * zoom, \"px\"),\n              textAlign: 'right',\n              borderRight: showBorders ? \"\".concat(tableStyles.borderWidth * zoom, \"px solid \").concat(tableStyles.rowBorder) : 'none'\n            }\n          }, product.price.toFixed(2), \"\\u20AC\"), columns.total && /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n            style: {\n              flex: \"0 0 \".concat(80 * zoom, \"px\"),\n              padding: \"\".concat(4 * zoom, \"px \").concat(6 * zoom, \"px\"),\n              textAlign: 'right'\n            }\n          }, product.total.toFixed(2), \"\\u20AC\"));\n        })), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n          style: {\n            borderTop: showBorders ? \"\".concat(tableStyles.borderWidth, \"px solid \").concat(tableStyles.headerBorder) : 'none'\n          }\n        }, element.showSubtotal && /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n          style: {\n            display: 'flex',\n            justifyContent: 'flex-end',\n            padding: \"\".concat(4 * zoom, \"px \").concat(6 * zoom, \"px\"),\n            fontWeight: 'bold'\n          }\n        }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n          style: {\n            width: \"\".concat(80 * zoom, \"px\"),\n            textAlign: 'right'\n          }\n        }, \"Sous-total: \", subtotal.toFixed(2), \"\\u20AC\")), element.showShipping && shipping > 0 && /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n          style: {\n            display: 'flex',\n            justifyContent: 'flex-end',\n            padding: \"\".concat(4 * zoom, \"px \").concat(6 * zoom, \"px\")\n          }\n        }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n          style: {\n            width: \"\".concat(80 * zoom, \"px\"),\n            textAlign: 'right'\n          }\n        }, \"Port: \", shipping.toFixed(2), \"\\u20AC\")), element.showTaxes && tax > 0 && /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n          style: {\n            display: 'flex',\n            justifyContent: 'flex-end',\n            padding: \"\".concat(4 * zoom, \"px \").concat(6 * zoom, \"px\")\n          }\n        }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n          style: {\n            width: \"\".concat(80 * zoom, \"px\"),\n            textAlign: 'right'\n          }\n        }, \"TVA: \", tax.toFixed(2), \"\\u20AC\")), element.showDiscount && discount < 0 && /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n          style: {\n            display: 'flex',\n            justifyContent: 'flex-end',\n            padding: \"\".concat(4 * zoom, \"px \").concat(6 * zoom, \"px\")\n          }\n        }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n          style: {\n            width: \"\".concat(80 * zoom, \"px\"),\n            textAlign: 'right'\n          }\n        }, \"Remise: \", Math.abs(discount).toFixed(2), \"\\u20AC\")), element.showTotal && /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n          style: {\n            display: 'flex',\n            justifyContent: 'flex-end',\n            padding: \"\".concat(4 * zoom, \"px \").concat(6 * zoom, \"px\"),\n            fontWeight: 'bold',\n            background: tableStyles.gradient || tableStyles.headerBg,\n            color: tableStyles.headerTextColor || (element.tableStyle === 'modern' ? '#ffffff' : '#000000'),\n            boxShadow: tableStyles.shadow ? \"0 2px 4px \".concat(tableStyles.shadow) : 'none'\n          }\n        }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n          style: {\n            width: \"\".concat(80 * zoom, \"px\"),\n            textAlign: 'right'\n          }\n        }, \"TOTAL: \", total.toFixed(2), \"\\u20AC\"))));\n      case 'customer_info':\n        // Rendu dynamique des informations client utilisant les propriétés de l'élément\n        var customerFields = element.fields || ['name', 'email', 'phone', 'address', 'company', 'vat', 'siret'];\n        var showLabels = element.showLabels !== false;\n        var layout = element.layout || 'vertical';\n        var alignment = element.alignment || 'left';\n        var spacing = element.spacing || 3;\n\n        // Données fictives pour l'aperçu (seront remplacées par les vraies données lors de la génération)\n        var customerData = {\n          name: 'Jean Dupont',\n          company: 'ABC Company SARL',\n          address: '123 Rue de la Paix\\n75001 Paris\\nFrance',\n          email: 'jean.dupont@email.com',\n          phone: '+33 6 12 34 56 78',\n          tva: 'FR 12 345 678 901',\n          siret: '123 456 789 00012',\n          website: 'www.abc-company.com'\n        };\n        var containerStyle = {\n          padding: \"\".concat(8 * zoom, \"px\"),\n          fontSize: (element.fontSize || 12) * zoom,\n          lineHeight: element.lineHeight || '1.4',\n          color: element.color || '#1e293b',\n          fontFamily: element.fontFamily || 'Inter, sans-serif',\n          textAlign: alignment,\n          display: layout === 'horizontal' ? 'flex' : 'block',\n          flexWrap: layout === 'horizontal' ? 'wrap' : 'nowrap',\n          gap: layout === 'horizontal' ? \"\".concat(spacing * zoom, \"px\") : '0'\n        };\n        return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n          style: containerStyle\n        }, customerFields.map(function (field, index) {\n          var fieldData = customerData[field];\n          if (!fieldData) return null;\n          var fieldStyle = layout === 'horizontal' ? {\n            flex: '1',\n            minWidth: \"\".concat(120 * zoom, \"px\")\n          } : {\n            marginBottom: index < customerFields.length - 1 ? \"\".concat(spacing * zoom, \"px\") : '0',\n            display: 'flex',\n            alignItems: 'flex-start'\n          };\n          return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n            key: field,\n            style: fieldStyle\n          }, showLabels && /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n            style: {\n              fontWeight: element.labelStyle === 'bold' ? 'bold' : 'normal',\n              marginBottom: layout === 'horizontal' ? \"\".concat(2 * zoom, \"px\") : '0',\n              marginRight: layout === 'horizontal' ? '0' : \"\".concat(8 * zoom, \"px\"),\n              fontSize: \"\".concat(11 * zoom, \"px\"),\n              opacity: 0.8,\n              minWidth: layout === 'horizontal' ? 'auto' : \"\".concat(80 * zoom, \"px\"),\n              flexShrink: 0\n            }\n          }, field === 'name' && 'Client', field === 'company' && 'Entreprise', field === 'address' && 'Adresse', field === 'email' && 'Email', field === 'phone' && 'Téléphone', field === 'tva' && 'N° TVA', field === 'siret' && 'SIRET', field === 'website' && 'Site web', \":\"), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n            style: {\n              whiteSpace: 'pre-line',\n              fontSize: (element.fontSize || 12) * zoom,\n              flex: layout === 'horizontal' ? '1' : 'auto'\n            }\n          }, fieldData));\n        }));\n      case 'company_info':\n        // Rendu dynamique des informations entreprise utilisant les propriétés de l'élément\n        var companyFields = element.fields || ['name', 'address', 'phone', 'email', 'website', 'vat', 'rcs', 'siret'];\n        var showCompanyLabels = element.showLabels !== false;\n        var companyLayout = element.layout || 'vertical';\n        var companyAlignment = element.alignment || 'left';\n        var companySpacing = element.spacing || 3;\n\n        // Données fictives pour l'aperçu (seront remplacées par les vraies données lors de la génération)\n        var companyData = {\n          name: 'ABC Company SARL',\n          address: '456 Avenue des Champs\\n75008 Paris\\nFrance',\n          phone: '01 23 45 67 89',\n          email: 'contact@abc-company.com',\n          tva: 'FR 98 765 432 109',\n          siret: '987 654 321 00098',\n          rcs: 'Paris B 123 456 789',\n          website: 'www.abc-company.com'\n        };\n        var companyContainerStyle = {\n          padding: \"\".concat(8 * zoom, \"px\"),\n          fontSize: (element.fontSize || 12) * zoom,\n          lineHeight: element.lineHeight || '1.4',\n          color: element.color || '#1e293b',\n          fontFamily: element.fontFamily || 'Inter, sans-serif',\n          textAlign: companyAlignment,\n          display: companyLayout === 'horizontal' ? 'flex' : 'block',\n          flexWrap: companyLayout === 'horizontal' ? 'wrap' : 'nowrap',\n          gap: companyLayout === 'horizontal' ? \"\".concat(companySpacing * zoom, \"px\") : '0'\n        };\n        return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n          style: companyContainerStyle\n        }, companyFields.map(function (field, index) {\n          var fieldData = companyData[field];\n          if (!fieldData) return null;\n          var companyFieldStyle = companyLayout === 'horizontal' ? {\n            flex: '1',\n            minWidth: \"\".concat(120 * zoom, \"px\")\n          } : {\n            marginBottom: index < companyFields.length - 1 ? \"\".concat(companySpacing * zoom, \"px\") : '0',\n            display: 'flex',\n            alignItems: 'flex-start'\n          };\n          return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n            key: field,\n            style: companyFieldStyle\n          }, showCompanyLabels && /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n            style: {\n              fontWeight: element.labelStyle === 'bold' ? 'bold' : 'normal',\n              marginBottom: companyLayout === 'horizontal' ? \"\".concat(2 * zoom, \"px\") : '0',\n              marginRight: companyLayout === 'horizontal' ? '0' : \"\".concat(8 * zoom, \"px\"),\n              fontSize: \"\".concat(11 * zoom, \"px\"),\n              opacity: 0.8,\n              minWidth: companyLayout === 'horizontal' ? 'auto' : \"\".concat(80 * zoom, \"px\"),\n              flexShrink: 0\n            }\n          }, field === 'name' && 'Entreprise', field === 'address' && 'Adresse', field === 'phone' && 'Téléphone', field === 'email' && 'Email', field === 'tva' && 'N° TVA', field === 'siret' && 'SIRET', field === 'rcs' && 'RCS', field === 'website' && 'Site web', \":\"), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n            style: {\n              whiteSpace: 'pre-line',\n              fontSize: (element.fontSize || 12) * zoom,\n              flex: companyLayout === 'horizontal' ? '1' : 'auto'\n            }\n          }, fieldData));\n        }));\n      case 'company_logo':\n        return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n          style: {\n            width: '100%',\n            height: '100%',\n            display: 'flex',\n            alignItems: 'center',\n            justifyContent: 'center',\n            padding: \"\".concat((element.padding || 8) * zoom, \"px\"),\n            backgroundColor: element.backgroundColor || 'transparent',\n            borderRadius: (element.borderRadius || 0) * zoom,\n            border: element.borderWidth ? \"\".concat(element.borderWidth * zoom, \"px solid \").concat(element.borderColor || '#e5e7eb') : 'none'\n          }\n        }, element.imageUrl || element.src ? /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"img\", {\n          src: element.imageUrl || element.src,\n          alt: element.alt || \"Logo entreprise\",\n          style: {\n            maxWidth: '100%',\n            maxHeight: '100%',\n            objectFit: element.objectFit || 'contain'\n          }\n        }) : /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n          style: {\n            width: '100%',\n            height: '100%',\n            backgroundColor: '#f0f0f0',\n            border: \"\".concat(2 * zoom, \"px dashed #ccc\"),\n            display: 'flex',\n            alignItems: 'center',\n            justifyContent: 'center',\n            color: '#666',\n            fontSize: (element.fontSize || 12) * zoom\n          }\n        }, \"\\uD83C\\uDFE2 Logo\"));\n      case 'order_number':\n        return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n          style: {\n            padding: \"\".concat((element.padding || 8) * zoom, \"px\"),\n            fontSize: (element.fontSize || 14) * zoom,\n            fontWeight: element.fontWeight || 'bold',\n            color: element.color || '#333',\n            fontFamily: element.fontFamily || 'Inter, sans-serif',\n            textAlign: element.textAlign || 'left',\n            backgroundColor: element.backgroundColor || 'transparent',\n            borderRadius: (element.borderRadius || 0) * zoom,\n            border: element.borderWidth ? \"\".concat(element.borderWidth * zoom, \"px solid \").concat(element.borderColor || '#e5e7eb') : 'none'\n          }\n        }, element.showLabel !== false && /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n          style: {\n            fontSize: (element.fontSize || 14) * 0.8 * zoom,\n            color: element.labelColor || '#666',\n            marginBottom: \"\".concat(2 * zoom, \"px\"),\n            fontWeight: 'normal'\n          }\n        }, element.label || 'N° de commande', \":\"), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n          style: {\n            fontSize: (element.fontSize || 14) * zoom,\n            fontWeight: element.fontWeight || 'bold'\n          }\n        }, element.prefix || 'CMD-', element.orderNumber || '2025-00123'));\n      case 'document_type':\n        return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n          style: {\n            padding: \"\".concat((element.padding || 8) * zoom, \"px\"),\n            fontSize: \"\".concat((element.fontSize || 18) * zoom, \"px\"),\n            fontWeight: element.fontWeight || 'bold',\n            color: element.color || '#1e293b',\n            fontFamily: element.fontFamily || 'Inter, sans-serif',\n            textAlign: element.textAlign || 'center',\n            backgroundColor: element.backgroundColor || 'transparent',\n            borderRadius: (element.borderRadius || 0) * zoom\n          }\n        }, element.documentType === 'invoice' ? 'FACTURE' : element.documentType === 'quote' ? 'DEVIS' : element.documentType === 'receipt' ? 'REÇU' : element.documentType === 'order' ? 'COMMANDE' : element.documentType === 'credit_note' ? 'AVOIR' : 'DOCUMENT');\n      case 'progress-bar':\n        return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n          style: {\n            width: '100%',\n            height: (element.height || 20) * zoom,\n            backgroundColor: element.backgroundColor || '#e5e7eb',\n            borderRadius: (element.borderRadius || 10) * zoom,\n            overflow: 'hidden',\n            border: element.borderWidth ? \"\".concat(element.borderWidth * zoom, \"px solid \").concat(element.borderColor || '#d1d5db') : 'none'\n          }\n        }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n          style: {\n            width: \"\".concat(Math.min(100, Math.max(0, element.progressValue || 75)), \"%\"),\n            height: '100%',\n            backgroundColor: element.progressColor || '#3b82f6',\n            borderRadius: (element.borderRadius || 10) * zoom,\n            transition: element.animate !== false ? 'width 0.3s ease' : 'none'\n          }\n        }));\n      default:\n        return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n          style: {\n            width: '100%',\n            height: '100%',\n            backgroundColor: '#f0f0f0',\n            border: \"\".concat(1 * zoom, \"px dashed #ccc\"),\n            display: 'flex',\n            alignItems: 'center',\n            justifyContent: 'center',\n            fontSize: \"\".concat(12 * zoom, \"px\"),\n            color: '#666',\n            padding: \"\".concat(4 * zoom, \"px\"),\n            boxSizing: 'border-box'\n          }\n        }, element.type || 'Élément inconnu');\n    }\n  }, []);\n\n  // Générer l'aperçu quand la modale s'ouvre\n  (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(function () {\n    if (isOpen && elements.length > 0) {\n      if (useServerPreview) {\n        // Utiliser l'aperçu unifié côté serveur\n        generateServerPreview();\n      } else {\n        // Afficher immédiatement le contenu du canvas\n        setPreviewData({\n          success: true,\n          elements_count: elements.length,\n          width: 400,\n          height: 566,\n          fallback: false\n        });\n        // Puis générer l'aperçu côté serveur en arrière-plan\n        generatePreview();\n      }\n    } else if (isOpen && elements.length === 0) {\n      setPreviewData({\n        success: true,\n        elements_count: 0,\n        width: 400,\n        height: 566,\n        fallback: false\n      });\n    }\n  }, [isOpen, elements.length, useServerPreview]);\n  var generatePreview = /*#__PURE__*/function () {\n    var _ref4 = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee() {\n      var _window$pdfBuilderAja, ajaxUrl, nonceFormData, nonceResponse, nonceData, freshNonce, _cleanElementsForJSON, validationResult, jsonString, cleanedElements, formData, response, data, responseText, errorMessage, _t, _t2;\n      return _regenerator().w(function (_context) {\n        while (1) switch (_context.p = _context.n) {\n          case 0:\n            // Ne pas définir loading=true car l'aperçu s'affiche déjà\n            setError(null);\n            _context.p = 1;\n            // Vérifier que les variables AJAX sont disponibles\n            ajaxUrl = ((_window$pdfBuilderAja = window.pdfBuilderAjax) === null || _window$pdfBuilderAja === void 0 ? void 0 : _window$pdfBuilderAja.ajaxurl) || ajaxurl;\n            if (ajaxUrl) {\n              _context.n = 2;\n              break;\n            }\n            console.warn('Variables AJAX non disponibles pour validation côté serveur');\n            return _context.a(2);\n          case 2:\n            // Obtenir un nonce frais\n            nonceFormData = new FormData();\n            nonceFormData.append('action', 'pdf_builder_get_fresh_nonce');\n            _context.n = 3;\n            return fetch(ajaxUrl, {\n              method: 'POST',\n              body: nonceFormData\n            });\n          case 3:\n            nonceResponse = _context.v;\n            if (nonceResponse.ok) {\n              _context.n = 4;\n              break;\n            }\n            console.warn('Erreur obtention nonce pour validation:', nonceResponse.status);\n            return _context.a(2);\n          case 4:\n            _context.n = 5;\n            return nonceResponse.json();\n          case 5:\n            nonceData = _context.v;\n            if (nonceData.success) {\n              _context.n = 6;\n              break;\n            }\n            console.warn('Impossible d\\'obtenir un nonce frais pour validation');\n            return _context.a(2);\n          case 6:\n            freshNonce = nonceData.data.nonce; // Fonction pour nettoyer les éléments avant sérialisation JSON\n            _cleanElementsForJSON = function _cleanElementsForJSON(elements) {\n              return elements.map(function (element) {\n                var cleaned = _objectSpread({}, element);\n\n                // Supprimer les propriétés non sérialisables\n                var propertiesToRemove = ['reactKey', 'tempId', 'style', '_internalId', 'ref', 'key'];\n                propertiesToRemove.forEach(function (prop) {\n                  delete cleaned[prop];\n                });\n\n                // Nettoyer récursivement tous les objets imbriqués\n                var _cleanObject = function cleanObject(obj) {\n                  if (obj === null || _typeof(obj) !== 'object') {\n                    return obj;\n                  }\n                  if (Array.isArray(obj)) {\n                    return obj.map(_cleanObject);\n                  }\n                  var cleanedObj = {};\n                  for (var key in obj) {\n                    if (obj.hasOwnProperty(key)) {\n                      var value = obj[key];\n\n                      // Ignorer les fonctions, symboles, et objets complexes\n                      if (typeof value === 'function' || _typeof(value) === 'symbol' || _typeof(value) === 'object' && value !== null && !Array.isArray(value) && !(value instanceof Date) && !(value instanceof RegExp)) {\n                        continue; // Skip this property\n                      }\n\n                      // Nettoyer récursivement\n                      cleanedObj[key] = _cleanObject(value);\n                    }\n                  }\n                  return cleanedObj;\n                };\n\n                // Appliquer le nettoyage récursif\n                var fullyCleaned = _cleanObject(cleaned);\n\n                // S'assurer que les propriétés numériques sont des nombres\n                ['x', 'y', 'width', 'height', 'fontSize', 'borderWidth', 'borderRadius'].forEach(function (prop) {\n                  if (fullyCleaned[prop] !== undefined && fullyCleaned[prop] !== null) {\n                    var num = parseFloat(fullyCleaned[prop]);\n                    if (!isNaN(num)) {\n                      fullyCleaned[prop] = num;\n                    } else {\n                      delete fullyCleaned[prop]; // Supprimer si pas un nombre valide\n                    }\n                  }\n                });\n\n                // S'assurer que les propriétés boolean sont des booléens\n                ['showLabels', 'showHeaders', 'showBorders', 'showSubtotal', 'showShipping', 'showTaxes', 'showDiscount', 'showTotal'].forEach(function (prop) {\n                  if (fullyCleaned[prop] !== undefined) {\n                    fullyCleaned[prop] = Boolean(fullyCleaned[prop]);\n                  }\n                });\n\n                // S'assurer que les chaînes sont des chaînes\n                ['id', 'type', 'content', 'text', 'color', 'backgroundColor', 'borderColor', 'fontFamily', 'fontWeight', 'fontStyle', 'textDecoration', 'textAlign', 'borderStyle'].forEach(function (prop) {\n                  if (fullyCleaned[prop] !== undefined && fullyCleaned[prop] !== null) {\n                    fullyCleaned[prop] = String(fullyCleaned[prop]);\n                  }\n                });\n                return fullyCleaned;\n              });\n            }; // Validation côté client avant envoi\n            validationResult = validateElementsBeforeSend(elements);\n            if (validationResult.success) {\n              _context.n = 7;\n              break;\n            }\n            console.error('❌ Validation côté client échouée:', validationResult.error);\n            setPreviewData(function (prev) {\n              return _objectSpread(_objectSpread({}, prev), {}, {\n                error: \"Erreur de validation c\\xF4t\\xE9 client: \".concat(validationResult.error),\n                isLoading: false\n              });\n            });\n            return _context.a(2);\n          case 7:\n            jsonString = validationResult.jsonString, cleanedElements = validationResult.cleanedElements; // Préparer les données pour l'AJAX\n            formData = new FormData();\n            formData.append('action', 'pdf_builder_validate_preview');\n            formData.append('nonce', freshNonce);\n            formData.append('elements', jsonString);\n\n            // Faire l'appel AJAX en arrière-plan\n            _context.n = 8;\n            return fetch(ajaxUrl, {\n              method: 'POST',\n              body: formData\n            });\n          case 8:\n            response = _context.v;\n            if (response.ok) {\n              _context.n = 9;\n              break;\n            }\n            console.warn('Erreur HTTP validation aperçu:', response.status);\n            return _context.a(2);\n          case 9:\n            _context.p = 9;\n            _context.n = 10;\n            return response.json();\n          case 10:\n            data = _context.v;\n            _context.n = 13;\n            break;\n          case 11:\n            _context.p = 11;\n            _t = _context.v;\n            console.error('❌ Erreur parsing JSON réponse serveur:', _t);\n            _context.n = 12;\n            return response.text();\n          case 12:\n            responseText = _context.v;\n            console.error('Contenu brut de la réponse:', responseText.substring(0, 500));\n            // Garder l'aperçu local mais marquer l'erreur\n            setPreviewData(function (prev) {\n              return _objectSpread(_objectSpread({}, prev), {}, {\n                server_error: 'Réponse serveur invalide (pas du JSON)'\n              });\n            });\n            return _context.a(2);\n          case 13:\n            if (data.success) {\n              // Mettre à jour previewData avec les données du serveur si nécessaire\n              setPreviewData(function (prev) {\n                return _objectSpread(_objectSpread(_objectSpread({}, prev), data.data), {}, {\n                  server_validated: true\n                });\n              });\n            } else {\n              console.warn('⚠️ Validation aperçu côté serveur échouée:', data.data);\n              // Garder l'aperçu local mais marquer qu'il y a un problème serveur\n              // S'assurer que server_error est toujours une chaîne\n              errorMessage = 'Erreur validation serveur';\n              if (typeof data.data === 'string') {\n                errorMessage = data.data;\n              } else if (data.data && _typeof(data.data) === 'object' && data.data.message) {\n                errorMessage = data.data.message;\n              } else if (data.data && _typeof(data.data) === 'object') {\n                errorMessage = JSON.stringify(data.data);\n              }\n              setPreviewData(function (prev) {\n                return _objectSpread(_objectSpread({}, prev), {}, {\n                  server_error: errorMessage\n                });\n              });\n            }\n            _context.n = 15;\n            break;\n          case 14:\n            _context.p = 14;\n            _t2 = _context.v;\n            console.warn('Erreur validation aperçu côté serveur:', _t2);\n            // Ne pas afficher d'erreur car l'aperçu local fonctionne\n            setPreviewData(function (prev) {\n              return _objectSpread(_objectSpread({}, prev), {}, {\n                server_error: _t2.message || 'Erreur inconnue côté serveur'\n              });\n            });\n          case 15:\n            return _context.a(2);\n        }\n      }, _callee, null, [[9, 11], [1, 14]]);\n    }));\n    return function generatePreview() {\n      return _ref4.apply(this, arguments);\n    };\n  }();\n  var generateServerPreview = /*#__PURE__*/function () {\n    var _ref5 = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee2() {\n      var fallbackTimeout, _window$pdfBuilderAja2, _window$pdfBuilderAja3, validationResult, jsonString, ajaxUrl, nonceFormData, nonceResponse, nonceData, freshNonce, formData, response, data, _t3;\n      return _regenerator().w(function (_context2) {\n        while (1) switch (_context2.p = _context2.n) {\n          case 0:\n            setLoading(true);\n            setError(null);\n            setPreviewData(null);\n\n            // Timeout de fallback - si l'aperçu côté serveur prend trop de temps, afficher l'aperçu côté client\n            fallbackTimeout = setTimeout(function () {\n              setPreviewData({\n                success: true,\n                elements_count: elements.length,\n                width: canvasWidth,\n                height: canvasHeight,\n                fallback: true,\n                server_timeout: true\n              });\n              setLoading(false);\n            }, 10000); // 10 secondes timeout\n            _context2.p = 1;\n            // Validation côté client avant envoi\n            validationResult = validateElementsBeforeSend(elements);\n            if (validationResult.success) {\n              _context2.n = 2;\n              break;\n            }\n            console.error('❌ Validation côté client échouée:', validationResult.error);\n            setPreviewData(function (prev) {\n              return _objectSpread(_objectSpread({}, prev), {}, {\n                error: \"Erreur de validation c\\xF4t\\xE9 client: \".concat(validationResult.error),\n                isLoading: false\n              });\n            });\n            return _context2.a(2);\n          case 2:\n            jsonString = validationResult.jsonString; // Vérifier que les variables AJAX sont disponibles\n            ajaxUrl = ((_window$pdfBuilderAja2 = window.pdfBuilderAjax) === null || _window$pdfBuilderAja2 === void 0 ? void 0 : _window$pdfBuilderAja2.ajaxurl) || ajaxurl;\n            if (ajaxUrl) {\n              _context2.n = 3;\n              break;\n            }\n            alert('Erreur: Variables AJAX non disponibles. Rechargez la page.');\n            return _context2.a(2);\n          case 3:\n            // Obtenir un nonce frais pour l'aperçu\n            nonceFormData = new FormData();\n            nonceFormData.append('action', 'pdf_builder_get_fresh_nonce');\n            _context2.n = 4;\n            return fetch(ajaxUrl, {\n              method: 'POST',\n              body: nonceFormData\n            });\n          case 4:\n            nonceResponse = _context2.v;\n            if (nonceResponse.ok) {\n              _context2.n = 5;\n              break;\n            }\n            throw new Error(\"Erreur HTTP nonce: \".concat(nonceResponse.status));\n          case 5:\n            _context2.n = 6;\n            return nonceResponse.json();\n          case 6:\n            nonceData = _context2.v;\n            if (nonceData.success) {\n              _context2.n = 7;\n              break;\n            }\n            throw new Error('Impossible d\\'obtenir un nonce frais');\n          case 7:\n            freshNonce = nonceData.data.nonce; // Préparer les données pour l'AJAX unifié\n            formData = new FormData();\n            formData.append('action', 'pdf_builder_unified_preview');\n            formData.append('nonce', freshNonce);\n            formData.append('elements', jsonString);\n            _context2.n = 8;\n            return fetch(ajaxurl || ((_window$pdfBuilderAja3 = window.pdfBuilderAjax) === null || _window$pdfBuilderAja3 === void 0 ? void 0 : _window$pdfBuilderAja3.ajaxurl) || '/wp-admin/admin-ajax.php', {\n              method: 'POST',\n              body: formData\n            });\n          case 8:\n            response = _context2.v;\n            if (response.ok) {\n              _context2.n = 9;\n              break;\n            }\n            throw new Error(\"Erreur HTTP: \".concat(response.status));\n          case 9:\n            _context2.n = 10;\n            return response.json();\n          case 10:\n            data = _context2.v;\n            if (!(data.success && data.data && data.data.url)) {\n              _context2.n = 11;\n              break;\n            }\n            // Nettoyer le timeout de fallback\n            clearTimeout(fallbackTimeout);\n\n            // Mettre à jour l'état pour afficher le PDF dans la modale\n            setPreviewData({\n              url: data.data.url,\n              server_validated: true,\n              elements_count: elements.length,\n              width: canvasWidth,\n              height: canvasHeight,\n              zoom: zoom\n            });\n            setLoading(false);\n            setError(null);\n\n            // Ne pas ouvrir de nouvel onglet - le PDF s'affichera dans la modale\n            return _context2.a(2);\n          case 11:\n            throw new Error(data.data || 'Erreur génération aperçu côté serveur');\n          case 12:\n            _context2.n = 14;\n            break;\n          case 13:\n            _context2.p = 13;\n            _t3 = _context2.v;\n            console.error('❌ Erreur génération aperçu côté serveur:', _t3);\n            // Nettoyer le timeout de fallback\n            clearTimeout(fallbackTimeout);\n            setError(\"Erreur aper\\xE7u c\\xF4t\\xE9 serveur: \".concat(_t3.message));\n            setLoading(false);\n          case 14:\n            return _context2.a(2);\n        }\n      }, _callee2, null, [[1, 13]]);\n    }));\n    return function generateServerPreview() {\n      return _ref5.apply(this, arguments);\n    };\n  }();\n  var handlePrint = /*#__PURE__*/function () {\n    var _ref6 = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee3() {\n      var printButton, _window$pdfBuilderAja4, ajaxUrl, nonceFormData, nonceResponse, nonceData, freshNonce, formData, originalText, response, data, errorMessage, pdfBase64, pdfBlob, pdfUrl, previewWindow, link, _t4;\n      return _regenerator().w(function (_context3) {\n        while (1) switch (_context3.p = _context3.n) {\n          case 0:\n            printButton = null;\n            _context3.p = 1;\n            // Vérifier que les variables AJAX sont disponibles\n            ajaxUrl = ((_window$pdfBuilderAja4 = window.pdfBuilderAjax) === null || _window$pdfBuilderAja4 === void 0 ? void 0 : _window$pdfBuilderAja4.ajaxurl) || ajaxurl;\n            if (ajaxUrl) {\n              _context3.n = 2;\n              break;\n            }\n            alert('Erreur: Variables AJAX non disponibles. Rechargez la page.');\n            return _context3.a(2);\n          case 2:\n            // Obtenir un nonce frais\n            nonceFormData = new FormData();\n            nonceFormData.append('action', 'pdf_builder_get_fresh_nonce');\n            _context3.n = 3;\n            return fetch(ajaxUrl, {\n              method: 'POST',\n              body: nonceFormData\n            });\n          case 3:\n            nonceResponse = _context3.v;\n            if (nonceResponse.ok) {\n              _context3.n = 4;\n              break;\n            }\n            throw new Error(\"Erreur HTTP nonce: \".concat(nonceResponse.status));\n          case 4:\n            _context3.n = 5;\n            return nonceResponse.json();\n          case 5:\n            nonceData = _context3.v;\n            if (nonceData.success) {\n              _context3.n = 6;\n              break;\n            }\n            throw new Error('Impossible d\\'obtenir un nonce frais');\n          case 6:\n            freshNonce = nonceData.data.nonce; // Préparer les données pour l'AJAX\n            formData = new FormData();\n            formData.append('action', 'pdf_builder_generate_pdf');\n            formData.append('nonce', freshNonce);\n            formData.append('elements', JSON.stringify(elements));\n\n            // Afficher un indicateur de chargement\n            printButton = document.querySelector('.btn-primary');\n            if (printButton) {\n              originalText = printButton.textContent;\n              printButton.textContent = '⏳ Génération PDF...';\n              printButton.disabled = true;\n            }\n\n            // Envoyer la requête AJAX\n            _context3.n = 7;\n            return fetch(ajaxUrl, {\n              method: 'POST',\n              body: formData\n            });\n          case 7:\n            response = _context3.v;\n            if (response.ok) {\n              _context3.n = 8;\n              break;\n            }\n            throw new Error('Erreur réseau: ' + response.status);\n          case 8:\n            _context3.n = 9;\n            return response.json()[\"catch\"](function (jsonError) {\n              console.error('Erreur parsing JSON:', jsonError);\n              throw new Error('Réponse invalide du serveur (pas du JSON)');\n            });\n          case 9:\n            data = _context3.v;\n            if (data.success) {\n              _context3.n = 10;\n              break;\n            }\n            errorMessage = 'Erreur inconnue lors de la génération du PDF';\n            if (typeof data.data === 'string') {\n              errorMessage = data.data;\n            } else if (_typeof(data.data) === 'object' && data.data !== null) {\n              errorMessage = data.data.message || JSON.stringify(data.data);\n            }\n            throw new Error(errorMessage);\n          case 10:\n            if (!(!data.data || !data.data.pdf)) {\n              _context3.n = 11;\n              break;\n            }\n            throw new Error('Données PDF manquantes dans la réponse');\n          case 11:\n            // Convertir le PDF base64 en blob\n            pdfBase64 = data.data.pdf;\n            pdfBlob = new Blob([Uint8Array.from(atob(pdfBase64), function (c) {\n              return c.charCodeAt(0);\n            })], {\n              type: 'application/pdf'\n            });\n            if (!(pdfBlob.size === 0)) {\n              _context3.n = 12;\n              break;\n            }\n            throw new Error('Le PDF généré est vide');\n          case 12:\n            // Créer un URL pour le blob PDF\n            pdfUrl = URL.createObjectURL(pdfBlob); // Ouvrir le PDF dans une modale si la prop est fournie, sinon dans une nouvelle fenêtre\n            if (onOpenPDFModal) {\n              onOpenPDFModal(pdfUrl);\n            } else {\n              // Fallback vers l'ancienne méthode\n              previewWindow = window.open(pdfUrl, '_blank');\n              if (!previewWindow) {\n                // Fallback si le popup est bloqué\n                link = document.createElement('a');\n                link.href = pdfUrl;\n                link.target = '_blank';\n                link.rel = 'noopener noreferrer';\n                document.body.appendChild(link);\n                link.click();\n                // Vérifier que l'élément existe encore avant de le supprimer\n                if (link.parentNode === document.body) {\n                  document.body.removeChild(link);\n                }\n              }\n            }\n\n            // Libérer l'URL du blob après un délai (seulement si pas en modale)\n            if (!onOpenPDFModal) {\n              setTimeout(function () {\n                URL.revokeObjectURL(pdfUrl);\n              }, 1000);\n            }\n            _context3.n = 14;\n            break;\n          case 13:\n            _context3.p = 13;\n            _t4 = _context3.v;\n            console.error('Erreur génération PDF:', _t4);\n            alert('Erreur lors de la génération du PDF: ' + _t4.message);\n          case 14:\n            _context3.p = 14;\n            // Restaurer le bouton\n            if (printButton) {\n              printButton.textContent = '👁️ Imprimer PDF';\n              printButton.disabled = false;\n            }\n            return _context3.f(14);\n          case 15:\n            return _context3.a(2);\n        }\n      }, _callee3, null, [[1, 13, 14, 15]]);\n    }));\n    return function handlePrint() {\n      return _ref6.apply(this, arguments);\n    };\n  }();\n  if (!isOpen) return null;\n  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n    className: \"preview-modal-overlay\",\n    onClick: onClose\n  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n    className: \"preview-modal-content\",\n    onClick: function onClick(e) {\n      return e.stopPropagation();\n    }\n  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n    className: \"preview-modal-header\"\n  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"h3\", null, \"\\uD83C\\uDFA8 Aper\\xE7u Canvas - PDF Builder Pro v2.0\"), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"button\", {\n    className: \"preview-modal-close\",\n    onClick: onClose\n  }, \"\\xD7\")), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n    className: \"preview-modal-body\"\n  }, loading && /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n    className: \"preview-loading\"\n  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n    className: \"preview-spinner\"\n  }), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"p\", null, \"G\\xE9n\\xE9ration de l'aper\\xE7u...\")), error && /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n    className: \"preview-error\"\n  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"h4\", null, \"\\u274C Erreur d'aper\\xE7u\"), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"p\", null, error), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"p\", null, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"small\", null, \"Le PDF pourra quand m\\xEAme \\xEAtre g\\xE9n\\xE9r\\xE9 normalement.\"))), previewData && /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n    className: \"preview-content\"\n  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n    style: {\n      textAlign: 'center',\n      marginBottom: '20px',\n      padding: '10px',\n      background: previewData.server_validated ? '#e8f5e8' : '#fff3cd',\n      borderRadius: '4px',\n      border: \"1px solid \".concat(previewData.server_validated ? '#c3e6c3' : '#ffeaa7')\n    }\n  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"strong\", null, previewData.server_validated ? '✅' : '⚡', \" Aper\\xE7u g\\xE9n\\xE9r\\xE9\"), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"br\", null), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"small\", null, previewData.elements_count, \" \\xE9l\\xE9ment\", previewData.elements_count !== 1 ? 's' : '', \" \\u2022 \", previewData.width, \"\\xD7\", previewData.height, \"px\", previewData.server_validated && ' • Serveur validé', previewData.server_error && ' • ⚠️ Problème serveur')), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n    style: {\n      display: 'flex',\n      justifyContent: 'center',\n      alignItems: 'flex-start',\n      minHeight: '400px',\n      backgroundColor: '#f8f9fa',\n      borderRadius: '8px',\n      padding: '20px'\n    }\n  }, previewData.url ?\n  /*#__PURE__*/\n  // Aperçu côté serveur - afficher le PDF dans un iframe\n  react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"iframe\", {\n    src: previewData.url,\n    style: {\n      width: '100%',\n      height: '600px',\n      border: '1px solid #dee2e6',\n      borderRadius: '4px',\n      backgroundColor: 'white'\n    },\n    title: \"Aper\\xE7u PDF c\\xF4t\\xE9 serveur\"\n  }) :\n  // Aperçu côté client - rendre le HTML\n  renderCanvasContent(elements)), previewData.server_error && /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n    style: {\n      marginTop: '20px',\n      padding: '15px',\n      backgroundColor: '#ffeaa7',\n      borderRadius: '6px',\n      border: '1px solid #d4a574'\n    }\n  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"h5\", {\n    style: {\n      margin: '0 0 10px 0',\n      color: '#856404'\n    }\n  }, \"\\u26A0\\uFE0F Note\"), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"p\", {\n    style: {\n      margin: '0',\n      fontSize: '14px',\n      color: '#333'\n    }\n  }, \"L'aper\\xE7u s'affiche correctement, mais il y a un probl\\xE8me de validation c\\xF4t\\xE9 serveur: \", previewData.server_error)), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n    style: {\n      marginTop: '20px',\n      padding: '15px',\n      backgroundColor: '#e8f4fd',\n      borderRadius: '6px',\n      border: '1px solid #b3d9ff'\n    }\n  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"h5\", {\n    style: {\n      margin: '0 0 10px 0',\n      color: '#0066cc'\n    }\n  }, \"\\u2139\\uFE0F Informations du Canvas\"), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"p\", {\n    style: {\n      margin: '0',\n      fontSize: '14px',\n      color: '#333'\n    }\n  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"strong\", null, \"Dimensions:\"), \" \", canvasWidth, \" \\xD7 \", canvasHeight, \" pixels\", /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"br\", null), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"strong\", null, \"\\xC9l\\xE9ments:\"), \" \", elements.length, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"br\", null), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"strong\", null, \"Zoom:\"), \" \", Math.round(zoom * 100), \"%\", /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"br\", null), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"strong\", null, \"Status:\"), \" \", previewData.server_validated ? 'Validé côté serveur' : 'Aperçu local'))), !loading && !error && !previewData && /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n    className: \"preview-loading\"\n  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"p\", null, \"Pr\\xE9paration de l'aper\\xE7u...\"))), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n    className: \"preview-modal-footer\"\n  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"button\", {\n    className: \"btn btn-secondary\",\n    onClick: onClose\n  }, \"\\u274C Fermer\"), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"button\", {\n    className: \"btn btn-primary\",\n    onClick: handlePrint\n  }, \"\\uD83D\\uDC41\\uFE0F Imprimer PDF\"))));\n};\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (PreviewModal);\n\n//# sourceURL=webpack://wp-pdf-builder-pro/./src/components/PreviewModal.jsx?\n}")}}]);