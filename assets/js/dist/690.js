"use strict";(self.webpackChunkwp_pdf_builder_pro=self.webpackChunkwp_pdf_builder_pro||[]).push([[690,702],{690:(e,o,t)=>{t.r(o),t.d(o,{default:()=>c});var r=t(540),n=t(705),a=t(702);function i(e){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i(e)}const c=function(e){var o=e.isOpen,t=e.onClose,c=e.elements,s=void 0===c?[]:c,d=e.canvasWidth,l=void 0===d?595:d,u=e.canvasHeight,m=void 0===u?842:u,h=e.zoom,p=void 0===h?1:h,w=e.ajaxurl,g=e.pdfBuilderNonce;return o&&o?r.createElement("div",{className:"preview-modal-overlay",onClick:t},r.createElement("div",{className:"preview-modal-content",onClick:function(e){return e.stopPropagation()}},r.createElement("div",{className:"preview-modal-header"},r.createElement("h3",null,"[PDF] AperÃ§u PDF - PDF Builder Pro"),r.createElement("button",{className:"preview-modal-close",onClick:t},"Ã—")),r.createElement("div",{className:"preview-modal-body"},r.createElement("div",{className:"preview-content",style:{padding:"20px",background:"#f8f9fa",borderRadius:"4px"}},r.createElement("div",{className:"preview-canvas",style:{width:l,height:m,margin:"0 auto",border:"1px solid #e2e8f0",background:"white",position:"relative",overflow:"hidden",transform:"scale(".concat(p,")"),transformOrigin:"top center"}},s.filter(function(e){return!e.type.startsWith("woocommerce-")}).map(function(e){return r.createElement(n.H,{key:e.id,element:e,isSelected:!1,zoom:1,snapToGrid:!1,gridSize:10,canvasWidth:l,canvasHeight:m,onSelect:function(){},onUpdate:function(){},onRemove:function(){},onContextMenu:function(){},dragAndDrop:!1})}),s.filter(function(e){return e.type.startsWith("woocommerce-")}).map(function(e){return r.createElement(a.default,{key:e.id,element:e,isSelected:!1,onSelect:function(){},onUpdate:function(){},dragAndDrop:!1,zoom:1,canvasWidth:l,canvasHeight:m})})))),r.createElement("div",{className:"preview-modal-footer"},r.createElement("button",{className:"btn btn-secondary",onClick:t},"âŒ Fermer"),r.createElement("button",{className:"btn btn-primary",onClick:function(){var e,o,t;console.log("handlePrint called with elements:",s),console.log("canvasWidth:",l,"canvasHeight:",m),console.log("window.pdfBuilderAjax au dÃ©but:",window.pdfBuilderAjax),s.forEach(function(e,o){console.log("Element ".concat(o,":"),{type:e.type,text:e.text,src:e.src,content:e.content,x:e.x,y:e.y,width:e.width,height:e.height})});var r=(null===(e=window.pdfBuilderAjax)||void 0===e?void 0:e.ajaxurl)||w,n=(null===(o=window.pdfBuilderAjax)||void 0===o?void 0:o.nonce)||g;if(!n&&null!==(t=window.pdfBuilderAjax)&&void 0!==t&&t.ajaxurl){console.log("Tentative de rÃ©gÃ©nÃ©ration du nonce...");try{var a=new XMLHttpRequest;if(a.open("POST",window.pdfBuilderAjax.ajaxurl,!1),a.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),a.send("action=pdf_builder_regenerate_nonce"),200===a.status){var c=JSON.parse(a.responseText);c.success&&c.data&&c.data.nonce&&(n=c.data.nonce,console.log("Nouveau nonce rÃ©gÃ©nÃ©rÃ©:",n))}}catch(e){console.error("Erreur lors de la rÃ©gÃ©nÃ©ration du nonce:",e)}}if(!r||!n)return console.error("Variables AJAX manquantes:",{ajaxUrl:r,nonce:n,windowPdfBuilderAjax:window.pdfBuilderAjax}),void alert("Erreur: Variables AJAX non disponibles. Rechargez la page.");var d=new FormData;d.append("action","pdf_builder_generate_pdf"),d.append("nonce",n),d.append("elements",JSON.stringify(s)),d.append("canvasWidth",l),d.append("canvasHeight",m),console.log("Valeur du nonce envoyÃ©:",n),console.log("Variables AJAX disponibles:",{ajaxUrl:r,nonce:n}),console.log("Envoi requÃªte AJAX vers:",r);var u=document.querySelector(".btn-primary"),h=u.textContent;u.textContent="â³ GÃ©nÃ©ration PDF...",u.disabled=!0,fetch(r,{method:"POST",body:d}).then(function(e){if(console.log("RÃ©ponse reÃ§ue:",e.status,e.statusText),!e.ok)throw new Error("Erreur rÃ©seau: "+e.status+" "+e.statusText);return e.json().catch(function(e){throw console.error("Erreur de parsing JSON:",e),new Error("RÃ©ponse invalide du serveur (pas du JSON)")})}).then(function(e){if(console.log("DonnÃ©es reÃ§ues:",e),!e.success){console.error("RÃ©ponse d'erreur du serveur:",e);var o="Erreur inconnue lors de la gÃ©nÃ©ration du PDF";throw"string"==typeof e.data?o=e.data:"object"===i(e.data)&&null!==e.data&&(o=e.data.message||JSON.stringify(e.data)),new Error(o)}if(!e.data||!e.data.pdf)throw new Error("DonnÃ©es PDF manquantes dans la rÃ©ponse");var t=e.data.pdf,r=new Blob([Uint8Array.from(atob(t),function(e){return e.charCodeAt(0)})],{type:"application/pdf"});if(console.log("Blob PDF crÃ©Ã©, taille:",r.size,"bytes"),0===r.size)throw new Error("Le PDF gÃ©nÃ©rÃ© est vide");var n=URL.createObjectURL(r),a=document.createElement("a");a.href=n,a.download=e.data.filename||"pdf-builder-pro-document.pdf",a.target="_blank",document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(n),console.log("PDF gÃ©nÃ©rÃ© et ouvert avec succÃ¨s")}).catch(function(e){console.error("Erreur lors de la gÃ©nÃ©ration du PDF:",e),alert("Erreur lors de la gÃ©nÃ©ration du PDF: "+e.message)}).finally(function(){u.textContent=h,u.disabled=!1})}},"ðŸ–¨ï¸ Imprimer")))):null}},702:(e,o,t)=>{t.r(o),t.d(o,{default:()=>c,useWooCommerceElements:()=>i});var r=t(540),n=t(630),a=function(e){return{"woocommerce-invoice-number":"NumÃ©ro Facture","woocommerce-invoice-date":"Date Facture","woocommerce-order-number":"NÂ° Commande","woocommerce-order-date":"Date Commande","woocommerce-billing-address":"Adresse Facturation","woocommerce-shipping-address":"Adresse Livraison","woocommerce-customer-name":"Nom Client","woocommerce-customer-email":"Email Client","woocommerce-payment-method":"Paiement","woocommerce-order-status":"Statut","woocommerce-products-table":"Tableau Produits","woocommerce-products-simple":"Liste Produits","woocommerce-subtotal":"Sous-total","woocommerce-discount":"Remise","woocommerce-shipping":"Livraison","woocommerce-taxes":"Taxes","woocommerce-total":"Total","woocommerce-refund":"Remboursement","woocommerce-fees":"Frais","woocommerce-quote-number":"NÂ° Devis","woocommerce-quote-date":"Date Devis","woocommerce-quote-validity":"ValiditÃ©","woocommerce-quote-notes":"Notes Devis"}[e]||"Ã‰lÃ©ment WC"},i=function(){return{getElementDefaults:function(e){var o={width:200,height:60,fontSize:14,fontFamily:"Arial, sans-serif",color:"#333333",backgroundColor:"#ffffff",borderColor:"#dddddd",borderWidth:1,borderStyle:"solid",borderRadius:4,padding:8};switch(e){case"woocommerce-billing-address":case"woocommerce-shipping-address":o.height=100;break;case"woocommerce-products-table":o.width=400,o.height=150,o.columns={image:!0,name:!0,sku:!0,quantity:!0,price:!0,total:!0};break;case"woocommerce-products-simple":o.width=350,o.height=120;break;case"woocommerce-invoice-number":case"woocommerce-order-number":case"woocommerce-quote-number":o.width=150,o.height=40}return o},validateElement:function(e){return e&&e.type&&e.id},getElementLabel:a}};const c=function(e){var o=e.element,t=e.isSelected,i=e.onSelect,c=e.onUpdate,s=e.dragAndDrop,d=e.zoom,l=void 0===d?1:d,u=e.canvasWidth,m=e.canvasHeight,h=e.orderData,p=void 0===h?{}:h,w=(0,r.useRef)(null),g=(0,n.s)({onElementResize:function(e){c({x:e.x,y:e.y,width:e.width,height:e.height})},snapToGrid:!0,gridSize:10,canvasWidth:u,canvasHeight:m}),f={position:"absolute",left:o.x*l,top:o.y*l,width:o.width*l,height:o.height*l,cursor:t?"move":"pointer",userSelect:"none",border:t?"2px solid #007cba":o.borderWidth>0?"".concat(o.borderWidth||1,"px ").concat(o.borderStyle||"solid"," ").concat(o.borderColor||"transparent"):"none",backgroundColor:o.backgroundColor||"transparent",color:o.color||"#333333",fontSize:(o.fontSize||14)*l,fontFamily:o.fontFamily||"Arial, sans-serif",padding:(o.padding||8)*l,borderRadius:(o.borderRadius||4)*l,boxSizing:"border-box",overflow:"hidden","--element-border-width":t?"2px":o.borderWidth>0?"".concat(o.borderWidth||1,"px"):"0px"};return r.createElement(r.Fragment,null,r.createElement("div",{ref:w,style:f,onClick:function(e){e.stopPropagation(),t||i(o.id)},onMouseDown:function(e){e.stopPropagation();var t=w.current.closest(".canvas-zoom-wrapper");if(t){for(var r=t.getBoundingClientRect(),n=(w.current.getBoundingClientRect(),(e.clientX-r.left)/l),a=(e.clientY-r.top)/l,i=8/l,c=0,d=[{name:"nw",x:o.x,y:o.y},{name:"ne",x:o.x+o.width,y:o.y},{name:"sw",x:o.x,y:o.y+o.height},{name:"se",x:o.x+o.width,y:o.y+o.height},{name:"n",x:o.x+o.width/2,y:o.y},{name:"s",x:o.x+o.width/2,y:o.y+o.height},{name:"w",x:o.x,y:o.y+o.height/2},{name:"e",x:o.x+o.width,y:o.y+o.height/2}];c<d.length;c++){var u=d[c];if(n>=u.x-i/2&&n<=u.x+i/2&&a>=u.y-i/2&&a<=u.y+i/2)return void g.handleResizeStart(e,u.name,{x:o.x,y:o.y,width:o.width,height:o.height},r,l)}if(s&&s.handleMouseDown){var m=w.current.closest(".canvas-zoom-wrapper").getBoundingClientRect();s.handleMouseDown(e,o.id,{left:o.x,top:o.y,width:o.width,height:o.height},m,l)}}}},r.createElement("div",{style:{fontWeight:"bold",textTransform:"uppercase",letterSpacing:"0.5px"}},a(o.type)),r.createElement("div",{style:{whiteSpace:"pre-line",lineHeight:"1.4",color:"#666"}},function(e){switch(e){case"woocommerce-invoice-number":return p.invoice_number||"INV-001";case"woocommerce-invoice-date":return p.invoice_date||"15/10/2025";case"woocommerce-order-number":return p.order_number||"#12345";case"woocommerce-order-date":return p.order_date||"15/10/2025";case"woocommerce-customer-name":return p.customer_name||"John Doe";case"woocommerce-customer-email":return p.customer_email||"john.doe@example.com";case"woocommerce-billing-address":return p.billing_address||"123 Rue de Test\n75001 Paris\nFrance";case"woocommerce-shipping-address":return p.shipping_address||"456 Rue de Livraison\n75002 Paris\nFrance";case"woocommerce-payment-method":return p.payment_method||"Carte bancaire";case"woocommerce-order-status":return p.order_status||"TraitÃ©e";case"woocommerce-subtotal":return p.subtotal||"45,00 â‚¬";case"woocommerce-discount":return p.discount||"-5,00 â‚¬";case"woocommerce-shipping":return p.shipping||"5,00 â‚¬";case"woocommerce-taxes":return p.tax||"9,00 â‚¬";case"woocommerce-total":return p.total||"54,00 â‚¬";case"woocommerce-refund":return p.refund||"0,00 â‚¬";case"woocommerce-fees":return p.fees||"1,50 â‚¬";case"woocommerce-quote-number":return p.quote_number||"QUO-001";case"woocommerce-quote-date":return p.quote_date||"15/10/2025";case"woocommerce-quote-validity":return p.quote_validity||"30 jours";case"woocommerce-quote-notes":return p.quote_notes||"Conditions spÃ©ciales : paiement Ã  30 jours.";case"woocommerce-products-table":return p.products&&p.products.length>0?p.products.map(function(e){return"".concat(e.name," x").concat(e.quantity," - ").concat(e.total)}).join("\n"):"Produit Test 1 x1 - 25,00 â‚¬\nProduit Test 2 x2 - 20,00 â‚¬";case"woocommerce-products-simple":return p.products&&p.products.length>0?p.products.map(function(e){return"".concat(e.quantity,"x ").concat(e.name)}).join("\n"):"1x Produit Test 1\n2x Produit Test 2";default:return"[Contenu dynamique WooCommerce]"}}(o.type))),t&&r.createElement(r.Fragment,null,r.createElement("div",{className:"resize-handle nw",style:{position:"absolute",width:8,height:8,backgroundColor:"#007cba",border:"1px solid white",pointerEvents:"auto"},onMouseDown:function(e){return g.handleResizeStart(e,"nw",{x:o.x,y:o.y,width:o.width,height:o.height})}}),r.createElement("div",{className:"resize-handle ne",style:{position:"absolute",width:8,height:8,backgroundColor:"#007cba",border:"1px solid white",pointerEvents:"auto"},onMouseDown:function(e){return g.handleResizeStart(e,"ne",{x:o.x,y:o.y,width:o.width,height:o.height})}}),r.createElement("div",{className:"resize-handle sw",style:{position:"absolute",width:8,height:8,backgroundColor:"#007cba",border:"1px solid white",pointerEvents:"auto"},onMouseDown:function(e){return g.handleResizeStart(e,"sw",{x:o.x,y:o.y,width:o.width,height:o.height})}}),r.createElement("div",{className:"resize-handle se",style:{position:"absolute",width:8,height:8,backgroundColor:"#007cba",border:"1px solid white",pointerEvents:"auto"},onMouseDown:function(e){return g.handleResizeStart(e,"se",{x:o.x,y:o.y,width:o.width,height:o.height})}}),r.createElement("div",{className:"resize-handle n",style:{position:"absolute",width:8,height:8,backgroundColor:"#007cba",border:"1px solid white",pointerEvents:"auto"},onMouseDown:function(e){return g.handleResizeStart(e,"n",{x:o.x,y:o.y,width:o.width,height:o.height})}}),r.createElement("div",{className:"resize-handle s",style:{position:"absolute",width:8,height:8,backgroundColor:"#007cba",border:"1px solid white",pointerEvents:"auto"},onMouseDown:function(e){return g.handleResizeStart(e,"s",{x:o.x,y:o.y,width:o.width,height:o.height})}}),r.createElement("div",{className:"resize-handle w",style:{position:"absolute",width:8,height:8,backgroundColor:"#007cba",border:"1px solid white",pointerEvents:"auto"},onMouseDown:function(e){return g.handleResizeStart(e,"w",{x:o.x,y:o.y,width:o.width,height:o.height})}}),r.createElement("div",{className:"resize-handle e",style:{position:"absolute",width:8,height:8,backgroundColor:"#007cba",border:"1px solid white",pointerEvents:"auto"},onMouseDown:function(e){return g.handleResizeStart(e,"e",{x:o.x,y:o.y,width:o.width,height:o.height})}})))}}}]);