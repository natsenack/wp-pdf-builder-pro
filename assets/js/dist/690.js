/*! For license information please see 690.js.LICENSE.txt */
"use strict";(self.webpackChunkwp_pdf_builder_pro=self.webpackChunkwp_pdf_builder_pro||[]).push([[690],{690:(e,r,t)=>{t.r(r),t.d(r,{default:()=>s});var n=t(540);function o(e){return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o(e)}function a(){var e,r,t="function"==typeof Symbol?Symbol:{},n=t.iterator||"@@iterator",o=t.toStringTag||"@@toStringTag";function i(t,n,o,a){var i=n&&n.prototype instanceof u?n:u,s=Object.create(i.prototype);return l(s,"_invoke",function(t,n,o){var a,l,i,u=0,s=o||[],p=!1,d={p:0,n:0,v:e,a:f,f:f.bind(e,4),d:function(r,t){return a=r,l=0,i=e,d.n=t,c}};function f(t,n){for(l=t,i=n,r=0;!p&&u&&!o&&r<s.length;r++){var o,a=s[r],f=d.p,m=a[2];t>3?(o=m===n)&&(i=a[(l=a[4])?5:(l=3,3)],a[4]=a[5]=e):a[0]<=f&&((o=t<2&&f<a[1])?(l=0,d.v=n,d.n=a[1]):f<m&&(o=t<3||a[0]>n||n>m)&&(a[4]=t,a[5]=n,d.n=m,l=0))}if(o||t>1)return c;throw p=!0,n}return function(o,s,m){if(u>1)throw TypeError("Generator is already running");for(p&&1===s&&f(s,m),l=s,i=m;(r=l<2?e:i)||!p;){a||(l?l<3?(l>1&&(d.n=-1),f(l,i)):d.n=i:d.v=i);try{if(u=2,a){if(l||(o="next"),r=a[o]){if(!(r=r.call(a,i)))throw TypeError("iterator result is not an object");if(!r.done)return r;i=r.value,l<2&&(l=0)}else 1===l&&(r=a.return)&&r.call(a),l<2&&(i=TypeError("The iterator does not provide a '"+o+"' method"),l=1);a=e}else if((r=(p=d.n<0)?i:t.call(n,d))!==c)break}catch(r){a=e,l=1,i=r}finally{u=1}}return{value:r,done:p}}}(t,o,a),!0),s}var c={};function u(){}function s(){}function p(){}r=Object.getPrototypeOf;var d=[][n]?r(r([][n]())):(l(r={},n,function(){return this}),r),f=p.prototype=u.prototype=Object.create(d);function m(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,p):(e.__proto__=p,l(e,o,"GeneratorFunction")),e.prototype=Object.create(f),e}return s.prototype=p,l(f,"constructor",p),l(p,"constructor",s),s.displayName="GeneratorFunction",l(p,o,"GeneratorFunction"),l(f),l(f,o,"Generator"),l(f,n,function(){return this}),l(f,"toString",function(){return"[object Generator]"}),(a=function(){return{w:i,m}})()}function l(e,r,t,n){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}l=function(e,r,t,n){function a(r,t){l(e,r,function(e){return this._invoke(r,t,e)})}r?o?o(e,r,{value:t,enumerable:!n,configurable:!n,writable:!n}):e[r]=t:(a("next",0),a("throw",1),a("return",2))},l(e,r,t,n)}function i(e,r,t,n,o,a,l){try{var i=e[a](l),c=i.value}catch(e){return void t(e)}i.done?r(c):Promise.resolve(c).then(n,o)}function c(e,r){return function(e){if(Array.isArray(e))return e}(e)||function(e,r){var t=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=t){var n,o,a,l,i=[],c=!0,u=!1;try{if(a=(t=t.call(e)).next,0===r){if(Object(t)!==t)return;c=!1}else for(;!(c=(n=a.call(t)).done)&&(i.push(n.value),i.length!==r);c=!0);}catch(e){u=!0,o=e}finally{try{if(!c&&null!=t.return&&(l=t.return(),Object(l)!==l))return}finally{if(u)throw o}}return i}}(e,r)||function(e,r){if(e){if("string"==typeof e)return u(e,r);var t={}.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?u(e,r):void 0}}(e,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function u(e,r){(null==r||r>e.length)&&(r=e.length);for(var t=0,n=Array(r);t<r;t++)n[t]=e[t];return n}const s=function(e){var r=e.isOpen,t=e.onClose,l=e.elements,u=void 0===l?[]:l,s=(e.canvasWidth,e.canvasHeight,e.zoom,e.ajaxurl),p=e.pdfBuilderNonce,d=c((0,n.useState)(null),2),f=d[0],m=d[1],v=c((0,n.useState)(!1),2),b=v[0],y=v[1],g=c((0,n.useState)(null),2),h=g[0],w=g[1];(0,n.useEffect)(function(){r&&u.length>0&&E()},[r,u]);var E=function(){var e,r=(e=a().m(function e(){var r,t,n,o;return a().w(function(e){for(;;)switch(e.p=e.n){case 0:return y(!0),w(null),e.p=1,console.log("G√©n√©ration aper√ßu c√¥t√© serveur pour",u.length,"√©l√©ments"),(r=new FormData).append("action","pdf_builder_generate_preview"),r.append("nonce",p),r.append("elements",JSON.stringify(u)),e.n=2,fetch(s,{method:"POST",body:r});case 2:if((t=e.v).ok){e.n=3;break}throw new Error("Erreur HTTP: ".concat(t.status));case 3:return e.n=4,t.json();case 4:if(!(n=e.v).success){e.n=5;break}console.log("Aper√ßu g√©n√©r√© avec succ√®s:",n.data),m(n.data),e.n=6;break;case 5:throw new Error(n.data||"Erreur g√©n√©ration aper√ßu");case 6:e.n=8;break;case 7:e.p=7,o=e.v,console.error("Erreur g√©n√©ration aper√ßu:",o),w(o.message);case 8:return e.p=8,y(!1),e.f(8);case 9:return e.a(2)}},e,null,[[1,7,8,9]])}),function(){var r=this,t=arguments;return new Promise(function(n,o){var a=e.apply(r,t);function l(e){i(a,n,o,l,c,"next",e)}function c(e){i(a,n,o,l,c,"throw",e)}l(void 0)})});return function(){return r.apply(this,arguments)}}();return r?n.createElement("div",{className:"preview-modal-overlay",onClick:t},n.createElement("div",{className:"preview-modal-content",onClick:function(e){return e.stopPropagation()}},n.createElement("div",{className:"preview-modal-header"},n.createElement("h3",null,"üìÑ Aper√ßu PDF - PDF Builder Pro v2.0"),n.createElement("button",{className:"preview-modal-close",onClick:t},"√ó")),n.createElement("div",{className:"preview-modal-body"},b&&n.createElement("div",{className:"preview-loading"},n.createElement("div",{className:"preview-spinner"}),n.createElement("p",null,"G√©n√©ration de l'aper√ßu...")),h&&n.createElement("div",{className:"preview-error"},n.createElement("h4",null,"‚ùå Erreur d'aper√ßu"),n.createElement("p",null,h),n.createElement("p",null,n.createElement("small",null,"Le PDF pourra quand m√™me √™tre g√©n√©r√© normalement."))),f&&f.success&&n.createElement("div",{className:"preview-content"},n.createElement("div",{style:{textAlign:"center",marginBottom:"20px",padding:"10px",background:"#e8f5e8",borderRadius:"4px",border:"1px solid #c3e6c3"}},n.createElement("strong",null,"‚úÖ Aper√ßu g√©n√©r√© avec succ√®s"),n.createElement("br",null),n.createElement("small",null,f.elements_count," √©l√©ments ‚Ä¢ ",f.width,"√ó",f.height,"px")),n.createElement("div",{style:{display:"flex",justifyContent:"center",alignItems:"flex-start",minHeight:"400px"}},n.createElement("img",{src:"data:image/png;base64,".concat(f.preview),alt:"Aper√ßu PDF",style:{maxWidth:"100%",maxHeight:"600px",border:"1px solid #e2e8f0",borderRadius:"8px",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.1)"}}))),!b&&!h&&!f&&n.createElement("div",{className:"preview-loading"},n.createElement("p",null,"Pr√©paration de l'aper√ßu..."))),n.createElement("div",{className:"preview-modal-footer"},n.createElement("button",{className:"btn btn-secondary",onClick:t},"‚ùå Fermer"),n.createElement("button",{className:"btn btn-primary",onClick:function(){var e,r;console.log("G√©n√©ration PDF finale...");var t=(null===(e=window.pdfBuilderAjax)||void 0===e?void 0:e.ajaxurl)||s,n=(null===(r=window.pdfBuilderAjax)||void 0===r?void 0:r.nonce)||p;if(!t||!n)return console.error("Variables AJAX manquantes:",{ajaxUrl:t,nonce:n}),void alert("Erreur: Variables AJAX non disponibles. Rechargez la page.");var a=new FormData;a.append("action","pdf_builder_generate_pdf"),a.append("nonce",n),a.append("elements",JSON.stringify(u)),console.log("Envoi requ√™te g√©n√©ration PDF...");var l=document.querySelector(".btn-primary");l&&(l.textContent,l.textContent="‚è≥ G√©n√©ration PDF...",l.disabled=!0),fetch(t,{method:"POST",body:a}).then(function(e){if(console.log("R√©ponse re√ßue:",e.status),!e.ok)throw new Error("Erreur r√©seau: "+e.status);return e.json().catch(function(e){throw console.error("Erreur parsing JSON:",e),new Error("R√©ponse invalide du serveur (pas du JSON)")})}).then(function(e){if(console.log("Donn√©es re√ßues:",e),!e.success){var r="Erreur inconnue lors de la g√©n√©ration du PDF";throw"string"==typeof e.data?r=e.data:"object"===o(e.data)&&null!==e.data&&(r=e.data.message||JSON.stringify(e.data)),new Error(r)}if(!e.data||!e.data.pdf)throw new Error("Donn√©es PDF manquantes dans la r√©ponse");var t=e.data.pdf,n=new Blob([Uint8Array.from(atob(t),function(e){return e.charCodeAt(0)})],{type:"application/pdf"});if(console.log("Blob PDF cr√©√©, taille:",n.size,"bytes"),0===n.size)throw new Error("Le PDF g√©n√©r√© est vide");var a=URL.createObjectURL(n);if(!window.open(a,"_blank")){var l=document.createElement("a");l.href=a,l.target="_blank",l.rel="noopener noreferrer",document.body.appendChild(l),l.click(),document.body.removeChild(l)}setTimeout(function(){URL.revokeObjectURL(a)},1e3),console.log("PDF g√©n√©r√© et ouvert avec succ√®s")}).catch(function(e){console.error("Erreur g√©n√©ration PDF:",e),alert("Erreur lors de la g√©n√©ration du PDF: "+e.message)}).finally(function(){l&&(l.textContent="üëÅÔ∏è Imprimer PDF",l.disabled=!1)})}},"üëÅÔ∏è Imprimer PDF")))):null}}}]);