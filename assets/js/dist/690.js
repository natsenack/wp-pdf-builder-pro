/*! For license information please see 690.js.LICENSE.txt */
"use strict";(self.webpackChunkwp_pdf_builder_pro=self.webpackChunkwp_pdf_builder_pro||[]).push([[690],{690:(e,n,r)=>{r.r(n),r.d(n,{default:()=>p});var t=r(540);function o(e){return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o(e)}function a(){var e,n,r="function"==typeof Symbol?Symbol:{},t=r.iterator||"@@iterator",o=r.toStringTag||"@@toStringTag";function i(r,t,o,a){var i=t&&t.prototype instanceof u?t:u,s=Object.create(i.prototype);return c(s,"_invoke",function(r,t,o){var a,c,i,u=0,s=o||[],p=!1,d={p:0,n:0,v:e,a:f,f:f.bind(e,4),d:function(n,r){return a=n,c=0,i=e,d.n=r,l}};function f(r,t){for(c=r,i=t,n=0;!p&&u&&!o&&n<s.length;n++){var o,a=s[n],f=d.p,m=a[2];r>3?(o=m===t)&&(i=a[(c=a[4])?5:(c=3,3)],a[4]=a[5]=e):a[0]<=f&&((o=r<2&&f<a[1])?(c=0,d.v=t,d.n=a[1]):f<m&&(o=r<3||a[0]>t||t>m)&&(a[4]=r,a[5]=t,d.n=m,c=0))}if(o||r>1)return l;throw p=!0,t}return function(o,s,m){if(u>1)throw TypeError("Generator is already running");for(p&&1===s&&f(s,m),c=s,i=m;(n=c<2?e:i)||!p;){a||(c?c<3?(c>1&&(d.n=-1),f(c,i)):d.n=i:d.v=i);try{if(u=2,a){if(c||(o="next"),n=a[o]){if(!(n=n.call(a,i)))throw TypeError("iterator result is not an object");if(!n.done)return n;i=n.value,c<2&&(c=0)}else 1===c&&(n=a.return)&&n.call(a),c<2&&(i=TypeError("The iterator does not provide a '"+o+"' method"),c=1);a=e}else if((n=(p=d.n<0)?i:r.call(t,d))!==l)break}catch(n){a=e,c=1,i=n}finally{u=1}}return{value:n,done:p}}}(r,o,a),!0),s}var l={};function u(){}function s(){}function p(){}n=Object.getPrototypeOf;var d=[][t]?n(n([][t]())):(c(n={},t,function(){return this}),n),f=p.prototype=u.prototype=Object.create(d);function m(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,p):(e.__proto__=p,c(e,o,"GeneratorFunction")),e.prototype=Object.create(f),e}return s.prototype=p,c(f,"constructor",p),c(p,"constructor",s),s.displayName="GeneratorFunction",c(p,o,"GeneratorFunction"),c(f),c(f,o,"Generator"),c(f,t,function(){return this}),c(f,"toString",function(){return"[object Generator]"}),(a=function(){return{w:i,m}})()}function c(e,n,r,t){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}c=function(e,n,r,t){function a(n,r){c(e,n,function(e){return this._invoke(n,r,e)})}n?o?o(e,n,{value:r,enumerable:!t,configurable:!t,writable:!t}):e[n]=r:(a("next",0),a("throw",1),a("return",2))},c(e,n,r,t)}function i(e,n,r,t,o,a,c){try{var i=e[a](c),l=i.value}catch(e){return void r(e)}i.done?n(l):Promise.resolve(l).then(t,o)}function l(e){return function(){var n=this,r=arguments;return new Promise(function(t,o){var a=e.apply(n,r);function c(e){i(a,t,o,c,l,"next",e)}function l(e){i(a,t,o,c,l,"throw",e)}c(void 0)})}}function u(e,n){return function(e){if(Array.isArray(e))return e}(e)||function(e,n){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var t,o,a,c,i=[],l=!0,u=!1;try{if(a=(r=r.call(e)).next,0===n){if(Object(r)!==r)return;l=!1}else for(;!(l=(t=a.call(r)).done)&&(i.push(t.value),i.length!==n);l=!0);}catch(e){u=!0,o=e}finally{try{if(!l&&null!=r.return&&(c=r.return(),Object(c)!==c))return}finally{if(u)throw o}}return i}}(e,n)||function(e,n){if(e){if("string"==typeof e)return s(e,n);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?s(e,n):void 0}}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s(e,n){(null==n||n>e.length)&&(n=e.length);for(var r=0,t=Array(n);r<n;r++)t[r]=e[r];return t}const p=function(e){var n=e.isOpen,r=e.onClose,c=e.elements,i=void 0===c?[]:c,s=(e.canvasWidth,e.canvasHeight,e.zoom,e.ajaxurl),p=(e.pdfBuilderNonce,u((0,t.useState)(null),2)),d=p[0],f=p[1],m=u((0,t.useState)(!1),2),b=m[0],v=m[1],g=u((0,t.useState)(null),2),h=g[0],y=g[1];(0,t.useEffect)(function(){n&&i.length>0&&w()},[n,i]);var w=function(){var e=l(a().m(function e(){var n,r,t,o,c,l,u,p,d,m,b,g,h;return a().w(function(e){for(;;)switch(e.p=e.n){case 0:if(v(!0),y(null),e.p=1,console.log("G√©n√©ration aper√ßu c√¥t√© serveur pour",i.length,"√©l√©ments"),r=(null===(n=window.pdfBuilderAjax)||void 0===n?void 0:n.ajaxurl)||s){e.n=2;break}throw new Error("Variables AJAX non disponibles. Rechargez la page.");case 2:return console.log("TEST: Test de l'endpoint AJAX de base..."),(t=new FormData).append("action","pdf_builder_test_ajax"),e.n=3,fetch(r,{method:"POST",body:t});case 3:if((o=e.v).ok){e.n=4;break}throw new Error("Erreur HTTP test: ".concat(o.status));case 4:return e.n=5,o.json();case 5:return c=e.v,console.log("TEST: AJAX fonctionne:",c),console.log("Obtention d'un nonce frais..."),(l=new FormData).append("action","pdf_builder_get_fresh_nonce"),e.n=6,fetch(r,{method:"POST",body:l});case 6:if((u=e.v).ok){e.n=7;break}throw new Error("Erreur HTTP nonce: ".concat(u.status));case 7:return e.n=8,u.json();case 8:if((p=e.v).success){e.n=9;break}throw new Error("Impossible d'obtenir un nonce frais");case 9:return d=p.data.nonce,console.log("Nonce frais obtenu:",d),console.log("Variables AJAX utilis√©es:",{ajaxUrl:r.substring(0,50)+"...",nonceLength:d.length}),console.log("Valeur du nonce envoy√©:",d),console.log("Timestamp envoi:",Date.now()),(m=new FormData).append("action","pdf_builder_generate_preview"),m.append("nonce",d),m.append("elements",JSON.stringify(i)),e.n=10,fetch(r,{method:"POST",body:m});case 10:if((b=e.v).ok){e.n=11;break}throw new Error("Erreur HTTP: ".concat(b.status));case 11:return e.n=12,b.json();case 12:if(!(g=e.v).success){e.n=13;break}console.log("Aper√ßu g√©n√©r√© avec succ√®s:",g.data),f(g.data),e.n=14;break;case 13:throw new Error(g.data||"Erreur g√©n√©ration aper√ßu");case 14:e.n=16;break;case 15:e.p=15,h=e.v,console.error("Erreur g√©n√©ration aper√ßu:",h),y(h.message);case 16:return e.p=16,v(!1),e.f(16);case 17:return e.a(2)}},e,null,[[1,15,16,17]])}));return function(){return e.apply(this,arguments)}}(),E=function(){var e=l(a().m(function e(){var n,r,t,c,l,u,p,d,f,m,b,v,g,h,y,w;return a().w(function(e){for(;;)switch(e.p=e.n){case 0:if(console.log("G√©n√©ration PDF finale..."),e.p=1,r=(null===(n=window.pdfBuilderAjax)||void 0===n?void 0:n.ajaxurl)||s){e.n=2;break}return alert("Erreur: Variables AJAX non disponibles. Rechargez la page."),e.a(2);case 2:return console.log("Obtention d'un nonce frais pour PDF..."),(t=new FormData).append("action","pdf_builder_get_fresh_nonce"),e.n=3,fetch(r,{method:"POST",body:t});case 3:if((c=e.v).ok){e.n=4;break}throw new Error("Erreur HTTP nonce: ".concat(c.status));case 4:return e.n=5,c.json();case 5:if((l=e.v).success){e.n=6;break}throw new Error("Impossible d'obtenir un nonce frais");case 6:return u=l.data.nonce,console.log("Nonce frais obtenu pour PDF:",u),(p=new FormData).append("action","pdf_builder_generate_pdf"),p.append("nonce",u),p.append("elements",JSON.stringify(i)),console.log("Envoi requ√™te g√©n√©ration PDF..."),(d=document.querySelector(".btn-primary"))&&(d.textContent,d.textContent="‚è≥ G√©n√©ration PDF...",d.disabled=!0),e.n=7,fetch(r,{method:"POST",body:p});case 7:if(f=e.v,console.log("R√©ponse re√ßue:",f.status),f.ok){e.n=8;break}throw new Error("Erreur r√©seau: "+f.status);case 8:return e.n=9,f.json().catch(function(e){throw console.error("Erreur parsing JSON:",e),new Error("R√©ponse invalide du serveur (pas du JSON)")});case 9:if(m=e.v,console.log("Donn√©es re√ßues:",m),m.success){e.n=10;break}throw b="Erreur inconnue lors de la g√©n√©ration du PDF","string"==typeof m.data?b=m.data:"object"===o(m.data)&&null!==m.data&&(b=m.data.message||JSON.stringify(m.data)),new Error(b);case 10:if(m.data&&m.data.pdf){e.n=11;break}throw new Error("Donn√©es PDF manquantes dans la r√©ponse");case 11:if(v=m.data.pdf,g=new Blob([Uint8Array.from(atob(v),function(e){return e.charCodeAt(0)})],{type:"application/pdf"}),console.log("Blob PDF cr√©√©, taille:",g.size,"bytes"),0!==g.size){e.n=12;break}throw new Error("Le PDF g√©n√©r√© est vide");case 12:h=URL.createObjectURL(g),window.open(h,"_blank")||((y=document.createElement("a")).href=h,y.target="_blank",y.rel="noopener noreferrer",document.body.appendChild(y),y.click(),document.body.removeChild(y)),setTimeout(function(){URL.revokeObjectURL(h)},1e3),console.log("PDF g√©n√©r√© et ouvert avec succ√®s"),e.n=14;break;case 13:e.p=13,w=e.v,console.error("Erreur g√©n√©ration PDF:",w),alert("Erreur lors de la g√©n√©ration du PDF: "+w.message);case 14:return e.p=14,printButton&&(printButton.textContent="üëÅÔ∏è Imprimer PDF",printButton.disabled=!1),e.f(14);case 15:return e.a(2)}},e,null,[[1,13,14,15]])}));return function(){return e.apply(this,arguments)}}();return n?t.createElement("div",{className:"preview-modal-overlay",onClick:r},t.createElement("div",{className:"preview-modal-content",onClick:function(e){return e.stopPropagation()}},t.createElement("div",{className:"preview-modal-header"},t.createElement("h3",null,"üìÑ Aper√ßu PDF - PDF Builder Pro v2.0"),t.createElement("button",{className:"preview-modal-close",onClick:r},"√ó")),t.createElement("div",{className:"preview-modal-body"},b&&t.createElement("div",{className:"preview-loading"},t.createElement("div",{className:"preview-spinner"}),t.createElement("p",null,"G√©n√©ration de l'aper√ßu...")),h&&t.createElement("div",{className:"preview-error"},t.createElement("h4",null,"‚ùå Erreur d'aper√ßu"),t.createElement("p",null,h),t.createElement("p",null,t.createElement("small",null,"Le PDF pourra quand m√™me √™tre g√©n√©r√© normalement."))),d&&d.success&&t.createElement("div",{className:"preview-content"},t.createElement("div",{style:{textAlign:"center",marginBottom:"20px",padding:"10px",background:"#e8f5e8",borderRadius:"4px",border:"1px solid #c3e6c3"}},t.createElement("strong",null,"‚úÖ Aper√ßu g√©n√©r√© avec succ√®s"),t.createElement("br",null),t.createElement("small",null,d.elements_count," √©l√©ments ‚Ä¢ ",d.width,"√ó",d.height,"px")),t.createElement("div",{style:{display:"flex",justifyContent:"center",alignItems:"flex-start",minHeight:"400px"}},t.createElement("img",{src:"data:image/png;base64,".concat(d.preview),alt:"Aper√ßu PDF",style:{maxWidth:"100%",maxHeight:"600px",border:"1px solid #e2e8f0",borderRadius:"8px",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.1)"}}))),!b&&!h&&!d&&t.createElement("div",{className:"preview-loading"},t.createElement("p",null,"Pr√©paration de l'aper√ßu..."))),t.createElement("div",{className:"preview-modal-footer"},t.createElement("button",{className:"btn btn-secondary",onClick:r},"‚ùå Fermer"),t.createElement("button",{className:"btn btn-primary",onClick:E},"üëÅÔ∏è Imprimer PDF")))):null}}}]);