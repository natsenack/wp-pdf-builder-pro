<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Navigation PDF Builder</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .nav-tab-wrapper { border-bottom: 1px solid #ccc; margin-bottom: 20px; }
        .nav-tab { display: inline-block; padding: 10px 15px; text-decoration: none; color: #666; border: 1px solid transparent; border-bottom: none; background: #f1f1f1; margin-right: 5px; }
        .nav-tab-active { background: white; color: #000; border-color: #ccc; }
        .tab-content { display: none; padding: 20px; border: 1px solid #ccc; border-top: none; }
        .tab-content.active { display: block; }
        .status { margin: 20px 0; padding: 10px; background: #f9f9f9; border: 1px solid #ddd; }
        .success { color: green; }
        .error { color: red; }
    </style>
</head>
<body>
    <h1>Test de Navigation PDF Builder</h1>

    <div class="status" id="status">Chargement...</div>

    <nav class="nav-tab-wrapper wp-clearfix" id="pdf-builder-tabs" role="tablist">
        <a href="#general" class="nav-tab nav-tab-active" data-tab="general" role="tab" aria-selected="true">Général</a>
        <a href="#licence" class="nav-tab" data-tab="licence" role="tab" aria-selected="false">Licence</a>
        <a href="#systeme" class="nav-tab" data-tab="systeme" role="tab" aria-selected="false">Système</a>
    </nav>

    <section id="pdf-builder-tab-content" class="tab-content-wrapper">
        <div id="general" class="tab-content active">
            <h2>Contenu Général</h2>
            <p>Ceci est le contenu de l'onglet Général.</p>
        </div>
        <div id="licence" class="tab-content">
            <h2>Contenu Licence</h2>
            <p>Ceci est le contenu de l'onglet Licence.</p>
        </div>
        <div id="systeme" class="tab-content">
            <h2>Contenu Système</h2>
            <p>Ceci est le contenu de l'onglet Système.</p>
        </div>
    </section>

    <script>
    (function() {
        'use strict';

        console.log('PDF Builder: Script de navigation chargé');

        // Fonction principale d'initialisation
        function initTabNavigation() {
            console.log('PDF Builder: Initialisation forcée de la navigation');

            const tabsContainer = document.getElementById('pdf-builder-tabs');
            const contentContainer = document.getElementById('pdf-builder-tab-content');

            if (!tabsContainer || !contentContainer) {
                console.error('PDF Builder: Conteneurs non trouvés, retry dans 1s...');
                setTimeout(initTabNavigation, 1000);
                return;
            }

            const tabs = tabsContainer.querySelectorAll('.nav-tab');
            const contents = contentContainer.querySelectorAll('.tab-content');

            console.log('PDF Builder: Trouvé', tabs.length, 'onglets et', contents.length, 'contenus');

            if (tabs.length === 0 || contents.length === 0) {
                console.error('PDF Builder: Éléments manquants, retry dans 1s...');
                setTimeout(initTabNavigation, 1000);
                return;
            }

            // Fonction de changement d'onglet
            function switchTab(tabId) {
                console.log('PDF Builder: Changement vers', tabId);

                // Désactiver tous les onglets
                tabs.forEach(function(tab) {
                    tab.classList.remove('nav-tab-active');
                    tab.setAttribute('aria-selected', 'false');
                });

                // Désactiver tous les contenus
                contents.forEach(function(content) {
                    content.classList.remove('active');
                });

                // Activer l'onglet cible
                const targetTab = tabsContainer.querySelector('[data-tab="' + tabId + '"]');
                const targetContent = document.getElementById(tabId);

                if (targetTab) {
                    targetTab.classList.add('nav-tab-active');
                    targetTab.setAttribute('aria-selected', 'true');
                    console.log('PDF Builder: Onglet', tabId, 'activé');
                }

                if (targetContent) {
                    targetContent.classList.add('active');
                    console.log('PDF Builder: Contenu', tabId, 'affiché');
                }
            }

            // Gestionnaire de clic
            function handleTabClick(event) {
                event.preventDefault();
                event.stopPropagation();

                const tabId = this.getAttribute('data-tab');
                console.log('PDF Builder: Clic détecté sur onglet', tabId);

                if (tabId) {
                    switchTab(tabId);
                }
            }

            // Attacher les événements - FORCER l'attachement
            console.log('PDF Builder: Attachement des événements...');
            tabs.forEach(function(tab, index) {
                // Supprimer les anciens événements pour éviter les doublons
                tab.removeEventListener('click', handleTabClick);
                // Attacher le nouvel événement
                tab.addEventListener('click', handleTabClick);
                console.log('PDF Builder: Événement attaché à onglet', index + 1, ':', tab.getAttribute('data-tab'));
            });

            // Activer l'onglet par défaut
            const activeTab = tabsContainer.querySelector('.nav-tab-active');
            if (activeTab) {
                const activeTabId = activeTab.getAttribute('data-tab');
                if (activeTabId) {
                    switchTab(activeTabId);
                }
            }

            console.log('PDF Builder: Navigation initialisée avec succès!');
            document.getElementById('status').innerHTML = '<span class="success">✓ Navigation initialisée avec succès! Événements attachés à ' + tabs.length + ' onglets.</span>';
            return true;
        }

        // Exécution immédiate
        console.log('PDF Builder: Tentative d\'initialisation immédiate...');
        initTabNavigation();

        // Fallbacks multiples
        setTimeout(initTabNavigation, 500);
        setTimeout(initTabNavigation, 1000);
        setTimeout(initTabNavigation, 2000);
        setTimeout(initTabNavigation, 5000);

        // Aussi au chargement du DOM si pas déjà fait
        document.addEventListener('DOMContentLoaded', function() {
            console.log('PDF Builder: DOM chargé, vérification...');
            setTimeout(initTabNavigation, 100);
        });

        // Et aussi au chargement complet de la page
        window.addEventListener('load', function() {
            console.log('PDF Builder: Page chargée, vérification finale...');
            setTimeout(initTabNavigation, 100);
        });

    })();
    </script>
</body>
</html>