<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Navigation PDF Builder Pro - Version Finale</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f1f1f1;
        }

        .wrap {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .pdf-builder-header {
            background: #23282d;
            color: white;
            padding: 20px;
            margin: 0;
        }

        .pdf-builder-header h1 {
            margin: 0;
            font-size: 24px;
            font-weight: 600;
        }

        .nav-tab-wrapper {
            background: #f8f9fa;
            border-bottom: 1px solid #dee2e6;
            margin: 0;
            padding: 0 20px;
        }

        .nav-tab {
            display: inline-block;
            padding: 12px 16px;
            margin: 0;
            border: none;
            background: transparent;
            color: #666;
            text-decoration: none;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: all 0.2s ease;
        }

        .nav-tab:hover {
            color: #007cba;
        }

        .nav-tab.nav-tab-active {
            color: #007cba;
            border-bottom-color: #007cba;
            background: white;
        }

        .tab-content-wrapper {
            padding: 20px;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .tab-content h2 {
            margin-top: 0;
            color: #23282d;
            font-size: 20px;
        }

        .tab-content p {
            line-height: 1.6;
            color: #666;
        }

        .debug-panel {
            margin-top: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 4px;
            border-left: 4px solid #007cba;
        }

        .debug-panel h3 {
            margin-top: 0;
            color: #23282d;
        }

        .debug-log {
            background: #fff;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 10px;
            max-height: 200px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
            line-height: 1.4;
        }

        .debug-log div {
            margin: 2px 0;
            padding: 2px 4px;
            border-radius: 2px;
        }

        .log-info { background: #e7f3ff; color: #0066cc; }
        .log-success { background: #e8f5e8; color: #155724; }
        .log-error { background: #f8d7da; color: #721c24; }
        .log-warning { background: #fff3cd; color: #856404; }
    </style>
</head>
<body>
    <div class="wrap" id="pdf-builder-settings-wrapper">
        <header class="pdf-builder-header">
            <h1>Paramètres PDF Builder Pro - Test Final</h1>
        </header>

        <nav class="nav-tab-wrapper wp-clearfix" id="pdf-builder-tabs" role="tablist" aria-label="Onglets des paramètres PDF Builder">
            <a href="#general" class="nav-tab nav-tab-active" data-tab="general" role="tab" aria-selected="true" aria-controls="general">Général</a>
            <a href="#licence" class="nav-tab" data-tab="licence" role="tab" aria-selected="false" aria-controls="licence">Licence</a>
            <a href="#systeme" class="nav-tab" data-tab="systeme" role="tab" aria-selected="false" aria-controls="systeme">Système</a>
            <a href="#acces" class="nav-tab" data-tab="acces" role="tab" aria-selected="false" aria-controls="acces">Accès</a>
            <a href="#securite" class="nav-tab" data-tab="securite" role="tab" aria-selected="false" aria-controls="securite">Sécurité</a>
            <a href="#pdf" class="nav-tab" data-tab="pdf" role="tab" aria-selected="false" aria-controls="pdf">PDF</a>
            <a href="#contenu" class="nav-tab" data-tab="contenu" role="tab" aria-selected="false" aria-controls="contenu">Contenu</a>
            <a href="#templates" class="nav-tab" data-tab="templates" role="tab" aria-selected="false" aria-controls="templates">Modèles</a>
            <a href="#developpeur" class="nav-tab" data-tab="developpeur" role="tab" aria-selected="false" aria-controls="developpeur">Développeur</a>
        </nav>

        <section id="pdf-builder-tab-content" class="tab-content-wrapper" role="tabpanel" aria-live="polite">
            <div id="general" class="tab-content active" role="tabpanel" aria-labelledby="tab-general">
                <h2>Paramètres Généraux</h2>
                <p>Configuration générale du plugin PDF Builder Pro. Ici vous pouvez définir les paramètres de base du système.</p>
                <ul>
                    <li>Paramètre 1: Valeur par défaut</li>
                    <li>Paramètre 2: Configuration avancée</li>
                    <li>Paramètre 3: Options d'affichage</li>
                </ul>
            </div>

            <div id="licence" class="tab-content" role="tabpanel" aria-labelledby="tab-licence">
                <h2>Gestion des Licences</h2>
                <p>Gérez votre licence PDF Builder Pro et les fonctionnalités associées.</p>
                <ul>
                    <li>Clé de licence: Non activée</li>
                    <li>Statut: Version d'essai</li>
                    <li>Expiration: Jamais</li>
                </ul>
            </div>

            <div id="systeme" class="tab-content" role="tabpanel" aria-labelledby="tab-systeme">
                <h2>Configuration Système</h2>
                <p>Paramètres système et compatibilité du plugin.</p>
                <ul>
                    <li>Version PHP: 8.1+</li>
                    <li>Version WordPress: 5.0+</li>
                    <li>Mémoire: 128MB+</li>
                </ul>
            </div>

            <div id="acces" class="tab-content" role="tabpanel" aria-labelledby="tab-acces">
                <h2>Contrôle d'Accès</h2>
                <p>Définissez qui peut accéder aux fonctionnalités du plugin.</p>
                <ul>
                    <li>Rôles autorisés: Administrateur</li>
                    <li>Permissions: Lecture/Écriture</li>
                    <li>Restrictions: Aucune</li>
                </ul>
            </div>

            <div id="securite" class="tab-content" role="tabpanel" aria-labelledby="tab-securite">
                <h2>Paramètres de Sécurité</h2>
                <p>Configuration de la sécurité et des protections.</p>
                <ul>
                    <li>Validation des entrées: Activée</li>
                    <li>Protection CSRF: Activée</li>
                    <li>Logs de sécurité: Désactivés</li>
                </ul>
            </div>

            <div id="pdf" class="tab-content" role="tabpanel" aria-labelledby="tab-pdf">
                <h2>Configuration PDF</h2>
                <p>Paramètres spécifiques à la génération de PDF.</p>
                <ul>
                    <li>Format: A4</li>
                    <li>Qualité: Haute</li>
                    <li>Marges: Standard</li>
                </ul>
            </div>

            <div id="contenu" class="tab-content" role="tabpanel" aria-labelledby="tab-contenu">
                <h2>Gestion du Contenu</h2>
                <p>Options de traitement et formatage du contenu.</p>
                <ul>
                    <li>Filtrage HTML: Activé</li>
                    <li>Encodage: UTF-8</li>
                    <li>Images: Incorporées</li>
                </ul>
            </div>

            <div id="templates" class="tab-content" role="tabpanel" aria-labelledby="tab-templates">
                <h2>Modèles PDF</h2>
                <p>Gestion des modèles de document PDF disponibles.</p>
                <ul>
                    <li>Modèle par défaut: Standard</li>
                    <li>Modèles personnalisés: 0</li>
                    <li>Thèmes: 3 disponibles</li>
                </ul>
            </div>

            <div id="developpeur" class="tab-content" role="tabpanel" aria-labelledby="tab-developpeur">
                <h2>Outils Développeur</h2>
                <p>Outils et options pour les développeurs.</p>
                <ul>
                    <li>Mode debug: Désactivé</li>
                    <li>Logs détaillés: Non</li>
                    <li>API: Disponible</li>
                </ul>
            </div>
        </section>

        <div class="debug-panel">
            <h3>Logs de Débogage</h3>
            <div id="debug-log" class="debug-log"></div>
        </div>
    </div>

    <!-- Navigation JavaScript - Version Finale -->
    <!-- Charger le script principal de navigation (assets) -->
    <script src="assets/js/settings-tabs.js"></script>
    <script>
    (function() {
        'use strict';

        const debugLog = document.getElementById('debug-log');

        function addLog(message, type = 'info') {
            const logEntry = document.createElement('div');
            logEntry.className = 'log-' + type;
            logEntry.textContent = '[' + new Date().toLocaleTimeString() + '] ' + message;
            debugLog.appendChild(logEntry);
            debugLog.scrollTop = debugLog.scrollHeight;
            console.log('PDF Builder:', message);
        }

        addLog('Script de navigation chargé');

        function initTabNavigation() {
            addLog('Initialisation de la navigation par onglets');

            // Vérifier que les éléments existent
            const tabsContainer = document.getElementById('pdf-builder-tabs');
            const contentContainer = document.getElementById('pdf-builder-tab-content');

            if (!tabsContainer) {
                addLog('Conteneur d\'onglets non trouvé!', 'error');
                return false;
            }

            if (!contentContainer) {
                addLog('Conteneur de contenu non trouvé!', 'error');
                return false;
            }

            const tabs = tabsContainer.querySelectorAll('.nav-tab');
            const contents = contentContainer.querySelectorAll('.tab-content');

            addLog('Onglets trouvés: ' + tabs.length);
            addLog('Contenus trouvés: ' + contents.length);

            if (tabs.length === 0 || contents.length === 0) {
                addLog('Éléments insuffisants pour la navigation', 'error');
                return false;
            }

            function switchTab(tabId) {
                addLog('Changement vers onglet: ' + tabId);

                // Désactiver tous les onglets
                tabs.forEach(function(tab) {
                    tab.classList.remove('nav-tab-active');
                    tab.setAttribute('aria-selected', 'false');
                });

                // Désactiver tous les contenus
                contents.forEach(function(content) {
                    content.classList.remove('active');
                });

                // Activer l'onglet cible
                const targetTab = tabsContainer.querySelector('[data-tab="' + tabId + '"]');
                const targetContent = document.getElementById(tabId);

                if (targetTab) {
                    targetTab.classList.add('nav-tab-active');
                    targetTab.setAttribute('aria-selected', 'true');
                    addLog('Onglet activé: ' + tabId, 'success');
                } else {
                    addLog('Onglet cible non trouvé: ' + tabId, 'error');
                }

                if (targetContent) {
                    targetContent.classList.add('active');
                    addLog('Contenu activé: ' + tabId, 'success');
                } else {
                    addLog('Contenu cible non trouvé: ' + tabId, 'error');
                }
            }

            function handleTabClick(event) {
                event.preventDefault();
                const tabId = event.currentTarget.getAttribute('data-tab');
                addLog('Clic sur onglet: ' + tabId, 'warning');
                if (tabId) {
                    switchTab(tabId);
                }
            }

            // Attacher les événements aux onglets
            tabs.forEach(function(tab) {
                tab.addEventListener('click', handleTabClick);
                addLog('Événement attaché à onglet: ' + tab.getAttribute('data-tab'), 'success');
            });

            // Forcer l'affichage de l'onglet actif initial
            const activeTab = tabsContainer.querySelector('.nav-tab-active');
            if (activeTab) {
                const activeTabId = activeTab.getAttribute('data-tab');
                if (activeTabId) {
                    switchTab(activeTabId);
                }
            }

            addLog('Navigation initialisée avec succès', 'success');
            return true;
        }

        // Attendre que le DOM soit chargé
        if (document.readyState === 'loading') {
            addLog('Attente du chargement du DOM...');
            document.addEventListener('DOMContentLoaded', function() {
                addLog('DOM chargé, initialisation...', 'success');
                initTabNavigation();
            });
        } else {
            // DOM déjà chargé
            addLog('DOM déjà chargé, initialisation...', 'success');
            initTabNavigation();
        }

        // Fallback: essayer d'initialiser après un court délai
        setTimeout(function() {
            if (!document.querySelector('#pdf-builder-tabs .nav-tab-active + .active')) {
                addLog('Tentative d\'initialisation retardée...', 'warning');
                initTabNavigation();
            }
        }, 1000);

        // Test dynamique: remplacer le container des onglets après un délai (simule un rendu SPA/React)
        setTimeout(function() {
            try {
                const tabsContainer = document.getElementById('pdf-builder-tabs');
                if (tabsContainer) {
                    tabsContainer.innerHTML = `
                        <a href="#general" class="nav-tab nav-tab-active" data-tab="general">Général (R)</a>
                        <a href="#licence" class="nav-tab" data-tab="licence">Licence (R)</a>
                        <a href="#systeme" class="nav-tab" data-tab="systeme">Système (R)</a>
                        <a href="#acces" class="nav-tab" data-tab="acces">Accès (R)</a>
                    `;
                    addLog('Container des onglets remplacé dynamiquement (test)', 'warning');
                }
            } catch(e) { addLog('Erreur test dynamique: ' + (e.message || e), 'error'); }
        }, 2000);

    })();
    </script>

    <!-- Test automatique: parcours des onglets via l'API si disponible -->
    <script>
        (function() {
            if (window.PDFBuilderTabsAPI && typeof window.PDFBuilderTabsAPI.switchToTab === 'function') {
                const ids = ['general','licence','systeme','acces','securite','pdf','contenu','templates','developpeur'];
                let i=0;
                const interval = setInterval(() => {
                    if (i >= ids.length) { clearInterval(interval); return; }
                    const id = ids[i++];
                    try { window.PDFBuilderTabsAPI.switchToTab(id); } catch(e) { console.warn('Switch via API failed', e); }
                }, 400);
            } else {
                console.log('API non disponible pour le test automatique');
            }
        })();
    </script>
</body>
</html>