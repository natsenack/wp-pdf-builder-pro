<!DOCTYPE html>
<html>
<head>
    <title>Test Template Preview System</title>
    <style>
        .template-preview {
            border: 1px solid #ddd;
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .current-template {
            color: #28a745;
            font-weight: bold;
        }
        .no-template {
            color: #6c757d;
            font-style: italic;
        }
    </style>
</head>
<body>
    <h1>Test du système de prévisualisation des templates</h1>

    <article>
        <h3>Status: processing</h3>
        <select class="template-select" id="template_processing">
            <option value="">Sélectionner un template</option>
            <option value="123">Template Test 1</option>
            <option value="456">Template Test 2</option>
        </select>
        <div class="template-preview">
            <p class="no-template">Aucun template assigné</p>
        </div>
    </article>

    <article>
        <h3>Status: completed</h3>
        <select class="template-select" id="template_completed">
            <option value="">Sélectionner un template</option>
            <option value="123">Template Test 1</option>
            <option value="456">Template Test 2</option>
        </select>
        <div class="template-preview">
            <p class="current-template">Template Test 1</p>
        </div>
    </article>

    <button id="test-update">Tester la mise à jour des prévisualisations</button>

    <script>
        // Simuler les données comme si elles venaient du serveur
        const mockData = {
            mappings: {
                processing: "",
                completed: "123"
            },
            templates: {
                "123": "Template Test 1",
                "456": "Template Test 2"
            }
        };

        // Fonction de test (similaire à updateTemplatePreviews)
        function updateTemplatePreviews() {
            const mappings = mockData.mappings || {};
            const templates = mockData.templates || {};

            // Mettre à jour chaque prévisualisation
            document.querySelectorAll('.template-preview').forEach(preview => {
                const statusKey = preview.closest('article').querySelector('.template-select').id.replace('template_', '');
                const assignedTemplate = mappings[statusKey];

                if (assignedTemplate && templates[assignedTemplate]) {
                    // Template assigné - afficher le nom
                    preview.innerHTML = `<p class="current-template">${templates[assignedTemplate]}</p>`;
                } else {
                    // Aucun template assigné
                    preview.innerHTML = '<p class="no-template">Aucun template assigné</p>';
                }
            });

            console.log('Prévisualisations mises à jour');
        }

        // Ajouter l'événement au bouton de test
        document.getElementById('test-update').addEventListener('click', updateTemplatePreviews);

        // Test initial
        updateTemplatePreviews();
    </script>
</body>
</html>