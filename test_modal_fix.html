<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Modal Fix - PDF Builder Pro</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        button { padding: 10px 20px; margin: 10px; background: #007cba; color: white; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #005a87; }
        #status { margin-top: 20px; padding: 10px; background: #f0f0f0; border-radius: 4px; }
    </style>
</head>
<body>
    <h1>üß™ Test Correction Modal Preview</h1>
    <p>Test rapide pour v√©rifier que le React error #306 est r√©solu.</p>

    <button onclick="testModal()">Tester le Modal d'Aper√ßu</button>
    <button onclick="checkPDFBuilderPro()">V√©rifier PDFBuilderPro</button>

    <div id="status">Status: Pr√™t</div>

    <!-- Scripts compil√©s -->
    <script src="assets/js/dist/vendors.js"></script>
    <script src="assets/js/dist/pdf-builder-admin.js"></script>

    <script>
        function updateStatus(message) {
            document.getElementById('status').textContent = 'Status: ' + message;
            console.log(message);
        }

        function checkPDFBuilderPro() {
            updateStatus('V√©rification de PDFBuilderPro...');
            console.log('üîç PDFBuilderPro:', window.PDFBuilderPro);
            console.log('üîç Type:', typeof window.PDFBuilderPro);

            if (window.PDFBuilderPro) {
                console.log('üîç Keys:', Object.keys(window.PDFBuilderPro));
                console.log('üîç hasOwnProperty showPreview:', window.PDFBuilderPro.hasOwnProperty('showPreview'));
                console.log('üîç showPreview in PDFBuilderPro:', 'showPreview' in window.PDFBuilderPro);
                console.log('üîç PDFBuilderPro.showPreview:', window.PDFBuilderPro.showPreview);
                console.log('üîç Type of showPreview:', typeof window.PDFBuilderPro.showPreview);

                // Tester l'√©num√©rabilit√©
                for (let key in window.PDFBuilderPro) {
                    if (key === 'showPreview') {
                        console.log('üîç showPreview trouv√© dans for...in loop');
                    }
                }

                updateStatus('‚úÖ PDFBuilderPro trouv√©');
            } else {
                updateStatus('‚ùå PDFBuilderPro non trouv√©');
            }
        }

        function testModal() {
            updateStatus('Test du modal...');

            console.log('üîç Au d√©but de testModal:');
            console.log('üîç window.PDFBuilderPro:', window.PDFBuilderPro);
            console.log('üîç typeof PDFBuilderPro:', typeof window.PDFBuilderPro);

            try {
                // V√©rifier d'abord si PDFBuilderPro existe
                if (!window.PDFBuilderPro) {
                    updateStatus('‚ùå PDFBuilderPro n\'existe pas du tout');
                    return;
                }

                console.log('üîç PDFBuilderPro existe, v√©rification de showPreview...');
                console.log('üîç PDFBuilderPro.showPreview:', window.PDFBuilderPro.showPreview);
                console.log('üîç typeof showPreview:', typeof window.PDFBuilderPro.showPreview);
                console.log('üîç hasOwnProperty:', window.PDFBuilderPro.hasOwnProperty('showPreview'));
                console.log('üîç in operator:', 'showPreview' in window.PDFBuilderPro);

                // Simuler l'ouverture du modal comme dans l'√©diteur
                if (window.PDFBuilderPro.showPreview) {
                    const testData = {
                        elements: [
                            { type: 'text', x: 50, y: 50, width: 200, height: 30, content: 'Test Modal Fix' }
                        ],
                        canvasWidth: 595,
                        canvasHeight: 842
                    };

                    console.log('üîç Appel de PDFBuilderPro.showPreview avec:', testData);
                    window.PDFBuilderPro.showPreview(testData);
                    updateStatus('‚úÖ Modal ouvert avec succ√®s');
                } else {
                    console.log('üîç PDFBuilderPro.showPreview est falsy');
                    updateStatus('‚ùå PDFBuilderPro.showPreview non disponible');
                }
            } catch (error) {
                updateStatus('‚ùå Erreur: ' + error.message);
                console.error('Erreur modal:', error);
            }
        }

        // Auto-test au chargement avec d√©lai
        window.addEventListener('load', function() {
            console.log('üîç Page charg√©e, attente de 2 secondes pour les scripts...');
            setTimeout(function() {
                console.log('üîç V√©rification automatique apr√®s d√©lai...');
                checkPDFBuilderPro();
            }, 2000);
        });
    </script>
</body>
</html>