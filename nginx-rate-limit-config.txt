# Nginx rate limiting configuration for WordPress/WooCommerce
# Add this to your nginx server block

# Rate limiting zones
limit_req_zone $binary_remote_addr zone=threeaxe.fr:10m rate=10r/s;
limit_req_zone $binary_remote_addr zone=admin:10m rate=5r/s;
limit_req_zone $binary_remote_addr zone=ajax:10m rate=2r/s;

# Apply rate limiting
location / {
    limit_req zone=threeaxe.fr burst=20 nodelay;
    try_files $uri $uri/ /index.php?$args;
}

# Stricter limits for admin area
location /wp-admin/ {
    limit_req zone=admin burst=10 nodelay;
    try_files $uri $uri/ /index.php?$args;
}

# Limits for AJAX calls
location /wp-admin/admin-ajax.php {
    limit_req zone=ajax burst=5 nodelay;
    try_files $uri $uri/ /index.php?$args;
}

# Block xmlrpc attacks
location /xmlrpc.php {
    deny all;
}

# Allow WooCommerce API with reasonable limits
location /wp-json/ {
    limit_req zone=threeaxe.fr burst=15 nodelay;
    try_files $uri $uri/ /index.php?$args;
}