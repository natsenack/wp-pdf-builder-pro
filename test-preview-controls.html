<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Contr√¥les Aper√ßu - PDF Builder Pro</title>
    <style>
        /* Copie des styles de la modal pour test */
        .pdf-builder-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 10000;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .preview-modal-content {
            background: #fff;
            border-radius: 8px;
            max-width: 90vw;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }
        .modal-toolbar {
            padding: 10px 20px;
            border-bottom: 1px solid #ddd;
            background: #f8f9fa;
        }
        .preview-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 20px;
            flex-wrap: wrap;
        }
        .zoom-controls, .rotation-controls, .download-controls {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .control-btn {
            padding: 6px 12px;
            border: 1px solid #ddd;
            background: #fff;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
        }
        .control-btn:hover {
            background: #f0f0f0;
            border-color: #bbb;
        }
        #zoom-level, #rotation-angle {
            min-width: 50px;
            text-align: center;
            font-weight: bold;
        }
        .preview-image-container {
            position: relative;
            min-height: 400px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #f8f9fa;
            border-radius: 4px;
        }
        .preview-image-container img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
            transition: transform 0.3s ease;
            cursor: move;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .preview-controls {
                flex-direction: column;
                gap: 10px;
            }
            .zoom-controls, .rotation-controls, .download-controls {
                justify-content: center;
            }
        }
        @media (max-width: 480px) {
            .control-btn {
                padding: 4px 8px;
                font-size: 12px;
            }
        }

        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-info { background: #e8f5e8; padding: 15px; border-radius: 5px; margin-bottom: 20px; }
    </style>
</head>
<body>
    <div class="test-info">
        <h2>üß™ Test des Contr√¥les d'Aper√ßu</h2>
        <p><strong>Objectif :</strong> Valider le fonctionnement des contr√¥les zoom, rotation et t√©l√©chargement</p>
        <p><strong>Test responsive :</strong> Redimensionnez la fen√™tre pour tester l'adaptation mobile</p>
        <button onclick="openTestModal()">Ouvrir Modal de Test</button>
    </div>

    <!-- Modale d'aper√ßu -->
    <div id="preview-modal" class="pdf-builder-modal" style="display: none;">
        <div class="modal-content preview-modal-content">
            <div class="modal-header">
                <h3>Aper√ßu de Test</h3>
                <button class="close-modal" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-toolbar">
                <div class="preview-controls">
                    <div class="zoom-controls">
                        <button id="zoom-out" class="control-btn" title="Zoom arri√®re">üîç-</button>
                        <span id="zoom-level">100%</span>
                        <button id="zoom-in" class="control-btn" title="Zoom avant">üîç+</button>
                        <button id="zoom-fit" class="control-btn" title="Ajuster √† la fen√™tre">‚õ∂</button>
                    </div>
                    <div class="rotation-controls">
                        <button id="rotate-left" class="control-btn" title="Rotation gauche">‚Ü∫</button>
                        <span id="rotation-angle">0¬∞</span>
                        <button id="rotate-right" class="control-btn" title="Rotation droite">‚Üª</button>
                    </div>
                    <div class="download-controls">
                        <button id="download-pdf" class="control-btn" title="T√©l√©charger PDF">üìÑ PDF</button>
                        <button id="download-png" class="control-btn" title="T√©l√©charger PNG">üñºÔ∏è PNG</button>
                        <button id="download-jpg" class="control-btn" title="T√©l√©charger JPG">üñºÔ∏è JPG</button>
                    </div>
                </div>
            </div>
            <div class="modal-body">
                <div id="preview-container" class="preview-image-container">
                    <img src="https://via.placeholder.com/800x600/3498db/ffffff?text=Test+Preview" alt="Test Preview" id="preview-image">
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentZoom = 100;
        let currentRotation = 0;

        function openTestModal() {
            document.getElementById('preview-modal').style.display = 'flex';
            fitToWindow();
        }

        function closeModal() {
            document.getElementById('preview-modal').style.display = 'none';
        }

        // Contr√¥les de zoom
        document.getElementById('zoom-in').addEventListener('click', () => adjustZoom(25));
        document.getElementById('zoom-out').addEventListener('click', () => adjustZoom(-25));
        document.getElementById('zoom-fit').addEventListener('click', fitToWindow);

        // Contr√¥les de rotation
        document.getElementById('rotate-left').addEventListener('click', () => adjustRotation(-90));
        document.getElementById('rotate-right').addEventListener('click', () => adjustRotation(90));

        // Contr√¥les de t√©l√©chargement
        document.getElementById('download-pdf').addEventListener('click', () => downloadPreview('pdf'));
        document.getElementById('download-png').addEventListener('click', () => downloadPreview('png'));
        document.getElementById('download-jpg').addEventListener('click', () => downloadPreview('jpg'));

        function adjustZoom(delta) {
            const img = document.getElementById('preview-image');
            currentZoom = Math.max(25, Math.min(500, currentZoom + delta));
            updateImageTransform();
            document.getElementById('zoom-level').textContent = currentZoom + '%';
        }

        function adjustRotation(delta) {
            currentRotation = (currentRotation + delta) % 360;
            updateImageTransform();
            document.getElementById('rotation-angle').textContent = currentRotation + '¬∞';
        }

        function fitToWindow() {
            const container = document.getElementById('preview-container');
            const img = document.getElementById('preview-image');
            const containerWidth = container.offsetWidth;
            const containerHeight = container.offsetHeight;
            const imgWidth = img.naturalWidth;
            const imgHeight = img.naturalHeight;

            const scaleX = containerWidth / imgWidth;
            const scaleY = containerHeight / imgHeight;
            const scale = Math.min(scaleX, scaleY) * 100;

            currentZoom = Math.max(25, Math.min(500, scale));
            updateImageTransform();
            document.getElementById('zoom-level').textContent = Math.round(currentZoom) + '%';
        }

        function updateImageTransform() {
            const img = document.getElementById('preview-image');
            img.style.transform = `scale(${currentZoom / 100}) rotate(${currentRotation}deg)`;
        }

        function downloadPreview(format) {
            alert(`T√©l√©chargement simul√© pour le format ${format.toUpperCase()}\n\nDans l'application r√©elle, cela d√©clencherait le t√©l√©chargement du fichier g√©n√©r√©.`);
        }

        // Gestion du drag
        let isDragging = false;
        let startX, startY;

        document.getElementById('preview-image').addEventListener('mousedown', (e) => {
            isDragging = true;
            startX = e.clientX - e.target.offsetLeft;
            startY = e.clientY - e.target.offsetTop;
            e.target.style.cursor = 'grabbing';
        });

        document.addEventListener('mousemove', (e) => {
            if (!isDragging) return;
            e.preventDefault();
            const img = document.getElementById('preview-image');
            const x = e.clientX - startX;
            const y = e.clientY - startY;
            img.style.transform = `translate(${x}px, ${y}px) scale(${currentZoom / 100}) rotate(${currentRotation}deg)`;
        });

        document.addEventListener('mouseup', () => {
            isDragging = false;
            document.getElementById('preview-image').style.cursor = 'move';
        });

        // Fermeture en cliquant en dehors
        document.getElementById('preview-modal').addEventListener('click', (e) => {
            if (e.target === document.getElementById('preview-modal')) {
                closeModal();
            }
        });
    </script>
</body>
</html>