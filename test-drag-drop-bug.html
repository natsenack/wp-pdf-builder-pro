<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Drag & Drop Bug</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        #test-container {
            border: 1px solid #ccc;
            width: 800px;
            height: 600px;
            position: relative;
        }
        #pdf-builder-canvas {
            border: 1px solid #000;
            background: #f9f9f9;
        }
        .controls {
            margin: 10px 0;
        }
        button {
            margin: 5px;
            padding: 8px 16px;
        }
    </style>
</head>
<body>
    <h1>Test du bug Drag & Drop</h1>
    <p>Cliquez sur "Ajouter un élément" puis faites un drag & drop, puis cliquez à nouveau sur l'élément.</p>

    <div class="controls">
        <button id="add-element">Ajouter un élément</button>
        <button id="clear-canvas">Vider le canvas</button>
        <button id="log-selection">Log sélection</button>
    </div>

    <div id="test-container">
        <canvas id="pdf-builder-canvas" width="800" height="600"></canvas>
    </div>

    <div id="log"></div>

    <script type="module">
        import { PDFCanvasVanilla } from './assets/js/src/pdf-canvas-vanilla.js';

        let canvas;

        function log(message) {
            const logDiv = document.getElementById('log');
            logDiv.innerHTML += '<div>' + new Date().toLocaleTimeString() + ': ' + message + '</div>';
            console.log(message);
        }

        function initCanvas() {
            try {
                canvas = new PDFCanvasVanilla('test-container', {
                    canvasElementId: 'pdf-builder-canvas',
                    width: 800,
                    height: 600
                });

                canvas.init();
                log('Canvas initialisé');

                // Écouter les événements de sélection
                canvas.on('selection-changed', (data) => {
                    log('Sélection changée: ' + JSON.stringify(data));
                });

            } catch (error) {
                log('Erreur d\'initialisation: ' + error.message);
                console.error(error);
            }
        }

        document.getElementById('add-element').addEventListener('click', () => {
            if (!canvas) return;

            const elementId = canvas.addElement('rectangle', {
                x: 100,
                y: 100,
                width: 100,
                height: 50,
                fillColor: '#ff0000'
            });

            log('Élément ajouté: ' + elementId);
        });

        document.getElementById('clear-canvas').addEventListener('click', () => {
            if (!canvas) return;

            // Vider tous les éléments
            const elements = Array.from(canvas.elements.keys());
            elements.forEach(id => canvas.deleteElement(id));

            log('Canvas vidé');
        });

        document.getElementById('log-selection').addEventListener('click', () => {
            if (!canvas) return;

            const selectedIds = canvas.selectionManager.getSelectedElementIds();
            const selectedElement = canvas.selectedElement;

            log('IDs sélectionnés: ' + JSON.stringify(selectedIds));
            log('selectedElement: ' + (selectedElement ? selectedElement.id : 'null'));
        });

        // Initialiser le canvas au chargement
        window.addEventListener('load', initCanvas);
    </script>
</body>
</html></content>
<parameter name="filePath">D:\wp-pdf-builder-pro\test-drag-drop-bug.html