<!DOCTYPE html>
<html>
<head>
    <title>Test Canvas Settings Integration</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .success { background-color: #d4edda; border-color: #c3e6cb; }
        .error { background-color: #f8d7da; border-color: #f5c6cb; }
        .warning { background-color: #fff3cd; border-color: #ffeaa7; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 3px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>üß™ Test d'int√©gration des param√®tres Canvas</h1>

    <div id="wp-settings-test" class="test-section">
        <h3>Param√®tres WordPress (window.pdfBuilderCanvasSettings)</h3>
        <div id="wp-settings-content">Chargement...</div>
    </div>

    <div id="hook-settings-test" class="test-section">
        <h3>Param√®tres du Hook useGlobalSettings</h3>
        <div id="hook-settings-content">Chargement...</div>
    </div>

    <div id="comparison-test" class="test-section">
        <h3>Comparaison des param√®tres</h3>
        <div id="comparison-content">Chargement...</div>
    </div>

    <script>
        // Simuler les param√®tres WordPress (comme ils seraient inject√©s par wp_localize_script)
        window.pdfBuilderCanvasSettings = {
            // Param√®tres g√©n√©raux du canvas
            default_canvas_width: 210,
            default_canvas_height: 297,
            default_canvas_unit: 'mm',
            default_orientation: 'portrait',
            canvas_background_color: '#ffffff',
            canvas_show_transparency: false,

            // Marges de s√©curit√©
            margin_top: 10,
            margin_right: 10,
            margin_bottom: 10,
            margin_left: 10,
            show_margins: true,

            // Param√®tres de grille
            show_grid: true,
            grid_size: 10,
            grid_color: '#e0e0e0',
            grid_opacity: 30,

            // Aimantation
            snap_to_grid: true,
            snap_to_elements: true,
            snap_to_margins: true,
            snap_tolerance: 5,

            // Lignes guides
            show_guides: true,
            lock_guides: false,

            // Param√®tres de zoom et navigation
            default_zoom: '100',
            min_zoom: 10,
            max_zoom: 500,
            zoom_step: 25,
            pan_with_mouse: true,
            smooth_zoom: true,
            show_zoom_indicator: true,
            zoom_with_wheel: true,
            zoom_to_selection: true,

            // Param√®tres de s√©lection et manipulation
            show_resize_handles: true,
            handle_size: 8,
            handle_color: '#007cba',
            enable_rotation: true,
            rotation_step: 15,
            rotation_snap: true,
            multi_select: true,
            select_all_shortcut: true,
            show_selection_bounds: true,
            copy_paste_enabled: true,
            duplicate_on_drag: false,

            // Param√®tres d'export et qualit√©
            export_quality: 'print',
            export_format: 'pdf',
            compress_images: true,
            image_quality: 85,
            max_image_size: 2048,
            include_metadata: true,
            pdf_author: 'Test Author',
            pdf_subject: 'Test Subject',
            auto_crop: false,
            embed_fonts: true,
            optimize_for_web: true,

            // Param√®tres avanc√©s
            enable_hardware_acceleration: true,
            limit_fps: true,
            max_fps: 60,
            auto_save_enabled: true,
            auto_save_interval: 30,
            auto_save_versions: 10,
            undo_levels: 50,
            redo_levels: 50,
            enable_keyboard_shortcuts: true,
            debug_mode: false,
            show_fps: false,

            // Anciens param√®tres (pour compatibilit√©)
            canvas_handle_size: 12,
            canvas_handle_color: '#007cba',
            canvas_handle_hover_color: '#ffffff',
            canvas_border_width: 2,
            canvas_border_color: '#007cba',
            canvas_border_spacing: 2,
            canvas_resize_handles_enabled: true,
            canvas_element_borders_enabled: true,
            default_text_color: '#000000',
            default_background_color: '#ffffff',
            default_font_size: 14
        };

        // Simuler les param√®tres AJAX
        window.pdfBuilderAjax = {
            ajaxurl: '/wp-admin/admin-ajax.php',
            nonce: 'test-nonce-123'
        };

        // Simuler le hook useGlobalSettings
        const useGlobalSettings = () => {
            const [settings, setSettings] = [{}, () => {}]; // Mock React state

            const getWordPressSettings = () => {
                if (window.pdfBuilderCanvasSettings) {
                    return window.pdfBuilderCanvasSettings;
                }
                return null;
            };

            const getAjaxSettings = () => {
                if (window.pdfBuilderAjax) {
                    return {
                        ajaxurl: window.pdfBuilderAjax.ajaxurl || '',
                        nonce: window.pdfBuilderAjax.nonce || ''
                    };
                }
                return {
                    ajaxurl: window.ajaxurl || '',
                    nonce: window.pdfBuilderNonce || ''
                };
            };

            // Simuler useEffect
            const wpSettings = getWordPressSettings();
            const ajaxSettings = getAjaxSettings();

            let finalSettings = {
                // Valeurs par d√©faut
                defaultCanvasWidth: 210,
                defaultCanvasHeight: 297,
                defaultCanvasUnit: 'mm',
                defaultOrientation: 'portrait',
                canvasBackgroundColor: '#ffffff',
                canvasShowTransparency: false,
                marginTop: 10,
                marginRight: 10,
                marginBottom: 10,
                marginLeft: 10,
                showMargins: true,
                showGrid: true,
                gridSize: 10,
                gridColor: '#e0e0e0',
                gridOpacity: 30,
                snapToGrid: true,
                snapToElements: true,
                snapToMargins: true,
                snapTolerance: 5,
                showGuides: true,
                lockGuides: false,
                defaultZoom: '100',
                minZoom: 10,
                maxZoom: 500,
                zoomStep: 25,
                panWithMouse: true,
                smoothZoom: true,
                showZoomIndicator: true,
                zoomWithWheel: true,
                zoomToSelection: true,
                showResizeHandles: true,
                handleSize: 8,
                handleColor: '#007cba',
                enableRotation: true,
                rotationStep: 15,
                rotationSnap: true,
                multiSelect: true,
                selectAllShortcut: true,
                showSelectionBounds: true,
                copyPasteEnabled: true,
                duplicateOnDrag: false,
                exportQuality: 'print',
                exportFormat: 'pdf',
                compressImages: true,
                imageQuality: 85,
                maxImageSize: 2048,
                includeMetadata: true,
                pdfAuthor: '',
                pdfSubject: '',
                autoCrop: false,
                embedFonts: true,
                optimizeForWeb: true,
                enableHardwareAcceleration: true,
                limitFps: true,
                maxFps: 60,
                autoSaveEnabled: true,
                autoSaveInterval: 30,
                autoSaveVersions: 10,
                undoLevels: 50,
                redoLevels: 50,
                enableKeyboardShortcuts: true,
                debugMode: false,
                showFps: false,
                resizeHandleSize: 12,
                resizeHandleColor: '#007cba',
                resizeHandleBorderColor: '#ffffff',
                selectionBorderWidth: 2,
                selectionBorderColor: 'var(--primary-color)',
                selectionShadowOpacity: 0.1,
                selectionBorderSpacing: 2,
                resizeZoneSize: 16,
                resizeZoneOpacity: 0.1,
                showResizeHandlesLegacy: true,
                showResizeZones: true,
                selectionAnimation: true,
                defaultTextColor: '#000000',
                defaultBackgroundColor: '#ffffff',
                defaultFontSize: 14,
                ajaxurl: '',
                nonce: ''
            };

            if (wpSettings) {
                finalSettings = {
                    ...finalSettings,
                    ...ajaxSettings,
                    defaultCanvasWidth: wpSettings.default_canvas_width || finalSettings.defaultCanvasWidth,
                    defaultCanvasHeight: wpSettings.default_canvas_height || finalSettings.defaultCanvasHeight,
                    defaultCanvasUnit: wpSettings.default_canvas_unit || finalSettings.defaultCanvasUnit,
                    defaultOrientation: wpSettings.default_orientation || finalSettings.defaultOrientation,
                    canvasBackgroundColor: wpSettings.canvas_background_color || finalSettings.canvasBackgroundColor,
                    canvasShowTransparency: wpSettings.canvas_show_transparency !== undefined ? wpSettings.canvas_show_transparency : finalSettings.canvasShowTransparency,
                    marginTop: wpSettings.margin_top || finalSettings.marginTop,
                    marginRight: wpSettings.margin_right || finalSettings.marginRight,
                    marginBottom: wpSettings.margin_bottom || finalSettings.marginBottom,
                    marginLeft: wpSettings.margin_left || finalSettings.marginLeft,
                    showMargins: wpSettings.show_margins !== undefined ? wpSettings.show_margins : finalSettings.showMargins,
                    showGrid: wpSettings.show_grid !== undefined ? wpSettings.show_grid : finalSettings.showGrid,
                    gridSize: wpSettings.grid_size || finalSettings.gridSize,
                    gridColor: wpSettings.grid_color || finalSettings.gridColor,
                    gridOpacity: wpSettings.grid_opacity || finalSettings.gridOpacity,
                    snapToGrid: wpSettings.snap_to_grid !== undefined ? wpSettings.snap_to_grid : finalSettings.snapToGrid,
                    snapToElements: wpSettings.snap_to_elements !== undefined ? wpSettings.snap_to_elements : finalSettings.snapToElements,
                    snapToMargins: wpSettings.snap_to_margins !== undefined ? wpSettings.snap_to_margins : finalSettings.snapToMargins,
                    snapTolerance: wpSettings.snap_tolerance || finalSettings.snapTolerance,
                    showGuides: wpSettings.show_guides !== undefined ? wpSettings.show_guides : finalSettings.showGuides,
                    lockGuides: wpSettings.lock_guides !== undefined ? wpSettings.lock_guides : finalSettings.lockGuides,
                    defaultZoom: wpSettings.default_zoom || finalSettings.defaultZoom,
                    minZoom: wpSettings.min_zoom || finalSettings.minZoom,
                    maxZoom: wpSettings.max_zoom || finalSettings.maxZoom,
                    zoomStep: wpSettings.zoom_step || finalSettings.zoomStep,
                    panWithMouse: wpSettings.pan_with_mouse !== undefined ? wpSettings.pan_with_mouse : finalSettings.panWithMouse,
                    smoothZoom: wpSettings.smooth_zoom !== undefined ? wpSettings.smooth_zoom : finalSettings.smoothZoom,
                    showZoomIndicator: wpSettings.show_zoom_indicator !== undefined ? wpSettings.show_zoom_indicator : finalSettings.showZoomIndicator,
                    zoomWithWheel: wpSettings.zoom_with_wheel !== undefined ? wpSettings.zoom_with_wheel : finalSettings.zoomWithWheel,
                    zoomToSelection: wpSettings.zoom_to_selection !== undefined ? wpSettings.zoom_to_selection : finalSettings.zoomToSelection,
                    showResizeHandles: wpSettings.show_resize_handles !== undefined ? wpSettings.show_resize_handles : finalSettings.showResizeHandles,
                    handleSize: wpSettings.handle_size || finalSettings.handleSize,
                    handleColor: wpSettings.handle_color || finalSettings.handleColor,
                    enableRotation: wpSettings.enable_rotation !== undefined ? wpSettings.enable_rotation : finalSettings.enableRotation,
                    rotationStep: wpSettings.rotation_step || finalSettings.rotationStep,
                    rotationSnap: wpSettings.rotation_snap !== undefined ? wpSettings.rotation_snap : finalSettings.rotationSnap,
                    multiSelect: wpSettings.multi_select !== undefined ? wpSettings.multi_select : finalSettings.multiSelect,
                    selectAllShortcut: wpSettings.select_all_shortcut !== undefined ? wpSettings.select_all_shortcut : finalSettings.selectAllShortcut,
                    showSelectionBounds: wpSettings.show_selection_bounds !== undefined ? wpSettings.show_selection_bounds : finalSettings.showSelectionBounds,
                    copyPasteEnabled: wpSettings.copy_paste_enabled !== undefined ? wpSettings.copy_paste_enabled : finalSettings.copyPasteEnabled,
                    duplicateOnDrag: wpSettings.duplicate_on_drag !== undefined ? wpSettings.duplicate_on_drag : finalSettings.duplicateOnDrag,
                    exportQuality: wpSettings.export_quality || finalSettings.exportQuality,
                    exportFormat: wpSettings.export_format || finalSettings.exportFormat,
                    compressImages: wpSettings.compress_images !== undefined ? wpSettings.compress_images : finalSettings.compressImages,
                    imageQuality: wpSettings.image_quality || finalSettings.imageQuality,
                    maxImageSize: wpSettings.max_image_size || finalSettings.maxImageSize,
                    includeMetadata: wpSettings.include_metadata !== undefined ? wpSettings.include_metadata : finalSettings.includeMetadata,
                    pdfAuthor: wpSettings.pdf_author || finalSettings.pdfAuthor,
                    pdfSubject: wpSettings.pdf_subject || finalSettings.pdfSubject,
                    autoCrop: wpSettings.auto_crop !== undefined ? wpSettings.auto_crop : finalSettings.autoCrop,
                    embedFonts: wpSettings.embed_fonts !== undefined ? wpSettings.embed_fonts : finalSettings.embedFonts,
                    optimizeForWeb: wpSettings.optimize_for_web !== undefined ? wpSettings.optimize_for_web : finalSettings.optimizeForWeb,
                    enableHardwareAcceleration: wpSettings.enable_hardware_acceleration !== undefined ? wpSettings.enable_hardware_acceleration : finalSettings.enableHardwareAcceleration,
                    limitFps: wpSettings.limit_fps !== undefined ? wpSettings.limit_fps : finalSettings.limitFps,
                    maxFps: wpSettings.max_fps || finalSettings.maxFps,
                    autoSaveEnabled: wpSettings.auto_save_enabled !== undefined ? wpSettings.auto_save_enabled : finalSettings.autoSaveEnabled,
                    autoSaveInterval: wpSettings.auto_save_interval || finalSettings.autoSaveInterval,
                    autoSaveVersions: wpSettings.auto_save_versions || finalSettings.autoSaveVersions,
                    undoLevels: wpSettings.undo_levels || finalSettings.undoLevels,
                    redoLevels: wpSettings.redo_levels || finalSettings.redoLevels,
                    enableKeyboardShortcuts: wpSettings.enable_keyboard_shortcuts !== undefined ? wpSettings.enable_keyboard_shortcuts : finalSettings.enableKeyboardShortcuts,
                    debugMode: wpSettings.debug_mode !== undefined ? wpSettings.debug_mode : finalSettings.debugMode,
                    showFps: wpSettings.show_fps !== undefined ? wpSettings.show_fps : finalSettings.showFps,
                    resizeHandleSize: wpSettings.canvas_handle_size || finalSettings.resizeHandleSize,
                    resizeHandleColor: wpSettings.canvas_handle_color || finalSettings.resizeHandleColor,
                    resizeHandleBorderColor: wpSettings.canvas_handle_hover_color || finalSettings.resizeHandleBorderColor,
                    selectionBorderWidth: wpSettings.canvas_border_width || finalSettings.selectionBorderWidth,
                    selectionBorderColor: wpSettings.canvas_border_color || finalSettings.selectionBorderColor,
                    selectionBorderSpacing: wpSettings.canvas_border_spacing || finalSettings.selectionBorderSpacing,
                    showResizeHandlesLegacy: wpSettings.canvas_resize_handles_enabled !== undefined ? wpSettings.canvas_resize_handles_enabled : finalSettings.showResizeHandlesLegacy,
                    showResizeZones: wpSettings.canvas_element_borders_enabled !== undefined ? wpSettings.canvas_element_borders_enabled : finalSettings.showResizeZones,
                    defaultTextColor: wpSettings.default_text_color || finalSettings.defaultTextColor,
                    defaultBackgroundColor: wpSettings.default_background_color || finalSettings.defaultBackgroundColor,
                    defaultFontSize: wpSettings.default_font_size || finalSettings.defaultFontSize
                };
            }

            return { settings: finalSettings };
        };

        // Ex√©cuter les tests
        document.addEventListener('DOMContentLoaded', function() {
            // Test 1: Afficher les param√®tres WordPress
            const wpContent = document.getElementById('wp-settings-content');
            if (window.pdfBuilderCanvasSettings) {
                wpContent.innerHTML = '<div class="success">‚úÖ Param√®tres WordPress charg√©s avec succ√®s</div>';
                wpContent.innerHTML += '<pre>' + JSON.stringify(window.pdfBuilderCanvasSettings, null, 2) + '</pre>';
            } else {
                wpContent.innerHTML = '<div class="error">‚ùå Param√®tres WordPress non trouv√©s</div>';
            }

            // Test 2: Simuler le hook useGlobalSettings
            const hookContent = document.getElementById('hook-settings-content');
            try {
                const { settings } = useGlobalSettings();
                hookContent.innerHTML = '<div class="success">‚úÖ Hook useGlobalSettings ex√©cut√© avec succ√®s</div>';
                hookContent.innerHTML += '<pre>' + JSON.stringify(settings, null, 2) + '</pre>';
            } catch (error) {
                hookContent.innerHTML = '<div class="error">‚ùå Erreur dans le hook useGlobalSettings: ' + error.message + '</div>';
            }

            // Test 3: Comparaison
            const comparisonContent = document.getElementById('comparison-content');
            if (window.pdfBuilderCanvasSettings) {
                const { settings } = useGlobalSettings();
                const wpKeys = Object.keys(window.pdfBuilderCanvasSettings);
                const hookKeys = Object.keys(settings);
                const differences = [];

                // V√©rifier que tous les param√®tres WordPress sont pr√©sents dans le hook
                wpKeys.forEach(key => {
                    if (!(key in settings)) {
                        differences.push(`Param√®tre manquant dans le hook: ${key}`);
                    }
                });

                if (differences.length === 0) {
                    comparisonContent.innerHTML = '<div class="success">‚úÖ Tous les param√®tres WordPress sont correctement int√©gr√©s dans le hook</div>';
                } else {
                    comparisonContent.innerHTML = '<div class="warning">‚ö†Ô∏è Certains param√®tres ne sont pas int√©gr√©s:</div>';
                    comparisonContent.innerHTML += '<ul>' + differences.map(diff => `<li>${diff}</li>`).join('') + '</ul>';
                }

                // V√©rifier quelques valeurs sp√©cifiques
                const testCases = [
                    { wp: 'default_canvas_width', hook: 'defaultCanvasWidth', expected: 210 },
                    { wp: 'show_grid', hook: 'showGrid', expected: true },
                    { wp: 'grid_size', hook: 'gridSize', expected: 10 },
                    { wp: 'handle_color', hook: 'handleColor', expected: '#007cba' },
                    { wp: 'enable_rotation', hook: 'enableRotation', expected: true }
                ];

                let valueTests = '<h4>Tests de valeurs sp√©cifiques:</h4><ul>';
                testCases.forEach(test => {
                    const wpValue = window.pdfBuilderCanvasSettings[test.wp];
                    const hookValue = settings[test.hook];
                    const passed = wpValue === hookValue;
                    valueTests += `<li ${passed ? 'style="color: green;"' : 'style="color: red;"'}>`;
                    valueTests += `${test.wp} (${wpValue}) ‚Üí ${test.hook} (${hookValue}) ${passed ? '‚úÖ' : '‚ùå'}`;
                    valueTests += '</li>';
                });
                valueTests += '</ul>';
                comparisonContent.innerHTML += valueTests;

            } else {
                comparisonContent.innerHTML = '<div class="error">‚ùå Impossible de comparer sans param√®tres WordPress</div>';
            }
        });
    </script>
</body>
</html>