(()=>{"use strict";function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function n(e){for(var n=1;n<arguments.length;n++){var a=null!=arguments[n]?arguments[n]:{};n%2?t(Object(a),!0).forEach(function(t){r(e,t,a[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):t(Object(a)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))})}return e}function r(t,n,r){return(n=function(t){var n=function(t){if("object"!=e(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=e(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==e(n)?n:n+""}(n))in t?Object.defineProperty(t,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[n]=r,t}var a;a=jQuery,window.PDFBuilderSettingsSaver={collectTabSettings:function(e){var t={},n=document.getElementById("pdf-builder-tab-"+e);return n?(n.querySelectorAll("input, select, textarea").forEach(function(n){var r=n.name;if(r){var a;switch(n.type){case"checkbox":a=n.checked?"1":"0";break;case"radio":if(!n.checked)return;a=n.value;break;case"number":case"range":a=n.value?parseFloat(n.value):"";break;default:a=n.value||""}var o=r.replace(/^pdf_builder_/,"");t[e+"_"+o]=a}}),t):(console.warn("[PDF Builder] Tab container not found:",e),t)},collectAllSettings:function(){var e={};return["general","appearance","security","advanced"].forEach(function(t){var n=this.collectTabSettings(t);Object.assign(e,n)}.bind(this)),e},saveTabSettings:function(e,t){return new Promise(function(r,o){var i=window.pdfBuilderAjax?window.pdfBuilderAjax.nonce:"";a.ajax({url:window.ajaxurl||window.pdfBuilderAjax.ajaxUrl,type:"POST",data:n({action:"pdf_builder_save_"+e,_wpnonce:i},t),success:function(e){e.success?r(e):o(new Error(e.data||"Unknown error"))},error:function(e,t,n){o(new Error("AJAX Error: "+n))}})})},saveAllSettingsGlobally:function(){var e=this,t=[];return this.showGlobalSaveLoading(),["general","licence","systeme","securite","pdf","contenu","templates","developpeur"].forEach(function(n){var r=e.collectTabSettings(n);Object.keys(r).length>0&&t.push(e.saveTabSettings(n,r))}),Promise.all(t).then(function(t){return e.hideGlobalSaveLoading(),e.showGlobalSaveSuccess(),t}).catch(function(t){throw e.hideGlobalSaveLoading(),e.showGlobalSaveError(t.message),t})},showGlobalSaveLoading:function(){var e=document.getElementById("pdf-builder-global-save-btn");e&&(e.disabled=!0,e.innerHTML='<span class="spinner is-active"></span> Sauvegarde...')},hideGlobalSaveLoading:function(){var e=document.getElementById("pdf-builder-global-save-btn");e&&(e.disabled=!1,e.innerHTML="Sauvegarder Tout")},showGlobalSaveSuccess:function(){this.showGlobalSaveMessage("Paramètres sauvegardés avec succès!","success")},showGlobalSaveError:function(e){this.showGlobalSaveMessage("Erreur lors de la sauvegarde: "+e,"error")},showGlobalSaveMessage:function(e,t){document.querySelectorAll(".pdf-builder-global-save-message").forEach(function(e){e.remove()});var n=document.createElement("div");n.className="pdf-builder-global-save-message notice notice-"+t+" is-dismissible",n.innerHTML="<p>"+e+"</p>";var r=document.createElement("button");r.type="button",r.className="notice-dismiss",r.addEventListener("click",function(){n.remove()}),n.appendChild(r);var a=document.getElementById("pdf-builder-global-save-btn");a&&a.parentNode&&a.parentNode.insertBefore(n,a.nextSibling),"success"===t&&setTimeout(function(){n.parentNode&&n.remove()},5e3)},init:function(){var e=this,t=document.getElementById("pdf-builder-global-save-btn");t&&t.addEventListener("click",function(t){t.preventDefault(),e.saveAllSettingsGlobally().catch(function(e){console.error("[PDF Builder] Global save failed:",e)})}),["general","licence","systeme","securite","pdf","contenu","templates","developpeur"].forEach(function(t){var n=document.getElementById("pdf-builder-save-"+t+"-btn");n&&n.addEventListener("click",function(n){n.preventDefault();var r=e.collectTabSettings(t);e.saveTabSettings(t,r).then(function(){e.showTabSaveSuccess(t)}).catch(function(n){e.showTabSaveError(t,n.message)})})})},showTabSaveSuccess:function(e){this.showTabSaveMessage(e,"Paramètres sauvegardés!","success")},showTabSaveError:function(e,t){this.showTabSaveMessage(e,"Erreur: "+t,"error")},showTabSaveMessage:function(e,t,n){var r=document.getElementById("pdf-builder-tab-"+e);if(r){r.querySelectorAll(".pdf-builder-tab-save-message").forEach(function(e){e.remove()});var a=document.createElement("div");a.className="pdf-builder-tab-save-message notice notice-"+n,a.innerHTML="<p>"+t+"</p>";var o=r.firstElementChild;r.insertBefore(a,o),"success"===n&&setTimeout(function(){a.parentNode&&a.remove()},3e3)}}},a(document).ready(function(){window.PDFBuilderSettingsSaver.init()})})();