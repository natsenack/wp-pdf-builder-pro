/*! For license information please see pdf-preview-integration.js.LICENSE.txt */
(()=>{"use strict";function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(){var e,n,o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",i=o.toStringTag||"@@toStringTag";function u(t,o,a,i){var u=o&&o.prototype instanceof c?o:c,l=Object.create(u.prototype);return r(l,"_invoke",function(t,r,o){var a,i,u,c=0,l=o||[],s=!1,p={p:0,n:0,v:e,a:v,f:v.bind(e,4),d:function(t,r){return a=t,i=0,u=e,p.n=r,d}};function v(t,r){for(i=t,u=r,n=0;!s&&c&&!o&&n<l.length;n++){var o,a=l[n],v=p.p,f=a[2];t>3?(o=f===r)&&(u=a[(i=a[4])?5:(i=3,3)],a[4]=a[5]=e):a[0]<=v&&((o=t<2&&v<a[1])?(i=0,p.v=r,p.n=a[1]):v<f&&(o=t<3||a[0]>r||r>f)&&(a[4]=t,a[5]=r,p.n=f,i=0))}if(o||t>1)return d;throw s=!0,r}return function(o,l,f){if(c>1)throw TypeError("Generator is already running");for(s&&1===l&&v(l,f),i=l,u=f;(n=i<2?e:u)||!s;){a||(i?i<3?(i>1&&(p.n=-1),v(i,u)):p.n=u:p.v=u);try{if(c=2,a){if(i||(o="next"),n=a[o]){if(!(n=n.call(a,u)))throw TypeError("iterator result is not an object");if(!n.done)return n;u=n.value,i<2&&(i=0)}else 1===i&&(n=a.return)&&n.call(a),i<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),i=1);a=e}else if((n=(s=p.n<0)?u:t.call(r,p))!==d)break}catch(t){a=e,i=1,u=t}finally{c=1}}return{value:n,done:s}}}(t,a,i),!0),l}var d={};function c(){}function l(){}function s(){}n=Object.getPrototypeOf;var p=[][a]?n(n([][a]())):(r(n={},a,function(){return this}),n),v=s.prototype=c.prototype=Object.create(p);function f(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,s):(e.__proto__=s,r(e,i,"GeneratorFunction")),e.prototype=Object.create(v),e}return l.prototype=s,r(v,"constructor",s),r(s,"constructor",l),l.displayName="GeneratorFunction",r(s,i,"GeneratorFunction"),r(v),r(v,i,"Generator"),r(v,a,function(){return this}),r(v,"toString",function(){return"[object Generator]"}),(t=function(){return{w:u,m:f}})()}function r(e,t,n,o){var a=Object.defineProperty;try{a({},"",{})}catch(e){a=0}r=function(e,t,n,o){function i(t,n){r(e,t,function(e){return this._invoke(t,n,e)})}t?a?a(e,t,{value:n,enumerable:!o,configurable:!o,writable:!o}):e[t]=n:(i("next",0),i("throw",1),i("return",2))},r(e,t,n,o)}function n(e,t,r,n,o,a,i){try{var u=e[a](i),d=u.value}catch(e){return void r(e)}u.done?t(d):Promise.resolve(d).then(n,o)}function o(e){return function(){var t=this,r=arguments;return new Promise(function(o,a){var i=e.apply(t,r);function u(e){n(i,o,a,u,d,"next",e)}function d(e){n(i,o,a,u,d,"throw",e)}u(void 0)})}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,d(n.key),n)}}function u(e,t,r){return t&&i(e.prototype,t),r&&i(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function d(t){var r=function(t){if("object"!=e(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=e(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==e(r)?r:r+""}function c(){}function l(){var e;(e=console).error.apply(e,arguments)}function s(){var e;(e=console).warn.apply(e,arguments)}var p=function(){return u(function e(t){a(this,e),this.canvasEditor=t,this.previewBtn=null,this.init()},[{key:"init",value:function(){this.createPreviewButton(),this.bindEvents()}},{key:"createPreviewButton",value:function(){this.previewBtn=document.createElement("button"),this.previewBtn.id="pdf-editor-preview-btn",this.previewBtn.innerHTML="üëÅÔ∏è Aper√ßu",this.previewBtn.title="G√©n√©rer un aper√ßu PDF",this.previewBtn.style.cssText="\n            background: #007cba;\n            color: white;\n            border: none;\n            padding: 8px 16px;\n            border-radius: 4px;\n            cursor: pointer;\n            font-size: 14px;\n            margin-left: 10px;\n        ";var e=document.querySelector(".pdf-editor-toolbar")||document.querySelector("#pdf-editor-toolbar")||document.querySelector(".toolbar");e?e.appendChild(this.previewBtn):(this.previewBtn.style.position="fixed",this.previewBtn.style.top="10px",this.previewBtn.style.right="10px",this.previewBtn.style.zIndex="1000",document.body.appendChild(this.previewBtn))}},{key:"bindEvents",value:function(){var e=this;this.previewBtn&&this.previewBtn.addEventListener("click",function(){e.generatePreview()}),document.addEventListener("keydown",function(t){(t.ctrlKey||t.metaKey)&&"p"===t.key&&(t.preventDefault(),e.generatePreview())})}},{key:"generatePreview",value:(e=o(t().m(function e(){var r;return t().w(function(e){for(;;)switch(e.p=e.n){case 0:if(c(),e.p=1,r=this.getTemplateData()){e.n=2;break}return s("‚ö†Ô∏è Aucune donn√©e de template trouv√©e"),alert("Aucune donn√©e de template trouv√©e. Veuillez cr√©er un template d'abord."),e.a(2);case 2:return c(),e.n=3,window.generateEditorPreview(r,{quality:150,format:"png"});case 3:e.v&&c(),e.n=5;break;case 4:e.p=4,l("‚ùå Erreur g√©n√©ration aper√ßu √©diteur:",e.v),alert("Erreur lors de la g√©n√©ration de l'aper√ßu. V√©rifiez la console pour plus de d√©tails.");case 5:return e.a(2)}},e,this,[[1,4]])})),function(){return e.apply(this,arguments)})},{key:"getTemplateData",value:function(){return this.canvasEditor&&"function"==typeof this.canvasEditor.getTemplateData?this.canvasEditor.getTemplateData():window.pdfEditorTemplate?window.pdfEditorTemplate:{template:{elements:[{type:"text",content:"APER√áU PDF BUILDER PRO",x:50,y:50,width:300,height:40,fontSize:18,fontFamily:"Arial",color:"#000000",textAlign:"center"},{type:"text",content:"Template de d√©monstration",x:50,y:100,width:300,height:30,fontSize:14,color:"#666666"}]}}}}]);var e}(),v=function(){return u(function e(t){a(this,e),this.metaboxContainer=t,this.orderId=this.getOrderId(),this.previewBtn=null,this.init()},[{key:"init",value:function(){this.createPreviewButtons(),this.bindEvents()}},{key:"createPreviewButtons",value:function(){var e=document.createElement("div");e.id="pdf-metabox-preview-buttons",e.style.cssText="\n            margin: 15px 0;\n            padding: 15px;\n            background: #f8f9fa;\n            border: 1px solid #dee2e6;\n            border-radius: 4px;\n        ",e.innerHTML='\n            <h4 style="margin: 0 0 10px 0; color: #495057;">üìÑ Aper√ßu PDF</h4>\n            <p style="margin: 0 0 15px 0; color: #6c757d; font-size: 13px;">\n                G√©n√©rez un aper√ßu du PDF avec les donn√©es r√©elles de cette commande.\n            </p>\n            <div style="display: flex; gap: 10px; flex-wrap: wrap;">\n                <button id="pdf-metabox-preview-btn" class="button button-secondary">\n                    üëÅÔ∏è Aper√ßu Image\n                </button>\n                <button id="pdf-metabox-generate-btn" class="button button-primary">\n                    üìÑ G√©n√©rer PDF\n                </button>\n            </div>\n        ',this.metaboxContainer&&this.metaboxContainer.appendChild(e),this.previewBtn=document.getElementById("pdf-metabox-preview-btn")}},{key:"bindEvents",value:function(){var e=this;this.previewBtn&&this.previewBtn.addEventListener("click",function(){e.generatePreview()}),window.regenerateOrderPreview=function(){e.generatePreview()}}},{key:"generatePreview",value:(e=o(t().m(function e(){var r;return t().w(function(e){for(;;)switch(e.p=e.n){case 0:if(c(),e.p=1,this.orderId){e.n=2;break}return l("‚ùå ID de commande non trouv√©"),alert("ID de commande non trouv√©."),e.a(2);case 2:if(c(this.orderId),r=this.getTemplateData()){e.n=3;break}return s("‚ö†Ô∏è Aucune donn√©e de template trouv√©e"),alert("Aucune donn√©e de template trouv√©e. Veuillez s√©lectionner un template."),e.a(2);case 3:return c(),e.n=4,window.generateOrderPreview(r,this.orderId,{quality:150,format:"png"});case 4:e.v&&c(),e.n=6;break;case 5:e.p=5,l("‚ùå Erreur g√©n√©ration aper√ßu commande:",e.v),alert("Erreur lors de la g√©n√©ration de l'aper√ßu. V√©rifiez la console pour plus de d√©tails.");case 6:return e.a(2)}},e,this,[[1,5]])})),function(){return e.apply(this,arguments)})},{key:"getOrderId",value:function(){var e=new URLSearchParams(window.location.search);if(e.get("post"))return parseInt(e.get("post"));if(window.wpApiSettings&&window.wpApiSettings.postId)return window.wpApiSettings.postId;var t=document.getElementById("pdf-order-id")||document.querySelector("[data-order-id]");if(t)return parseInt(t.dataset.orderId||t.value);var r=document.querySelector(".wp-heading-inline")||document.querySelector("h1");if(r){var n=r.textContent.match(/#(\d+)/);if(n)return parseInt(n[1])}return s("‚ö†Ô∏è ID de commande non trouv√© automatiquement"),null}},{key:"getTemplateData",value:function(){var e=document.getElementById("pdf-template-data")||document.querySelector("[data-template-data]");if(e)try{return JSON.parse(e.value||e.dataset.templateData)}catch(e){s("Donn√©es template mal format√©es:",e)}return window.pdfCurrentTemplate?window.pdfCurrentTemplate:{template:{elements:[{type:"text",content:"FACTURE",x:50,y:30,width:200,height:40,fontSize:24,fontWeight:"bold",color:"#000000"},{type:"text",content:"Commande #{{order_number}}",x:50,y:80,width:200,height:30,fontSize:16,color:"#333333"},{type:"text",content:"Client: {{customer_name}}",x:50,y:120,width:200,height:25,fontSize:14,color:"#666666"},{type:"text",content:"Total: {{order_total}} ‚Ç¨",x:50,y:150,width:200,height:25,fontSize:14,fontWeight:"bold",color:"#000000"}]}}}}]);var e}();document.addEventListener("DOMContentLoaded",function(){(document.querySelector("#pdf-editor-canvas")||document.querySelector(".pdf-canvas-editor")||window.location.href.includes("pdf-builder-editor"))&&(window.pdfEditorPreview=new p(window.pdfCanvasEditor)),(document.querySelector(".woocommerce-order-data")||document.querySelector("#woocommerce-order-data")||window.location.href.includes("post.php?post=")&&window.location.href.includes("action=edit"))&&setTimeout(function(){var e=document.querySelector("#pdf-builder-metabox")||document.querySelector(".pdf-builder-metabox")||document.querySelector(".postbox");e&&(window.pdfMetaboxPreview=new v(e))},1e3)}),window.generateQuickPreview=o(t().m(function e(){var r,n,o,a,i,u,d,p,v,f,m=arguments;return t().w(function(e){for(;;)switch(e.p=e.n){case 0:if(r=m.length>0&&void 0!==m[0]?m[0]:null,n=m.length>1&&void 0!==m[1]?m[1]:null,c(),e.p=1,o=document.querySelector("#pdf-editor-canvas")||document.querySelector(".pdf-canvas-editor")||window.location.href.includes("pdf-builder-editor"),a=document.querySelector(".woocommerce-order-data")||document.querySelector("#woocommerce-order-data")||window.location.href.includes("post.php")&&window.location.href.includes("action=edit"),c(),!o){e.n=3;break}return c(),u=r||(null===(i=window.pdfEditorPreview)||void 0===i?void 0:i.getTemplateData()),e.n=2,window.generateEditorPreview(u);case 2:case 4:return e.a(2,e.v);case 3:if(!a){e.n=5;break}return c(),v=r||(null===(d=window.pdfMetaboxPreview)||void 0===d?void 0:d.getTemplateData()),f=n||(null===(p=window.pdfMetaboxPreview)||void 0===p?void 0:p.getOrderId()),e.n=4,window.generateOrderPreview(v,f);case 5:return s("‚ö†Ô∏è Contexte non reconnu pour l'aper√ßu"),e.a(2,null);case 6:return e.p=6,l("‚ùå Erreur g√©n√©ration aper√ßu rapide:",e.v),e.a(2,null)}},e,null,[[1,6]])})),window.CanvasPreviewManager={updatePreviews:function(e){try{switch(e){case"dimensions":"function"==typeof updateDimensionsCardPreview&&updateDimensionsCardPreview();break;case"apparence":"function"==typeof updateApparenceCardPreview&&updateApparenceCardPreview();break;case"performance":"function"==typeof updatePerformanceCardPreview&&updatePerformanceCardPreview();break;case"autosave":"function"==typeof updateAutosaveCardPreview&&updateAutosaveCardPreview();break;case"zoom":"function"==typeof updateZoomCardPreview&&updateZoomCardPreview();break;case"grille":"function"==typeof updateGrilleCardPreview&&updateGrilleCardPreview();break;case"interactions":"function"==typeof updateInteractionsCardPreview&&updateInteractionsCardPreview();break;case"export":"function"==typeof updateExportCardPreview&&updateExportCardPreview();break;case"all":this.updatePreviews("dimensions"),this.updatePreviews("apparence"),this.updatePreviews("performance"),this.updatePreviews("autosave"),this.updatePreviews("zoom"),this.updatePreviews("grille"),this.updatePreviews("interactions"),this.updatePreviews("export");break;default:s("‚ö†Ô∏è Cat√©gorie inconnue:",e)}}catch(e){l("‚ùå Erreur mise √† jour preview:",e)}},getCardValues:function(e){try{var t=window.pdfBuilderCanvasSettings||{};switch(e){case"performance":return{fps_target:t.fps_target||60,memory_limit_js:t.memory_limit_js||128,memory_limit_php:t.memory_limit_php||256,lazy_loading_editor:t.lazy_loading_editor||!1,lazy_loading_plugin:t.lazy_loading_plugin||!1};case"apparence":return{canvas_bg_color:t.canvas_background_color||"#ffffff",canvas_border_color:t.border_color||"#cccccc",canvas_border_width:t.border_width||1,canvas_shadow_enabled:t.shadow_enabled||!1,canvas_container_bg_color:t.container_background_color||"#f8f9fa"};case"grille":return{grid_enabled:t.show_grid||!1,grid_size:t.grid_size||20,snap_to_grid:t.snap_to_grid||!1};case"interactions":return{drag_enabled:!1!==t.drag_enabled,resize_enabled:!1!==t.resize_enabled,rotate_enabled:!1!==t.rotate_enabled,multi_select:!1!==t.multi_select,selection_mode:t.selection_mode||"rectangle",keyboard_shortcuts:!1!==t.keyboard_shortcuts};case"export":return{canvas_export_format:t.export_format||"pdf",canvas_export_quality:t.export_quality||90,canvas_export_transparent:t.export_transparent||!1};case"zoom":return{canvas_zoom_min:t.min_zoom||10,canvas_zoom_max:t.max_zoom||500,canvas_zoom_default:t.default_zoom||100,canvas_zoom_step:t.zoom_step||25};case"autosave":return{canvas_autosave_enabled:!1!==t.autosave_enabled,canvas_autosave_interval:t.autosave_interval||5,canvas_history_max:t.versions_limit||10};default:return s("‚ö†Ô∏è Cat√©gorie inconnue pour getCardValues:",e),{}}}catch(e){return l("‚ùå Erreur r√©cup√©ration valeurs carte:",e),{}}},getCardElement:function(e,t){try{var r=document.querySelector('.canvas-card[data-category="'.concat(e,'"]'));return r?r.querySelector(t):(s("‚ö†Ô∏è Carte non trouv√©e:",e),null)}catch(e){return l("‚ùå Erreur recherche √©l√©ment:",e),null}},updateElement:function(e,t,r){if(e)try{if(t.includes(".")){for(var n=t.split("."),o=e,a=0;a<n.length-1;a++)if(!(o=o[n[a]]))return void s("‚ö†Ô∏è Propri√©t√© parent non trouv√©e:",n.slice(0,a+1).join("."));o[n[n.length-1]]=r}else e[t]=r}catch(e){l("‚ùå Erreur mise √† jour √©l√©ment:",e)}else s("‚ö†Ô∏è √âl√©ment null pass√© √† updateElement")},updateExportCardPreview:function(){try{var e=this.getCardValues("export").export_quality,t=this.getCardElement("export",".quality-fill"),r=this.getCardElement("export",".quality-text");this.updateElement(t,"style.width","".concat(e,"%")),this.updateElement(r,"textContent","".concat(e,"%"))}catch(e){l("‚ùå Error updating export preview:",e)}},updateGrilleCardPreview:function(){try{var e=this.getCardValues("grille"),t=e.show_grid,r=e.snap_to_grid,n=e.show_guides,o=this.getCardElement("grille",".grid-preview-container");if(!o)return;o.classList.toggle("grid-enabled",t),o.classList.toggle("grid-disabled",!t),o.querySelectorAll(".guide-line").forEach(function(e){return e.classList.toggle("active",n)});var a=o.querySelector(".snap-indicator");if(a){var i=r&&t;a.textContent=i?"üîó Snap activ√©":"üîó Snap d√©sactiv√©",a.style.color=i?"#28a745":"#6c757d"}}catch(e){l("‚ùå Error updating grille preview:",e)}},initializeRealTimeUpdates:function(e){e&&e.getAttribute("data-category")}}})();