/*! For license information please see pdf-preview-api-client.js.LICENSE.txt */
(()=>{"use strict";var e={};function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function t(){var e,n,i="function"==typeof Symbol?Symbol:{},o=i.iterator||"@@iterator",a=i.toStringTag||"@@toStringTag";function d(t,i,o,a){var d=i&&i.prototype instanceof p?i:p,u=Object.create(d.prototype);return r(u,"_invoke",function(t,r,i){var o,a,d,p=0,u=i||[],l=!1,s={p:0,n:0,v:e,a:f,f:f.bind(e,4),d:function(n,t){return o=n,a=0,d=e,s.n=t,c}};function f(t,r){for(a=t,d=r,n=0;!l&&p&&!i&&n<u.length;n++){var i,o=u[n],f=s.p,m=o[2];t>3?(i=m===r)&&(d=o[(a=o[4])?5:(a=3,3)],o[4]=o[5]=e):o[0]<=f&&((i=t<2&&f<o[1])?(a=0,s.v=r,s.n=o[1]):f<m&&(i=t<3||o[0]>r||r>m)&&(o[4]=t,o[5]=r,s.n=m,a=0))}if(i||t>1)return c;throw l=!0,r}return function(i,u,m){if(p>1)throw TypeError("Generator is already running");for(l&&1===u&&f(u,m),a=u,d=m;(n=a<2?e:d)||!l;){o||(a?a<3?(a>1&&(s.n=-1),f(a,d)):s.n=d:s.v=d);try{if(p=2,o){if(a||(i="next"),n=o[i]){if(!(n=n.call(o,d)))throw TypeError("iterator result is not an object");if(!n.done)return n;d=n.value,a<2&&(a=0)}else 1===a&&(n=o.return)&&n.call(o),a<2&&(d=TypeError("The iterator does not provide a '"+i+"' method"),a=1);o=e}else if((n=(l=s.n<0)?d:t.call(r,s))!==c)break}catch(n){o=e,a=1,d=n}finally{p=1}}return{value:n,done:l}}}(t,o,a),!0),u}var c={};function p(){}function u(){}function l(){}n=Object.getPrototypeOf;var s=[][o]?n(n([][o]())):(r(n={},o,function(){return this}),n),f=l.prototype=p.prototype=Object.create(s);function m(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,l):(e.__proto__=l,r(e,a,"GeneratorFunction")),e.prototype=Object.create(f),e}return u.prototype=l,r(f,"constructor",l),r(l,"constructor",u),u.displayName="GeneratorFunction",r(l,a,"GeneratorFunction"),r(f),r(f,a,"Generator"),r(f,o,function(){return this}),r(f,"toString",function(){return"[object Generator]"}),(t=function(){return{w:d,m}})()}function r(e,n,t,i){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}r=function(e,n,t,i){function a(n,t){r(e,n,function(e){return this._invoke(n,t,e)})}n?o?o(e,n,{value:t,enumerable:!i,configurable:!i,writable:!i}):e[n]=t:(a("next",0),a("throw",1),a("return",2))},r(e,n,t,i)}function i(e,n,t,r,i,o,a){try{var d=e[o](a),c=d.value}catch(e){return void t(e)}d.done?n(c):Promise.resolve(c).then(r,i)}function o(e){return function(){var n=this,t=arguments;return new Promise(function(r,o){var a=e.apply(n,t);function d(e){i(a,r,o,d,c,"next",e)}function c(e){i(a,r,o,d,c,"throw",e)}d(void 0)})}}function a(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,d(r.key),r)}}function d(e){var t=function(e){if("object"!=n(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=n(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==n(t)?t:t+""}function c(){}function p(){var e;(e=console).error.apply(e,arguments)}function u(){var e;(e=console).warn.apply(e,arguments)}(e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})})(e);var l=function(){return e=function e(){var n;!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e),this.endpoint=pdfBuilderAjax.ajaxurl,this.nonce=(null===(n=pdfBuilderAjax)||void 0===n?void 0:n.nonce)||"",this.isGenerating=!1,this.cache=new Map},n=[{key:"generateEditorPreview",value:(i=o(t().m(function e(n){var r,i,o,a,d=arguments;return t().w(function(e){for(;;)switch(e.p=e.n){case 0:if(r=d.length>1&&void 0!==d[1]?d[1]:{},!this.isGenerating){e.n=1;break}return u("‚ö†Ô∏è G√©n√©ration d√©j√† en cours..."),e.a(2,null);case 1:return this.isGenerating=!0,this.showLoadingIndicator(),e.p=2,(i=new FormData).append("action","wp_pdf_preview_image"),i.append("nonce",this.nonce),i.append("context","editor"),i.append("template_data",JSON.stringify(n)),i.append("quality",r.quality||150),i.append("format",r.format||"png"),c(),e.n=3,fetch(this.endpoint,{method:"POST",body:i});case 3:return o=e.v,e.n=4,o.json();case 4:if(!(a=e.v).success){e.n=5;break}return c(a.data),this.cachePreview(a.data),this.displayPreview(a.data.image_url,"editor"),e.a(2,a.data);case 5:return p("‚ùå Erreur g√©n√©ration √©diteur:",a.data),this.showError("Erreur lors de la g√©n√©ration de l'aper√ßu"),e.a(2,null);case 6:e.n=8;break;case 7:return e.p=7,p("‚ùå Erreur r√©seau:",e.v),this.showError("Erreur de connexion"),e.a(2,null);case 8:return e.p=8,this.isGenerating=!1,this.hideLoadingIndicator(),e.f(8);case 9:return e.a(2)}},e,this,[[2,7,8,9]])})),function(e){return i.apply(this,arguments)})},{key:"generateOrderPreview",value:(r=o(t().m(function e(n,r){var i,o,a,d,l=arguments;return t().w(function(e){for(;;)switch(e.p=e.n){case 0:if(i=l.length>2&&void 0!==l[2]?l[2]:{},!this.isGenerating){e.n=1;break}return u("‚ö†Ô∏è G√©n√©ration d√©j√† en cours..."),e.a(2,null);case 1:return this.isGenerating=!0,this.showLoadingIndicator(),e.p=2,(o=new FormData).append("action","wp_pdf_preview_image"),o.append("nonce",this.nonce),o.append("context","metabox"),o.append("template_data",JSON.stringify(n)),o.append("order_id",r),o.append("quality",i.quality||150),o.append("format",i.format||"png"),c(),e.n=3,fetch(this.endpoint,{method:"POST",body:o});case 3:return a=e.v,e.n=4,a.json();case 4:if(!(d=e.v).success){e.n=5;break}return c(d.data),this.cachePreview(d.data),this.displayPreview(d.data.image_url,"metabox",r),e.a(2,d.data);case 5:return p("‚ùå Erreur g√©n√©ration commande:",d.data),this.showError("Erreur lors de la g√©n√©ration de l'aper√ßu de commande"),e.a(2,null);case 6:e.n=8;break;case 7:return e.p=7,p("‚ùå Erreur r√©seau:",e.v),this.showError("Erreur de connexion"),e.a(2,null);case 8:return e.p=8,this.isGenerating=!1,this.hideLoadingIndicator(),e.f(8);case 9:return e.a(2)}},e,this,[[2,7,8,9]])})),function(e,n){return r.apply(this,arguments)})},{key:"cachePreview",value:function(e){var n=e.cache_key||this.generateCacheKey(e);if(this.cache.set(n,{url:e.image_url,timestamp:Date.now(),context:e.context||"unknown"}),this.cache.size>10){var t=this.cache.keys().next().value;this.cache.delete(t)}}},{key:"generateCacheKey",value:function(e){return btoa(JSON.stringify({context:e.context,order_id:e.order_id,template_hash:this.hashString(JSON.stringify(e.template_data))})).slice(0,32)}},{key:"hashString",value:function(e){for(var n=0,t=0;t<e.length;t++)n=(n<<5)-n+e.charCodeAt(t),n&=n;return Math.abs(n).toString(36)}},{key:"displayPreview",value:function(e,n){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=document.getElementById("pdf-preview-modal");r||(r=this.createPreviewModal(),document.body.appendChild(r));var i=r.querySelector("#pdf-preview-image"),o=r.querySelector("#pdf-preview-title");i.src=e,i.style.maxWidth="100%",i.style.height="auto",o.textContent="editor"===n?"üëÅÔ∏è Aper√ßu du Template":"üìÑ Aper√ßu Commande #".concat(t),this.addPreviewActions(r,e,n),r.classList.add("visible")}},{key:"createPreviewModal",value:function(){if(!document.getElementById("pdf-preview-modal-styles")){var e=document.createElement("style");e.id="pdf-preview-modal-styles",e.textContent="\n                #pdf-preview-modal {\n                    position: fixed !important;\n                    top: 0 !important;\n                    left: 0 !important;\n                    width: 100% !important;\n                    height: 100% !important;\n                    background-color: rgba(0,0,0,0.8) !important;\n                    display: none !important;\n                    z-index: 99999 !important;\n                    align-items: center !important;\n                    justify-content: center !important;\n                    flex-direction: column !important;\n                    visibility: visible !important;\n                    gap: 0 !important;\n                    padding: 0 !important;\n                    margin: 0 !important;\n                }\n                \n                #pdf-preview-modal.visible {\n                    display: flex !important;\n                }\n                \n                #pdf-preview-modal-wrapper {\n                    background: white !important;\n                    border-radius: 8px !important;\n                    padding: 20px !important;\n                    max-width: 90vw !important;\n                    max-height: 90vh !important;\n                    overflow-y: auto !important;\n                    box-shadow: 0 10px 40px rgba(0,0,0,0.3) !important;\n                    flex-shrink: 0 !important;\n                    min-width: 300px !important;\n                    position: relative !important;\n                    width: 500px !important;\n                    align-self: center !important;\n                }\n            ",document.head.appendChild(e)}var n=document.createElement("div");n.id="pdf-preview-modal";var t=document.createElement("div");t.id="pdf-preview-modal-wrapper";var r=document.createElement("div");r.style.cssText="\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n            margin-bottom: 15px;\n        ";var i=document.createElement("h3");i.id="pdf-preview-title",i.textContent="Aper√ßu PDF",i.style.cssText="margin: 0; color: #1d2327;";var o=document.createElement("button");o.id="pdf-preview-close",o.textContent="√ó",o.style.cssText="\n            background: none;\n            border: none;\n            font-size: 24px;\n            cursor: pointer;\n            color: #666;\n        ",r.appendChild(i),r.appendChild(o);var a=document.createElement("div");a.id="pdf-preview-actions",a.style.cssText="margin-bottom: 15px;";var d=document.createElement("img");return d.id="pdf-preview-image",d.alt="Aper√ßu PDF",d.style.cssText="max-width: 100%; height: auto; border: 1px solid #ddd;",t.appendChild(r),t.appendChild(a),t.appendChild(d),n.appendChild(t),o.addEventListener("click",function(){n.classList.remove("visible")}),n.addEventListener("click",function(e){e.target===n&&n.classList.remove("visible")}),n}},{key:"addPreviewActions",value:function(e,n,t){var r=this,i=e.querySelector("#pdf-preview-actions");i.innerHTML="";var o=document.createElement("button");o.textContent="üì• T√©l√©charger",o.style.cssText="\n            background: #007cba;\n            color: white;\n            border: none;\n            padding: 8px 16px;\n            border-radius: 4px;\n            cursor: pointer;\n            margin-right: 10px;\n        ",o.addEventListener("click",function(){r.downloadPreview(n)});var a=document.createElement("button");if(a.textContent="üñ®Ô∏è Imprimer",a.style.cssText="\n            background: #46b450;\n            color: white;\n            border: none;\n            padding: 8px 16px;\n            border-radius: 4px;\n            cursor: pointer;\n            margin-right: 10px;\n        ",a.addEventListener("click",function(){r.printPreview(n)}),"metabox"===t){var d=document.createElement("button");d.textContent="üîÑ R√©g√©n√©rer",d.style.cssText="\n                background: #f56e28;\n                color: white;\n                border: none;\n                padding: 8px 16px;\n                border-radius: 4px;\n                cursor: pointer;\n            ",d.addEventListener("click",function(){"function"==typeof window.regenerateOrderPreview&&window.regenerateOrderPreview()}),i.appendChild(d)}i.appendChild(o),i.appendChild(a)}},{key:"downloadPreview",value:function(e){var n=document.createElement("a");n.href=e,n.download="pdf-preview-".concat(Date.now(),".png"),n.style.display="none",document.body.appendChild(n),n.click(),document.body.removeChild(n)}},{key:"printPreview",value:function(e){var n=window.open("","_blank");n.document.write('\n            <html>\n                <head>\n                    <title>Aper√ßu PDF</title>\n                    <style>\n                        body { margin: 0; padding: 20px; text-align: center; }\n                        img { max-width: 100%; height: auto; }\n                        @media print {\n                            body { margin: 0; }\n                            img { max-width: 100%; height: auto; }\n                        }\n                    </style>\n                </head>\n                <body>\n                    <img src="'.concat(e,'" alt="Aper√ßu PDF" onload="window.print(); window.close();" />\n                </body>\n            </html>\n        ')),n.document.close()}},{key:"showLoadingIndicator",value:function(){var e=document.getElementById("pdf-preview-loader");e||((e=document.createElement("div")).id="pdf-preview-loader",e.style.cssText="\n                position: fixed;\n                top: 50%;\n                left: 50%;\n                transform: translate(-50%, -50%);\n                background: rgba(255,255,255,0.9);\n                border: 1px solid #ccc;\n                border-radius: 8px;\n                padding: 20px;\n                z-index: 10000;\n                display: none;\n                text-align: center;\n            ",e.innerHTML='\n                <div style="border: 4px solid #f3f3f3; border-top: 4px solid #007cba; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin: 0 auto 10px;"></div>\n                <div>G√©n√©ration de l\'aper√ßu...</div>\n                <style>\n                    @keyframes spin {\n                        0% { transform: rotate(0deg); }\n                        100% { transform: rotate(360deg); }\n                    }\n                </style>\n            ',document.body.appendChild(e)),e.style.display="block"}},{key:"hideLoadingIndicator",value:function(){var e=document.getElementById("pdf-preview-loader");e&&(e.style.display="none")}},{key:"showError",value:function(e){p("PDF Preview Error:",e)}}],n&&a(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,n,r,i}();window.pdfPreviewAPI=new l,window.generateEditorPreview=function(e,n){return window.pdfPreviewAPI.generateEditorPreview(e,n)},window.generateOrderPreview=function(e,n,t){return window.pdfPreviewAPI.generateOrderPreview(e,n,t)};var s=window;for(var f in e)s[f]=e[f];e.__esModule&&Object.defineProperty(s,"__esModule",{value:!0})})();