/*! For license information please see pdf-preview-api-client.js.LICENSE.txt */
(()=>{"use strict";function e(n){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(n)}function n(){var e,r,i="function"==typeof Symbol?Symbol:{},o=i.iterator||"@@iterator",a=i.toStringTag||"@@toStringTag";function d(n,i,o,a){var d=i&&i.prototype instanceof c?i:c,u=Object.create(d.prototype);return t(u,"_invoke",function(n,t,i){var o,a,d,c=0,u=i||[],l=!1,s={p:0,n:0,v:e,a:m,f:m.bind(e,4),d:function(n,t){return o=n,a=0,d=e,s.n=t,p}};function m(n,t){for(a=n,d=t,r=0;!l&&c&&!i&&r<u.length;r++){var i,o=u[r],m=s.p,f=o[2];n>3?(i=f===t)&&(d=o[(a=o[4])?5:(a=3,3)],o[4]=o[5]=e):o[0]<=m&&((i=n<2&&m<o[1])?(a=0,s.v=t,s.n=o[1]):m<f&&(i=n<3||o[0]>t||t>f)&&(o[4]=n,o[5]=t,s.n=f,a=0))}if(i||n>1)return p;throw l=!0,t}return function(i,u,f){if(c>1)throw TypeError("Generator is already running");for(l&&1===u&&m(u,f),a=u,d=f;(r=a<2?e:d)||!l;){o||(a?a<3?(a>1&&(s.n=-1),m(a,d)):s.n=d:s.v=d);try{if(c=2,o){if(a||(i="next"),r=o[i]){if(!(r=r.call(o,d)))throw TypeError("iterator result is not an object");if(!r.done)return r;d=r.value,a<2&&(a=0)}else 1===a&&(r=o.return)&&r.call(o),a<2&&(d=TypeError("The iterator does not provide a '"+i+"' method"),a=1);o=e}else if((r=(l=s.n<0)?d:n.call(t,s))!==p)break}catch(n){o=e,a=1,d=n}finally{c=1}}return{value:r,done:l}}}(n,o,a),!0),u}var p={};function c(){}function u(){}function l(){}r=Object.getPrototypeOf;var s=[][o]?r(r([][o]())):(t(r={},o,function(){return this}),r),m=l.prototype=c.prototype=Object.create(s);function f(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,l):(e.__proto__=l,t(e,a,"GeneratorFunction")),e.prototype=Object.create(m),e}return u.prototype=l,t(m,"constructor",l),t(l,"constructor",u),u.displayName="GeneratorFunction",t(l,a,"GeneratorFunction"),t(m),t(m,a,"Generator"),t(m,o,function(){return this}),t(m,"toString",function(){return"[object Generator]"}),(n=function(){return{w:d,m:f}})()}function t(e,n,r,i){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}t=function(e,n,r,i){function a(n,r){t(e,n,function(e){return this._invoke(n,r,e)})}n?o?o(e,n,{value:r,enumerable:!i,configurable:!i,writable:!i}):e[n]=r:(a("next",0),a("throw",1),a("return",2))},t(e,n,r,i)}function r(e,n,t,r,i,o,a){try{var d=e[o](a),p=d.value}catch(e){return void t(e)}d.done?n(p):Promise.resolve(p).then(r,i)}function i(e){return function(){var n=this,t=arguments;return new Promise(function(i,o){var a=e.apply(n,t);function d(e){r(a,i,o,d,p,"next",e)}function p(e){r(a,i,o,d,p,"throw",e)}d(void 0)})}}function o(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,a(r.key),r)}}function a(n){var t=function(n){if("object"!=e(n)||!n)return n;var t=n[Symbol.toPrimitive];if(void 0!==t){var r=t.call(n,"string");if("object"!=e(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(n)}(n);return"symbol"==e(t)?t:t+""}function d(){}function p(){var e;(e=console).error.apply(e,arguments)}function c(){var e;(e=console).warn.apply(e,arguments)}var u=function(){return e=function e(){var n;!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e),this.endpoint=pdfBuilderAjax.ajaxurl,this.nonce=(null===(n=pdfBuilderAjax)||void 0===n?void 0:n.nonce)||"",this.isGenerating=!1},t=[{key:"generateEditorPreview",value:(a=i(n().m(function e(t){var r,i,o,a,u=arguments;return n().w(function(e){for(;;)switch(e.p=e.n){case 0:if(r=u.length>1&&void 0!==u[1]?u[1]:{},!this.isGenerating){e.n=1;break}return c("‚ö†Ô∏è G√©n√©ration d√©j√† en cours..."),e.a(2,null);case 1:return this.isGenerating=!0,this.showLoadingIndicator(),e.p=2,(i=new FormData).append("action","wp_pdf_preview_image"),i.append("nonce",this.nonce),i.append("context","editor"),i.append("template_data",JSON.stringify(t)),i.append("quality",r.quality||150),i.append("format",r.format||"png"),d(),e.n=3,fetch(this.endpoint,{method:"POST",body:i});case 3:return o=e.v,e.n=4,o.json();case 4:if(!(a=e.v).success){e.n=5;break}return d(a.data),this.displayPreview(a.data.image_url,"editor"),e.a(2,a.data);case 5:return p("‚ùå Erreur g√©n√©ration √©diteur:",a.data),this.showError("Erreur lors de la g√©n√©ration de l'aper√ßu"),e.a(2,null);case 6:e.n=8;break;case 7:return e.p=7,p("‚ùå Erreur r√©seau:",e.v),this.showError("Erreur de connexion"),e.a(2,null);case 8:return e.p=8,this.isGenerating=!1,this.hideLoadingIndicator(),e.f(8);case 9:return e.a(2)}},e,this,[[2,7,8,9]])})),function(e){return a.apply(this,arguments)})},{key:"generateOrderPreview",value:(r=i(n().m(function e(t,r){var i,o,a,u,l=arguments;return n().w(function(e){for(;;)switch(e.p=e.n){case 0:if(i=l.length>2&&void 0!==l[2]?l[2]:{},!this.isGenerating){e.n=1;break}return c("‚ö†Ô∏è G√©n√©ration d√©j√† en cours..."),e.a(2,null);case 1:return this.isGenerating=!0,this.showLoadingIndicator(),e.p=2,(o=new FormData).append("action","wp_pdf_preview_image"),o.append("nonce",this.nonce),o.append("context","metabox"),o.append("template_data",JSON.stringify(t)),o.append("order_id",r),o.append("quality",i.quality||150),o.append("format",i.format||"png"),d(),e.n=3,fetch(this.endpoint,{method:"POST",body:o});case 3:return a=e.v,e.n=4,a.json();case 4:if(!(u=e.v).success){e.n=5;break}return d(u.data),this.displayPreview(u.data.image_url,"metabox",r),e.a(2,u.data);case 5:return p("‚ùå Erreur g√©n√©ration commande:",u.data),this.showError("Erreur lors de la g√©n√©ration de l'aper√ßu de commande"),e.a(2,null);case 6:e.n=8;break;case 7:return e.p=7,p("‚ùå Erreur r√©seau:",e.v),this.showError("Erreur de connexion"),e.a(2,null);case 8:return e.p=8,this.isGenerating=!1,this.hideLoadingIndicator(),e.f(8);case 9:return e.a(2)}},e,this,[[2,7,8,9]])})),function(e,n){return r.apply(this,arguments)})},{key:"displayPreview",value:function(e,n){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=document.getElementById("pdf-preview-modal");r||(r=this.createPreviewModal(),document.body.appendChild(r));var i=r.querySelector("#pdf-preview-image"),o=r.querySelector("#pdf-preview-title");i.src=e,i.style.maxWidth="100%",i.style.height="auto",o.textContent="editor"===n?"üëÅÔ∏è Aper√ßu du Template":"üìÑ Aper√ßu Commande #".concat(t),this.addPreviewActions(r,e,n),r.classList.add("visible")}},{key:"createPreviewModal",value:function(){if(!document.getElementById("pdf-preview-modal-styles")){var e=document.createElement("style");e.id="pdf-preview-modal-styles",e.textContent="\n                #pdf-preview-modal {\n                    position: fixed !important;\n                    top: 0 !important;\n                    left: 0 !important;\n                    width: 100% !important;\n                    height: 100% !important;\n                    background-color: rgba(0,0,0,0.8) !important;\n                    display: none !important;\n                    z-index: 99999 !important;\n                    align-items: center !important;\n                    justify-content: center !important;\n                    flex-direction: column !important;\n                    visibility: visible !important;\n                    gap: 0 !important;\n                    padding: 0 !important;\n                    margin: 0 !important;\n                }\n                \n                #pdf-preview-modal.visible {\n                    display: flex !important;\n                }\n                \n                #pdf-preview-modal-wrapper {\n                    background: white !important;\n                    border-radius: 8px !important;\n                    padding: 20px !important;\n                    max-width: 90vw !important;\n                    max-height: 90vh !important;\n                    overflow-y: auto !important;\n                    box-shadow: 0 10px 40px rgba(0,0,0,0.3) !important;\n                    flex-shrink: 0 !important;\n                    min-width: 300px !important;\n                    position: relative !important;\n                    width: 500px !important;\n                    align-self: center !important;\n                }\n            ",document.head.appendChild(e)}var n=document.createElement("div");n.id="pdf-preview-modal";var t=document.createElement("div");t.id="pdf-preview-modal-wrapper";var r=document.createElement("div");r.style.cssText="\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n            margin-bottom: 15px;\n        ";var i=document.createElement("h3");i.id="pdf-preview-title",i.textContent="Aper√ßu PDF",i.style.cssText="margin: 0; color: #1d2327;";var o=document.createElement("button");o.id="pdf-preview-close",o.textContent="√ó",o.style.cssText="\n            background: none;\n            border: none;\n            font-size: 24px;\n            cursor: pointer;\n            color: #666;\n        ",r.appendChild(i),r.appendChild(o);var a=document.createElement("div");a.id="pdf-preview-actions",a.style.cssText="margin-bottom: 15px;";var d=document.createElement("img");return d.id="pdf-preview-image",d.alt="Aper√ßu PDF",d.style.cssText="max-width: 100%; height: auto; border: 1px solid #ddd;",t.appendChild(r),t.appendChild(a),t.appendChild(d),n.appendChild(t),o.addEventListener("click",function(){n.classList.remove("visible")}),n.addEventListener("click",function(e){e.target===n&&n.classList.remove("visible")}),n}},{key:"addPreviewActions",value:function(e,n,t){var r=this,i=e.querySelector("#pdf-preview-actions");i.innerHTML="";var o=document.createElement("button");o.textContent="üì• T√©l√©charger",o.style.cssText="\n            background: #007cba;\n            color: white;\n            border: none;\n            padding: 8px 16px;\n            border-radius: 4px;\n            cursor: pointer;\n            margin-right: 10px;\n        ",o.addEventListener("click",function(){r.downloadPreview(n)});var a=document.createElement("button");if(a.textContent="üñ®Ô∏è Imprimer",a.style.cssText="\n            background: #46b450;\n            color: white;\n            border: none;\n            padding: 8px 16px;\n            border-radius: 4px;\n            cursor: pointer;\n            margin-right: 10px;\n        ",a.addEventListener("click",function(){r.printPreview(n)}),"metabox"===t){var d=document.createElement("button");d.textContent="üîÑ R√©g√©n√©rer",d.style.cssText="\n                background: #f56e28;\n                color: white;\n                border: none;\n                padding: 8px 16px;\n                border-radius: 4px;\n                cursor: pointer;\n            ",d.addEventListener("click",function(){"function"==typeof window.regenerateOrderPreview&&window.regenerateOrderPreview()}),i.appendChild(d)}i.appendChild(o),i.appendChild(a)}},{key:"downloadPreview",value:function(e){var n=document.createElement("a");n.href=e,n.download="pdf-preview-".concat(Date.now(),".png"),n.style.display="none",document.body.appendChild(n),n.click(),document.body.removeChild(n)}},{key:"printPreview",value:function(e){var n=window.open("","_blank");n.document.write('\n            <html>\n                <head>\n                    <title>Aper√ßu PDF</title>\n                    <style>\n                        body { margin: 0; padding: 20px; text-align: center; }\n                        img { max-width: 100%; height: auto; }\n                        @media print {\n                            body { margin: 0; }\n                            img { max-width: 100%; height: auto; }\n                        }\n                    </style>\n                </head>\n                <body>\n                    <img src="'.concat(e,'" alt="Aper√ßu PDF" onload="window.print(); window.close();" />\n                </body>\n            </html>\n        ')),n.document.close()}},{key:"showLoadingIndicator",value:function(){var e=document.getElementById("pdf-preview-loader");e||((e=document.createElement("div")).id="pdf-preview-loader",e.style.cssText="\n                position: fixed;\n                top: 50%;\n                left: 50%;\n                transform: translate(-50%, -50%);\n                background: rgba(255,255,255,0.9);\n                border: 1px solid #ccc;\n                border-radius: 8px;\n                padding: 20px;\n                z-index: 10000;\n                display: none;\n                text-align: center;\n            ",e.innerHTML='\n                <div style="border: 4px solid #f3f3f3; border-top: 4px solid #007cba; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin: 0 auto 10px;"></div>\n                <div>G√©n√©ration de l\'aper√ßu...</div>\n                <style>\n                    @keyframes spin {\n                        0% { transform: rotate(0deg); }\n                        100% { transform: rotate(360deg); }\n                    }\n                </style>\n            ',document.body.appendChild(e)),e.style.display="block"}},{key:"hideLoadingIndicator",value:function(){var e=document.getElementById("pdf-preview-loader");e&&(e.style.display="none")}},{key:"showError",value:function(e){p("PDF Preview Error:",e)}}],t&&o(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,r,a}();window.pdfPreviewAPI=new u,window.generateEditorPreview=function(e,n){return window.pdfPreviewAPI.generateEditorPreview(e,n)},window.generateOrderPreview=function(e,n,t){return window.pdfPreviewAPI.generateOrderPreview(e,n,t)}})();