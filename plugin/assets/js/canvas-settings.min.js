"use strict";(Object("undefined"!=typeof window?window:global).webpackChunkwp_pdf_builder_pro_v2=Object("undefined"!=typeof window?window:global).webpackChunkwp_pdf_builder_pro_v2||[]).push([[835],{932(e,t,a){a.r(t),function(e){class t{constructor(){this.modals={},this.currentModal=null,this.isInitialized=!1}init(){this.registerModals(),this.isInitialized=!0}registerModals(){["canvas-affichage-modal-overlay","canvas-navigation-modal-overlay","canvas-comportement-modal-overlay","canvas-systeme-modal-overlay"].forEach(e=>{const t=document.getElementById(e);if(t){const a=e.replace("canvas-","").replace("-modal-overlay","");this.modals[a]={id:e,element:t,category:a,applyButton:t.querySelector(".canvas-modal-apply"),cancelButton:t.querySelector(".canvas-modal-cancel"),closeButton:t.querySelector(".canvas-modal-close")}}}),this.bindEvents()}bindEvents(){document.addEventListener("click",e=>{const t=e.target.closest(".canvas-configure-btn");t&&(e.preventDefault(),this.handleConfigureButtonClick(t))}),document.addEventListener("click",e=>{const t=e.target.closest(".canvas-modal-apply");t&&(e.preventDefault(),this.handleApplyButtonClick(t))}),document.addEventListener("click",e=>{const t=e.target.closest(".canvas-modal-cancel"),a=e.target.closest(".canvas-modal-close");(t||a)&&(e.preventDefault(),this.handleCloseButtonClick(t||a))}),document.addEventListener("click",e=>{e.target.classList.contains("canvas-modal-overlay")&&this.closeModal(e.target)})}handleConfigureButtonClick(e){const t=e.closest(".canvas-card");if(!t)return;const a=t.getAttribute("data-category");a&&this.openModal(a)}async handleApplyButtonClick(e){const t=e.closest(".canvas-modal-overlay");if(!t)return;const a=e.getAttribute("data-category");a&&await this.saveModalSettings(t,a)}handleCloseButtonClick(e){const t=e.closest(".canvas-modal-overlay");t&&this.closeModal(t)}openModal(e){const t=this.modals[e];if(!t)return;const a=t.element;a&&(this.closeAllModals(),a.style.display="flex",document.body.style.overflow="hidden",this.currentModal=t)}closeModal(e){e&&(e.style.display="none",document.body.style.overflow="",this.currentModal=null)}closeAllModals(){Object.values(this.modals).forEach(e=>{e.element.style.display="none"}),document.body.style.overflow="",this.currentModal=null}async saveModalSettings(e,t){try{const a=this.collectModalData(e,t),n=e.querySelector(".canvas-modal-apply");n&&(n.disabled=!0,n.textContent="⏳ Sauvegarde...");const o=await this.sendSaveRequest(a);if(!o.success)throw new Error(o.data?.message||"Erreur inconnue lors de la sauvegarde");this.closeModal(e),setTimeout(()=>{window.location.reload()},1e3)}catch(e){this.showNotification(`Erreur lors de la sauvegarde: ${e.message}`,"error")}finally{const t=e.querySelector(".canvas-modal-apply");t&&(t.disabled=!1,t.textContent="✅ Appliquer")}}collectModalData(e,t){const a=new FormData;let n=0;return a.append("action","pdf_builder_save_canvas_modal"),a.append("category",t),a.append("nonce",window.pdfBuilderCanvasSettings?.nonce||""),e.querySelectorAll("input, select, textarea").forEach(e=>{const t=e.name,o=e.type;if(!t||e.disabled)return;let l=null;if("checkbox"===o)l=e.checked?"1":"0";else if("radio"===o){if(!e.checked)return;l=e.value}else l=e.value;null!==l&&(a.append(t,l),n++)}),a.append("field_count",n.toString()),a}async sendSaveRequest(t){const a=window.pdfBuilderCanvasSettings?.ajax_url||ajaxurl;return new Promise((n,o)=>{e.ajax({url:a,type:"POST",data:t,processData:!1,contentType:!1,success:e=>{n(e)},error:(e,t,a)=>{o(new Error(`Erreur AJAX: ${a}`))}})})}showNotification(e,t){"undefined"!=typeof showSystemNotification?showSystemNotification(e,t):alert(e)}getModalCategory(e){for(const[t,a]of Object.entries(this.modals))if(a.element===e)return t;return null}}document.addEventListener("DOMContentLoaded",function(){setTimeout(function(){!function(){if(void 0===window.jQuery&&void 0===e)return;var e=window.jQuery||window.$;if(void 0===window.pdfBuilderCanvasSettings)return;const a=window.location.href;if(!a.includes("page=pdf-builder-settings")||!a.includes("tab=contenu"))return;const n=["canvas-affichage-modal-overlay","canvas-navigation-modal-overlay","canvas-comportement-modal-overlay","canvas-systeme-modal-overlay"];if(n.forEach(e=>{document.getElementById(e)}),!(n.filter(e=>!document.getElementById(e)).length>0)&&0!==document.querySelectorAll(".canvas-configure-btn").length)try{window.canvasModalManager=new t,window.canvasModalManager.init()}catch(e){}}()},100)})}(jQuery)}},e=>{var t=e(e.s=932),a=window;for(var n in t)a[n]=t[n];t.__esModule&&Object.defineProperty(a,"__esModule",{value:!0})}]);