"use strict";(this.webpackChunkwp_pdf_builder_pro=this.webpackChunkwp_pdf_builder_pro||[]).push([[309],{711:function(e,t,n){n.d(t,{T:function(){return f}});var r=n(594),a=n(75);function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function u(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach(function(t){c(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function c(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=o(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=o(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==o(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e){return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o(e)}function l(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,i,u,c=[],o=!0,l=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;o=!1}else for(;!(o=(r=i.call(n)).done)&&(c.push(r.value),c.length!==t);o=!0);}catch(e){l=!0,a=e}finally{try{if(!o&&null!=n.return&&(u=n.return(),Object(u)!==u))return}finally{if(l)throw a}}return c}}(e,t)||function(e,t){if(e){if("string"==typeof e)return s(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?s(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var f=function(e){var t=e.canvasRef,n=e.canvasWidth,i=e.canvasHeight,c=e.elements,s=e.dragEnabled,f=void 0===s||s,d=(0,a.nY)(),h=d.state,v=d.dispatch,y=l((0,r.useState)(!1),2),m=y[0],p=y[1],g=(0,r.useCallback)(function(e){if(!e||"object"!==o(e))return!1;var t=e;return"string"==typeof t.type&&"string"==typeof t.label&&"object"===o(t.defaultProps)&&null!==t.defaultProps},[]),b=(0,r.useCallback)(function(e,r){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:50,c=t.current;if(!c)throw new Error("Canvas ref not available");var o=c.getBoundingClientRect();if(o.width<=0||o.height<=0)throw new Error("Invalid canvas dimensions");var l=e-o.left,s=r-o.top;l<0||s<0||l>o.width||o.height;var f=h.canvas.zoom/100,d=(l-h.canvas.pan.x)/f,v=(s-h.canvas.pan.y)/f,y=Math.max(0,d-a/2),m=Math.max(0,v-u/2);return{x:Math.max(0,Math.min(y,n-a)),y:Math.max(0,Math.min(m,i-u)),originalCanvasX:l,originalCanvasY:s,transformedX:d,transformedY:v}},[t,n,i,h.canvas]),w=(0,r.useCallback)(function(e){var t=Date.now(),n=Math.random().toString(36).substr(2,9);return"element_".concat(e,"_").concat(t,"_").concat(n)},[]),x=(0,r.useCallback)(function(e,t){var n=w(e.type),r=e.defaultProps.width||100,a=e.defaultProps.height||50;return u(u({id:n,type:e.type},e.defaultProps),{},{x:t.x,y:t.y,width:r,height:a,visible:!0,locked:!1,createdAt:new Date,updatedAt:new Date})},[w]);return{handleDrop:(0,r.useCallback)(function(e){if(f){e.preventDefault(),p(!1);try{var t=e.dataTransfer.getData("application/json");if(!t)throw new Error("No drag data received");var n=JSON.parse(t);if(!g(n))throw new Error("Invalid drag data structure");var r=n.defaultProps.width||100,a=n.defaultProps.height||50,i=b(e.clientX,e.clientY,r,a),u=x(n,i);c.find(function(e){return e.id===u.id})&&(u.id=w(n.type)),v({type:"ADD_ELEMENT",payload:u})}catch(o){}}},[g,b,x,c,v,w]),handleDragOver:(0,r.useCallback)(function(e){f&&(e.preventDefault(),e.dataTransfer.dropEffect="copy",m||p(!0))},[m,f]),handleDragLeave:(0,r.useCallback)(function(e){f&&e.relatedTarget&&p(!1)},[f]),isDragOver:m}}},748:function(e,t,n){n.d(t,{U:function(){return u}});var r=n(75),a=n(902),i=n(351);function u(){var e,t,n,u,c,o,l=(0,r.nY)(),s=l.state,f=l.dispatch,d=(null===(e=window.pdfBuilderData)||void 0===e?void 0:e.nonce)||window.pdfBuilderNonce||(null===(t=window.pdfBuilderReactData)||void 0===t?void 0:t.nonce)||"",h=(null===(n=window.pdfBuilderCanvasSettings)||void 0===n?void 0:n.auto_save_interval)||(null===(u=window.pdfBuilderData)||void 0===u?void 0:u.auto_save_interval)||(null===(c=window.pdfBuilderReactData)||void 0===c?void 0:c.auto_save_interval)||30,v=1e3*Math.max(10,h),y=!0===(null===(o=window.pdfBuilderCanvasSettings)||void 0===o?void 0:o.auto_save_enabled),m=(0,a.K)({templateId:s.template.id,elements:s.elements,nonce:d,autoSaveInterval:y?v:0,onSaveStart:function(){},onSaveSuccess:function(e){f({type:"SET_TEMPLATE_MODIFIED",payload:!1})},onSaveError:function(e){(0,i.AO)("[AUTO SAVE] Erreur: ".concat(e))}});return{state:m.state,isSaving:m.isSaving,lastSavedAt:m.lastSavedAt,error:m.error,saveNow:m.saveNow,triggerSave:m.triggerSave,clearError:m.clearError,progress:m.progress,isEnabled:y}}},980:function(e,t,n){n.d(t,{g:function(){return h}});var r=n(594),a=n(75),i=n(49);function u(e){return u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},u(e)}function c(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function o(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=u(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=u(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==u(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e){return function(e){if(Array.isArray(e))return d(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||f(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,i,u,c=[],o=!0,l=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;o=!1}else for(;!(o=(r=i.call(n)).done)&&(c.push(r.value),c.length!==t);o=!0);}catch(e){l=!0,a=e}finally{try{if(!o&&null!=n.return&&(u=n.return(),Object(u)!==u))return}finally{if(l)throw a}}return c}}(e,t)||f(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function f(e,t){if(e){if("string"==typeof e)return d(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?d(e,t):void 0}}function d(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var h=function(e){var t=e.canvasRef,n=e.canvasWidth,u=void 0===n?794:n,d=e.canvasHeight,h=void 0===d?1123:d,v=(0,a.nY)(),y=v.state,m=v.dispatch,p=(0,i.h)(),g=p.selectionMultiSelectEnabled?p.canvasSelectionMode:"click",b=s((0,r.useState)(0),2),w=b[0],x=b[1],E=(0,r.useRef)(!1),M=(0,r.useRef)(!1),S=(0,r.useRef)(!1),O=(0,r.useRef)({}),C=(0,r.useRef)({x:0,y:0}),k=(0,r.useRef)({x:0,y:0}),D=(0,r.useRef)({x:0,y:0}),A=(0,r.useRef)({}),T=(0,r.useRef)(null),j=(0,r.useRef)([]),R=(0,r.useRef)(null),P=(0,r.useRef)("default"),_=(0,r.useRef)(!1),I=(0,r.useRef)({x:0,y:0}),N=(0,r.useRef)([]),L=(0,r.useRef)({x:0,y:0,width:0,height:0}),z=(0,r.useRef)(null),B=(0,r.useRef)(null),U=(0,r.useRef)(null),Y=(0,r.useRef)(null),X=(0,r.useRef)(null),G=(0,r.useRef)(y),W=(0,r.useCallback)(function(){z.current||B.current||(z.current=function(e){var n=t.current;if(n){var r=n.getBoundingClientRect(),a=y.canvas.zoom/100,i=e.clientX-r.left,u=e.clientY-r.top,c=(i-y.canvas.pan.x)/a,o=(u-y.canvas.pan.y)/a;if("lasso"===g)N.current.push({x:c,y:o}),x(function(e){return e+1});else if("rectangle"===g){var l=Math.min(I.current.x,c),s=Math.min(I.current.y,o),f=Math.abs(c-I.current.x),d=Math.abs(o-I.current.y);L.current={x:l,y:s,width:f,height:d},x(function(e){return e+1})}}},B.current=function(){if(q(),_.current){var e=[];"lasso"===g&&N.current.length>2?e=y.elements.filter(function(e){for(var t=e.x+e.width/2,n=e.y+e.height/2,r=!1,a=N.current,i=0,u=a.length-1;i<a.length;u=i++){var c=a[i].x,o=a[i].y,l=a[u].x,s=a[u].y;o>n!=s>n&&t<(l-c)*(n-o)/(s-o)+c&&(r=!r)}return r}).map(function(e){return e.id}):"rectangle"===g&&L.current.width>0&&L.current.height>0&&(e=y.elements.filter(function(e){var t=e.x+e.width,n=e.y+e.height,r=L.current.x+L.current.width,a=L.current.y+L.current.height;return!(e.x>r||t<L.current.x||e.y>a||n<L.current.y)}).map(function(e){return e.id})),e.length>0?m({type:"SET_SELECTION",payload:e}):m({type:"CLEAR_SELECTION"}),_.current=!1,N.current=[],L.current={x:0,y:0,width:0,height:0}}},document.addEventListener("mousemove",z.current),document.addEventListener("mouseup",B.current))},[t,y.canvas.zoom,y.canvas.pan,y.elements,g,m]),q=(0,r.useCallback)(function(){z.current&&(document.removeEventListener("mousemove",z.current),z.current=null),B.current&&(document.removeEventListener("mouseup",B.current),B.current=null)},[]),F=(0,r.useCallback)(function(){if(Y.current){var e=Y.current,t=e.x,n=e.y,r=G.current,a=r.selection.selectedElements;if(0!==a.length){var i=t-C.current.x,c=n-C.current.y;a.forEach(function(e){var t=r.elements.find(function(t){return t.id===e});if(t){var n=O.current[e];if(n){var a=n.x+i,o=n.y+c;if(r.canvas.snapToGrid&&r.canvas.gridSize>0){var l=r.canvas.gridSize,s=Math.round(a/l)*l,f=Math.round(o/l)*l;Math.abs(a-s)<=5&&(a=s),Math.abs(o-f)<=5&&(o=f)}var d=u,v=h,y=Math.min(50,.3*t.width);a<0&&(a=0),a+y>d&&(a=d-y);var p=Math.min(30,.3*t.height);o<0&&(o=0),o+p>v&&(o=v-p);var g={x:a,y:o},b=t;Object.keys(b).forEach(function(e){"x"!==e&&"y"!==e&&"updatedAt"!==e&&(g[e]=b[e])}),"src"in b&&(g.src=b.src),"logoUrl"in b&&(g.logoUrl=b.logoUrl),"alignment"in b&&(g.alignment=b.alignment),m({type:"UPDATE_ELEMENT",payload:{id:e,updates:g}})}}}),Y.current=null,U.current=null}else U.current=null}else U.current=null},[m,u,h]),H=(0,r.useCallback)(function(){if(X.current){var e=X.current,t=e.x,n=e.y,r=G.current,a=r.selection.selectedElements;if(0!==a.length){var i=r.elements.filter(function(e){return a.includes(e.id)}),u=1/0,c=1/0,o=-1/0,l=-1/0;i.forEach(function(e){u=Math.min(u,e.x),c=Math.min(c,e.y),o=Math.max(o,e.x+e.width),l=Math.max(l,e.y+e.height)});for(var s=(u+o)/2,f=(c+l)/2,d=Math.atan2(D.current.y-f,D.current.x-s),h=Math.atan2(n-f,t-s)-d;h>Math.PI;)h-=2*Math.PI;for(;h<-Math.PI;)h+=2*Math.PI;var v=180*(h*=1.3)/Math.PI;a.forEach(function(e){if(r.elements.find(function(t){return t.id===e})){var t=A.current[e]||0,n=(t+v)%360;n>180&&(n-=360),n<-180&&(n+=360),Math.abs(n)<=8&&(v=-t)}}),a.forEach(function(e){if(r.elements.find(function(t){return t.id===e})){var t=A.current[e]||0;m({type:"UPDATE_ELEMENT",payload:{id:e,updates:{rotation:t+v}}})}}),X.current=null,U.current=null}else U.current=null}else U.current=null},[m]),K=(0,r.useRef)(0),$=(0,r.useCallback)(function(e,t,n,r){var a,i=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=f(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,u=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return u=e.done,e},e:function(e){c=!0,i=e},f:function(){try{u||null==n.return||n.return()}finally{if(c)throw i}}}}(r.filter(function(e){return n.includes(e.id)}));try{for(i.s();!(a=i.n()).done;)for(var u=a.value,c=[{name:"nw",x:u.x-4,y:u.y-4},{name:"ne",x:u.x+u.width-4,y:u.y-4},{name:"sw",x:u.x-4,y:u.y+u.height-4},{name:"se",x:u.x+u.width-4,y:u.y+u.height-4},{name:"n",x:u.x+u.width/2-4,y:u.y-4},{name:"s",x:u.x+u.width/2-4,y:u.y+u.height-4},{name:"w",x:u.x-4,y:u.y+u.height/2-4},{name:"e",x:u.x+u.width-4,y:u.y+u.height/2-4}],o=0,l=c;o<l.length;o++){var s=l[o];if(e>=s.x-6&&e<=s.x+8+6&&t>=s.y-6&&t<=s.y+8+6)return{elementId:u.id,handle:s.name}}}catch(d){i.e(d)}finally{i.f()}return null},[]),J=(0,r.useCallback)(function(e,t,n){var r,a="element_".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9)),i=e,u=t;if(y.canvas.snapToGrid&&y.canvas.gridSize>0){var c=y.canvas.gridSize;i=Math.round(e/c)*c,u=Math.round(t/c)*c}switch(n){case"rectangle":r={id:a,type:"rectangle",x:i-50,y:u-50,width:100,height:100,fillColor:"#ffffff",strokeColor:"#000000",strokeWidth:1,borderRadius:0,rotation:0,visible:!0,locked:!1,createdAt:new Date,updatedAt:new Date};break;case"circle":r={id:a,type:"circle",x:i-50,y:u-50,width:100,height:100,fillColor:"#ffffff",strokeColor:"#000000",strokeWidth:1,rotation:0,visible:!0,locked:!1,createdAt:new Date,updatedAt:new Date};break;case"line":r={id:a,type:"line",x:i-50,y:u-1,width:100,height:2,strokeColor:"#000000",strokeWidth:2,rotation:0,visible:!0,locked:!1,createdAt:new Date,updatedAt:new Date};break;case"text":r={id:a,type:"text",x:i-50,y:u-10,width:100,height:30,text:"Texte",fontSize:16,color:"#000000",align:"left",rotation:0,visible:!0,locked:!1,createdAt:new Date,updatedAt:new Date};break;case"image":r={id:a,type:"image",x:i-50,y:u-50,width:100,height:100,src:"",rotation:0,visible:!0,locked:!1,createdAt:new Date,updatedAt:new Date};break;default:return}m({type:"ADD_ELEMENT",payload:r}),m({type:"SET_SELECTION",payload:[a]}),T.current=a,m({type:"SET_MODE",payload:"select"})},[m,y.canvas.snapToGrid,y.canvas.gridSize]);(0,r.useEffect)(function(){j.current=y.selection.selectedElements,G.current=y},[y.selection.selectedElements,y]);var V=function(e){return!(!e||e.width<=0||e.height<=0)&&!(isNaN(e.left)||isNaN(e.top)||isNaN(e.right)||isNaN(e.bottom))},Q=function(e,t,n){var r=0;"line"===n.type&&(r=Math.max(1,Math.min(2,.5*n.height)));var a=n.x-r,i=n.x+n.width+r,u=n.y-r,c=n.y+n.height+r;return e>=a&&e<=i&&t>=u&&t<=c},Z=(0,r.useCallback)(function(e){var n=t.current;if(n){var r=n.getBoundingClientRect();if(V(r)){var a=y.canvas.zoom/100,i=(e.clientX-r.left-y.canvas.pan.x)/a,u=(e.clientY-r.top-y.canvas.pan.y)/a;l(y.elements).reverse().find(function(e){return Q(i,u,e)})||"select"===y.mode||J(i,u,y.mode)}}},[y,t,J]),ee=(0,r.useCallback)(function(e){var n=t.current;if(n){var r=n.getBoundingClientRect();if(V(r)){var a=y.canvas.zoom/100,i=e.clientX-r.left,u=e.clientY-r.top,c=(i-y.canvas.pan.x)/a,s=(u-y.canvas.pan.y)/a,f=l(y.elements).reverse().find(function(e){return Q(c,s,e)});if(f){var d=y.selection.selectedElements.includes(f.id);if(p.selectionMultiSelectEnabled&&e.ctrlKey){if(d){var h=y.selection.selectedElements.filter(function(e){return e!==f.id});m({type:"SET_SELECTION",payload:h})}else{var v=[].concat(l(y.selection.selectedElements),[f.id]);m({type:"SET_SELECTION",payload:v})}return void e.preventDefault()}if(!d)return m({type:"SET_SELECTION",payload:[f.id]}),E.current=!0,O.current=o({},f.id,{x:f.x,y:f.y}),C.current={x:c,y:s},T.current=f.id,void e.preventDefault();E.current=!0;var b={};return y.selection.selectedElements.forEach(function(e){var t=y.elements.find(function(t){return t.id===e});t&&(b[e]={x:t.x,y:t.y})}),O.current=b,C.current={x:c,y:s},T.current=f.id,void e.preventDefault()}var w=$(c,s,y.selection.selectedElements,y.elements);if(w)return M.current=!0,R.current=w.handle,T.current=w.elementId,k.current={x:c,y:s},void e.preventDefault();if(null!=p&&p.selectionRotationEnabled&&y.selection.selectedElements.length>0){var x=y.elements.filter(function(e){return y.selection.selectedElements.includes(e.id)});if(x.length>0){var j=1/0,P=1/0,z=-1/0,B=-1/0;x.forEach(function(e){j=Math.min(j,e.x),P=Math.min(P,e.y),z=Math.max(z,e.x+e.width),B=Math.max(B,e.y+e.height)});var U=(j+z)/2,Y=P-20;if(Math.sqrt(Math.pow(c-U,2)+Math.pow(s-Y,2))<=4){S.current=!0,D.current={x:c,y:s};var X={};return y.selection.selectedElements.forEach(function(e){var t=y.elements.find(function(t){return t.id===e});t&&(X[e]=t.rotation||0)}),A.current=X,void e.preventDefault()}}}if("lasso"===g||"rectangle"===g)return _.current=!0,I.current={x:c,y:s},N.current=[{x:c,y:s}],"rectangle"===g&&(L.current={x:c,y:s,width:0,height:0}),W(),void e.preventDefault();y.selection.selectedElements.length>0&&(m({type:"CLEAR_SELECTION"}),T.current=null)}}},[y,t,m,$]),te=(0,r.useCallback)(function(){null!==U.current&&(cancelAnimationFrame(U.current),U.current=null,Y.current&&F(),X.current&&H());var e=G.current,t=e.selection.selectedElements;if(t.length>0&&S.current&&t.forEach(function(t){var n=e.elements.find(function(e){return e.id===t});if(n){var r=(n.rotation||0)%360;r>180&&(r-=360),r<-180&&(r+=360);Math.abs(r)<=10&&m({type:"UPDATE_ELEMENT",payload:{id:t,updates:{rotation:0}}})}}),_.current){var n=[];"lasso"===g&&N.current.length>2?n=y.elements.filter(function(e){return le(e,N.current)}).map(function(e){return e.id}):"rectangle"===g&&L.current.width>0&&L.current.height>0&&(n=y.elements.filter(function(e){return oe(e,L.current)}).map(function(e){return e.id})),n.length>0?m({type:"SET_SELECTION",payload:n}):m({type:"CLEAR_SELECTION"}),_.current=!1,N.current=[],L.current={x:0,y:0,width:0,height:0}}E.current=!1,M.current=!1,S.current=!1,R.current=null,T.current=null,A.current={},X.current=null},[F,H,m]),ne=function(e){switch(e){case"nw":case"se":return"nw-resize";case"ne":case"sw":return"ne-resize";case"n":return"n-resize";case"s":return"s-resize";case"w":return"w-resize";case"e":return"e-resize";default:return"default"}},re=(0,r.useCallback)(function(e,t){if(E.current)return"grabbing";if(M.current)return ne(R.current);if(S.current)return"grabbing";if(null!=p&&p.selectionRotationEnabled&&y.selection.selectedElements.length>0){var n=y.elements.filter(function(e){return y.selection.selectedElements.includes(e.id)});if(n.length>0){var r=1/0,a=1/0,i=-1/0,u=-1/0;n.forEach(function(e){r=Math.min(r,e.x),a=Math.min(a,e.y),i=Math.max(i,e.x+e.width),u=Math.max(u,e.y+e.height)});var c=(r+i)/2,o=a-20;if(Math.sqrt(Math.pow(e-c,2)+Math.pow(t-o,2))<=4)return"grab"}}var l=$(e,t,y.selection.selectedElements,y.elements);if(l)return ne(l.handle);if(y.selection.selectedElements.length>0&&y.elements.find(function(n){return y.selection.selectedElements.includes(n.id)&&Q(e,t,n)}))return"grab";return"default"},[y.selection.selectedElements,y.elements,$,p.selectionRotationEnabled]),ae=(0,r.useCallback)(function(e){var n=t.current;n&&e!==P.current&&(n.style.cursor=e,P.current=e)},[t]),ie=(0,r.useCallback)(function(e,t,n,r,a){var i={},u=20;switch(t){case"se":i.width=Math.max(u,n-e.x),i.height=Math.max(u,r-e.y);break;case"sw":var c=Math.min(n,e.x+e.width-u);i.width=Math.max(u,e.x+e.width-c),i.x=c,i.height=Math.max(u,r-e.y);break;case"ne":var o=Math.min(r,e.y+e.height-u);i.width=Math.max(u,n-e.x),i.height=Math.max(u,e.y+e.height-o),i.y=o;break;case"nw":var l=Math.min(n,e.x+e.width-u),s=Math.min(r,e.y+e.height-u);i.width=Math.max(u,e.x+e.width-l),i.height=Math.max(u,e.y+e.height-s),i.x=l,i.y=s;break;case"n":var f=Math.min(r,e.y+e.height-u);i.height=Math.max(u,e.y+e.height-f),i.y=f;break;case"s":i.height=Math.max(u,r-e.y);break;case"w":var d=Math.min(n,e.x+e.width-u);i.width=Math.max(u,e.x+e.width-d),i.x=d;break;case"e":i.width=Math.max(u,n-e.x)}if(y.canvas.snapToGrid&&y.canvas.gridSize>0){var h=y.canvas.gridSize;if(void 0!==i.x){var v=Math.round(i.x/h)*h;Math.abs(i.x-v)<=5&&(i.x=v)}if(void 0!==i.y){var m=Math.round(i.y/h)*h;Math.abs(i.y-m)<=5&&(i.y=m)}}return i},[y.canvas.snapToGrid,y.canvas.gridSize]),ue=(0,r.useCallback)(function(e){var n=Date.now();if(!(n-K.current<8)){K.current=n;var r=t.current;if(r){var a=r.getBoundingClientRect(),i=y.canvas.zoom/100,u=e.clientX-a.left,l=e.clientY-a.top,s=(u-y.canvas.pan.x)/i,f=(l-y.canvas.pan.y)/i,d=re(s,f);if(ae(d),!_.current||z.current)if(E.current&&T.current)Y.current={x:s,y:f},null===U.current&&(U.current=requestAnimationFrame(F));else if(M.current&&T.current&&R.current){var h=G.current.elements.find(function(e){return e.id===T.current});if(!h)return;var v=ie(h,R.current,s,f,k.current),p=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?c(Object(n),!0).forEach(function(t){o(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({},v),b=h;Object.keys(b).forEach(function(e){e in v||"updatedAt"===e||(p[e]=b[e])}),m({type:"UPDATE_ELEMENT",payload:{id:T.current,updates:p}})}else S.current&&y.selection.selectedElements.length>0&&(X.current={x:s,y:f},null===U.current&&(U.current=requestAnimationFrame(H)));else if("lasso"===g)N.current.push({x:s,y:f}),x(function(e){return e+1});else if("rectangle"===g){var w=Math.min(I.current.x,s),O=Math.min(I.current.y,f),C=Math.abs(s-I.current.x),D=Math.abs(f-I.current.y);L.current={x:w,y:O,width:C,height:D},x(function(e){return e+1})}}}},[m,t,re,ae,ie,y.canvas,F]);(0,r.useEffect)(function(){return function(){q()}},[q]);var ce=(0,r.useCallback)(function(e,n){e.preventDefault();var r=t.current;if(r){var a=e.clientX,i=e.clientY,u=r.getBoundingClientRect(),c=e.clientX-u.left,o=e.clientY-u.top,l=y.canvas.zoom/100,s=(c-y.canvas.pan.x)/l,f=(o-y.canvas.pan.y)/l,d=y.elements.find(function(e){return Q(s,f,e)});d?n(a,i,d.id):n(a,i)}},[y,t]),oe=(0,r.useCallback)(function(e,t){var n=e.x+e.width,r=e.y+e.height,a=t.x+t.width,i=t.y+t.height;return!(e.x>a||n<t.x||e.y>i||r<t.y)},[]),le=(0,r.useCallback)(function(e,t){if(t.length<3)return!1;var n=e.x+e.width/2,r=e.y+e.height/2;return se(n,r,t)},[]),se=function(e,t,n){for(var r=!1,a=0,i=n.length-1;a<n.length;i=a++){var u=n[a].x,c=n[a].y,o=n[i].x,l=n[i].y;c>t!=l>t&&e<(o-u)*(t-c)/(l-c)+u&&(r=!r)}return r};return{handleCanvasClick:Z,handleMouseDown:ee,handleMouseMove:ue,handleMouseUp:te,handleContextMenu:ce,selectionState:{isSelecting:_.current,selectionMode:g,selectionRect:L.current,selectionPoints:N.current,updateTrigger:w}}}}}]);