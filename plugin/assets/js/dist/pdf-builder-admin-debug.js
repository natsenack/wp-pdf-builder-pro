/*! For license information please see pdf-builder-admin-debug.js.LICENSE.txt */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.pdfBuilderPro=t():e.pdfBuilderPro=t()}(this,function(){return function(){"use strict";var e={52:function(e,t,r){function n(e){this.canvasInstance=e,this.selectedElements=new Set,this.selectionBounds=null,this.isSelecting=!1,this.selectionStartPoint=null,this.selectionRect=null,this.selectionColor="rgba(0, 123, 255, 0.2)",this.selectionBorderColor="#007bff",this.selectionBorderWidth=2,this.minSelectionSize=5}r.d(t,{K:function(){return n}}),e=r.hmd(e),n.prototype.selectAtPoint=function(e,t){var r=this.canvasInstance.getElementAtPoint(e);return t||this.clearSelection(),!!r&&(t&&this.selectedElements.has(r.id)?this.selectedElements.delete(r.id):this.selectedElements.add(r.id),this.updateSelectionBounds(),!0)},n.prototype.startSelection=function(e){this.isSelecting=!0,this.selectionStartPoint={x:e.x,y:e.y},this.selectionRect={x:e.x,y:e.y,width:0,height:0}},n.prototype.updateSelection=function(e){this.isSelecting&&this.selectionStartPoint&&(this.selectionRect.x=Math.min(this.selectionStartPoint.x,e.x),this.selectionRect.y=Math.min(this.selectionStartPoint.y,e.y),this.selectionRect.width=Math.abs(e.x-this.selectionStartPoint.x),this.selectionRect.height=Math.abs(e.y-this.selectionStartPoint.y))},n.prototype.endSelection=function(e){if(this.isSelecting&&this.selectionRect){if(e||this.clearSelection(),this.selectionRect.width>=this.minSelectionSize&&this.selectionRect.height>=this.minSelectionSize)this.getElementsInRect(this.selectionRect).forEach(function(e){this.selectedElements.add(e)}.bind(this));this.updateSelectionBounds(),this.isSelecting=!1,this.selectionStartPoint=null,this.selectionRect=null}},n.prototype.getElementsInRect=function(e){var t=[];return this.canvasInstance.elements.forEach(function(r,n){this.elementIntersectsRect(r,e)&&t.push(n)}.bind(this)),t},n.prototype.elementIntersectsRect=function(e,t){var r=e.properties;return!(r.x+r.width<t.x||t.x+t.width<r.x||r.y+r.height<t.y||t.y+t.height<r.y)},n.prototype.updateSelectionBounds=function(){if(0!==this.selectedElements.size){var e=1/0,t=1/0,r=-1/0,n=-1/0;this.selectedElements.forEach(function(i){var o=this.canvasInstance.elements.get(i);if(o){var a=o.properties;e=Math.min(e,a.x),t=Math.min(t,a.y),r=Math.max(r,a.x+a.width),n=Math.max(n,a.y+a.height)}}.bind(this)),this.selectionBounds={x:e,y:t,width:r-e,height:n-t}}else this.selectionBounds=null},n.prototype.clearSelection=function(){this.selectedElements.clear(),this.selectionBounds=null},n.prototype.getSelectionCount=function(){return this.selectedElements.size},n.prototype.getSelectedElementIds=function(){return Array.from(this.selectedElements)},n.prototype.getSelectedElements=function(){var e=[];return this.selectedElements.forEach(function(t){var r=this.canvasInstance.elements.get(t);r&&e.push(r)}.bind(this)),e},n.prototype.isElementSelected=function(e){return this.selectedElements.has(e)},n.prototype.selectAll=function(){this.canvasInstance.elements.forEach(function(e,t){this.selectedElements.add(t)}.bind(this)),this.updateSelectionBounds()},n.prototype.render=function(e){this.isSelecting&&this.selectionRect&&(e.save(),e.fillStyle=this.selectionColor,e.strokeStyle=this.selectionBorderColor,e.lineWidth=this.selectionBorderWidth,e.fillRect(this.selectionRect.x,this.selectionRect.y,this.selectionRect.width,this.selectionRect.height),e.strokeRect(this.selectionRect.x,this.selectionRect.y,this.selectionRect.width,this.selectionRect.height),e.restore()),this.selectionBounds&&this.selectedElements.size>0&&(e.save(),e.strokeStyle=this.selectionBorderColor,e.lineWidth=this.selectionBorderWidth,e.setLineDash([5,5]),e.strokeRect(this.selectionBounds.x,this.selectionBounds.y,this.selectionBounds.width,this.selectionBounds.height),e.restore())},n.prototype.dispose=function(){this.clearSelection(),this.isSelecting=!1,this.selectionStartPoint=null,this.selectionRect=null},e.exports&&(e.exports=n),t.A=n},57:function(e,t,r){function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function i(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,o,a,s=[],c=!0,l=!1;try{if(o=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=o.call(r)).done)&&(s.push(n.value),s.length!==t);c=!0);}catch(e){l=!0,i=e}finally{try{if(!c&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(l)throw i}}return s}}(e,t)||function(e,t){if(e){if("string"==typeof e)return o(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?o(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function a(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function s(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?a(Object(r),!0).forEach(function(t){c(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function c(e,t,r){return(t=h(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function l(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,h(n.key),n)}}function h(e){var t=function(e,t){if("object"!=n(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=n(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==n(t)?t:t+""}r.d(t,{O:function(){return u}});var u=function(){return e=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.canvas=null,this.canvasInstance=t,this.eventListeners=new Map,this.mouseState={isDown:!1,button:null,position:{x:0,y:0},lastPosition:{x:0,y:0},dragStart:null},this.keyboardState={keys:new Set,modifiers:{ctrl:!1,shift:!1,alt:!1,meta:!1}},this.touchState={touches:new Map,gesture:null},this.eventConfig={enableKeyboard:!0,enableMouse:!0,enableTouch:!0,enableWheel:!0,enableContextMenu:!1,throttleMouseMove:!0,mouseMoveThrottleMs:16},this.throttleTimers=new Map},(t=[{key:"initialize",value:function(e){this.canvas=e,this.init()}},{key:"init",value:function(){this.attachMouseEvents(),this.attachKeyboardEvents(),this.attachTouchEvents(),this.attachWheelEvents(),this.attachFocusEvents()}},{key:"attachMouseEvents",value:function(){var e=this;this.eventConfig.enableMouse&&["mousedown","mouseup","mousemove","mouseenter","mouseleave","mouseover","mouseout","click","dblclick","contextmenu"].forEach(function(t){var r=e.createMouseHandler(t);e.canvas.addEventListener(t,r,{passive:!1}),e.eventListeners.set("mouse_".concat(t),r)})}},{key:"attachKeyboardEvents",value:function(){var e=this;this.eventConfig.enableKeyboard&&["keydown","keyup","keypress"].forEach(function(t){var r=e.createKeyboardHandler(t);document.addEventListener(t,r,{passive:!1}),e.eventListeners.set("keyboard_".concat(t),r)})}},{key:"attachTouchEvents",value:function(){var e=this;this.eventConfig.enableTouch&&["touchstart","touchend","touchmove","touchcancel","gesturestart","gesturechange","gestureend"].forEach(function(t){var r=e.createTouchHandler(t);e.canvas.addEventListener(t,r,{passive:!1,capture:!0}),e.eventListeners.set("touch_".concat(t),r)})}},{key:"attachWheelEvents",value:function(){if(this.eventConfig.enableWheel){var e=this.createWheelHandler();this.canvas.addEventListener("wheel",e,{passive:!1}),this.eventListeners.set("wheel",e)}}},{key:"attachFocusEvents",value:function(){var e=this;["focus","blur","focusin","focusout"].forEach(function(t){var r=e.createFocusHandler(t);e.canvas.addEventListener(t,r),e.eventListeners.set("focus_".concat(t),r)})}},{key:"createMouseHandler",value:function(e){var t=this;return function(r){if("contextmenu"!==e||t.eventConfig.enableContextMenu){t.updateMouseState(r,e);var n=t.normalizeMouseEvent(r,e);"mousemove"===e&&t.eventConfig.throttleMouseMove?t.throttleEvent("mousemove",function(){t.dispatchEvent(n)},t.eventConfig.mouseMoveThrottleMs):t.dispatchEvent(n),t.shouldPreventDefault(r,e)&&r.preventDefault()}else r.preventDefault()}}},{key:"updateMouseState",value:function(e,t){var r=this.canvas.getBoundingClientRect(),n=this.canvas.width/r.width,i=this.canvas.height/r.height;switch(this.mouseState.lastPosition=s({},this.mouseState.position),this.mouseState.position={x:(e.clientX-r.left)*n,y:(e.clientY-r.top)*i},t){case"mousedown":this.mouseState.isDown=!0,this.mouseState.button=e.button,this.mouseState.dragStart=s({},this.mouseState.position);break;case"mouseup":this.mouseState.isDown=!1,this.mouseState.button=null,this.mouseState.dragStart=null}}},{key:"normalizeMouseEvent",value:function(e,t){return{type:t,originalEvent:e,position:s({},this.mouseState.position),delta:{x:this.mouseState.position.x-this.mouseState.lastPosition.x,y:this.mouseState.position.y-this.mouseState.lastPosition.y},button:e.button,buttons:e.buttons,isDown:this.mouseState.isDown,modifiers:s({},this.keyboardState.modifiers),dragStart:this.mouseState.dragStart?s({},this.mouseState.dragStart):null,timestamp:Date.now()}}},{key:"createKeyboardHandler",value:function(e){var t=this;return function(r){t.updateKeyboardState(r,e);var n=t.normalizeKeyboardEvent(r,e);t.dispatchEvent(n),t.shouldPreventDefault(r,e)&&r.preventDefault()}}},{key:"updateKeyboardState",value:function(e,t){var r=e.key.toLowerCase();switch(t){case"keydown":this.keyboardState.keys.add(r);break;case"keyup":this.keyboardState.keys.delete(r)}this.keyboardState.modifiers={ctrl:e.ctrlKey,shift:e.shiftKey,alt:e.altKey,meta:e.metaKey}}},{key:"normalizeKeyboardEvent",value:function(e,t){return{type:t,originalEvent:e,key:e.key,code:e.code,modifiers:s({},this.keyboardState.modifiers),isRepeat:e.repeat,timestamp:Date.now()}}},{key:"createTouchHandler",value:function(e){var t=this;return function(r){t.updateTouchState(r,e);var n=t.normalizeTouchEvent(r,e);t.dispatchEvent(n),t.shouldPreventDefault(r,e)&&r.preventDefault()}}},{key:"updateTouchState",value:function(e,t){var r=this,n=this.canvas.getBoundingClientRect(),i=this.canvas.width/n.width,o=this.canvas.height/n.height;switch(t){case"touchstart":Array.from(e.touches).forEach(function(e){var t={id:e.identifier,x:(e.clientX-n.left)*i,y:(e.clientY-n.top)*o,force:e.force||1};r.touchState.touches.set(e.identifier,t)});break;case"touchend":case"touchcancel":Array.from(e.changedTouches).forEach(function(e){r.touchState.touches.delete(e.identifier)});break;case"touchmove":Array.from(e.touches).forEach(function(e){if(r.touchState.touches.has(e.identifier)){var t=r.touchState.touches.get(e.identifier);t.x=(e.clientX-n.left)*i,t.y=(e.clientY-n.top)*o,t.force=e.force||1}})}this.detectGestures(e)}},{key:"detectGestures",value:function(e){var t=Array.from(this.touchState.touches.values());if(2===t.length){var r=t[0],n=t[1],i=Math.sqrt(Math.pow(n.x-r.x,2)+Math.pow(n.y-r.y,2));this.touchState.gesture?this.touchState.gesture.currentDistance=i:this.touchState.gesture={type:"pinch",initialDistance:i,currentDistance:i}}else this.touchState.gesture=null}},{key:"normalizeTouchEvent",value:function(e,t){return{type:t,originalEvent:e,touches:Array.from(this.touchState.touches.values()),changedTouches:Array.from(e.changedTouches||[]).map(function(e){return{id:e.identifier,x:e.clientX,y:e.clientY,force:e.force||1}}),gesture:this.touchState.gesture,timestamp:Date.now()}}},{key:"createWheelHandler",value:function(){var e=this;return function(t){var r=e.normalizeWheelEvent(t);e.dispatchEvent(r),e.shouldPreventDefault(t,"wheel")&&t.preventDefault()}}},{key:"normalizeWheelEvent",value:function(e){return{type:"wheel",originalEvent:e,deltaX:e.deltaX,deltaY:e.deltaY,deltaZ:e.deltaZ,deltaMode:e.deltaMode,modifiers:s({},this.keyboardState.modifiers),timestamp:Date.now()}}},{key:"createFocusHandler",value:function(e){var t=this;return function(r){var n={type:e,originalEvent:r,timestamp:Date.now()};t.dispatchEvent(n)}}},{key:"shouldPreventDefault",value:function(e,t){return"wheel"===t||("contextmenu"===t&&!this.eventConfig.enableContextMenu||!("keydown"!==t||!["ArrowUp","ArrowDown","ArrowLeft","ArrowRight","Space"].includes(e.code)))}},{key:"dispatchEvent",value:function(e){if(this.canvasInstance){var t={mousedown:"handleMouseDown",mouseup:"handleMouseUp",mousemove:"handleMouseMove",click:"handleClick",dblclick:"handleDoubleClick",keydown:"handleKeyDown",keyup:"handleKeyUp",wheel:"handleWheel",touchstart:"handleTouchStart",touchend:"handleTouchEnd",touchmove:"handleTouchMove"}[e.type];t&&"function"==typeof this.canvasInstance[t]&&this.canvasInstance[t](e),this.emitCustomEvent(e)}}},{key:"emitCustomEvent",value:function(e){var t=new CustomEvent("pdf-canvas-event",{detail:e,bubbles:!0,cancelable:!0});this.canvas.dispatchEvent(t)}},{key:"throttleEvent",value:function(e,t,r){var n=this;this.throttleTimers.has(e)&&clearTimeout(this.throttleTimers.get(e));var i=setTimeout(function(){t(),n.throttleTimers.delete(e)},r);this.throttleTimers.set(e,i)}},{key:"addEventListener",value:function(e,t){this.canvas.addEventListener("pdf-canvas-".concat(e),t)}},{key:"removeEventListener",value:function(e,t){this.canvas.removeEventListener("pdf-canvas-".concat(e),t)}},{key:"getEventState",value:function(){return{mouse:s({},this.mouseState),keyboard:{keys:Array.from(this.keyboardState.keys),modifiers:s({},this.keyboardState.modifiers)},touch:{touches:Array.from(this.touchState.touches.values()),gesture:this.touchState.gesture}}}},{key:"configure",value:function(e){this.eventConfig=s(s({},this.eventConfig),e)}},{key:"simulateEvent",value:function(e,t){var r=s(s({type:e,simulated:!0},t),{},{timestamp:Date.now()});this.dispatchEvent(r)}},{key:"dispose",value:function(){var e=this;this.eventListeners.forEach(function(t,r){var n=i(r.split("_"),2),o=n[0],a=n[1];("keyboard"===o?document:e.canvas).removeEventListener(a,t)}),this.eventListeners.clear(),this.throttleTimers.clear(),this.mouseState={isDown:!1,button:null,position:{x:0,y:0},lastPosition:{x:0,y:0},dragStart:null},this.keyboardState={keys:new Set,modifiers:{ctrl:!1,shift:!1,alt:!1,meta:!1}},this.touchState={touches:new Map,gesture:null}}}])&&l(e.prototype,t),r&&l(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,r}();t.A=u},166:function(e,t,r){function n(e){this.canvasInstance=e,this.history=[],this.historyIndex=-1,this.maxHistorySize=50}r.d(t,{C:function(){return n}}),e=r.hmd(e),n.prototype.saveState=function(){if(this.canvasInstance.elements){var e={elements:new Map,selectedElement:this.canvasInstance.selectedElement?this.canvasInstance.selectedElement.id:null,timestamp:Date.now()};this.canvasInstance.elements.forEach(function(t,r){e.elements.set(r,JSON.parse(JSON.stringify(t)))}),this.historyIndex<this.history.length-1&&(this.history=this.history.slice(0,this.historyIndex+1)),this.history.push(e),this.historyIndex++,this.history.length>this.maxHistorySize&&(this.history.shift(),this.historyIndex--)}},n.prototype.undo=function(){return this.historyIndex>0&&(this.historyIndex--,this.restoreState(this.history[this.historyIndex]),!0)},n.prototype.redo=function(){return this.historyIndex<this.history.length-1&&(this.historyIndex++,this.restoreState(this.history[this.historyIndex]),!0)},n.prototype.restoreState=function(e){var t=this;if(this.canvasInstance.elements.clear(),e.elements.forEach(function(e,r){t.canvasInstance.elements.set(r,JSON.parse(JSON.stringify(e)))}),e.selectedElement){if(this.canvasInstance.selectedElement=this.canvasInstance.elements.get(e.selectedElement),this.canvasInstance.selectionManager){this.canvasInstance.selectionManager.clearSelection();var r=this.canvasInstance.selectedElement;r&&r.properties?this.canvasInstance.selectionManager.selectAtPoint({x:(r.properties.x||0)+(r.properties.width||100)/2,y:(r.properties.y||0)+(r.properties.height||50)/2},!1):console.warn("restoreState: selectedElement has no properties",r)}}else this.canvasInstance.selectedElement=null,this.canvasInstance.selectionManager&&this.canvasInstance.selectionManager.clearSelection();this.canvasInstance.render(),this.canvasInstance.emit("history-restored",{action:"restore",timestamp:e.timestamp})},n.prototype.canUndo=function(){return this.historyIndex>0},n.prototype.canRedo=function(){return this.historyIndex<this.history.length-1},n.prototype.getHistoryInfo=function(){return{size:this.history.length,currentIndex:this.historyIndex,canUndo:this.canUndo(),canRedo:this.canRedo(),maxSize:this.maxHistorySize}},n.prototype.clearHistory=function(){this.history=[],this.historyIndex=-1,this.saveState()},n.prototype.configure=function(e){if(void 0!==e.maxHistorySize&&(this.maxHistorySize=Math.max(10,Math.min(200,e.maxHistorySize)),this.history.length>this.maxHistorySize)){var t=Math.max(0,this.history.length-this.maxHistorySize);this.history=this.history.slice(t),this.historyIndex=Math.max(0,this.historyIndex-t)}},e.exports&&(e.exports=n)},287:function(e,t,r){r.d(t,{M:function(){return R},A:function(){return B}});var n=r(901),i=r(878),o=r(351),a=r(483),s=r(57),c=r(52),l=r(557),h=r(718),u=r(730),d=r(349);function f(e){return f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},f(e)}function y(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,o,a,s=[],c=!0,l=!1;try{if(o=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=o.call(r)).done)&&(s.push(n.value),s.length!==t);c=!0);}catch(e){l=!0,i=e}finally{try{if(!c&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(l)throw i}}return s}}(e,t)||p(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function p(e,t){if(e){if("string"==typeof e)return m(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?m(e,t):void 0}}function m(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function v(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,g(n.key),n)}}function g(e){var t=function(e,t){if("object"!=f(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=f(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==f(t)?t:t+""}var b=function(){return e=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.canvasInstance=t,this.isTransforming=!1,this.transformHandle=null,this.transformStartPoint=null,this.originalBounds=null,this.snapToGrid=!1,this.gridSize=20,this.minSize=10,this.handleSize=12,this.handleColor="#007bff",this.handleBorderColor="#ffffff",this.rotationHandleColor="#ff6b35"},t=[{key:"startTransform",value:function(e,t){if(!e||!t)return!1;if(!this.canvasInstance.selectionManager||0===this.canvasInstance.selectionManager.getSelectionCount())return!1;if(this.isTransforming=!0,this.transformHandle=t,this.transformStartPoint={x:e.x,y:e.y},t.element){var r=t.element.properties;r?this.originalBounds={x:r.x||0,y:r.y||0,width:r.width||100,height:r.height||50}:(console.warn("startTransform: handle.element.properties is undefined"),this.originalBounds={x:0,y:0,width:100,height:50})}else this.originalBounds=this.canvasInstance.selectionManager.selectionBounds;return!0}},{key:"updateTransform",value:function(e){if(e&&this.isTransforming&&this.transformStartPoint&&this.originalBounds){var t=e.x-this.transformStartPoint.x,r=e.y-this.transformStartPoint.y;switch(this.transformHandle.type){case"move":this.moveElements(t,r);break;case"resize":this.resizeElements(this.transformHandle.position,t,r);break;case"rotate":this.rotateElements(t,r)}this.canvasInstance.render()}}},{key:"endTransform",value:function(){this.isTransforming&&(this.isTransforming=!1,this.transformHandle=null,this.transformStartPoint=null,this.originalBounds=null,this.canvasInstance.historyManager&&this.canvasInstance.historyManager.saveState())}},{key:"moveElement",value:function(e,t,r){var n=this.originalBounds;if(e&&e.properties){var i=n.x+t,o=n.y+r;if(this.snapToGrid){var a=this.snapToGridPoint(i,o);i=a.x,o=a.y}e.properties.x=i,e.properties.y=o,e.updatedAt=Date.now()}else console.warn("moveElement: invalid element or properties",e)}},{key:"moveElements",value:function(e,t){var r=this;this.transformHandle&&this.transformHandle.element?this.moveElement(this.transformHandle.element,e,t):this.canvasInstance.selectionManager.getSelectedElementIds().forEach(function(n){var i=r.canvasInstance.elements.get(n);i&&r.moveElement(i,e,t)}),this.canvasInstance.selectionManager.updateSelectionBounds()}},{key:"resizeElements",value:function(e,t,r){var n=this;this.transformHandle&&this.transformHandle.element?this.resizeElement(this.transformHandle.element,e,t,r):this.canvasInstance.selectionManager.getSelectedElementIds().forEach(function(i){var o=n.canvasInstance.elements.get(i);o&&n.resizeElement(o,e,t,r)}),this.canvasInstance.selectionManager.updateSelectionBounds()}},{key:"resizeElement",value:function(e,t,r,n){if(e&&e.properties){var i=e.properties,o=this.originalBounds,a=o.x,s=o.y,c=o.width,l=o.height;switch(t){case"nw":a=o.x+r,s=o.y+n,c=Math.max(this.minSize,o.width-r),l=Math.max(this.minSize,o.height-n);break;case"ne":s=o.y+n,c=Math.max(this.minSize,o.width+r),l=Math.max(this.minSize,o.height-n);break;case"sw":a=o.x+r,c=Math.max(this.minSize,o.width-r),l=Math.max(this.minSize,o.height+n);break;case"se":c=Math.max(this.minSize,o.width+r),l=Math.max(this.minSize,o.height+n);break;case"n":s=o.y+n,l=Math.max(this.minSize,o.height-n);break;case"s":l=Math.max(this.minSize,o.height+n);break;case"w":a=o.x+r,c=Math.max(this.minSize,o.width-r);break;case"e":c=Math.max(this.minSize,o.width+r)}i.x=a,i.y=s,i.width=c,i.height=l,e.updatedAt=Date.now()}else console.warn("resizeElement: invalid element or properties",e)}},{key:"rotateElements",value:function(e,t){var r=this,n=this.originalBounds.x+this.originalBounds.width/2,i=this.originalBounds.y+this.originalBounds.height/2,o=Math.atan2(this.transformStartPoint.y-i,this.transformStartPoint.x-n),a=Math.atan2(this.transformStartPoint.y+t-i,this.transformStartPoint.x+e-n)-o;this.canvasInstance.selectionManager.getSelectedElementIds().forEach(function(e){var t=r.canvasInstance.elements.get(e);t&&t.properties&&(t.properties.rotation=(t.properties.rotation||0)+a,t.updatedAt=Date.now())})}},{key:"snapToGridPoint",value:function(e,t){return{x:Math.round(e/this.gridSize)*this.gridSize,y:Math.round(t/this.gridSize)*this.gridSize}}},{key:"getHandleAtPoint",value:function(e){if(!e)return null;var t,r=function(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=p(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==r.return||r.return()}finally{if(s)throw o}}}}(this.canvasInstance.selectionManager.getSelectedElements());try{for(r.s();!(t=r.n()).done;){var n=t.value,i=this.getHandleAtPointForElement(e,n);if(i)return i}}catch(o){r.e(o)}finally{r.f()}return null}},{key:"getHandleAtPointForElement",value:function(e,t){if(!e||!t||!t.properties)return null;for(var r=t.properties,n=this.getResizeHandles(r),i=0,o=Object.entries(n);i<o.length;i++){var a=y(o[i],2),s=a[0],c=a[1];if(Math.sqrt(Math.pow(e.x-c.x,2)+Math.pow(e.y-c.y,2))<=this.handleSize/2)return{type:"resize",position:s,element:t,x:c.x,y:c.y}}return null}},{key:"getResizeHandles",value:function(e){if(!e)return console.warn("getResizeHandles: props is undefined"),{nw:{x:0,y:0},n:{x:50,y:0},ne:{x:100,y:0},w:{x:0,y:25},e:{x:100,y:25},sw:{x:0,y:50},s:{x:50,y:50},se:{x:100,y:50}};var t=e.x||0,r=e.y||0,n=e.width||100,i=e.height||50;return{nw:{x:t,y:r},n:{x:t+n/2,y:r},ne:{x:t+n,y:r},w:{x:t,y:r+i/2},e:{x:t+n,y:r+i/2},sw:{x:t,y:r+i},s:{x:t+n/2,y:r+i},se:{x:t+n,y:r+i}}}},{key:"render",value:function(e){var t=this;this.canvasInstance.selectionManager&&0!==this.canvasInstance.selectionManager.getSelectionCount()&&this.canvasInstance.selectionManager.getSelectedElements().forEach(function(r){t.renderElementHandles(e,r)})}},{key:"renderElementHandles",value:function(e,t){var r=this;if(t&&t.properties){var n=this.getResizeHandles(t.properties);e.save(),Object.values(n).forEach(function(t){e.fillStyle=r.handleColor,e.strokeStyle=r.handleBorderColor,e.lineWidth=1,e.beginPath(),e.rect(t.x-r.handleSize/2,t.y-r.handleSize/2,r.handleSize,r.handleSize),e.fill(),e.stroke()});var i=n.n;e.fillStyle=this.rotationHandleColor,e.strokeStyle=this.handleBorderColor,e.beginPath(),e.arc(i.x,i.y-20,this.handleSize/2,0,2*Math.PI),e.fill(),e.stroke(),e.restore()}else console.warn("renderElementHandles: invalid element or properties",t)}},{key:"configure",value:function(e){void 0!==e.snapToGrid&&(this.snapToGrid=e.snapToGrid),void 0!==e.gridSize&&(this.gridSize=e.gridSize),void 0!==e.minSize&&(this.minSize=e.minSize),void 0!==e.handleSize&&(this.handleSize=e.handleSize)}},{key:"dispose",value:function(){this.endTransform()}}],t&&v(e.prototype,t),r&&v(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,r}(),w=r(166),x=r(703);function S(e){return S="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},S(e)}function k(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,o,a,s=[],c=!0,l=!1;try{if(o=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=o.call(r)).done)&&(s.push(n.value),s.length!==t);c=!0);}catch(e){l=!0,i=e}finally{try{if(!c&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(l)throw i}}return s}}(e,t)||P(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function E(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=P(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==r.return||r.return()}finally{if(s)throw o}}}}function P(e,t){if(e){if("string"==typeof e)return C(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?C(e,t):void 0}}function C(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function T(){var e,t,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",i=r.toStringTag||"@@toStringTag";function o(r,n,i,o){var c=n&&n.prototype instanceof s?n:s,l=Object.create(c.prototype);return O(l,"_invoke",function(r,n,i){var o,s,c,l=0,h=i||[],u=!1,d={p:0,n:0,v:e,a:f,f:f.bind(e,4),d:function(t,r){return o=t,s=0,c=e,d.n=r,a}};function f(r,n){for(s=r,c=n,t=0;!u&&l&&!i&&t<h.length;t++){var i,o=h[t],f=d.p,y=o[2];r>3?(i=y===n)&&(c=o[(s=o[4])?5:(s=3,3)],o[4]=o[5]=e):o[0]<=f&&((i=r<2&&f<o[1])?(s=0,d.v=n,d.n=o[1]):f<y&&(i=r<3||o[0]>n||n>y)&&(o[4]=r,o[5]=n,d.n=y,s=0))}if(i||r>1)return a;throw u=!0,n}return function(i,h,y){if(l>1)throw TypeError("Generator is already running");for(u&&1===h&&f(h,y),s=h,c=y;(t=s<2?e:c)||!u;){o||(s?s<3?(s>1&&(d.n=-1),f(s,c)):d.n=c:d.v=c);try{if(l=2,o){if(s||(i="next"),t=o[i]){if(!(t=t.call(o,c)))throw TypeError("iterator result is not an object");if(!t.done)return t;c=t.value,s<2&&(s=0)}else 1===s&&(t=o.return)&&t.call(o),s<2&&(c=TypeError("The iterator does not provide a '"+i+"' method"),s=1);o=e}else if((t=(u=d.n<0)?c:r.call(n,d))!==a)break}catch(t){o=e,s=1,c=t}finally{l=1}}return{value:t,done:u}}}(r,i,o),!0),l}var a={};function s(){}function c(){}function l(){}t=Object.getPrototypeOf;var h=[][n]?t(t([][n]())):(O(t={},n,function(){return this}),t),u=l.prototype=s.prototype=Object.create(h);function d(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,l):(e.__proto__=l,O(e,i,"GeneratorFunction")),e.prototype=Object.create(u),e}return c.prototype=l,O(u,"constructor",l),O(l,"constructor",c),c.displayName="GeneratorFunction",O(l,i,"GeneratorFunction"),O(u),O(u,i,"Generator"),O(u,n,function(){return this}),O(u,"toString",function(){return"[object Generator]"}),(T=function(){return{w:o,m:d}})()}function O(e,t,r,n){var i=Object.defineProperty;try{i({},"",{})}catch(e){i=0}O=function(e,t,r,n){function o(t,r){O(e,t,function(e){return this._invoke(t,r,e)})}t?i?i(e,t,{value:r,enumerable:!n,configurable:!n,writable:!n}):e[t]=r:(o("next",0),o("throw",1),o("return",2))},O(e,t,r,n)}function M(e,t,r,n,i,o,a){try{var s=e[o](a),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,i)}function I(e){return function(){var t=this,r=arguments;return new Promise(function(n,i){var o=e.apply(t,r);function a(e){M(o,n,i,a,s,"next",e)}function s(e){M(o,n,i,a,s,"throw",e)}a(void 0)})}}function j(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function A(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?j(Object(r),!0).forEach(function(t){D(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):j(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function D(e,t,r){return(t=L(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function z(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,L(n.key),n)}}function L(e){var t=function(e,t){if("object"!=S(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=S(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==S(t)?t:t+""}var R=function(){return e=function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.containerId=t,this.options=A({width:r.width||800,height:r.height||600,backgroundColor:r.backgroundColor||"#ffffff",gridSize:r.gridSize||20,showGrid:!1!==r.showGrid,zoom:r.zoom||1,snapToGrid:!1!==r.snapToGrid,constrainToCanvas:!1!==r.constrainToCanvas,dragFeedback:!1!==r.dragFeedback},r),this.dragState=null,this.isRendering=!1,this.lastMouseMoveTime=0,this.mouseMoveThrottleMs=8,this.lastRenderTime=0,this.targetFPS=60,this.frameInterval=1e3/this.targetFPS,this.canvas=null,this.ctx=null,this.elements=new Map,this.selectedElement=null,this.eventListeners=new Map,this.wooCommerceManager=i.p,this.customizationService=o.l,this.renderer=new a.m(this),this.eventManager=new s.O(this),this.selectionManager=new c.K(this),this.propertiesManager=new l.V(this),this.layersManager=new h.g(this),this.exportManager=new u.M(this),this.performanceOptimizer=new d.O(this),this.transformationsManager=new b(this),this.historyManager=new w.C(this),this.dragDropManager=new x.d(this),this.mode="select",this.tool=null,this.history=[],this.historyIndex=-1},t=[{key:"on",value:function(e,t){this.eventListeners.has(e)||this.eventListeners.set(e,[]),this.eventListeners.get(e).push(t)}},{key:"off",value:function(e,t){if(this.eventListeners.has(e)){var r=this.eventListeners.get(e),n=r.indexOf(t);n>-1&&r.splice(n,1)}}},{key:"emit",value:function(e,t){this.eventListeners.has(e)&&this.eventListeners.get(e).forEach(function(e){try{e(t)}catch(r){}})}},{key:"init",value:(p=I(T().m(function e(){return T().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,this.createCanvas(),this.setupContext(),this.renderer.initialize(this.canvas,this.ctx),this.eventManager.initialize(this.canvas),this.attachEventListeners(),e.n=1,this.loadInitialData();case 1:this.render(),this.historyManager.saveState(),this.isInitialized=!0,e.n=3;break;case 2:throw e.p=2,e.v;case 3:return e.a(2)}},e,this,[[0,2]])})),function(){return p.apply(this,arguments)})},{key:"createCanvas",value:function(){if(!document.getElementById(this.containerId))throw new Error('Container with id "'.concat(this.containerId,'" not found'));if(this.canvas=document.getElementById(this.options.canvasElementId||"pdf-builder-canvas"),!this.canvas||"CANVAS"!==this.canvas.tagName)throw new Error('Canvas element with id "'.concat(this.options.canvasElementId||"pdf-builder-canvas",'" not found or is not a canvas element'));if(this.ctx=this.canvas.getContext("2d"),!this.ctx)throw new Error("Failed to get 2D context from canvas");this.canvasWidth=this.canvas.width,this.canvasHeight=this.canvas.height}},{key:"setupContext",value:function(){this.ctx.imageSmoothingEnabled=!0,this.ctx.imageSmoothingQuality="high",this.ctx.textBaseline="top",this.ctx.font="14px Arial, sans-serif"}},{key:"attachEventListeners",value:function(){document.addEventListener("dragover",this.handleDragOver.bind(this)),document.addEventListener("drop",this.handleDrop.bind(this)),window.addEventListener("resize",this.handleResize.bind(this))}},{key:"loadInitialData",value:(y=I(T().m(function e(){return T().w(function(e){for(;;)switch(e.n){case 0:if(!(this.options.templateId&&this.options.templateId>0)){e.n=2;break}return e.n=1,this.loadTemplateFromServer(this.options.templateId);case 1:e.n=3;break;case 2:this.options.templateData&&this.options.templateData.elements&&this.loadTemplateData(this.options.templateData);case 3:return this.wooCommerceManager.setTestMode(!0),e.n=4,this.wooCommerceManager.loadWooCommerceData();case 4:return e.a(2)}},e,this)})),function(){return y.apply(this,arguments)})},{key:"loadTemplateFromServer",value:(f=I(T().m(function e(t){var r,n;return T().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,fetch(window.ajaxurl||"/wp-admin/admin-ajax.php",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({action:"pdf_builder_load_template",template_id:t,nonce:window.pdfBuilderNonce||""})});case 1:return r=e.v,e.n=2,r.json();case 2:(n=e.v).success&&n.data.template&&this.loadTemplateData(n.data.template),e.n=4;break;case 3:e.p=3,e.v;case 4:return e.a(2)}},e,this,[[0,3]])})),function(e){return f.apply(this,arguments)})},{key:"loadTemplateData",value:function(e){var t=this;e.elements&&(this.elements.clear(),e.elements.forEach(function(e){t.addElement(e.type,e)}))}},{key:"handleMouseDown",value:function(e){e.position;var t=e.position,r=e.modifiers.ctrl||e.modifiers.shift,n=this.transformationsManager.getHandleAtPoint(t);if(n)return this.transformationsManager.startTransform(t,n),void(this.canvas.style.cursor=this.getCursorForHandle(n));var i=this.getElementAtPoint(t);if(i)return i.id,this.selectionManager.isElementSelected(i.id)||this.selectionManager.selectAtPoint(t,r),this.selectionManager.getSelectionCount()>0&&(this.transformationsManager.startTransform(t,{type:"move"}),this.canvas.style.cursor="move"),void this.render();this.selectionManager.startSelection(t),this.render()}},{key:"handleMouseMove",value:function(e){var t=e.position;if(this.transformationsManager.isTransforming)this.transformationsManager.updateTransform(t);else{if(this.selectionManager.isSelecting)return this.selectionManager.updateSelection(t),void this.render();var r=this.transformationsManager.getHandleAtPoint(t);if(r)this.canvas.style.cursor=this.getCursorForHandle(r);else{var n=this.getElementAtPoint(t);this.canvas.style.cursor=n?"move":"default"}}}},{key:"handleMouseUp",value:function(e){if(this.transformationsManager.isTransforming)return this.transformationsManager.endTransform(),void(this.canvas.style.cursor="default");if(this.selectionManager.isSelecting){var t=e.modifiers.ctrl||e.modifiers.shift;this.selectionManager.endSelection(t),this.render()}}},{key:"handleDragOver",value:function(e){try{if(!e||"function"!=typeof e.preventDefault)return;this.dragDropManager&&this.dragDropManager.handleDragOver(e)}catch(t){}}},{key:"handleDrop",value:function(e){try{if(!e||"function"!=typeof e.preventDefault)return;this.dragDropManager&&this.dragDropManager.handleDrop(e)}catch(t){}}},{key:"handleKeyDown",value:function(e){switch(e.key,e.key){case"Delete":case"Backspace":this.deleteSelectedElements();break;case"Escape":this.selectionManager.clearSelection(),this.render();break;case"a":e.modifiers.ctrl&&(e.originalEvent.preventDefault(),this.selectAllElements());break;case"z":e.modifiers.ctrl&&(e.originalEvent.preventDefault(),e.modifiers.shift?this.redo():this.undo());break;case"y":e.modifiers.ctrl&&(e.originalEvent.preventDefault(),this.redo())}}},{key:"handleArrowKey",value:function(e){var t=this,r=this.selectionManager.getSelectedElements();if(0!==r.length){e.preventDefault();var n=e.shiftKey?10:1,i=0,o=0;switch(e.key){case"ArrowUp":o=-n;break;case"ArrowDown":o=n;break;case"ArrowLeft":i=-n;break;case"ArrowRight":i=n}if(this.options.snapToGrid){var a=this.snapToGrid(i,o);i=a.x,o=a.y}r.forEach(function(e){var r=e.properties.x+i,n=e.properties.y+o;t.updateElementProperty(e.id,"x",r),t.updateElementProperty(e.id,"y",n)}),this.historyManager.saveState(),this.render()}}},{key:"handleKeyUp",value:function(e){}},{key:"handleResize",value:function(){this.render()}},{key:"getMousePosition",value:function(e){if(!this.canvas||!e)return{x:0,y:0};var t=this.canvas.getBoundingClientRect(),r=this.canvas.width/t.width,n=this.canvas.height/t.height;return{x:(e.clientX-t.left)*r,y:(e.clientY-t.top)*n}}},{key:"handleSelectMode",value:function(e,t){var r,n,i,o=(null===(r=t.modifiers)||void 0===r?void 0:r.ctrl)||t.ctrlKey||(null===(n=t.originalEvent)||void 0===n?void 0:n.ctrlKey),a=E(this.selectionManager.getSelectedElements());try{for(a.s();!(i=a.n()).done;){var s=i.value,c=this.transformationsManager.getHandleAtPoint(e,s);if(c)return this.transformationsManager.startTransform(e,c),void this.render()}}catch(h){a.e(h)}finally{a.f()}if(this.selectionManager.selectAtPoint(e,o)){var l=this.selectionManager.getSelectedElementIds();1===l.length?this.selectedElement=this.elements.get(l[0]):this.selectedElement=null,this.transformationsManager.isTransforming||this.startDrag(e)}else this.selectionManager.startSelection(e);this.render()}},{key:"handleDrawMode",value:function(e){}},{key:"handleTextMode",value:function(e){}},{key:"startDrag",value:function(e){var t=this.selectionManager.getSelectedElements();if(0!==t.length){this.selectedElement=t[0];var r=this.calculateSelectionBounds(t);this.dragState={startPoint:A({},e),currentPoint:A({},e),elementStartPositions:t.map(function(e){return{id:e.id,x:e.properties&&e.properties.x||0,y:e.properties&&e.properties.y||0,originalX:e.properties&&e.properties.x||0,originalY:e.properties&&e.properties.y||0}}),bounds:r,snapped:!1,lastSnappedPosition:null},this.options.dragFeedback&&(this.canvas.style.cursor="grabbing")}}},{key:"handleDragImmediate",value:function(e){var t=this;if(this.dragState&&this.dragState.elementStartPositions){this.dragState.currentPoint=A({},e);var r=e.x-this.dragState.startPoint.x,n=e.y-this.dragState.startPoint.y;this.dragState.pendingDeltaX=r,this.dragState.pendingDeltaY=n,this.dragState.animationFrameRequested||(this.dragState.animationFrameRequested=!0,requestAnimationFrame(function(){t.processDragUpdate()}))}}},{key:"processDragUpdate",value:function(){var e=this;if(this.dragState){this.dragState.animationFrameRequested=!1;var t=this.dragState.pendingDeltaX,r=this.dragState.pendingDeltaY,n=t,i=r;if(this.options.snapToGrid){var o=this.snapToGrid(t,r);n=o.x,i=o.y,this.dragState.snapped=o.snapped}if(this.options.constrainToCanvas){var a=this.constrainToCanvas(n,i,this.dragState.bounds);n=a.x,i=a.y}this.dragState.elementStartPositions.forEach(function(t){var r=e.elements.get(t.id);r&&(r.properties.x=t.originalX+n,r.properties.y=t.originalY+i,r.updatedAt=Date.now())}),this.render()}}},{key:"endDrag",value:function(){var e=this;this.dragState&&(this.options.dragFeedback&&(this.canvas.style.cursor=this.getCursorForMode(this.mode)),this.dragState.elementStartPositions.some(function(t){var r=e.elements.get(t.id);return r&&(r.properties.x!==t.originalX||r.properties.y!==t.originalY)})&&this.historyManager.saveState(),this.dragState=null,this.render())}},{key:"calculateSelectionBounds",value:function(e){if(0===e.length)return null;var t=1/0,r=1/0,n=-1/0,i=-1/0;return e.forEach(function(e){var o=e.properties,a=o.x||0,s=o.y||0,c=o.width||100,l=o.height||50;t=Math.min(t,a),r=Math.min(r,s),n=Math.max(n,a+c),i=Math.max(i,s+l)}),{x:t,y:r,width:n-t,height:i-r}}},{key:"snapToGrid",value:function(e,t){var r=this.options.gridSize,n=.3*r,i=Math.round(e/r)*r,o=Math.round(t/r)*r,a=Math.abs(e-i)<=n,s=Math.abs(t-o)<=n;return{x:a?i:e,y:s?o:t,snapped:a||s}}},{key:"constrainToCanvas",value:function(e,t,r){if(!r)return{x:e,y:t};var n=this.canvas.width,i=this.canvas.height,o=r.x+e,a=r.y+t,s=e,c=t;return o<0?s=-r.x:o+r.width>n&&(s=n-r.width-r.x),a<0?c=-r.y:a+r.height>i&&(c=i-r.height-r.y),{x:s,y:c}}},{key:"renderDragOptimized",value:function(){if(this.dragState&&!this.isRendering){this.isRendering=!0;var e=performance.now();try{this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.options.showGrid&&this.drawGrid();var t,r=new Set(this.dragState.elementStartPositions.map(function(e){return e.id})),n=E(this.elements);try{for(n.s();!(t=n.n()).done;){var i=k(t.value,2),o=i[0],a=i[1];if(!r.has(o))try{this.renderer.renderElement(a,a.properties)}catch(d){}}}catch(f){n.e(f)}finally{n.f()}var s,c=E(this.dragState.elementStartPositions);try{for(c.s();!(s=c.n()).done;){var l=s.value,h=this.elements.get(l.id);h&&this.renderElementDragFeedback(h)}}catch(f){c.e(f)}finally{c.f()}this.selectionManager.render(this.ctx),this.transformationsManager.render(this.ctx)}finally{this.isRendering=!1;var u=performance.now()-e;u>16.67&&"Drag render took ".concat(u.toFixed(2),"ms")}}}},{key:"renderElementDragFeedback",value:function(e){var t=e.properties;if(this.ctx.save(),this.ctx.translate(t.x+t.width/2,t.y+t.height/2),t.rotation&&this.ctx.rotate(t.rotation*Math.PI/180),this.ctx.translate(-t.width/2,-t.height/2),void 0!==t.opacity){var r=t.opacity;this.ctx.globalAlpha=.85*(r<=1?r:r/100)}else this.ctx.globalAlpha=.85;switch(this.ctx.shadowColor="rgba(0, 123, 255, 0.3)",this.ctx.shadowBlur=4,this.ctx.shadowOffsetX=1,this.ctx.shadowOffsetY=1,e.type){case"text":this.renderTextElement(e);break;case"rectangle":this.renderRectangleElement(e);break;case"image":this.renderImageElement(e);break;default:this.renderGenericElement(e)}this.ctx.restore()}},{key:"handleHover",value:function(e){var t,r=E(this.selectionManager.getSelectedElements());try{for(r.s();!(t=r.n()).done;){var n=t.value,i=this.transformationsManager.getHandleAtPoint(e,n);if(i)return void(this.canvas.style.cursor={nw:"nw-resize",n:"n-resize",ne:"ne-resize",e:"e-resize",se:"se-resize",s:"s-resize",sw:"sw-resize",w:"w-resize"}[i.position]||"crosshair")}}catch(a){r.e(a)}finally{r.f()}if(this.dragState)return this.dragState.snapped,void(this.canvas.style.cursor="grabbing");var o=this.getElementAtPoint(e);this.canvas.style.cursor=o?"grab":"default"}},{key:"selectElement",value:function(e){if(this.selectedElement=this.elements.get(e),this.selectionManager.clearSelection(),this.selectedElement){var t=this.selectedElement.properties||{};this.selectionManager.selectAtPoint({x:(t.x||0)+(t.width||100)/2,y:(t.y||0)+(t.height||50)/2},!1)}this.render()}},{key:"deselectElement",value:function(){this.selectedElement=null,this.selectionManager.clearSelection(),this.render()}},{key:"getElementAtPoint",value:function(e){var t,r=E(Array.from(this.elements.values()).reverse());try{for(r.s();!(t=r.n()).done;){var n=t.value;if(this.isPointInElement(e,n))return n}}catch(i){r.e(i)}finally{r.f()}return null}},{key:"isPointInElement",value:function(e,t){var r=t.properties,n=r.x||0,i=r.y||0,o=r.width||100,a=r.height||50;return e.x>=n&&e.x<=n+o&&e.y>=i&&e.y<=i+a}},{key:"addElement",value:function(e){var t="element_"+Date.now()+"_"+Math.random().toString(36).substr(2,9),r=A(A({},this.customizationService.getDefaultProperties(e.type)),e.properties),n={id:t,type:e.type,properties:r,createdAt:Date.now(),updatedAt:Date.now()};return this.elements.set(t,n),this.historyManager.saveState(),this.render(),n}},{key:"updateElementProperty",value:function(e,t,r){var i=this.elements.get(e);if(!i)return!1;var o=this.customizationService.validateProperty(t,r);return!!(0,n.Qn)(i.type,t)&&(i.properties[t]=o,i.updatedAt=Date.now(),this.historyManager.saveState(),this.render(),!0)}},{key:"deleteElement",value:function(e){return!!this.elements.delete(e)&&(this.selectedElement&&this.selectedElement.id===e&&(this.selectedElement=null),this.historyManager.saveState(),this.render(),!0)}},{key:"undo",value:function(){this.historyManager&&this.historyManager.undo()}},{key:"redo",value:function(){this.historyManager&&this.historyManager.redo()}},{key:"setZoom",value:function(e){this.options.zoom=Math.max(.1,Math.min(5,e)),this.canvas.style.transform="scale(".concat(this.options.zoom,")"),this.canvas.style.transformOrigin="top left"}},{key:"setMode",value:function(e){this.mode=e,this.canvas.style.cursor=this.getCursorForMode(e)}},{key:"setTool",value:function(e){this.tool=e;var t={select:"select","add-text":"text","add-text-title":"text","add-text-subtitle":"text","add-rectangle":"draw","add-circle":"draw","add-line":"draw","add-arrow":"draw","add-triangle":"draw","add-star":"draw","add-divider":"draw","add-image":"draw"}[e]||"select";this.setMode(t)}},{key:"toggleGrid",value:function(){return this.options.showGrid,this.options.showGrid=!this.options.showGrid,this.options.showGrid,this.render(),this.options.showGrid}},{key:"setGrid",value:function(e){this.options.showGrid=e,this.render()}},{key:"setSnapToGrid",value:function(e){this.options.snapToGrid=e}},{key:"setConstrainToCanvas",value:function(e){this.options.constrainToCanvas=e}},{key:"setDragFeedback",value:function(e){this.options.dragFeedback=e}},{key:"setGridSize",value:function(e){this.options.gridSize=Math.max(5,Math.min(100,e)),this.options.showGrid&&this.render()}},{key:"selectAll",value:function(){this.selectionManager.clearSelection();var e,t=E(this.elements.values());try{for(t.s();!(e=t.n()).done;){var r=e.value;this.selectionManager.selectAtPoint({x:r.properties.x+r.properties.width/2,y:r.properties.y+r.properties.height/2},!0)}}catch(n){t.e(n)}finally{t.f()}this.render()}},{key:"selectNone",value:function(){this.selectionManager.clearSelection(),this.selectedElement=null,this.render()}},{key:"invertSelection",value:function(){var e=new Set(this.selectionManager.getSelectedElementIds()),t=Array.from(this.elements.keys());this.selectionManager.clearSelection();for(var r=0,n=t;r<n.length;r++){var i=n[r];if(!e.has(i)){var o=this.elements.get(i);o&&this.selectionManager.selectAtPoint({x:o.properties.x+o.properties.width/2,y:o.properties.y+o.properties.height/2},!0)}}this.render()}},{key:"getCursorForMode",value:function(e){return{select:"default",draw:"crosshair",text:"text",move:"move"}[e]||"default"}},{key:"render",value:function(){if(!this.isRendering){this.isRendering=!0;try{if(this.performanceOptimizer&&this.performanceOptimizer.shouldRender())return void this.performanceOptimizer.optimizeRendering();this.renderNormal()}finally{this.isRendering=!1}}}},{key:"renderNormal",value:function(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.options.showGrid&&this.drawGrid();var e,t=E(this.elements.values());try{for(t.s();!(e=t.n()).done;){var r=e.value;try{this.renderer.renderElement(r,r.properties)}catch(n){}}}catch(i){t.e(i)}finally{t.f()}this.selectionManager.render(this.ctx),this.transformationsManager.render(this.ctx),this.dragDropManager.render(this.ctx)}},{key:"drawGrid",value:function(){var e=this.options.gridSize,t=this.canvas.getBoundingClientRect(),r=t.width,n=t.height;this.ctx.strokeStyle="#e0e0e0",this.ctx.lineWidth=1;for(var i=0;i<=r;i+=e)this.ctx.beginPath(),this.ctx.moveTo(i,0),this.ctx.lineTo(i,n),this.ctx.stroke();for(var o=0;o<=n;o+=e)this.ctx.beginPath(),this.ctx.moveTo(0,o),this.ctx.lineTo(r,o),this.ctx.stroke()}},{key:"renderElement",value:function(e){var t=e.properties;if(this.ctx.save(),this.ctx.translate(t.x+t.width/2,t.y+t.height/2),t.rotation&&this.ctx.rotate(t.rotation*Math.PI/180),this.ctx.translate(-t.width/2,-t.height/2),void 0!==t.opacity){var r=t.opacity;r<=1?this.ctx.globalAlpha=r:r<=100&&(this.ctx.globalAlpha=r/100)}switch(e.type){case"text":this.renderTextElement(e);break;case"rectangle":this.renderRectangleElement(e);break;case"image":this.renderImageElement(e);break;default:this.renderGenericElement(e)}this.ctx.restore()}},{key:"renderTextElement",value:function(e){var t=e.properties;this.ctx.font="".concat(t.fontWeight||"normal"," ").concat(t.fontSize||14,"px ").concat(t.fontFamily||"Arial, sans-serif"),this.ctx.fillStyle=t.color||"#000000",this.ctx.textAlign=t.textAlign||"left";var r=0;"center"===t.textAlign?r=t.width/2:"right"===t.textAlign&&(r=t.width);for(var n=(t.text||"Texte").split("\n"),i=0;i<n.length;i++)this.ctx.fillText(n[i],r,0+i*(t.fontSize||14)*1.2)}},{key:"renderRectangleElement",value:function(e){var t=e.properties;t.backgroundColor&&"transparent"!==t.backgroundColor&&(this.ctx.fillStyle=t.backgroundColor,this.roundRect(0,0,t.width,t.height,t.borderRadius||0),this.ctx.fill()),t.borderWidth&&t.borderWidth>0&&(this.ctx.strokeStyle=t.borderColor||"#000000",this.ctx.lineWidth=t.borderWidth,this.roundRect(0,0,t.width,t.height,t.borderRadius||0),this.ctx.stroke())}},{key:"renderImageElement",value:function(e){var t=this,r=e.properties;if(r.src){var n=new Image;n.onload=function(){var e=r.width,i=r.height,o=0,a=0;if("cover"===r.objectFit){var s=Math.max(r.width/n.width,r.height/n.height);e=n.width*s,i=n.height*s,o=(r.width-e)/2,a=(r.height-i)/2}t.ctx.drawImage(n,o,a,e,i),t.render()},n.src=r.src}}},{key:"renderGenericElement",value:function(e){e.properties,this.isWooCommerceElement(e.type)?this.renderWooCommerceElement(e):this.renderRectangleElement(e)}},{key:"isWooCommerceElement",value:function(e){return["product_table","customer_info","company_info","company_logo","order_number","dynamic-text","mentions"].includes(e)}},{key:"renderWooCommerceElement",value:function(e){var t=e.properties;this.ctx.fillStyle=t.backgroundColor||"#f8f9fa",this.ctx.strokeStyle=t.borderColor||"#6c757d",this.ctx.lineWidth=t.borderWidth||1,this.roundRect(0,0,t.width,t.height,4),this.ctx.fill(),!1!==t.showBorders&&this.ctx.stroke(),this.ctx.fillStyle="#495057",this.ctx.font="12px Arial",this.ctx.textAlign="center",this.ctx.textBaseline="middle";var r=t.width/2,n=t.height/2,i=this.getElementDisplayName(e.type);this.ctx.fillText(i,r,n),this.ctx.strokeStyle="#007bff",this.ctx.lineWidth=2,this.ctx.setLineDash([5,5]),this.roundRect(2,2,t.width-4,t.height-4,2),this.ctx.stroke(),this.ctx.setLineDash([])}},{key:"getElementDisplayName",value:function(e){return{product_table:" Tableau Produits",customer_info:" Infos Client",company_info:" Infos Entreprise",company_logo:" Logo",order_number:" N Commande","dynamic-text":" Texte Dynamique",mentions:" Mentions"}[e]||e}},{key:"roundRect",value:function(e,t,r,n,i){0!==i?(this.ctx.beginPath(),this.ctx.moveTo(e+i,t),this.ctx.lineTo(e+r-i,t),this.ctx.quadraticCurveTo(e+r,t,e+r,t+i),this.ctx.lineTo(e+r,t+n-i),this.ctx.quadraticCurveTo(e+r,t+n,e+r-i,t+n),this.ctx.lineTo(e+i,t+n),this.ctx.quadraticCurveTo(e,t+n,e,t+n-i),this.ctx.lineTo(e,t+i),this.ctx.quadraticCurveTo(e,t,e+i,t),this.ctx.closePath()):this.ctx.rect(e,t,r,n)}},{key:"drawSelectionHandles",value:function(e){var t=this,r=e.properties;this.ctx.strokeStyle="#007bff",this.ctx.lineWidth=2,this.ctx.fillStyle="#ffffff",[{x:r.x,y:r.y},{x:r.x+r.width,y:r.y},{x:r.x+r.width,y:r.y+r.height},{x:r.x,y:r.y+r.height}].forEach(function(e){t.ctx.fillRect(e.x-4,e.y-4,8,8),t.ctx.strokeRect(e.x-4,e.y-4,8,8)}),this.ctx.strokeStyle="#007bff",this.ctx.setLineDash([5,5]),this.ctx.strokeRect(r.x,r.y,r.width,r.height),this.ctx.setLineDash([])}},{key:"saveToHistory",value:function(){var e={elements:new Map(this.elements),selectedElement:this.selectedElement?this.selectedElement.id:null};this.history=this.history.slice(0,this.historyIndex+1),this.history.push(e),this.historyIndex++,this.history.length>50&&(this.history.shift(),this.historyIndex--)}},{key:"restoreFromHistory",value:function(){var e=this.history[this.historyIndex];this.elements=new Map(e.elements),this.selectedElement=e.selectedElement?this.elements.get(e.selectedElement):null,this.render()}},{key:"exportToImage",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"png",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return this.canvas.toDataURL("image/".concat(e),t)}},{key:"exportToJSON",value:function(){return{version:"1.0",canvas:{width:this.options.width,height:this.options.height,backgroundColor:this.options.backgroundColor},elements:Array.from(this.elements.values()).map(function(e){return{id:e.id,type:e.type,properties:e.properties,createdAt:e.createdAt,updatedAt:e.updatedAt}}),metadata:{exportedAt:Date.now(),elementCount:this.elements.size}}}},{key:"importFromJSON",value:function(e){var t=this;try{return this.elements.clear(),e.elements.forEach(function(e){var r=A(A({},e),{},{properties:A({},e.properties)});t.elements.set(r.id,r)}),this.render(),this.saveToHistory(),!0}catch(r){return!1}}},{key:"dispose",value:function(){this.eventManager&&this.eventManager.dispose(),document.removeEventListener("dragover",this.handleDragOver),document.removeEventListener("drop",this.handleDrop),window.removeEventListener("resize",this.handleResize),this.elements.clear(),this.selectedElement=null,this.dragState=null,this.history=[],this.historyIndex=-1}},{key:"getStats",value:function(){var e={totalElements:this.elements.size,selectedElement:this.selectedElement?this.selectedElement.id:null,canvasSize:{width:this.canvas.width,height:this.canvas.height},zoom:this.options.zoom,mode:this.mode};return this.performanceOptimizer?A(A({},e),{},{performance:this.performanceOptimizer.getPerformanceStats()}):e}},{key:"removeDuplicateElements",value:function(){var e,t=this,r=new Map,n=[],i=E(this.elements);try{for(i.s();!(e=i.n()).done;){var o=k(e.value,2),a=o[0],s=o[1],c="".concat(s.type,"_").concat(JSON.stringify(s.properties));r.has(c)?n.push(a):r.set(c,a)}}catch(l){i.e(l)}finally{i.f()}return n.forEach(function(e){t.elements.delete(e)}),n.length>0&&("Removed ".concat(n.length," duplicate elements"),this.historyManager.saveState(),this.render()),n.length}},{key:"setGridVisibility",value:function(e){return this.options.showGrid=!0===e,this.options.showGrid,this.render(),this.options.showGrid}},{key:"isGridVisible",value:function(){return this.options.showGrid,this.options.showGrid}},{key:"handleClick",value:function(e){}},{key:"handleDoubleClick",value:function(e){var t=e.position,r=this.getElementAtPoint(t);r&&(r.id,this.emit("element-double-click",{element:r,point:t}))}},{key:"getCursorForHandle",value:function(e){switch(e.type){case"move":return"move";case"resize":switch(e.position){case"nw":case"se":return"nw-resize";case"ne":case"sw":return"ne-resize";case"n":case"s":return"ns-resize";case"e":case"w":return"ew-resize";default:return"pointer"}case"rotate":return"alias";default:return"pointer"}}},{key:"deleteSelectedElements",value:function(){var e=this,t=Array.from(this.selectionManager.selectedElements);0!==t.length&&(t.forEach(function(t){e.elements.delete(t)}),this.selectionManager.clearSelection(),this.historyManager.saveState(),this.render())}},{key:"selectAllElements",value:function(){this.selectionManager.clearSelection();var e,t=E(this.elements);try{for(t.s();!(e=t.n()).done;){var r=k(e.value,1)[0];this.selectionManager.selectedElements.add(r)}}catch(n){t.e(n)}finally{t.f()}this.selectionManager.updateSelectionBounds(),this.render()}}],t&&z(e.prototype,t),r&&z(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,r,f,y,p}(),B=R;window.pdfBuilderInitVanilla=function(e){var t,r;if("string"==typeof e)t=e,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};else{if("object"!==S(e))throw new Error("Invalid parameters for pdfBuilderInitVanilla");t=(r=e).canvasElementId||r.containerId||"pdf-canvas-container"}try{var n=new R(t,r);return"loading"===document.readyState?document.addEventListener("DOMContentLoaded",function(){n.init()}):n.init(),window.pdfBuilderInstance=n,n}catch(i){throw i}},window.pdfBuilderPro={init:window.pdfBuilderInitVanilla}},349:function(e,t,r){function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function o(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),!0).forEach(function(t){a(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function a(e,t,r){return(t=d(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function s(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,o,a,s=[],c=!0,l=!1;try{if(o=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=o.call(r)).done)&&(s.push(n.value),s.length!==t);c=!0);}catch(e){l=!0,i=e}finally{try{if(!c&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(l)throw i}}return s}}(e,t)||l(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function c(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=l(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==r.return||r.return()}finally{if(s)throw o}}}}function l(e,t){if(e){if("string"==typeof e)return h(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?h(e,t):void 0}}function h(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function u(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,d(n.key),n)}}function d(e){var t=function(e,t){if("object"!=n(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=n(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==n(t)?t:t+""}r.d(t,{O:function(){return f}});var f=function(){return e=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.canvasInstance=t,this.metrics={renderTime:0,frameCount:0,memoryUsage:0,elementCount:0,lastFrameTime:0},this.optimizationConfig={enableFrameSkipping:!0,maxFrameRate:60,enableObjectPooling:!0,enableDirtyRectRendering:!0,enableLOD:!0,maxCanvasSize:4096,enableWebWorkers:!1,cacheStaticElements:!0},this.objectPool=new Map,this.dirtyRegions=[],this.staticElementCache=new Map,this.frameSkipCounter=0,this.initPerformanceMonitoring()},t=[{key:"initPerformanceMonitoring",value:function(){var e=this;"undefined"!=typeof performance&&performance.memory&&(this.originalMemory=performance.memory.usedJSHeapSize),this.monitorInterval=setInterval(function(){e.updateMetrics()},1e3)}},{key:"updateMetrics",value:function(){this.metrics.elementCount=this.canvasInstance.elements?this.canvasInstance.elements.size:0,this.metrics.frameCount++,"undefined"!=typeof performance&&performance.memory&&(this.metrics.memoryUsage=performance.memory.usedJSHeapSize-this.originalMemory);var e=performance.now();if(this.metrics.lastFrameTime){var t=e-this.metrics.lastFrameTime;this.metrics.fps=1e3/t}this.metrics.lastFrameTime=e}},{key:"shouldRender",value:function(){return this.optimizationConfig.enableFrameSkipping}},{key:"optimizeRendering",value:function(){if(this.optimizationConfig.enableFrameSkipping){this.frameSkipCounter++;var e=1e3/this.optimizationConfig.maxFrameRate;this.frameSkipCounter>=e/16.67&&(this.frameSkipCounter=0,this.renderOptimized())}else this.renderOptimized()}},{key:"renderOptimized",value:function(){var e=performance.now();this.optimizationConfig.enableDirtyRectRendering&&this.dirtyRegions.length>0?this.renderDirtyRegions():this.renderNormal(),this.metrics.renderTime=performance.now()-e}},{key:"renderNormal",value:function(){this.canvasInstance.renderNormal()}},{key:"renderDirtyRegions",value:function(){this.renderNormal(),this.dirtyRegions=[]}},{key:"isElementInRegion",value:function(e,t){if(!e||!e.properties)return console.warn("isElementInRegion: invalid element or properties",e),!1;var r=e.properties,n=r.x||0,i=r.y||0,o=r.width||0,a=r.height||0;return!(n+o<t.x||n>t.x+t.width||i+a<t.y||i>t.y+t.height)}},{key:"markDirtyRegion",value:function(e,t,r,n){this.optimizationConfig.enableDirtyRectRendering&&(this.dirtyRegions.push({x:e,y:t,width:r,height:n}),this.mergeDirtyRegions())}},{key:"mergeDirtyRegions",value:function(){if(!(this.dirtyRegions.length<2)){for(var e=[],t=this.dirtyRegions.sort(function(e,t){return e.x-t.x}),r=t[0],n=1;n<t.length;n++){var i=t[n];r.x+r.width>=i.x&&r.y+r.height>=i.y&&r.y<=i.y+i.height?(r.width=Math.max(r.x+r.width,i.x+i.width)-r.x,r.height=Math.max(r.y+r.height,i.y+i.height)-r.y):(e.push(r),r=i)}e.push(r),this.dirtyRegions=e}}},{key:"cacheStaticElement",value:function(e){if(this.optimizationConfig.cacheStaticElements){var t=this.canvasInstance.elements.get(e);if(t){var r=document.createElement("canvas"),n=r.getContext("2d"),i=this.getElementBounds(t);r.width=i.width,r.height=i.height;var o=this.canvasInstance.ctx;this.canvasInstance.ctx=n;var a=t.properties&&t.properties.x||0,s=t.properties&&t.properties.y||0;t.properties||(t.properties={}),t.properties.x=0,t.properties.y=0,this.canvasInstance.renderElement(t),t.properties.x=a,t.properties.y=s,this.canvasInstance.ctx=o,this.staticElementCache.set(e,{canvas:r,bounds:i,lastModified:Date.now()})}}}},{key:"getElementBounds",value:function(e){if(!e||!e.properties)return console.warn("getElementBounds: invalid element or properties",e),{x:0,y:0,width:100,height:100};var t=e.properties;return{x:t.x||0,y:t.y||0,width:t.width||100,height:t.height||100}}},{key:"renderCachedElement",value:function(e,t){var r=this.staticElementCache.get(e);if(!r)return!1;var n=this.canvasInstance.elements.get(e);if(!n)return!1;var i=n.properties&&n.properties.x||0,o=n.properties&&n.properties.y||0;return t.drawImage(r.canvas,i,o),!0}},{key:"getPooledObject",value:function(e,t){if(!this.optimizationConfig.enableObjectPooling)return new t;this.objectPool.has(e)||this.objectPool.set(e,[]);var r=this.objectPool.get(e);return r.length>0?r.pop():new t}},{key:"returnToPool",value:function(e,t){if(this.optimizationConfig.enableObjectPooling){this.objectPool.has(e)||this.objectPool.set(e,[]);var r=this.objectPool.get(e);r.length<50&&("function"==typeof t.reset&&t.reset(),r.push(t))}}},{key:"optimizeCanvasSize",value:function(){var e=this.canvasInstance.canvas,t=this.optimizationConfig.maxCanvasSize;e.width>t||e.height;var r=window.devicePixelRatio||1;if(r>1&&!e.style.width){var n=e.getContext("2d"),i=e.width,o=e.height;e.width=i*r,e.height=o*r,e.style.width=i+"px",e.style.height=o+"px",n.scale(r,r)}}},{key:"throttleEvent",value:function(e,t){var r,n=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:16,o=0;return function(){for(var e=arguments.length,a=new Array(e),s=0;s<e;s++)a[s]=arguments[s];var c=Date.now();c-o>i?(t.apply(n,a),o=c):(clearTimeout(r),r=setTimeout(function(){t.apply(n,a),o=Date.now()},i-(c-o)))}}},{key:"applyLOD",value:function(e,t){if(!this.optimizationConfig.enableLOD)return e;var r="high";t>300?r="low":t>100&&(r="medium");var n={high:1,medium:.7,low:.4}[r];return n<1&&(e.properties.opacity=(e.properties.opacity||100)*n),e}},{key:"cleanupCache",value:function(){var e,t=new Set(this.canvasInstance.elements.keys()),r=c(this.staticElementCache);try{for(r.s();!(e=r.n()).done;){var n=s(e.value,1)[0];t.has(n)||this.staticElementCache.delete(n)}}catch(u){r.e(u)}finally{r.f()}var i,o=c(this.objectPool);try{for(o.s();!(i=o.n()).done;){var a=s(i.value,2),l=a[0],h=a[1];h.length>10&&this.objectPool.set(l,h.slice(-10))}}catch(u){o.e(u)}finally{o.f()}}},{key:"getPerformanceStats",value:function(){return o(o({},this.metrics),{},{cacheSize:this.staticElementCache.size,poolSizes:Object.fromEntries(Array.from(this.objectPool.entries()).map(function(e){var t=s(e,2);return[t[0],t[1].length]})),dirtyRegionsCount:this.dirtyRegions.length,config:o({},this.optimizationConfig)})}},{key:"configure",value:function(e){this.optimizationConfig=o(o({},this.optimizationConfig),e)}},{key:"forceGC",value:function(){"undefined"!=typeof window&&window.gc&&window.gc()}},{key:"dispose",value:function(){this.monitorInterval&&clearInterval(this.monitorInterval),this.objectPool.clear(),this.staticElementCache.clear(),this.dirtyRegions=[],this.forceGC()}}],t&&u(e.prototype,t),r&&u(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,r}();t.A=f},351:function(e,t,r){function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function o(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),!0).forEach(function(t){a(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function a(e,t,r){return(t=c(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function s(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,c(n.key),n)}}function c(e){var t=function(e,t){if("object"!=n(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=n(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==n(t)?t:t+""}r.d(t,{J:function(){return l},l:function(){return h}});var l=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.propertyValidators=new Map,this.propertyPresets=new Map,this.propertyGroups=new Map,this.initDefaults()},t=[{key:"initDefaults",value:function(){var e=this;this.propertyValidators.set("numeric",function(e){return parseFloat(e)||0}),this.propertyValidators.set("positiveNumeric",function(e){return Math.max(0,parseFloat(e)||0)}),this.propertyValidators.set("percentage",function(e){return Math.max(0,Math.min(100,parseFloat(e)||100))}),this.propertyValidators.set("angle",function(e){return((parseFloat(e)||0)%360+360)%360}),this.propertyValidators.set("color",function(t){return e.validateColor(t)}),this.propertyValidators.set("fontSize",function(e){return Math.max(8,Math.min(72,parseInt(e)||14))}),this.propertyValidators.set("borderWidth",function(e){return Math.max(0,Math.min(20,parseInt(e)||0))}),this.propertyValidators.set("borderStyle",function(e){return["solid","dashed","dotted","double"].includes(e)?e:"solid"}),this.propertyValidators.set("borderRadius",function(e){return Math.max(0,Math.min(100,parseInt(e)||0))}),this.propertyPresets.set("colors",{slate:["#f8fafc","#f1f5f9","#e2e8f0","#cbd5e1","#94a3b8","#64748b","#475569","#334155","#1e293b"],blue:["#eff6ff","#dbeafe","#bfdbfe","#93c5fd","#60a5fa","#3b82f6","#2563eb","#1d4ed8","#1e40af"],green:["#f0fdf4","#dcfce7","#bbf7d0","#86efac","#4ade80","#22c55e","#16a34a","#15803d","#166534"],red:["#fef2f2","#fee2e2","#fecaca","#fca5a5","#f87171","#ef4444","#dc2626","#b91c1c","#991b1b"]}),this.propertyGroups.set("position",["x","y"]),this.propertyGroups.set("dimensions",["width","height"]),this.propertyGroups.set("typography",["fontFamily","fontSize","fontWeight","fontStyle","color","textAlign"]),this.propertyGroups.set("appearance",["backgroundColor","borderColor","borderWidth","borderRadius"]),this.propertyGroups.set("effects",["opacity","shadow","brightness","contrast","saturate"]),this.propertyGroups.set("transform",["rotation","scale"])}},{key:"validateColor",value:function(e){if(!e)return"#000000";if(/^#[0-9A-Fa-f]{6}$/.test(e)||/^#[0-9A-Fa-f]{3}$/.test(e))return e;var t=document.createElement("div");return t.style.color=e,t.style.color||"#000000"}},{key:"validateProperty",value:function(e,t){if("boolean"==typeof t)return t;if(e.startsWith("columns."))return t;var r=this.propertyValidators.get(e);if(r)try{return r(t)}catch(n){return this.getDefaultValue(e)}return this.isNumericProperty(e)?this.validateNumericProperty(e,t):this.isColorProperty(e)?this.validateColorProperty(t):this.isTextStyleProperty(e)?this.validateTextStyleProperty(e,t):t}},{key:"isNumericProperty",value:function(e){return["x","y","width","height","fontSize","opacity","lineHeight","letterSpacing","zIndex","borderWidth","borderRadius","rotation","padding"].includes(e)}},{key:"isColorProperty",value:function(e){return["color","backgroundColor","borderColor"].includes(e)}},{key:"isTextStyleProperty",value:function(e){return["fontWeight","textAlign","textDecoration","textTransform","borderStyle"].includes(e)}},{key:"validateNumericProperty",value:function(e,t){if(null==t||""===t)return this.getDefaultValue(e);var r;if("string"==typeof t){if(r=parseFloat(t),isNaN(r))return this.getDefaultValue(e)}else{if("number"!=typeof t)return this.getDefaultValue(e);r=t}var n={fontSize:{min:8,max:72},opacity:{min:0,max:1},lineHeight:{min:.5,max:3},letterSpacing:{min:-5,max:10},zIndex:{min:-100,max:1e3},borderWidth:{min:0,max:20},borderRadius:{min:0,max:100},rotation:{min:-180,max:180},padding:{min:0,max:100}};if(n[e]){var i=n[e],o=i.min,a=i.max;r=Math.max(o,Math.min(a,r))}return r}},{key:"validateColorProperty",value:function(e){if(!e)return"#000000";if("transparent"===e)return e;if(/^#[0-9A-Fa-f]{6}$/.test(e)||/^#[0-9A-Fa-f]{3}$/.test(e))return e;var t=document.createElement("div");t.style.color=e;var r=t.style.color;return r&&""!==r?e:"#000000"}},{key:"validateTextStyleProperty",value:function(e,t){var r={fontWeight:["normal","bold","100","200","300","400","500","600","700","800","900"],textAlign:["left","center","right","justify"],textDecoration:["none","underline","overline","line-through"],textTransform:["none","capitalize","uppercase","lowercase"],borderStyle:["solid","dashed","dotted","double","none"]};return r[e]&&r[e].includes(t)?t:{fontWeight:"normal",textAlign:"left",textDecoration:"none",textTransform:"none",borderStyle:"solid"}[e]||t}},{key:"getDefaultValue",value:function(e){return{x:0,y:0,width:100,height:50,fontSize:14,opacity:1,lineHeight:1.2,letterSpacing:0,zIndex:0,borderWidth:0,borderRadius:0,rotation:0,padding:0,color:"#333333",backgroundColor:"transparent",borderColor:"#dddddd",fontWeight:"normal",textAlign:"left",textDecoration:"none",textTransform:"none",borderStyle:"solid"}[e]||null}},{key:"getPresets",value:function(e){return this.propertyPresets.get(e)||{}}},{key:"getPropertiesInGroup",value:function(e){return this.propertyGroups.get(e)||[]}},{key:"applyPreset",value:function(e,t){return{"text-title":{fontSize:24,fontWeight:"bold",textAlign:"center",color:"#1e293b"},"text-subtitle":{fontSize:18,fontWeight:"bold",textAlign:"left",color:"#334155"},"text-body":{fontSize:14,fontWeight:"normal",textAlign:"left",color:"#475569"},"text-caption":{fontSize:12,fontWeight:"normal",textAlign:"left",color:"#64748b"},"shape-rounded":{borderRadius:8,borderWidth:1,borderColor:"transparent"},"shape-circle":{borderRadius:50,borderWidth:1,borderColor:"transparent"},"shape-square":{borderRadius:0,borderWidth:1,borderColor:"transparent"},"effect-shadow-soft":{shadow:!0,shadowColor:"#000000",shadowOffsetX:1,shadowOffsetY:1,opacity:90},"effect-shadow-strong":{shadow:!0,shadowColor:"#000000",shadowOffsetX:3,shadowOffsetY:3,opacity:85},"effect-glow":{shadow:!0,shadowColor:"#2563eb",shadowOffsetX:0,shadowOffsetY:0,opacity:95},"color-primary":{backgroundColor:"#2563eb",color:"#ffffff"},"color-secondary":{backgroundColor:"#64748b",color:"#ffffff"},"color-success":{backgroundColor:"#16a34a",color:"#ffffff"},"color-warning":{backgroundColor:"#ca8a04",color:"#ffffff"},"color-error":{backgroundColor:"#dc2626",color:"#ffffff"}}[e]||{}}},{key:"getDefaultProperties",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"text",t=a({text:{width:150,height:30,text:"Texte d'exemple"},"text-title":{width:200,height:40,text:"FACTURE PROFESSIONNELLE",fontSize:24,fontWeight:"bold"},"text-subtitle":{width:180,height:35,text:"quipement informatique",fontSize:18,fontWeight:"bold"},image:{width:150,height:100},rectangle:{backgroundColor:"#f1f5f9",borderWidth:1,borderColor:"#e2e8f0",width:150,height:80},circle:{backgroundColor:"#e0f2fe",borderWidth:2,borderColor:"#0ea5e9",width:80,height:80},line:{height:2,lineWidth:2,color:"#64748b"},product_table:{width:300,height:150},customer_info:{width:200,height:100,text:"Marie Dupont\n15 Rue de la Paix\n75002 Paris\nFrance\nmarie.dupont@email.fr"},company_logo:{width:100,height:60},order_number:{width:150,height:30,text:"Commande #WC-12345"},company_info:{width:200,height:80,text:"TechCorp SARL\n123 Boulevard Haussmann\n75008 Paris\nFrance\ncontact@techcorp.fr\nSIRET: 123 456 789 00012"},document_type:{width:120,height:40,text:"FACTURE"},watermark:{width:300,height:200,opacity:10,text:"CONFIDENTIEL"},"progress-bar":{width:200,height:20},barcode:{width:150,height:60},qrcode:{width:80,height:80},icon:{width:50,height:50}},"line",{height:2});return o(o({},{x:50,y:50,width:100,height:50,opacity:100,rotation:0,scale:100,visible:!0,backgroundColor:"transparent",borderColor:"transparent",borderWidth:0,borderStyle:"solid",borderRadius:0,color:"#1e293b",fontFamily:"Inter, sans-serif",fontSize:14,fontWeight:"normal",fontStyle:"normal",textAlign:"left",textDecoration:"none",src:"",alt:"",objectFit:"cover",shadow:!1,shadowColor:"#000000",shadowOffsetX:2,shadowOffsetY:2,brightness:100,contrast:100,saturate:100,showHeaders:!0,showBorders:!0,headers:["Produit","Qt","Prix"],dataSource:"order_items",columns:{image:!0,name:!0,sku:!1,quantity:!0,price:!0,total:!0},showSubtotal:!1,showShipping:!0,showTaxes:!0,showDiscount:!1,showTotal:!1,progressColor:"#3b82f6",progressValue:75,lineColor:"#64748b",lineWidth:2,documentType:"invoice",imageUrl:"",spacing:8,layout:"vertical",alignment:"left",fit:"contain"}),t[e]||{})}},{key:"getComputedProperties",value:function(e){return{absoluteX:e.x+e.width/2,absoluteY:e.y+e.height/2,scaledWidth:e.width*(e.scale/100),scaledHeight:e.height*(e.scale/100),cssTransform:"rotate(".concat(e.rotation,"deg) scale(").concat(e.scale/100,")"),cssFilter:"brightness(".concat(e.brightness,"%) contrast(").concat(e.contrast,"%) saturate(").concat(e.saturate,"%)"),cssBoxShadow:e.shadow?"".concat(e.shadowOffsetX||0,"px ").concat(e.shadowOffsetY||0,"px 4px ").concat(e.shadowColor||"#000000"):"none"}}},{key:"isAnimatable",value:function(e){return["x","y","width","height","rotation","scale","opacity","brightness","contrast","saturate"].includes(e)}},{key:"getPropertyConstraints",value:function(e){return{x:{min:-1e3,max:2e3,step:1},y:{min:-1e3,max:2e3,step:1},width:{min:1,max:2e3,step:1},height:{min:1,max:2e3,step:1},fontSize:{min:8,max:72,step:1},borderWidth:{min:0,max:20,step:1},borderRadius:{min:0,max:100,step:1},rotation:{min:-180,max:180,step:1},scale:{min:10,max:200,step:5},opacity:{min:0,max:100,step:1},brightness:{min:0,max:200,step:5},contrast:{min:0,max:200,step:5},saturate:{min:0,max:200,step:5},shadowOffsetX:{min:-50,max:50,step:1},shadowOffsetY:{min:-50,max:50,step:1}}[e]||{}}}],t&&s(e.prototype,t),r&&s(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,r}(),h=new l},483:function(e,t,r){function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function o(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),!0).forEach(function(t){a(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function a(e,t,r){return(t=c(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function s(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,c(n.key),n)}}function c(e){var t=function(e,t){if("object"!=n(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=n(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==n(t)?t:t+""}r.d(t,{m:function(){return l}});var l=function(){return e=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.mainInstance=t,this.canvas=null,this.ctx=null,this.devicePixelRatio=window.devicePixelRatio||1,this.imageCache=new Map,this.shapeCache=new Map,this.renderSettings={antiAlias:!0,imageSmoothing:!0,shadowQuality:"high",textRendering:"optimizeLegibility"},this.performanceStats={renderTime:0,elementCount:0,lastRenderTime:Date.now()}},(t=[{key:"initialize",value:function(e,t){this.canvas=e,this.ctx=t,this.init()}},{key:"init",value:function(){this.canvas&&this.ctx&&(this.optimizeForDevice(),this.setupContext())}},{key:"optimizeForDevice",value:function(){var e=this.canvas.getBoundingClientRect();this.canvas.width=e.width*this.devicePixelRatio,this.canvas.height=e.height*this.devicePixelRatio,this.ctx.scale(this.devicePixelRatio,this.devicePixelRatio),this.canvas.style.width=e.width+"px",this.canvas.style.height=e.height+"px"}},{key:"setupContext",value:function(){this.ctx.imageSmoothingEnabled=this.renderSettings.imageSmoothing,this.ctx.imageSmoothingQuality="high",this.ctx.textBaseline="top",this.ctx.font="14px Arial, sans-serif",this.ctx.globalCompositeOperation="source-over"}},{key:"render",value:function(){this.clear(),this.renderBackground(),this.mainInstance.options.showGrid,this.mainInstance.options.showGrid&&this.renderGrid(),this.renderAllElements(),this.renderSelectionHandles()}},{key:"renderBackground",value:function(){this.ctx.fillStyle=this.mainInstance.options.backgroundColor||"#ffffff",this.ctx.fillRect(0,0,this.canvas.width/this.devicePixelRatio,this.canvas.height/this.devicePixelRatio)}},{key:"renderGrid",value:function(){var e=this.mainInstance.options.gridSize||20,t=this.canvas.width/this.devicePixelRatio,r=this.canvas.height/this.devicePixelRatio;this.mainInstance.options.showGrid,this.ctx.save(),this.ctx.strokeStyle="rgba(0, 0, 0, 0.1)",this.ctx.lineWidth=.5,this.ctx.setLineDash([2,2]);for(var n=0;n<=t;n+=e)this.ctx.beginPath(),this.ctx.moveTo(n,0),this.ctx.lineTo(n,r),this.ctx.stroke();for(var i=0;i<=r;i+=e)this.ctx.beginPath(),this.ctx.moveTo(0,i),this.ctx.lineTo(t,i),this.ctx.stroke();this.ctx.restore()}},{key:"renderAllElements",value:function(){var e=this;Array.from(this.mainInstance.elements.values()).sort(function(e,t){return(e.properties.zIndex||0)-(t.properties.zIndex||0)}).forEach(function(t){e.renderElement(t,{})})}},{key:"renderSelectionHandles",value:function(){var e=this,t=this.mainInstance.selectionManager.getSelectedElements();t.forEach(function(t){e.mainInstance.transformationsManager.renderElementHandles(e.ctx,t)}),t.length>1&&this.renderSelectionBounds()}},{key:"renderSelectionBounds",value:function(){var e=this.mainInstance.selectionManager.selectionBounds;e&&(this.ctx.save(),this.ctx.strokeStyle="#007bff",this.ctx.lineWidth=2,this.ctx.setLineDash([5,5]),this.ctx.strokeRect(e.x,e.y,e.width,e.height),this.ctx.restore())}},{key:"renderElement",value:function(e,t){var r=performance.now();this.ctx.save();try{if(!e||!e.properties)return void console.warn("renderElement: invalid element or properties",e);this.applyTransforms(e.properties,t),this.applyVisualEffects(e.properties),this.renderByType(e),this.applyPostFilters(e.properties)}finally{this.ctx.restore()}this.performanceStats.renderTime+=performance.now()-r,this.performanceStats.elementCount++}},{key:"applyTransforms",value:function(e,t){if(e){var r=o({x:e.x||0,y:e.y||0,width:e.width||100,height:e.height||50,rotation:e.rotation||0,scale:e.scale||100,opacity:void 0!==e.opacity?e.opacity:100},e);if(this.ctx.translate(r.x,r.y),r.rotation&&0!==r.rotation){var n=r.width/2,i=r.height/2;this.ctx.translate(n,i),this.ctx.rotate(r.rotation*Math.PI/180),this.ctx.translate(-n,-i)}if(r.scale&&100!==r.scale){var a=r.scale/100,s=r.width/2,c=r.height/2;this.ctx.translate(s,c),this.ctx.scale(a,a),this.ctx.translate(-s,-c)}if(void 0!==r.opacity){var l=r.opacity;l<=1?this.ctx.globalAlpha=l:l<=100&&(this.ctx.globalAlpha=l/100)}}else console.warn("applyTransforms: properties is undefined")}},{key:"applyVisualEffects",value:function(e){if(e.shadow?(this.ctx.shadowColor=e.shadowColor||"#000000",this.ctx.shadowBlur=4,this.ctx.shadowOffsetX=e.shadowOffsetX||2,this.ctx.shadowOffsetY=e.shadowOffsetY||2):(this.ctx.shadowColor="transparent",this.ctx.shadowBlur=0,this.ctx.shadowOffsetX=0,this.ctx.shadowOffsetY=0),void 0!==this.ctx.filter){var t=[];e.brightness&&100!==e.brightness&&t.push("brightness(".concat(e.brightness,"%)")),e.contrast&&100!==e.contrast&&t.push("contrast(".concat(e.contrast,"%)")),e.saturate&&100!==e.saturate&&t.push("saturate(".concat(e.saturate,"%)")),this.ctx.filter=t.join(" ")||"none"}}},{key:"renderByType",value:function(e){if(this.isWooCommerceElement(e.type))this.renderWooCommerceElement(e);else switch(e.type){case"text":this.renderText(e);break;case"rectangle":case"shape-rectangle":this.renderRectangle(e);break;case"circle":case"shape-circle":this.renderCircle(e);break;case"line":case"shape-line":this.renderLine(e);break;case"image":this.renderImage(e);break;case"barcode":this.renderBarcode(e);break;case"qrcode":this.renderQRCode(e);break;default:this.renderGeneric(e)}}},{key:"isWooCommerceElement",value:function(e){return["order_number","order_date","customer_name","customer_email","billing_address","shipping_address","payment_method","order_status","subtotal","discount","shipping","taxes","total","refund","product_table","customer_info","company_info","company_logo","dynamic-text","woocommerce-invoice-number","woocommerce-invoice-date","woocommerce-order-number","woocommerce-order-date","woocommerce-billing-address","woocommerce-shipping-address","woocommerce-customer-name","woocommerce-customer-email","woocommerce-payment-method","woocommerce-order-status","woocommerce-products-table","woocommerce-subtotal","woocommerce-discount","woocommerce-shipping","woocommerce-taxes","woocommerce-total","woocommerce-refund"].includes(e)}},{key:"renderWooCommerceElement",value:function(e){var t="";this.mainInstance&&this.mainInstance.wooCommerceManager&&(t=this.mainInstance.wooCommerceManager.getElementDisplayText(e.type));var r=o(o({},e),{},{properties:o(o({},e.properties),{},{text:t||"[".concat(e.type,"]")})});this.renderText(r)}},{key:"renderText",value:function(e){var t=e.properties;if(t){var r=this.buildFontString(t);this.ctx.font=r,this.ctx.fillStyle=t.color||"#000000",this.ctx.textAlign=t.textAlign||"left";var n=0,i=t.text||"",o=this.ctx.measureText(i);"center"===t.textAlign?n=(t.width||100)/2:"right"===t.textAlign&&(n=t.width||100),t.textDecoration&&this.renderTextDecoration(i,n,0,t,o),this.ctx.fillText(i,n,0),t.strokeWidth&&t.strokeWidth>0&&(this.ctx.strokeStyle=t.strokeColor||"#000000",this.ctx.lineWidth=t.strokeWidth,this.ctx.strokeText(i,n,0))}else console.warn("renderText: properties is undefined for element",e)}},{key:"buildFontString",value:function(e){var t=e.fontWeight||"normal",r=e.fontSize||14,n=e.fontFamily||"Arial, sans-serif",i=e.fontStyle||"normal";return"".concat(i," ").concat(t," ").concat(r,"px ").concat(n)}},{key:"renderTextDecoration",value:function(e,t,r,n,i){var o=r+.8*(n.fontSize||14);switch(this.ctx.strokeStyle=n.color||"#000000",this.ctx.lineWidth=1,n.textDecoration){case"underline":this.ctx.beginPath(),this.ctx.moveTo(t,o),this.ctx.lineTo(t+i.width,o),this.ctx.stroke();break;case"overline":this.ctx.beginPath(),this.ctx.moveTo(t,r),this.ctx.lineTo(t+i.width,r),this.ctx.stroke();break;case"line-through":var a=r+.5*(n.fontSize||14);this.ctx.beginPath(),this.ctx.moveTo(t,a),this.ctx.lineTo(t+i.width,a),this.ctx.stroke()}}},{key:"renderRectangle",value:function(e){var t=e.properties,r=t.borderRadius||0;this.ctx.beginPath(),0===r?this.ctx.rect(0,0,t.width,t.height):this.roundedRect(0,0,t.width,t.height,r),t.backgroundColor&&"transparent"!==t.backgroundColor&&(this.ctx.fillStyle=t.backgroundColor,this.ctx.fill()),t.borderWidth&&t.borderWidth>0&&(this.ctx.strokeStyle=t.borderColor||"#000000",this.ctx.lineWidth=t.borderWidth,this.ctx.stroke())}},{key:"renderCircle",value:function(e){var t=e.properties,r=t.width/2,n=t.height/2,i=Math.min(r,n);this.ctx.beginPath(),this.ctx.arc(r,n,i,0,2*Math.PI),t.backgroundColor&&"transparent"!==t.backgroundColor&&(this.ctx.fillStyle=t.backgroundColor,this.ctx.fill()),t.borderWidth&&t.borderWidth>0&&(this.ctx.strokeStyle=t.borderColor||"#000000",this.ctx.lineWidth=t.borderWidth,this.ctx.stroke())}},{key:"renderLine",value:function(e){var t=e.properties;this.ctx.beginPath(),this.ctx.moveTo(0,t.height/2),this.ctx.lineTo(t.width,t.height/2),this.ctx.strokeStyle=t.color||"#000000",this.ctx.lineWidth=t.lineWidth||2,this.ctx.lineCap="round",this.ctx.stroke()}},{key:"renderImage",value:function(e){var t=e.properties;if(t.src){var r=t.src;if(this.imageCache.has(r)){var n=this.imageCache.get(r);this.drawCachedImage(n,t)}else this.loadAndCacheImage(t.src,r,t)}}},{key:"loadAndCacheImage",value:function(e,t,r){var n=this,i=new Image;i.crossOrigin="anonymous",i.onload=function(){var e={image:i,loaded:!0,width:i.naturalWidth,height:i.naturalHeight};n.imageCache.set(t,e),n.drawCachedImage(e,r)},i.onerror=function(){n.drawImagePlaceholder(r)},i.src=e}},{key:"drawCachedImage",value:function(e,t){if(e.loaded){var r=e.image,n=t.width,i=t.height,o=0,a=0;if("cover"===t.objectFit){var s=Math.max(t.width/r.width,t.height/r.height);n=r.width*s,i=r.height*s,o=(t.width-n)/2,a=(t.height-i)/2}else if("contain"===t.objectFit){var c=Math.min(t.width/r.width,t.height/r.height);n=r.width*c,i=r.height*c,o=(t.width-n)/2,a=(t.height-i)/2}this.ctx.drawImage(r,o,a,n,i)}}},{key:"drawImagePlaceholder",value:function(e){var t=this.ctx.createLinearGradient(0,0,e.width,e.height);t.addColorStop(0,"#f8fafc"),t.addColorStop(1,"#e2e8f0"),this.ctx.fillStyle=t,this.ctx.fillRect(0,0,e.width,e.height),this.ctx.strokeStyle="#cbd5e1",this.ctx.lineWidth=2,this.ctx.strokeRect(2,2,e.width-4,e.height-4),this.ctx.fillStyle="#94a3b8",this.ctx.font=Math.min(e.width/4,24)+"px Arial, sans-serif",this.ctx.textAlign="center",this.ctx.fillText("",e.width/2,e.height/2+8),e.width>80&&e.height>40&&(this.ctx.fillStyle="#64748b",this.ctx.font="11px Arial, sans-serif",this.ctx.fillText("Image",e.width/2,e.height-15))}},{key:"renderBarcode",value:function(e){var t=e.properties,r=t.value||"123456789012";this.renderSimpleBarcode(r,t)}},{key:"renderQRCode",value:function(e){var t=e.properties,r=t.value||"https://example.com";this.renderQRPlaceholder(r,t)}},{key:"renderSimpleBarcode",value:function(e,t){var r=.8*t.height,n=(t.width-2*e.length)/2,i=(t.height-r)/2;this.ctx.fillStyle=t.color||"#000000";for(var o=0;o<e.length;o++)parseInt(e[o])%2==0&&this.ctx.fillRect(n+2*o,i,2,r)}},{key:"renderQRPlaceholder",value:function(e,t){this.ctx.fillStyle="#000000",this.ctx.fillRect(0,0,t.width,t.height),this.ctx.fillStyle="#ffffff";var r=.4*Math.min(t.width,t.height),n=(t.width-r)/2,i=(t.height-r)/2;this.ctx.fillRect(n,i,r,r),this.ctx.fillStyle="#000000",this.ctx.font="10px monospace",this.ctx.textAlign="center",this.ctx.fillText("QR",t.width/2,t.height/2+3)}},{key:"renderGeneric",value:function(e){this.renderRectangle(e)}},{key:"applyPostFilters",value:function(e){}},{key:"roundedRect",value:function(e,t,r,n,i){this.ctx.beginPath(),this.ctx.moveTo(e+i,t),this.ctx.lineTo(e+r-i,t),this.ctx.quadraticCurveTo(e+r,t,e+r,t+i),this.ctx.lineTo(e+r,t+n-i),this.ctx.quadraticCurveTo(e+r,t+n,e+r-i,t+n),this.ctx.lineTo(e+i,t+n),this.ctx.quadraticCurveTo(e,t+n,e,t+n-i),this.ctx.lineTo(e,t+i),this.ctx.quadraticCurveTo(e,t,e+i,t),this.ctx.closePath()}},{key:"clear",value:function(){this.ctx.clearRect(0,0,this.canvas.width/this.devicePixelRatio,this.canvas.height/this.devicePixelRatio)}},{key:"resize",value:function(e,t){this.canvas.width=e*this.devicePixelRatio,this.canvas.height=t*this.devicePixelRatio,this.canvas.style.width=e+"px",this.canvas.style.height=t+"px",this.ctx.scale(this.devicePixelRatio,this.devicePixelRatio)}},{key:"getPerformanceStats",value:function(){return o(o({},this.performanceStats),{},{averageRenderTime:this.performanceStats.elementCount>0?this.performanceStats.renderTime/this.performanceStats.elementCount:0,fps:this.performanceStats.lastRenderTime>0?1e3/(Date.now()-this.performanceStats.lastRenderTime):0})}},{key:"resetStats",value:function(){this.performanceStats={renderTime:0,elementCount:0,lastRenderTime:Date.now()}}},{key:"clearCache",value:function(){this.imageCache.clear(),this.shapeCache.clear()}},{key:"dispose",value:function(){this.clearCache(),this.resetStats()}}])&&s(e.prototype,t),r&&s(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,r}();t.A=l},501:function(e,t,r){r.d(t,{A:function(){return E}});var n=r(287),i=r(901),o=r(878),a=r(351);function s(e){return s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s(e)}function c(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return l(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?l(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==r.return||r.return()}finally{if(s)throw o}}}}function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function h(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,u(n.key),n)}}function u(e){var t=function(e,t){if("object"!=s(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=s(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==s(t)?t:t+""}var d=function(){return e=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.ctx=t,this.cache=new Map},t=[{key:"drawRoundedRect",value:function(e,t,r,n,i){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{},a=o.fill,s=void 0===a?null:a,c=o.stroke,l=void 0===c?null:c,h=o.lineWidth,u=void 0===h?1:h,d=o.shadow,f=void 0===d?null:d;this.ctx.save(),f&&(this.ctx.shadowColor=f.color||"#000000",this.ctx.shadowBlur=f.blur||4,this.ctx.shadowOffsetX=f.offsetX||2,this.ctx.shadowOffsetY=f.offsetY||2),this.ctx.beginPath(),this.ctx.moveTo(e+i,t),this.ctx.lineTo(e+r-i,t),this.ctx.quadraticCurveTo(e+r,t,e+r,t+i),this.ctx.lineTo(e+r,t+n-i),this.ctx.quadraticCurveTo(e+r,t+n,e+r-i,t+n),this.ctx.lineTo(e+i,t+n),this.ctx.quadraticCurveTo(e,t+n,e,t+n-i),this.ctx.lineTo(e,t+i),this.ctx.quadraticCurveTo(e,t,e+i,t),this.ctx.closePath(),s&&(this.ctx.fillStyle=s,this.ctx.fill()),l&&(this.ctx.strokeStyle=l,this.ctx.lineWidth=u,this.ctx.stroke()),this.ctx.restore()}},{key:"drawMultilineText",value:function(e,t,r,n){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},o=i.fontSize,a=void 0===o?14:o,s=i.fontFamily,l=void 0===s?"Arial, sans-serif":s,h=i.fontWeight,u=void 0===h?"normal":h,d=i.color,f=void 0===d?"#000000":d,y=i.lineHeight,p=void 0===y?1.2:y,m=i.textAlign,v=void 0===m?"left":m,g=i.verticalAlign,b=void 0===g?"top":g,w=i.maxLines,x=void 0===w?null:w,S=i.ellipsis,k=void 0===S?"...":S;if(!e)return{width:0,height:0,lines:0};this.ctx.save(),this.ctx.font="".concat(u," ").concat(a,"px ").concat(l),this.ctx.fillStyle=f,this.ctx.textAlign=v;var E,P,C=[],T="",O=c(e.split(" "));try{for(O.s();!(P=O.n()).done;){var M=P.value,I=T+(T?" ":"")+M;this.ctx.measureText(I).width>n&&T?(C.push(T),T=M):T=I}}catch(R){O.e(R)}finally{O.f()}if(T&&C.push(T),x&&C.length>x){C.splice(x-1);var j=C[C.length-1];for(this.ctx.measureText(k).width;C.length>0&&this.ctx.measureText(j+k).width>n;){var A=j.split(" ");A.pop(),C[C.length-1]=A.join(" ")}C[C.length-1]+=k}E=C.length*(a*p);var D=r;"middle"===b?D=r-E/2+a/2:"bottom"===b&&(D=r-E+a);for(var z=0;z<C.length;z++){var L=D+z*(a*p);this.ctx.fillText(C[z],t,L)}return this.ctx.restore(),{width:n,height:E,lines:C.length}}},{key:"drawShape",value:function(e,t,r,n){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},o="".concat(e,"_").concat(n,"_").concat(JSON.stringify(i));if(this.cache.has(o)){var a=this.cache.get(o);this.drawCachedShape(a,t,r)}else{var s=this.createShape(e,n,i);this.cache.set(o,s),this.drawCachedShape(s,t,r)}}},{key:"createShape",value:function(e,t,r){var n=r.sides,i=void 0===n?6:n,o=r.spikes,a=void 0===o?5:o,s=r.rotation,c=void 0===s?0:s,l=[],h=t/2,u=t/2,d=t/2;switch(e){case"polygon":for(var f=0;f<i;f++){var y=2*f*Math.PI/i+c;l.push({x:h+d*Math.cos(y),y:u+d*Math.sin(y)})}break;case"star":for(var p=0;p<2*a;p++){var m=p*Math.PI/a+c,v=p%2==0?d:.5*d;l.push({x:h+v*Math.cos(m),y:u+v*Math.sin(m)})}break;case"arrow":l.push({x:0,y:.3*t},{x:.7*t,y:.3*t},{x:.7*t,y:.2*t},{x:t,y:.5*t},{x:.7*t,y:.8*t},{x:.7*t,y:.7*t},{x:0,y:.7*t})}return{points:l,type:e}}},{key:"drawCachedShape",value:function(e,t,r){if(this.ctx.save(),this.ctx.translate(t,r),this.ctx.beginPath(),e.points.length>0){this.ctx.moveTo(e.points[0].x,e.points[0].y);for(var n=1;n<e.points.length;n++)this.ctx.lineTo(e.points[n].x,e.points[n].y);this.ctx.closePath()}this.ctx.fillStyle="#e5e7eb",this.ctx.fill(),this.ctx.strokeStyle="#64748b",this.ctx.lineWidth=1,this.ctx.stroke(),this.ctx.restore()}},{key:"drawGrid",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:20,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=n.color,o=void 0===i?"#f0f0f0":i,a=n.lineWidth,s=void 0===a?1:a,c=n.showLabels,l=void 0!==c&&c,h=n.labelSize,u=void 0===h?10:h;this.ctx.save(),this.ctx.strokeStyle=o,this.ctx.lineWidth=s,this.ctx.font="".concat(u,"px monospace"),this.ctx.fillStyle="#999";for(var d=0;d<=e;d+=r)this.ctx.beginPath(),this.ctx.moveTo(d,0),this.ctx.lineTo(d,t),this.ctx.stroke(),l&&d>0&&this.ctx.fillText(d.toString(),d+2,u+2);for(var f=0;f<=t;f+=r)this.ctx.beginPath(),this.ctx.moveTo(0,f),this.ctx.lineTo(e,f),this.ctx.stroke(),l&&f>0&&this.ctx.fillText(f.toString(),2,f-2);this.ctx.restore()}},{key:"drawResizeHandles",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:8,n=e.properties,i=[{x:n.x,y:n.y,cursor:"nw-resize"},{x:n.x+n.width,y:n.y,cursor:"ne-resize"},{x:n.x+n.width,y:n.y+n.height,cursor:"se-resize"},{x:n.x,y:n.y+n.height,cursor:"sw-resize"}];this.ctx.save(),this.ctx.fillStyle="#007bff",this.ctx.strokeStyle="#ffffff",this.ctx.lineWidth=1,i.forEach(function(e){t.ctx.beginPath(),t.ctx.arc(e.x,e.y,r/2,0,2*Math.PI),t.ctx.fill(),t.ctx.stroke(),t.ctx.fillStyle="#ffffff",t.ctx.font="".concat(r-2,"px monospace"),t.ctx.textAlign="center",t.ctx.fillText("",e.x,e.y+2)}),this.ctx.restore()}},{key:"applyAdvancedEffects",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};e.properties,t.brightness&&100!==t.brightness&&(this.ctx.filter="brightness(".concat(t.brightness,"%)")),t.contrast&&100!==t.contrast&&(this.ctx.filter+=" contrast(".concat(t.contrast,"%)")),t.saturate&&100!==t.saturate&&(this.ctx.filter+=" saturate(".concat(t.saturate,"%)")),t.blur&&t.blur>0&&(this.ctx.filter+=" blur(".concat(t.blur,"px)")),t.hueRotate&&0!==t.hueRotate&&(this.ctx.filter+=" hue-rotate(".concat(t.hueRotate,"deg)"))}},{key:"measureText",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.fontSize,n=void 0===r?14:r,i=t.fontFamily,o=void 0===i?"Arial, sans-serif":i,a=t.fontWeight,s=void 0===a?"normal":a;this.ctx.save(),this.ctx.font="".concat(s," ").concat(n,"px ").concat(o);var c=this.ctx.measureText(e),l=1.2*n;return this.ctx.restore(),{width:c.width,height:l,actualBoundingBoxAscent:c.actualBoundingBoxAscent||0,actualBoundingBoxDescent:c.actualBoundingBoxDescent||0}}},{key:"createLinearGradient",value:function(e,t,r,n,i){var o=this.ctx.createLinearGradient(e,t,r,n);return i.forEach(function(e,t){var r=i.length>1?t/(i.length-1):0;o.addColorStop(r,e)}),o}},{key:"createRadialGradient",value:function(e,t,r,n,i,o,a){var s=this.ctx.createRadialGradient(e,t,r,n,i,o);return a.forEach(function(e,t){var r=a.length>1?t/(a.length-1):0;s.addColorStop(r,e)}),s}},{key:"drawStyledLine",value:function(e,t,r,n){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},o=i.color,a=void 0===o?"#000000":o,s=i.width,c=void 0===s?1:s,l=i.style,h=void 0===l?"solid":l,u=i.cap,d=void 0===u?"butt":u,f=i.dash,y=void 0===f?[]:f;this.ctx.save(),this.ctx.strokeStyle=a,this.ctx.lineWidth=c,this.ctx.lineCap=d,"dashed"===h?this.ctx.setLineDash([5,5]):"dotted"===h?this.ctx.setLineDash([2,2]):y.length>0&&this.ctx.setLineDash(y),this.ctx.beginPath(),this.ctx.moveTo(e,t),this.ctx.lineTo(r,n),this.ctx.stroke(),this.ctx.restore()}},{key:"drawBezierCurve",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.tension,n=void 0===r?.5:r,i=t.close,o=void 0!==i&&i;if(!(e.length<2)){if(this.ctx.save(),t.color&&(this.ctx.strokeStyle=t.color),t.width&&(this.ctx.lineWidth=t.width),t.fill&&(this.ctx.fillStyle=t.fill),this.ctx.beginPath(),this.ctx.moveTo(e[0].x,e[0].y),2===e.length)this.ctx.lineTo(e[1].x,e[1].y);else for(var a=1;a<e.length;a++){var s=e[a-1],c=e[a],l=e[a+1]||c,h=s.x+(c.x-s.x)*n,u=s.y+(c.y-s.y)*n,d=c.x-(l.x-s.x)*n,f=c.y-(l.y-s.y)*n;this.ctx.bezierCurveTo(h,u,d,f,c.x,c.y)}o&&this.ctx.closePath(),t.fill&&this.ctx.fill(),this.ctx.stroke(),this.ctx.restore()}}},{key:"clearCache",value:function(){this.cache.clear()}},{key:"getCacheStats",value:function(){return{size:this.cache.size,keys:Array.from(this.cache.keys())}}}],t&&h(e.prototype,t),r&&h(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,r}(),f=r(557),y=r(718),p=r(730);function m(e){return m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},m(e)}function v(){var e,t,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",i=r.toStringTag||"@@toStringTag";function o(r,n,i,o){var c=n&&n.prototype instanceof s?n:s,l=Object.create(c.prototype);return g(l,"_invoke",function(r,n,i){var o,s,c,l=0,h=i||[],u=!1,d={p:0,n:0,v:e,a:f,f:f.bind(e,4),d:function(t,r){return o=t,s=0,c=e,d.n=r,a}};function f(r,n){for(s=r,c=n,t=0;!u&&l&&!i&&t<h.length;t++){var i,o=h[t],f=d.p,y=o[2];r>3?(i=y===n)&&(c=o[(s=o[4])?5:(s=3,3)],o[4]=o[5]=e):o[0]<=f&&((i=r<2&&f<o[1])?(s=0,d.v=n,d.n=o[1]):f<y&&(i=r<3||o[0]>n||n>y)&&(o[4]=r,o[5]=n,d.n=y,s=0))}if(i||r>1)return a;throw u=!0,n}return function(i,h,y){if(l>1)throw TypeError("Generator is already running");for(u&&1===h&&f(h,y),s=h,c=y;(t=s<2?e:c)||!u;){o||(s?s<3?(s>1&&(d.n=-1),f(s,c)):d.n=c:d.v=c);try{if(l=2,o){if(s||(i="next"),t=o[i]){if(!(t=t.call(o,c)))throw TypeError("iterator result is not an object");if(!t.done)return t;c=t.value,s<2&&(s=0)}else 1===s&&(t=o.return)&&t.call(o),s<2&&(c=TypeError("The iterator does not provide a '"+i+"' method"),s=1);o=e}else if((t=(u=d.n<0)?c:r.call(n,d))!==a)break}catch(t){o=e,s=1,c=t}finally{l=1}}return{value:t,done:u}}}(r,i,o),!0),l}var a={};function s(){}function c(){}function l(){}t=Object.getPrototypeOf;var h=[][n]?t(t([][n]())):(g(t={},n,function(){return this}),t),u=l.prototype=s.prototype=Object.create(h);function d(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,l):(e.__proto__=l,g(e,i,"GeneratorFunction")),e.prototype=Object.create(u),e}return c.prototype=l,g(u,"constructor",l),g(l,"constructor",c),c.displayName="GeneratorFunction",g(l,i,"GeneratorFunction"),g(u),g(u,i,"Generator"),g(u,n,function(){return this}),g(u,"toString",function(){return"[object Generator]"}),(v=function(){return{w:o,m:d}})()}function g(e,t,r,n){var i=Object.defineProperty;try{i({},"",{})}catch(e){i=0}g=function(e,t,r,n){function o(t,r){g(e,t,function(e){return this._invoke(t,r,e)})}t?i?i(e,t,{value:r,enumerable:!n,configurable:!n,writable:!n}):e[t]=r:(o("next",0),o("throw",1),o("return",2))},g(e,t,r,n)}function b(e,t,r,n,i,o,a){try{var s=e[o](a),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,i)}function w(e){return function(){var t=this,r=arguments;return new Promise(function(n,i){var o=e.apply(t,r);function a(e){b(o,n,i,a,s,"next",e)}function s(e){b(o,n,i,a,s,"throw",e)}a(void 0)})}}function x(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,S(n.key),n)}}function S(e){var t=function(e,t){if("object"!=m(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=m(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==m(t)?t:t+""}e=r.hmd(e);var k=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.results={passed:0,failed:0,tests:[]},this.canvasInstance=null},t=[{key:"runAllTests",value:(C=w(v().m(function e(){var t;return v().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,this.testElementRestrictions();case 1:return e.n=2,this.testWooCommerceManager();case 2:return e.n=3,this.testCustomizationService();case 3:return e.n=4,this.testRenderUtils();case 4:return e.n=5,this.testPropertiesManager();case 5:return e.n=6,this.testLayersManager();case 6:return e.n=7,this.testExportManager();case 7:return e.n=8,this.testCanvasInitialization();case 8:return e.n=9,this.testElementCreation();case 9:return e.n=10,this.testSelectionSystem();case 10:return e.n=11,this.testEventHandling();case 11:this.printResults(),e.n=13;break;case 12:e.p=12,t=e.v,this.logTest("Test Suite",!1,t.message),this.printResults();case 13:return e.a(2)}},e,this,[[0,12]])})),function(){return C.apply(this,arguments)})},{key:"testElementRestrictions",value:(P=w(v().m(function e(){var t,r,n,o,a;return v().w(function(e){for(;;)switch(e.n){case 0:try{for(t=Object.keys(i.$d),this.assert(t.length>0,"Types d'lments dfinis"),r=0,n=t;r<n.length;r++)o=n[r],a=i.$d[o]&&i.$d[o].defaults,this.assert(a,"Proprits par dfaut pour ".concat(o));this.logTest("Element Restrictions",!0)}catch(s){this.logTest("Element Restrictions",!1,s.message)}case 1:return e.a(2)}},e,this)})),function(){return P.apply(this,arguments)})},{key:"testWooCommerceManager",value:(E=w(v().m(function e(){var t,r,n,i;return v().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,t=new o.Z,r=t.getTestData(),this.assert(Array.isArray(r),"Donnes de test disponibles"),e.n=1,t.loadWooCommerceData();case 1:n=e.v,this.assert("boolean"==typeof n,"Chargement des donnes WooCommerce"),this.logTest("WooCommerce Manager",!0),e.n=3;break;case 2:e.p=2,i=e.v,this.logTest("WooCommerce Manager",!1,i.message);case 3:return e.a(2)}},e,this,[[0,2]])})),function(){return E.apply(this,arguments)})},{key:"testCustomizationService",value:(k=w(v().m(function e(){var t,r,n;return v().w(function(e){for(;;)switch(e.n){case 0:try{t=new a.J,r=t.validateProperty("text","fontSize",12),this.assert(r,"Validation de proprit basique"),n=t.getDefaultProperties("rectangle"),this.assert(n&&"object"===m(n),"Proprits par dfaut"),this.logTest("Customization Service",!0)}catch(i){this.logTest("Customization Service",!1,i.message)}case 1:return e.a(2)}},e,this)})),function(){return k.apply(this,arguments)})},{key:"testRenderUtils",value:(S=w(v().m(function e(){var t,r;return v().w(function(e){for(;;)switch(e.n){case 0:try{t=document.createElement("canvas"),r=t.getContext("2d"),t.width=200,t.height=200,d.drawShape(r,"rectangle",{x:10,y:10,width:50,height:50,fillColor:"#ff0000",strokeColor:"#000000"}),d.drawMultilineText(r,"Test Text",{x:10,y:80,maxWidth:100,fontSize:12}),this.logTest("Render Utils",!0)}catch(n){this.logTest("Render Utils",!1,n.message)}case 1:return e.a(2)}},e,this)})),function(){return S.apply(this,arguments)})},{key:"testPropertiesManager",value:(b=w(v().m(function e(){var t,r,n,i;return v().w(function(e){for(;;)switch(e.n){case 0:try{t=new f.V(null),r="test-element",t.setProperty(r,"width",100),n=t.getProperty(r,"width"),this.assert(100===n,"Dfinition et rcupration de proprit"),i=t.validatePropertyByType("width",50),this.assert(i,"Validation de proprit par type"),this.logTest("Properties Manager",!0)}catch(o){this.logTest("Properties Manager",!1,o.message)}case 1:return e.a(2)}},e,this)})),function(){return b.apply(this,arguments)})},{key:"testLayersManager",value:(g=w(v().m(function e(){var t,r,n;return v().w(function(e){for(;;)switch(e.n){case 0:try{t=new y.g(null),r=t.createLayer("test-layer",{name:"Test Layer"}),this.assert(r&&"test-layer"===r.id,"Cration de calque"),n=t.getLayer("test-layer"),this.assert(n===r,"Rcupration de calque"),this.logTest("Layers Manager",!0)}catch(i){this.logTest("Layers Manager",!1,i.message)}case 1:return e.a(2)}},e,this)})),function(){return g.apply(this,arguments)})},{key:"testExportManager",value:(u=w(v().m(function e(){var t,r,n;return v().w(function(e){for(;;)switch(e.n){case 0:try{t=new p.M(null),r=t.getSupportedFormats(),this.assert(Array.isArray(r)&&r.includes("pdf"),"Formats d'export supports"),t.configure({format:"a4"}),n=t.getExportStats(),this.assert("a4"===n.config.format,"Configuration d'export"),this.logTest("Export Manager",!0)}catch(i){this.logTest("Export Manager",!1,i.message)}case 1:return e.a(2)}},e,this)})),function(){return u.apply(this,arguments)})},{key:"testCanvasInitialization",value:(h=w(v().m(function e(){var t,r;return v().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,(t=document.createElement("div")).id="test-canvas-container",t.style.width="800px",t.style.height="600px",document.body.appendChild(t),this.canvasInstance=new n.M("test-canvas-container",{width:800,height:600}),e.n=1,this.canvasInstance.init();case 1:this.assert(this.canvasInstance.canvas,"Canvas cr"),this.assert(this.canvasInstance.ctx,"Contexte 2D disponible"),this.assert(this.canvasInstance.isInitialized,"Canvas initialis"),document.body.removeChild(t),this.logTest("Canvas Initialization",!0),e.n=3;break;case 2:e.p=2,r=e.v,this.logTest("Canvas Initialization",!1,r.message);case 3:return e.a(2)}},e,this,[[0,2]])})),function(){return h.apply(this,arguments)})},{key:"testElementCreation",value:(l=w(v().m(function e(){var t,r,n;return v().w(function(e){for(;;)switch(e.p=e.n){case 0:if(e.p=0,this.canvasInstance){e.n=1;break}throw new Error("Canvas instance not available");case 1:t=this.canvasInstance.addElement("text",{x:100,y:100,text:"Test Text"}),this.assert(t,"lment texte cr"),r=this.canvasInstance.addElement("rectangle",{x:200,y:200,width:100,height:50}),this.assert(r,"lment rectangle cr"),this.assert(this.canvasInstance.elements.has(t),"lment texte dans la collection"),this.assert(this.canvasInstance.elements.has(r),"lment rectangle dans la collection"),this.logTest("Element Creation",!0),e.n=3;break;case 2:e.p=2,n=e.v,this.logTest("Element Creation",!1,n.message);case 3:return e.a(2)}},e,this,[[0,2]])})),function(){return l.apply(this,arguments)})},{key:"testSelectionSystem",value:(c=w(v().m(function e(){var t,r,n;return v().w(function(e){for(;;)switch(e.p=e.n){case 0:if(e.p=0,this.canvasInstance){e.n=1;break}throw new Error("Canvas instance not available");case 1:t=this.canvasInstance.addElement("rectangle",{x:10,y:10,width:50,height:50}),r=this.canvasInstance.addElement("rectangle",{x:70,y:10,width:50,height:50}),this.canvasInstance.selectionManager.selectElement(t),this.assert(this.canvasInstance.selectionManager.isSelected(t),"lment slectionn"),this.canvasInstance.selectionManager.selectElements([t,r]),this.assert(2===this.canvasInstance.selectionManager.getSelectedElements().length,"Slection multiple"),this.logTest("Selection System",!0),e.n=3;break;case 2:e.p=2,n=e.v,this.logTest("Selection System",!1,n.message);case 3:return e.a(2)}},e,this,[[0,2]])})),function(){return c.apply(this,arguments)})},{key:"testEventHandling",value:(s=w(v().m(function e(){var t,r;return v().w(function(e){for(;;)switch(e.p=e.n){case 0:if(e.p=0,this.canvasInstance){e.n=1;break}throw new Error("Canvas instance not available");case 1:t={type:"mousedown",clientX:100,clientY:100,preventDefault:function(){},stopPropagation:function(){}},this.canvasInstance.eventManager.handleMouseDown(t),this.logTest("Event Handling",!0),e.n=3;break;case 2:e.p=2,r=e.v,this.logTest("Event Handling",!1,r.message);case 3:return e.a(2)}},e,this,[[0,2]])})),function(){return s.apply(this,arguments)})},{key:"assert",value:function(e,t){if(!e)throw new Error("Assertion failed: ".concat(t))}},{key:"logTest",value:function(e,t){var r={name:e,passed:t,error:(arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)||null,timestamp:(new Date).toISOString()};this.results.tests.push(r),t?this.results.passed++:this.results.failed++}},{key:"printResults",value:function(){this.results.failed>0&&this.results.tests.filter(function(e){return!e.passed}).forEach(function(e){})}}],t&&x(e.prototype,t),r&&x(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,r,s,c,l,h,u,g,b,S,k,E,P,C}();window.runPDFCanvasTests=w(v().m(function e(){var t;return v().w(function(e){for(;;)switch(e.n){case 0:return t=new k,e.n=1,t.runAllTests();case 1:return e.a(2,t.results)}},e)})),e.exports&&(e.exports=k);var E=k},557:function(e,t,r){r.d(t,{V:function(){return f}});var n=r(901),i=r(351);function o(e){return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o(e)}function a(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function s(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?a(Object(r),!0).forEach(function(t){c(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function c(e,t,r){return(t=d(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function l(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,o,a,s=[],c=!0,l=!1;try{if(o=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=o.call(r)).done)&&(s.push(n.value),s.length!==t);c=!0);}catch(e){l=!0,i=e}finally{try{if(!c&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(l)throw i}}return s}}(e,t)||function(e,t){if(e){if("string"==typeof e)return h(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?h(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function h(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function u(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,d(n.key),n)}}function d(e){var t=function(e,t){if("object"!=o(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=o(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==o(t)?t:t+""}var f=function(){return e=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.canvasInstance=t,this.propertyHistory=new Map,this.propertyBindings=new Map,this.propertyWatchers=new Map,this.bulkUpdateQueue=new Map,this.config={enableHistory:!0,maxHistorySize:50,enableValidation:!0,enableBindings:!0,enableWatchers:!0,autoSave:!0,debounceMs:100},this.debounceTimers=new Map},t=[{key:"setProperty",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=n.skipValidation,o=void 0!==i&&i,a=n.skipHistory,s=void 0!==a&&a,c=n.skipWatchers,l=void 0!==c&&c,h=n.immediate,u=void 0!==h&&h,d=this.canvasInstance.elements.get(e);if(!d)return!1;if(this.config.enableValidation&&!o){var f=this.validateProperty(d,t,r);if(!f.valid)return!1;r=f.value}var y=d.properties[t];return y===r||(d.properties[t]=r,d.updatedAt=Date.now(),this.config.enableHistory&&!s&&this.addToHistory(e,t,y,r),this.config.enableBindings&&this.processBindings(e,t,r),this.config.enableWatchers&&!l&&this.notifyWatchers(e,t,y,r),u?this.canvasInstance.render():this.scheduleBulkUpdate(e)),!0}},{key:"getProperty",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=this.canvasInstance.elements.get(e);if(!n)return r;var i=n.properties[t];return void 0!==i?i:r}},{key:"setProperties",value:function(e,t){for(var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n={},i=0,o=Object.entries(t);i<o.length;i++){var a=l(o[i],2),c=a[0],h=a[1];n[c]=this.setProperty(e,c,h,s(s({},r),{},{skipHistory:!0,immediate:!1}))}return this.config.enableHistory&&!r.skipHistory&&this.addGroupToHistory(e,t),r.immediate?this.canvasInstance.render():this.scheduleBulkUpdate(e),n}},{key:"getProperties",value:function(e){var t=this.canvasInstance.elements.get(e);return t?s({},t.properties):{}}},{key:"validateProperty",value:function(e,t,r){if(!(0,n.Qn)(e.type,t))return{valid:!1,reason:'Property "'.concat(t,'" not allowed for element type "').concat(e.type,'"'),value:r};var o=i.l.validateProperty(t,r),a=this.validatePropertyByType(t,o,e);return{valid:a.valid,reason:a.reason,value:a.value}}},{key:"validatePropertyByType",value:function(e,t,r){var n=this,i={width:function(e){return n.validateDimension(e,1,2e3)},height:function(e){return n.validateDimension(e,1,2e3)},x:function(e){return n.validateCoordinate(e)},y:function(e){return n.validateCoordinate(e)},backgroundColor:function(e){return n.validateColor(e)},borderColor:function(e){return n.validateColor(e)},color:function(e){return n.validateColor(e)},fontSize:function(e){return n.validateRange(e,8,72)},opacity:function(e){return n.validateRange(e,0,100)},rotation:function(e){return n.validateAngle(e)},scale:function(e){return n.validateRange(e,10,200)}}[e];return i?i(t):{valid:!0,value:t}}},{key:"validateDimension",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2e3;return"number"!=typeof e||e<t||e>r?{valid:!1,reason:"Dimension must be a number between ".concat(t," and ").concat(r),value:Math.max(t,Math.min(r,Number(e)||t))}:{valid:!0,value:e}}},{key:"validateCoordinate",value:function(e){return"number"!=typeof e?{valid:!1,reason:"Coordinate must be a number",value:Number(e)||0}:{valid:!0,value:e}}},{key:"validateColor",value:function(e){if("transparent"===e||""===e)return{valid:!0,value:e};if(/^#[0-9A-Fa-f]{6}$/.test(e)||/^#[0-9A-Fa-f]{3}$/.test(e))return{valid:!0,value:e};var t=document.createElement("div");t.style.color=e;var r=t.style.color;return r&&""!==r?{valid:!0,value:e}:{valid:!1,reason:"Invalid color format",value:"#000000"}}},{key:"validateRange",value:function(e,t,r){return"number"!=typeof e||e<t||e>r?{valid:!1,reason:"Value must be between ".concat(t," and ").concat(r),value:Math.max(t,Math.min(r,Number(e)||t))}:{valid:!0,value:e}}},{key:"validateAngle",value:function(e){if("number"!=typeof e)return{valid:!1,reason:"Angle must be a number",value:Number(e)||0};var t=(e%360+360)%360;return{valid:!0,value:t>180?t-360:t}}},{key:"addToHistory",value:function(e,t,r,n){this.propertyHistory.has(e)||this.propertyHistory.set(e,[]);var i=this.propertyHistory.get(e);i.push({property:t,oldValue:r,newValue:n,timestamp:Date.now()}),i.length>this.config.maxHistorySize&&i.shift()}},{key:"addGroupToHistory",value:function(e,t){this.propertyHistory.has(e)||this.propertyHistory.set(e,[]);var r=this.propertyHistory.get(e);r.push({properties:s({},t),timestamp:Date.now(),type:"group"}),r.length>this.config.maxHistorySize&&r.shift()}},{key:"undoProperty",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=this.propertyHistory.get(e);if(!r||0===r.length)return!1;var n=null;if(t)for(var i=r.length-1;i>=0;i--){var o=r[i];if(o.property===t||"group"===o.type&&o.properties[t]){n=o,r.splice(i,1);break}}else n=r.pop();if(!n)return!1;if("group"===n.type)for(var a=0,s=Object.entries(n.properties);a<s.length;a++){var c=l(s[a],2),h=c[0],u=c[1];this.setProperty(e,h,u,{skipHistory:!0,immediate:!1})}else this.setProperty(e,n.property,n.oldValue,{skipHistory:!0,immediate:!1});return this.scheduleBulkUpdate(e),!0}},{key:"bindProperties",value:function(e,t,r,n){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,o="".concat(e,".").concat(t);this.propertyBindings.has(o)||this.propertyBindings.set(o,[]),this.propertyBindings.get(o).push({targetElementId:r,targetProperty:n,transform:i})}},{key:"unbindProperties",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i="".concat(e,".").concat(t),o=this.propertyBindings.get(i);if(o)if(r&&n){var a=o.findIndex(function(e){return e.targetElementId===r&&e.targetProperty===n});-1!==a&&o.splice(a,1)}else this.propertyBindings.delete(i)}},{key:"processBindings",value:function(e,t,r){var n=this,i="".concat(e,".").concat(t),o=this.propertyBindings.get(i);o&&o.forEach(function(e){var t=r;e.transform&&(t=e.transform(r)),n.setProperty(e.targetElementId,e.targetProperty,t,{skipHistory:!0,skipWatchers:!0,immediate:!1})})}},{key:"watchProperty",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i="".concat(e,".").concat(t);this.propertyWatchers.has(i)||this.propertyWatchers.set(i,[]),this.propertyWatchers.get(i).push({callback:r,options:s({immediate:!1},n)}),n.immediate&&r(this.getProperty(e,t),void 0,{type:"initial"})}},{key:"unwatchProperty",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n="".concat(e,".").concat(t),i=this.propertyWatchers.get(n);if(i)if(r){var o=i.findIndex(function(e){return e.callback===r});-1!==o&&i.splice(o,1)}else this.propertyWatchers.delete(n)}},{key:"notifyWatchers",value:function(e,t,r,n){var i="".concat(e,".").concat(t),o=this.propertyWatchers.get(i);o&&o.forEach(function(i){try{i.callback(n,r,{elementId:e,propertyName:t,type:"change"})}catch(o){}})}},{key:"scheduleBulkUpdate",value:function(e){var t=this;this.debounceTimers.has(e)&&clearTimeout(this.debounceTimers.get(e));var r=setTimeout(function(){t.canvasInstance.render(),t.debounceTimers.delete(e)},this.config.debounceMs);this.debounceTimers.set(e,r)}},{key:"forceUpdate",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;e?(this.debounceTimers.has(e)&&(clearTimeout(this.debounceTimers.get(e)),this.debounceTimers.delete(e)),this.canvasInstance.render()):(this.debounceTimers.forEach(function(e,t){clearTimeout(e)}),this.debounceTimers.clear(),this.canvasInstance.render())}},{key:"getPropertyHistory",value:function(e){return this.propertyHistory.get(e)||[]}},{key:"getPropertyBindings",value:function(e,t){var r="".concat(e,".").concat(t);return this.propertyBindings.get(r)||[]}},{key:"getPropertyWatchers",value:function(e,t){var r="".concat(e,".").concat(t);return this.propertyWatchers.get(r)||[]}},{key:"resetProperties",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=this.canvasInstance.elements.get(e);if(!r)return!1;var n=i.l.getDefaultProperties(r.type),o=t||Object.keys(n),a={};return o.forEach(function(e){n.hasOwnProperty(e)&&(a[e]=n[e])}),this.setProperties(e,a)}},{key:"copyProperties",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=this.getProperties(e),o=this.canvasInstance.elements.get(t);if(!o)return!1;var a=r||Object.keys(i),s={};return a.forEach(function(e){i.hasOwnProperty(e)&&(0,n.Qn)(o.type,e)&&(s[e]=i[e])}),this.setProperties(t,s)}},{key:"configure",value:function(e){this.config=s(s({},this.config),e)}},{key:"getStats",value:function(){return{totalElements:this.canvasInstance.elements.size,totalHistoryEntries:Array.from(this.propertyHistory.values()).reduce(function(e,t){return e+t.length},0),totalBindings:Array.from(this.propertyBindings.values()).reduce(function(e,t){return e+t.length},0),totalWatchers:Array.from(this.propertyWatchers.values()).reduce(function(e,t){return e+t.length},0),pendingUpdates:this.debounceTimers.size}}},{key:"dispose",value:function(){this.debounceTimers.forEach(function(e){return clearTimeout(e)}),this.debounceTimers.clear(),this.propertyHistory.clear(),this.propertyBindings.clear(),this.propertyWatchers.clear(),this.bulkUpdateQueue.clear()}}],t&&u(e.prototype,t),r&&u(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,r}();t.A=f},703:function(e,t,r){function n(e){this.canvasInstance=e,this.isDragging=!1,this.dragElement=null,this.dragOffset=null,this.dropZones=new Map,this.init()}r.d(t,{d:function(){return n}}),e=r.hmd(e),n.prototype.init=function(){this.setupGlobalListeners()},n.prototype.setupGlobalListeners=function(){document.addEventListener("dragstart",this.handleDragStart.bind(this)),document.addEventListener("dragend",this.handleDragEnd.bind(this)),document.addEventListener("dragover",this.handleDragOver.bind(this)),document.addEventListener("drop",this.handleDrop.bind(this))},n.prototype.handleDragStart=function(e){var t=e.target.getAttribute("data-element-type");t&&(this.isDragging=!0,this.dragElement={type:t,properties:this.getDefaultPropertiesForType(t)},e.dataTransfer.effectAllowed="copy",e.dataTransfer.setData("application/json",JSON.stringify(this.dragElement)),document.body.classList.add("pdf-builder-dragging"))},n.prototype.handleDragEnd=function(e){this.isDragging=!1,this.dragElement=null,this.dragOffset=null,document.body.classList.remove("pdf-builder-dragging")},n.prototype.handleDragOver=function(e){try{if(!e||"function"!=typeof e.preventDefault)return;if(!this.isDragging||!this.canvasInstance||!this.canvasInstance.canvas)return;var t=this.canvasInstance.canvas.getBoundingClientRect();if(e.clientX>=t.left&&e.clientX<=t.right&&e.clientY>=t.top&&e.clientY<=t.bottom){e.preventDefault(),e.dataTransfer.dropEffect="copy";var r=this.canvasInstance.getMousePosition(e);this.dragOffset=r,this.canvasInstance.render()}}catch(n){}},n.prototype.handleDrop=function(e){try{if(!(this.isDragging&&this.dragElement&&this.canvasInstance&&this.canvasInstance.canvas))return;var t=this.canvasInstance.canvas.getBoundingClientRect();if(!(e.clientX>=t.left&&e.clientX<=t.right&&e.clientY>=t.top&&e.clientY<=t.bottom))return;e.preventDefault();var r=this.canvasInstance.getMousePosition(e),n=Object.assign({},this.dragElement.properties);n.x=r.x-(n.width||100)/2,n.y=r.y-(n.height||50)/2;var i=this.canvasInstance.addElement(this.dragElement.type,n);this.canvasInstance.selectElement(i),this.canvasInstance.emit("element-dropped",{elementId:i,elementType:this.dragElement.type,position:r}),this.isDragging=!1,this.dragElement=null,this.dragOffset=null}catch(o){}},n.prototype.getDefaultPropertiesForType=function(e){return{text:{content:"Nouveau texte",fontSize:14,fontFamily:"Arial",color:"#000000",width:200,height:50},rectangle:{fillColor:"#ffffff",strokeColor:"#000000",strokeWidth:1,width:100,height:100},circle:{fillColor:"#ffffff",strokeColor:"#000000",strokeWidth:1,radius:50},line:{strokeColor:"#000000",strokeWidth:2,x2:100,y2:0},image:{src:"",width:100,height:100},product_table:{x:50,y:100,width:500,height:200,showHeaders:!0,showBorders:!0,fontSize:12,backgroundColor:"#ffffff",borderColor:"#e5e7eb",borderWidth:1},customer_info:{x:50,y:50,width:250,height:120,showHeaders:!0,showBorders:!1,fontSize:12,backgroundColor:"transparent",layout:"vertical"},company_info:{x:320,y:50,width:250,height:120,showHeaders:!0,showBorders:!1,fontSize:12,backgroundColor:"transparent",layout:"vertical"},company_logo:{x:50,y:200,width:150,height:80,fit:"contain",alignment:"left"},order_number:{x:450,y:20,width:100,height:30,fontSize:14,fontFamily:"Arial",textAlign:"right",backgroundColor:"transparent"},"dynamic-text":{x:50,y:320,width:200,height:40,template:"Commande #{order_number}",fontSize:14,fontFamily:"Arial",backgroundColor:"transparent"},mentions:{x:50,y:380,width:500,height:60,fontSize:10,fontFamily:"Arial",textAlign:"left",backgroundColor:"transparent"}}[e]||{}},n.prototype.render=function(e){if(this.isDragging&&this.dragOffset&&this.dragElement){e.save(),e.globalAlpha=.7,e.strokeStyle="#007bff",e.lineWidth=2,e.setLineDash([5,5]);var t=this.dragElement.properties,r=this.dragOffset.x-(t.width||100)/2,n=this.dragOffset.y-(t.height||50)/2,i=t.width||100,o=t.height||50;e.strokeRect(r,n,i,o),e.globalAlpha=1,e.fillStyle="#007bff",e.font="12px Arial",e.textAlign="center",e.fillText(this.dragElement.type,r+i/2,n+o/2),e.restore()}},n.prototype.registerDropZone=function(e,t){this.dropZones.set(e,t)},n.prototype.unregisterDropZone=function(e){this.dropZones.delete(e)},n.prototype.dispose=function(){document.removeEventListener("dragstart",this.handleDragStart.bind(this)),document.removeEventListener("dragend",this.handleDragEnd.bind(this)),document.removeEventListener("dragover",this.handleDragOver.bind(this)),document.removeEventListener("drop",this.handleDrop.bind(this)),this.dropZones.clear()},e.exports&&(e.exports=n)},718:function(e,t,r){function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function i(e){return function(e){if(Array.isArray(e))return u(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||h(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=h(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==r.return||r.return()}finally{if(s)throw o}}}}function a(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function s(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?a(Object(r),!0).forEach(function(t){c(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function c(e,t,r){return(t=f(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function l(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,o,a,s=[],c=!0,l=!1;try{if(o=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=o.call(r)).done)&&(s.push(n.value),s.length!==t);c=!0);}catch(e){l=!0,i=e}finally{try{if(!c&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(l)throw i}}return s}}(e,t)||h(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function h(e,t){if(e){if("string"==typeof e)return u(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?u(e,t):void 0}}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function d(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,f(n.key),n)}}function f(e){var t=function(e,t){if("object"!=n(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=n(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==n(t)?t:t+""}r.d(t,{g:function(){return y}});var y=function(){return e=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.canvasInstance=t,this.layers=new Map,this.layerOrder=[],this.activeLayerId=null,this.layerGroups=new Map,this.config={maxLayers:100,defaultLayerName:"Layer",autoCreateLayers:!0,showLayerBounds:!1,enableLayerLocking:!0,enableLayerVisibility:!0,snapToLayerBounds:!1},this.createLayer("default",{name:"Default Layer",visible:!0,locked:!1,opacity:100,blendMode:"normal"})},t=[{key:"createLayer",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this.layers.size>=this.config.maxLayers)throw new Error("Maximum number of layers (".concat(this.config.maxLayers,") reached"));if(this.layers.has(e))throw new Error('Layer with id "'.concat(e,'" already exists'));var r={id:e,name:t.name||"".concat(this.config.defaultLayerName," ").concat(this.layers.size+1),visible:!1!==t.visible,locked:t.locked||!1,opacity:t.opacity||100,blendMode:t.blendMode||"normal",elements:new Set,bounds:null,createdAt:Date.now(),updatedAt:Date.now(),metadata:t.metadata||{}};return this.layers.set(e,r),this.layerOrder.push(e),this.activeLayerId||(this.activeLayerId=e),this.emitLayerEvent("layer-created",r),r}},{key:"deleteLayer",value:function(e){var t=this,r=this.layers.get(e);if(!r)return!1;if(1===this.layers.size)throw new Error("Cannot delete the last remaining layer");var n=this.activeLayerId!==e?this.activeLayerId:"default";return this.layers.get(n)&&r.elements.forEach(function(e){t.moveElementToLayer(e,n)}),this.layers.delete(e),this.layerOrder=this.layerOrder.filter(function(t){return t!==e}),this.activeLayerId===e&&(this.activeLayerId=this.layerOrder[0]||null),this.emitLayerEvent("layer-deleted",{id:e}),this.canvasInstance.render(),!0}},{key:"getLayer",value:function(e){return this.layers.get(e)||null}},{key:"getAllLayers",value:function(){return Array.from(this.layers.values())}},{key:"getLayersInOrder",value:function(){var e=this;return this.layerOrder.map(function(t){return e.layers.get(t)}).filter(function(e){return e})}},{key:"setActiveLayer",value:function(e){if(!this.layers.has(e))throw new Error('Layer "'.concat(e,'" does not exist'));var t=this.activeLayerId;return this.activeLayerId=e,this.emitLayerEvent("active-layer-changed",{previous:t,current:e}),!0}},{key:"getActiveLayer",value:function(){return this.layers.get(this.activeLayerId)||null}},{key:"updateLayer",value:function(e,t){var r=this.layers.get(e);if(!r)return!1;for(var n={},i=0,o=Object.entries(t);i<o.length;i++){var a=l(o[i],2),c=a[0],h=a[1];r.hasOwnProperty(c)&&(n[c]=r[c],r[c]=h)}return r.updatedAt=Date.now(),this.emitLayerEvent("layer-updated",{id:e,changes:n,layer:s({},r)}),this.canvasInstance.render(),!0}},{key:"addElementToLayer",value:function(e,t){var r=this.layers.get(t);return!!r&&(this.removeElementFromLayer(e),r.elements.add(e),this.updateLayerBounds(t),this.emitLayerEvent("element-added-to-layer",{elementId:e,layerId:t}),!0)}},{key:"removeElementFromLayer",value:function(e){var t,r=o(this.layers.values());try{for(r.s();!(t=r.n()).done;){var n=t.value;if(n.elements.has(e))return n.elements.delete(e),this.updateLayerBounds(n.id),this.emitLayerEvent("element-removed-from-layer",{elementId:e,layerId:n.id}),!0}}catch(i){r.e(i)}finally{r.f()}return!1}},{key:"moveElementToLayer",value:function(e,t){return this.addElementToLayer(e,t)}},{key:"getElementLayer",value:function(e){var t,r=o(this.layers);try{for(r.s();!(t=r.n()).done;){var n=l(t.value,2),i=(n[0],n[1]);if(i.elements.has(e))return i}}catch(a){r.e(a)}finally{r.f()}return null}},{key:"getLayerElements",value:function(e){var t=this.layers.get(e);if(!t)return[];var r,n=[],i=o(t.elements);try{for(i.s();!(r=i.n()).done;){var a=r.value,s=this.canvasInstance.elements.get(a);s&&n.push(s)}}catch(c){i.e(c)}finally{i.f()}return n}},{key:"reorderLayers",value:function(e){var t=new Set(this.layerOrder),r=new Set(e);if(t.size!==r.size||!e.every(function(e){return t.has(e)}))throw new Error("Invalid layer order: must contain all existing layer IDs");this.layerOrder=i(e),this.emitLayerEvent("layers-reordered",{newOrder:i(this.layerOrder)}),this.canvasInstance.render()}},{key:"moveLayerUp",value:function(e){var t=this.layerOrder.indexOf(e);if(t>0){var r=[this.layerOrder[t-1],this.layerOrder[t]];this.layerOrder[t]=r[0],this.layerOrder[t-1]=r[1],this.reorderLayers(this.layerOrder)}}},{key:"moveLayerDown",value:function(e){var t=this.layerOrder.indexOf(e);if(t<this.layerOrder.length-1){var r=[this.layerOrder[t+1],this.layerOrder[t]];this.layerOrder[t]=r[0],this.layerOrder[t+1]=r[1],this.reorderLayers(this.layerOrder)}}},{key:"bringLayerToFront",value:function(e){var t=this.layerOrder.indexOf(e);-1!==t&&t<this.layerOrder.length-1&&(this.layerOrder.splice(t,1),this.layerOrder.push(e),this.reorderLayers(this.layerOrder))}},{key:"sendLayerToBack",value:function(e){var t=this.layerOrder.indexOf(e);t>0&&(this.layerOrder.splice(t,1),this.layerOrder.unshift(e),this.reorderLayers(this.layerOrder))}},{key:"mergeLayers",value:function(e,t){var r=this,n=this.layers.get(e),i=this.layers.get(t);return!(!n||!i)&&(n.elements.forEach(function(e){r.moveElementToLayer(e,t)}),this.deleteLayer(e))}},{key:"duplicateLayer",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=this.layers.get(e);if(!n)return null;var i="layer_".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9)),o=this.createLayer(i,{name:r||"".concat(n.name," Copy"),visible:n.visible,locked:n.locked,opacity:n.opacity,blendMode:n.blendMode,metadata:s({},n.metadata)});return n.elements.forEach(function(e){var r=t.canvasInstance.elements.get(e);if(r){var n=r.properties||{},o=t.canvasInstance.addElement(r.type,s(s({},n),{},{x:(n.x||0)+20,y:(n.y||0)+20}));t.addElementToLayer(o,i)}}),o}},{key:"createLayerGroup",value:function(e,t){var r=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(this.layerGroups.has(e))throw new Error('Layer group "'.concat(e,'" already exists'));var o=t.filter(function(e){return!r.layers.has(e)});if(o.length>0)throw new Error("Invalid layer IDs: ".concat(o.join(", ")));var a={id:e,name:n.name||"Group ".concat(e),layerIds:i(t),visible:!1!==n.visible,locked:n.locked||!1,opacity:n.opacity||100,createdAt:Date.now(),metadata:n.metadata||{}};return this.layerGroups.set(e,a),this.emitLayerEvent("layer-group-created",a),a}},{key:"deleteLayerGroup",value:function(e){return!!this.layerGroups.has(e)&&(this.layerGroups.delete(e),this.emitLayerEvent("layer-group-deleted",{id:e}),!0)}},{key:"updateLayerBounds",value:function(e){var t=this.layers.get(e);if(t){var r=this.getLayerElements(e);if(0!==r.length){var n=1/0,i=1/0,o=-1/0,a=-1/0;r.forEach(function(e){var t=e.properties;n=Math.min(n,t.x),i=Math.min(i,t.y),o=Math.max(o,t.x+t.width),a=Math.max(a,t.y+t.height)}),t.bounds={x:n,y:i,width:o-n,height:a-a}}else t.bounds=null}}},{key:"updateAllLayerBounds",value:function(){var e,t=o(this.layers.keys());try{for(t.s();!(e=t.n()).done;){var r=e.value;this.updateLayerBounds(r)}}catch(n){t.e(n)}finally{t.f()}}},{key:"render",value:function(e){var t,r=o(this.getLayersInOrder());try{for(r.s();!(t=r.n()).done;){var n=t.value;n.visible&&(e.save(),n.opacity<100&&(e.globalAlpha=n.opacity/100),"normal"!==n.blendMode&&(e.globalCompositeOperation=n.blendMode),this.renderLayerElements(e,n),this.config.showLayerBounds&&n.bounds&&this.renderLayerBounds(e,n),e.restore())}}catch(i){r.e(i)}finally{r.f()}}},{key:"renderLayerElements",value:function(e,t){var r,n=o(t.elements);try{for(n.s();!(r=n.n()).done;){var i=r.value,a=this.canvasInstance.elements.get(i);a&&this.canvasInstance.renderElement(a)}}catch(s){n.e(s)}finally{n.f()}}},{key:"renderLayerBounds",value:function(e,t){t.bounds&&(e.strokeStyle="#007bff",e.lineWidth=1,e.setLineDash([5,5]),e.strokeRect(t.bounds.x,t.bounds.y,t.bounds.width,t.bounds.height),e.setLineDash([]))}},{key:"isLayerVisible",value:function(e){var t=this.layers.get(e);return!!t&&t.visible}},{key:"isLayerLocked",value:function(e){var t=this.layers.get(e);return!!t&&t.locked}},{key:"getLayerStats",value:function(){var e,t={totalLayers:this.layers.size,visibleLayers:0,lockedLayers:0,totalElements:0,layerElementCounts:{},activeLayer:this.activeLayerId,layerGroups:this.layerGroups.size},r=o(this.layers);try{for(r.s();!(e=r.n()).done;){var n=l(e.value,2),i=n[0],a=n[1];a.visible&&t.visibleLayers++,a.locked&&t.lockedLayers++;var s=a.elements.size;t.totalElements+=s,t.layerElementCounts[i]=s}}catch(c){r.e(c)}finally{r.f()}return t}},{key:"exportLayers",value:function(){return{layers:Array.from(this.layers.entries()),layerOrder:i(this.layerOrder),activeLayerId:this.activeLayerId,layerGroups:Array.from(this.layerGroups.entries()),config:s({},this.config)}}},{key:"importLayers",value:function(e){var t=this;try{return this.layers.clear(),this.layerOrder=[],this.layerGroups.clear(),e.layers.forEach(function(e){var r=l(e,2),n=r[0],i=r[1];t.layers.set(n,s(s({},i),{},{elements:new Set(i.elements)}))}),this.layerOrder=i(e.layerOrder),this.activeLayerId=e.activeLayerId,e.layerGroups.forEach(function(e){var r=l(e,2),n=r[0],i=r[1];t.layerGroups.set(n,s({},i))}),e.config&&(this.config=s(s({},this.config),e.config)),this.emitLayerEvent("layers-imported",e),!0}catch(r){return!1}}},{key:"emitLayerEvent",value:function(e,t){if(this.canvasInstance.canvas){var r=new CustomEvent("layer-".concat(e),{detail:t,bubbles:!0});this.canvasInstance.canvas.dispatchEvent(r)}}},{key:"configure",value:function(e){this.config=s(s({},this.config),e)}},{key:"dispose",value:function(){this.layers.clear(),this.layerOrder=[],this.layerGroups.clear(),this.activeLayerId=null}}],t&&d(e.prototype,t),r&&d(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,r}();t.A=y},730:function(e,t,r){function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function i(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,o,a,s=[],c=!0,l=!1;try{if(o=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=o.call(r)).done)&&(s.push(n.value),s.length!==t);c=!0);}catch(e){l=!0,i=e}finally{try{if(!c&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(l)throw i}}return s}}(e,t)||a(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=a(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,c=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return s=e.done,e},e:function(e){c=!0,o=e},f:function(){try{s||null==r.return||r.return()}finally{if(c)throw o}}}}function a(e,t){if(e){if("string"==typeof e)return s(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?s(e,t):void 0}}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function c(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function l(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?c(Object(r),!0).forEach(function(t){h(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):c(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function h(e,t,r){return(t=m(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function u(){var e,t,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",i=r.toStringTag||"@@toStringTag";function o(r,n,i,o){var c=n&&n.prototype instanceof s?n:s,l=Object.create(c.prototype);return d(l,"_invoke",function(r,n,i){var o,s,c,l=0,h=i||[],u=!1,d={p:0,n:0,v:e,a:f,f:f.bind(e,4),d:function(t,r){return o=t,s=0,c=e,d.n=r,a}};function f(r,n){for(s=r,c=n,t=0;!u&&l&&!i&&t<h.length;t++){var i,o=h[t],f=d.p,y=o[2];r>3?(i=y===n)&&(c=o[(s=o[4])?5:(s=3,3)],o[4]=o[5]=e):o[0]<=f&&((i=r<2&&f<o[1])?(s=0,d.v=n,d.n=o[1]):f<y&&(i=r<3||o[0]>n||n>y)&&(o[4]=r,o[5]=n,d.n=y,s=0))}if(i||r>1)return a;throw u=!0,n}return function(i,h,y){if(l>1)throw TypeError("Generator is already running");for(u&&1===h&&f(h,y),s=h,c=y;(t=s<2?e:c)||!u;){o||(s?s<3?(s>1&&(d.n=-1),f(s,c)):d.n=c:d.v=c);try{if(l=2,o){if(s||(i="next"),t=o[i]){if(!(t=t.call(o,c)))throw TypeError("iterator result is not an object");if(!t.done)return t;c=t.value,s<2&&(s=0)}else 1===s&&(t=o.return)&&t.call(o),s<2&&(c=TypeError("The iterator does not provide a '"+i+"' method"),s=1);o=e}else if((t=(u=d.n<0)?c:r.call(n,d))!==a)break}catch(t){o=e,s=1,c=t}finally{l=1}}return{value:t,done:u}}}(r,i,o),!0),l}var a={};function s(){}function c(){}function l(){}t=Object.getPrototypeOf;var h=[][n]?t(t([][n]())):(d(t={},n,function(){return this}),t),f=l.prototype=s.prototype=Object.create(h);function y(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,l):(e.__proto__=l,d(e,i,"GeneratorFunction")),e.prototype=Object.create(f),e}return c.prototype=l,d(f,"constructor",l),d(l,"constructor",c),c.displayName="GeneratorFunction",d(l,i,"GeneratorFunction"),d(f),d(f,i,"Generator"),d(f,n,function(){return this}),d(f,"toString",function(){return"[object Generator]"}),(u=function(){return{w:o,m:y}})()}function d(e,t,r,n){var i=Object.defineProperty;try{i({},"",{})}catch(e){i=0}d=function(e,t,r,n){function o(t,r){d(e,t,function(e){return this._invoke(t,r,e)})}t?i?i(e,t,{value:r,enumerable:!n,configurable:!n,writable:!n}):e[t]=r:(o("next",0),o("throw",1),o("return",2))},d(e,t,r,n)}function f(e,t,r,n,i,o,a){try{var s=e[o](a),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,i)}function y(e){return function(){var t=this,r=arguments;return new Promise(function(n,i){var o=e.apply(t,r);function a(e){f(o,n,i,a,s,"next",e)}function s(e){f(o,n,i,a,s,"throw",e)}a(void 0)})}}function p(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,m(n.key),n)}}function m(e){var t=function(e,t){if("object"!=n(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=n(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==n(t)?t:t+""}r.d(t,{M:function(){return v}});var v=function(){return e=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.canvasInstance=t,this.jspdf=null,this.config={format:"a4",orientation:"portrait",unit:"mm",quality:2,compression:"FAST",includeMetadata:!0,includeLayers:!0,backgroundColor:"#ffffff",margin:{top:10,right:10,bottom:10,left:10},dpi:300,filename:"pdf-builder-export.pdf"},this.isExporting=!1,this.exportProgress=0,this.exportCallbacks={onProgress:null,onComplete:null,onError:null}},t=[{key:"initializeJSPDF",value:(b=y(u().m(function e(){var t;return u().w(function(e){for(;;)switch(e.p=e.n){case 0:if(!this.jspdf){e.n=1;break}return e.a(2,this.jspdf);case 1:if(e.p=1,"undefined"==typeof window||window.jspdf){e.n=2;break}return e.n=2,this.loadJSPDF();case 2:return t=window.jspdf.jsPDF,this.jspdf=t,e.a(2,this.jspdf);case 3:throw e.p=3,e.v,new Error("jsPDF library is required for PDF export");case 4:return e.a(2)}},e,this,[[1,3]])})),function(){return b.apply(this,arguments)})},{key:"loadJSPDF",value:(g=y(u().m(function e(){return u().w(function(e){for(;;)if(0===e.n)return e.a(2,new Promise(function(e,t){var r=document.createElement("script");r.src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js",r.onload=e,r.onerror=t,document.head.appendChild(r)}))},e)})),function(){return g.apply(this,arguments)})},{key:"exportToPDF",value:(v=y(u().m(function e(){var t,r,n,i,o,a,s,c,h,d,f,y,p,m,v,g,b,w,x=arguments;return u().w(function(e){for(;;)switch(e.p=e.n){case 0:if(t=x.length>0&&void 0!==x[0]?x[0]:{},!this.isExporting){e.n=1;break}throw new Error("Export already in progress");case 1:return this.isExporting=!0,this.exportProgress=0,e.p=2,r=l(l({},this.config),t),e.n=3,this.initializeJSPDF();case 3:return n=new this.jspdf({orientation:r.orientation,unit:r.unit,format:r.format,compress:"NONE"!==r.compression}),i=n.internal.pageSize.getWidth(),o=n.internal.pageSize.getHeight(),a=i-r.margin.left-r.margin.right,s=o-r.margin.top-r.margin.bottom,c=this.getCanvasBounds(),h=a/c.width,d=s/c.height,f=Math.min(h,d)*r.quality,y=r.margin.left,p=r.margin.top,r.includeMetadata&&this.addPDFMetadata(n,r),e.n=4,this.convertLayersToImages(f,r);case 4:for(m=e.v,this.emitProgress(20),v=0;v<m.length;v++)g=m[v],v>0&&n.addPage(),n.addImage(g.data,g.format,y,p,g.width/r.quality,g.height/r.quality),this.emitProgress(20+v/m.length*60);return this.emitProgress(90),b=r.filename||this.config.filename,n.save(b),this.emitProgress(100),this.emitComplete({filename:b,pageCount:m.length}),e.a(2,{success:!0,filename:b,pageCount:m.length});case 5:throw e.p=5,w=e.v,this.emitError(w),w;case 6:return e.p=6,this.isExporting=!1,this.exportProgress=0,e.f(6);case 7:return e.a(2)}},e,this,[[2,5,6,7]])})),function(){return v.apply(this,arguments)})},{key:"convertLayersToImages",value:(m=y(u().m(function e(t,r){var n,i,a,s,c,l,h;return u().w(function(e){for(;;)switch(e.p=e.n){case 0:n=this.canvasInstance.layersManager.getLayersInOrder(),i=[],a=o(n),e.p=1,a.s();case 2:if((s=a.n()).done){e.n=6;break}if((c=s.value).visible||!r.includeLayers){e.n=3;break}return e.a(3,5);case 3:return e.n=4,this.convertLayerToImage(c,t,r);case 4:(l=e.v)&&i.push(l);case 5:e.n=2;break;case 6:e.n=8;break;case 7:e.p=7,h=e.v,a.e(h);case 8:return e.p=8,a.f(),e.f(8);case 9:return e.a(2,i)}},e,this,[[1,7,8,9]])})),function(e,t){return m.apply(this,arguments)})},{key:"convertLayerToImage",value:(f=y(u().m(function e(t,r,n){var i,a,s,c,l,h,d,f,y;return u().w(function(e){for(;;)switch(e.p=e.n){case 0:i=document.createElement("canvas"),a=i.getContext("2d"),s=this.getCanvasBounds(),i.width=s.width*r,i.height=s.height*r,a.scale(r,r),a.fillStyle=n.backgroundColor,a.fillRect(0,0,s.width,s.height),t.opacity<100&&(a.globalAlpha=t.opacity/100),"normal"!==t.blendMode&&(a.globalCompositeOperation=t.blendMode),c=this.canvasInstance.layersManager.getLayerElements(t.id),l=o(c),e.p=1,l.s();case 2:if((h=l.n()).done){e.n=4;break}return d=h.value,e.n=3,this.renderElementToCanvas(a,d);case 3:e.n=2;break;case 4:e.n=6;break;case 5:e.p=5,y=e.v,l.e(y);case 6:return e.p=6,l.f(),e.f(6);case 7:return f=i.toDataURL("image/png",.95),e.a(2,{data:f,format:"PNG",width:i.width,height:i.height,layerId:t.id,layerName:t.name})}},e,this,[[1,5,6,7]])})),function(e,t,r){return f.apply(this,arguments)})},{key:"renderElementToCanvas",value:(d=y(u().m(function e(t,r){var n,i;return u().w(function(e){for(;;)switch(e.n){case 0:n=r.properties,t.save(),n.rotation?(t.translate(n.x+n.width/2,n.y+n.height/2),t.rotate(n.rotation*Math.PI/180),t.translate(-n.width/2,-n.height/2)):t.translate(n.x,n.y),void 0!==n.opacity&&(t.globalAlpha=n.opacity/100),i=r.type,e.n="text"===i?1:"rectangle"===i?2:"circle"===i?3:"line"===i?4:"image"===i?5:7;break;case 1:return this.renderTextElement(t,n),e.a(3,8);case 2:return this.renderRectangleElement(t,n),e.a(3,8);case 3:return this.renderCircleElement(t,n),e.a(3,8);case 4:return this.renderLineElement(t,n),e.a(3,8);case 5:return e.n=6,this.renderImageElement(t,n);case 6:return e.a(3,8);case 7:this.canvasInstance.renderElement(r,t);case 8:t.restore();case 9:return e.a(2)}},e,this)})),function(e,t){return d.apply(this,arguments)})},{key:"renderTextElement",value:function(e,t){e.fillStyle=t.color||"#000000",e.font="".concat(t.fontSize||12,"px ").concat(t.fontFamily||"Arial"),t.bold&&(e.font="bold ".concat(e.font)),t.italic&&(e.font="italic ".concat(e.font)),e.textAlign=t.textAlign||"left",e.textBaseline="top";var r=(t.text||"").split("\n"),n=t.lineHeight||1.2,i=0;r.forEach(function(r){e.fillText(r,0,i),i+=(t.fontSize||12)*n})}},{key:"renderRectangleElement",value:function(e,t){e.fillStyle=t.fillColor||"transparent",e.strokeStyle=t.strokeColor||"#000000",e.lineWidth=t.strokeWidth||1,t.fillColor&&e.fillRect(0,0,t.width,t.height),t.strokeColor&&t.strokeWidth>0&&e.strokeRect(0,0,t.width,t.height)}},{key:"renderCircleElement",value:function(e,t){var r=t.width/2,n=t.height/2,i=Math.min(t.width,t.height)/2;e.beginPath(),e.arc(r,n,i,0,2*Math.PI),e.fillStyle=t.fillColor||"transparent",e.strokeStyle=t.strokeColor||"#000000",e.lineWidth=t.strokeWidth||1,t.fillColor&&e.fill(),t.strokeColor&&t.strokeWidth>0&&e.stroke()}},{key:"renderLineElement",value:function(e,t){e.strokeStyle=t.strokeColor||"#000000",e.lineWidth=t.strokeWidth||1,e.lineCap=t.lineCap||"butt",e.lineJoin=t.lineJoin||"miter",e.beginPath(),e.moveTo(0,0),e.lineTo(t.width,t.height),e.stroke()}},{key:"renderImageElement",value:(h=y(u().m(function e(t,r){var n;return u().w(function(e){for(;;)switch(e.p=e.n){case 0:if(r.imageSrc){e.n=1;break}return e.a(2);case 1:return e.p=1,n=new Image,e.n=2,new Promise(function(e,t){n.onload=e,n.onerror=t,n.src=r.imageSrc});case 2:t.drawImage(n,0,0,r.width,r.height),e.n=4;break;case 3:e.p=3,e.v,t.strokeStyle="#ff0000",t.lineWidth=2,t.strokeRect(0,0,r.width,r.height);case 4:return e.a(2)}},e,null,[[1,3]])})),function(e,t){return h.apply(this,arguments)})},{key:"getCanvasBounds",value:function(){var e=Array.from(this.canvasInstance.elements.values());if(0===e.length)return{x:0,y:0,width:800,height:600};var t=1/0,r=1/0,n=-1/0,i=-1/0;return e.forEach(function(e){var o=e.properties;t=Math.min(t,o.x),r=Math.min(r,o.y),n=Math.max(n,o.x+o.width),i=Math.max(i,o.y+o.height)}),{x:t,y:r,width:n-t,height:i-r}}},{key:"addPDFMetadata",value:function(e,t){var r=new Date;if(e.setProperties({title:"PDF Builder Export",subject:"Generated PDF Document",author:"PDF Builder Pro",creator:"PDF Builder Pro",creationDate:r,modDate:r}),t.includeMetadata){var n=this.canvasInstance.getStats();e.setKeywords(["elements: ".concat(n.totalElements),"layers: ".concat(n.totalLayers),"exported: ".concat(r.toISOString()),"pdf-builder-pro"])}}},{key:"exportToFormat",value:(c=y(u().m(function e(t){var r,n,i=arguments;return u().w(function(e){for(;;)switch(e.n){case 0:r=i.length>1&&void 0!==i[1]?i[1]:{},n=t.toLowerCase(),e.n="pdf"===n?1:"png"===n?3:"jpeg"===n||"jpg"===n?5:"svg"===n?7:9;break;case 1:return e.n=2,this.exportToPDF(r);case 2:case 4:case 6:case 8:return e.a(2,e.v);case 3:return e.n=4,this.exportToPNG(r);case 5:return e.n=6,this.exportToJPEG(r);case 7:return e.n=8,this.exportToSVG(r);case 9:throw new Error("Unsupported export format: ".concat(t));case 10:return e.a(2)}},e,this)})),function(e){return c.apply(this,arguments)})},{key:"exportToPNG",value:(s=y(u().m(function e(){var t,r,n,i,o,a,s=arguments;return u().w(function(e){for(;;)if(0===e.n)return t=s.length>0&&void 0!==s[0]?s[0]:{},r=l(l({},this.config),t),n=this.canvasInstance.canvas,i=document.createElement("canvas"),o=i.getContext("2d"),i.width=n.width*r.quality,i.height=n.height*r.quality,o.scale(r.quality,r.quality),o.fillStyle=r.backgroundColor,o.fillRect(0,0,n.width,n.height),o.drawImage(n,0,0),a=i.toDataURL("image/png",.95),this.downloadDataURL(a,r.filename.replace(".pdf",".png")),e.a(2,{success:!0,format:"png"})},e,this)})),function(){return s.apply(this,arguments)})},{key:"exportToJPEG",value:(a=y(u().m(function e(){var t,r,n,i,o,a,s=arguments;return u().w(function(e){for(;;)if(0===e.n)return t=s.length>0&&void 0!==s[0]?s[0]:{},r=l(l({},this.config),t),n=this.canvasInstance.canvas,i=document.createElement("canvas"),o=i.getContext("2d"),i.width=n.width*r.quality,i.height=n.height*r.quality,o.scale(r.quality,r.quality),o.fillStyle=r.backgroundColor,o.fillRect(0,0,n.width,n.height),o.drawImage(n,0,0),a=i.toDataURL("image/jpeg",.95),this.downloadDataURL(a,r.filename.replace(".pdf",".jpg")),e.a(2,{success:!0,format:"jpeg"})},e,this)})),function(){return a.apply(this,arguments)})},{key:"exportToSVG",value:(n=y(u().m(function e(){var t,r,n,a,s,c,h,d,f,y,p=arguments;return u().w(function(e){for(;;)if(0===e.n){t=p.length>0&&void 0!==p[0]?p[0]:{},r=l(l({},this.config),t),n=this.getCanvasBounds(),a='<svg width="'.concat(n.width,'" height="').concat(n.height,'" xmlns="http://www.w3.org/2000/svg">'),a+='<rect width="100%" height="100%" fill="'.concat(r.backgroundColor,'"/>'),s=o(this.canvasInstance.elements);try{for(s.s();!(c=s.n()).done;)(h=i(c.value,2))[0],d=h[1],a+=this.elementToSVG(d)}catch(u){s.e(u)}finally{s.f()}return a+="</svg>",f=new Blob([a],{type:"image/svg+xml"}),y=URL.createObjectURL(f),this.downloadDataURL(y,r.filename.replace(".pdf",".svg")),e.a(2,{success:!0,format:"svg"})}},e,this)})),function(){return n.apply(this,arguments)})},{key:"elementToSVG",value:function(e){var t=e.properties;switch(e.type){case"rectangle":return'<rect x="'.concat(t.x,'" y="').concat(t.y,'" width="').concat(t.width,'" height="').concat(t.height,'" fill="').concat(t.fillColor||"transparent",'" stroke="').concat(t.strokeColor||"#000",'" stroke-width="').concat(t.strokeWidth||1,'"/>');case"circle":var r=t.x+t.width/2,n=t.y+t.height/2,i=Math.min(t.width,t.height)/2;return'<circle cx="'.concat(r,'" cy="').concat(n,'" r="').concat(i,'" fill="').concat(t.fillColor||"transparent",'" stroke="').concat(t.strokeColor||"#000",'" stroke-width="').concat(t.strokeWidth||1,'"/>');case"text":return'<text x="'.concat(t.x,'" y="').concat(t.y+(t.fontSize||12),'" font-family="').concat(t.fontFamily||"Arial",'" font-size="').concat(t.fontSize||12,'" fill="').concat(t.color||"#000",'">').concat(t.text||"","</text>");default:return""}}},{key:"downloadDataURL",value:function(e,t){var r=document.createElement("a");r.href=e,r.download=t,document.body.appendChild(r),r.click(),document.body.removeChild(r)}},{key:"configure",value:function(e){this.config=l(l({},this.config),e)}},{key:"setCallbacks",value:function(e){this.exportCallbacks=l(l({},this.exportCallbacks),e)}},{key:"emitProgress",value:function(e){this.exportProgress=e,this.exportCallbacks.onProgress&&this.exportCallbacks.onProgress(e)}},{key:"emitComplete",value:function(e){this.exportCallbacks.onComplete&&this.exportCallbacks.onComplete(e)}},{key:"emitError",value:function(e){this.exportCallbacks.onError&&this.exportCallbacks.onError(e)}},{key:"getSupportedFormats",value:function(){return["pdf","png","jpeg","jpg","svg"]}},{key:"getExportStats",value:function(){return{isExporting:this.isExporting,progress:this.exportProgress,supportedFormats:this.getSupportedFormats(),config:l({},this.config)}}},{key:"dispose",value:function(){this.exportCallbacks={onProgress:null,onComplete:null,onError:null},this.isExporting=!1,this.exportProgress=0}}],t&&p(e.prototype,t),r&&p(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,r,n,a,s,c,h,d,f,m,v,g,b}();t.A=v},878:function(e,t,r){function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function i(){var e,t,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",a=r.toStringTag||"@@toStringTag";function s(r,n,i,a){var s=n&&n.prototype instanceof l?n:l,h=Object.create(s.prototype);return o(h,"_invoke",function(r,n,i){var o,a,s,l=0,h=i||[],u=!1,d={p:0,n:0,v:e,a:f,f:f.bind(e,4),d:function(t,r){return o=t,a=0,s=e,d.n=r,c}};function f(r,n){for(a=r,s=n,t=0;!u&&l&&!i&&t<h.length;t++){var i,o=h[t],f=d.p,y=o[2];r>3?(i=y===n)&&(s=o[(a=o[4])?5:(a=3,3)],o[4]=o[5]=e):o[0]<=f&&((i=r<2&&f<o[1])?(a=0,d.v=n,d.n=o[1]):f<y&&(i=r<3||o[0]>n||n>y)&&(o[4]=r,o[5]=n,d.n=y,a=0))}if(i||r>1)return c;throw u=!0,n}return function(i,h,y){if(l>1)throw TypeError("Generator is already running");for(u&&1===h&&f(h,y),a=h,s=y;(t=a<2?e:s)||!u;){o||(a?a<3?(a>1&&(d.n=-1),f(a,s)):d.n=s:d.v=s);try{if(l=2,o){if(a||(i="next"),t=o[i]){if(!(t=t.call(o,s)))throw TypeError("iterator result is not an object");if(!t.done)return t;s=t.value,a<2&&(a=0)}else 1===a&&(t=o.return)&&t.call(o),a<2&&(s=TypeError("The iterator does not provide a '"+i+"' method"),a=1);o=e}else if((t=(u=d.n<0)?s:r.call(n,d))!==c)break}catch(t){o=e,a=1,s=t}finally{l=1}}return{value:t,done:u}}}(r,i,a),!0),h}var c={};function l(){}function h(){}function u(){}t=Object.getPrototypeOf;var d=[][n]?t(t([][n]())):(o(t={},n,function(){return this}),t),f=u.prototype=l.prototype=Object.create(d);function y(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,u):(e.__proto__=u,o(e,a,"GeneratorFunction")),e.prototype=Object.create(f),e}return h.prototype=u,o(f,"constructor",u),o(u,"constructor",h),h.displayName="GeneratorFunction",o(u,a,"GeneratorFunction"),o(f),o(f,a,"Generator"),o(f,n,function(){return this}),o(f,"toString",function(){return"[object Generator]"}),(i=function(){return{w:s,m:y}})()}function o(e,t,r,n){var i=Object.defineProperty;try{i({},"",{})}catch(e){i=0}o=function(e,t,r,n){function a(t,r){o(e,t,function(e){return this._invoke(t,r,e)})}t?i?i(e,t,{value:r,enumerable:!n,configurable:!n,writable:!n}):e[t]=r:(a("next",0),a("throw",1),a("return",2))},o(e,t,r,n)}function a(e,t,r,n,i,o,a){try{var s=e[o](a),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,i)}function s(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function c(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?s(Object(r),!0).forEach(function(t){l(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):s(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function l(e,t,r){return(t=u(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function h(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,u(n.key),n)}}function u(e){var t=function(e,t){if("object"!=n(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=n(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==n(t)?t:t+""}r.d(t,{Z:function(){return d},p:function(){return f}});var d=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.elements=new Map,this.testMode=!0,this.orderId=null},t=[{key:"setTestMode",value:function(e){this.testMode=e}},{key:"setOrderId",value:function(e){this.orderId=e}},{key:"registerElement",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.elements.set(e,{type:t,data:r,lastUpdate:Date.now()})}},{key:"updateElementData",value:function(e,t){if(this.elements.has(e)){var r=this.elements.get(e);r.data=c(c({},r.data),t),r.lastUpdate=Date.now(),this.elements.set(e,r)}}},{key:"unregisterElement",value:function(e){this.elements.delete(e)}},{key:"getElementData",value:function(e){var t=this.elements.get(e);return t?t.data:null}},{key:"getElementDisplayText",value:function(e){return this.getTestData(e)}},{key:"getTestData",value:function(e){return{"woocommerce-invoice-number":"FACT-2025-001","woocommerce-invoice-date":"27/10/2025","woocommerce-order-number":"#WC-12345","woocommerce-order-date":"26/10/2025  14:30","woocommerce-billing-address":"Marie Dupont\n15 Rue de la Paix\n75002 Paris\nFrance","woocommerce-shipping-address":"Marie Dupont\n25 Avenue des Champs-lyses\n75008 Paris\nFrance","woocommerce-customer-name":"Marie Dupont","woocommerce-customer-email":"marie.dupont@email.fr","woocommerce-payment-method":"Carte bancaire (Stripe)","woocommerce-order-status":"Commande expdie","woocommerce-products-table":this.formatProductsTable([{name:"Ordinateur portable Dell XPS 13",quantity:1,price:"1 299,00 ",total:"1 299,00 "},{name:"Souris Logitech MX Master 3",quantity:1,price:"89,99 ",total:"89,99 "},{name:"Clavier mcanique Keychron K8",quantity:1,price:"79,99 ",total:"79,99 "},{name:'Sacoche ordinateur 15"',quantity:1,price:"49,99 ",total:"49,99 "}]),"woocommerce-subtotal":"1 518,97 ","woocommerce-discount":"-76,00 ","woocommerce-shipping":"9,99 ","woocommerce-taxes":"304,00 ","woocommerce-total":"1 756,96 ","woocommerce-refund":"0,00 ","woocommerce-fees":"15,00 ","woocommerce-quote-number":"DEV-2025-001","woocommerce-quote-date":"20/10/2025","woocommerce-quote-validity":"30 jours","woocommerce-quote-notes":"Devis pour quipement informatique professionnel. Prix valables 30 jours."}[e]||""}},{key:"formatProductsTable",value:function(e){if(!Array.isArray(e))return"";var t="PRODUIT\t\t\tQT\tPRIX UNIT.\tTOTAL\n";return t+="".repeat(80)+"\n",e.forEach(function(e){var r=e.name.length>30?e.name.substring(0,27)+"...":e.name,n="".concat(r,"\t").concat(e.quantity,"\t").concat(e.price,"\t").concat(e.total);t+=n+"\n"}),t}},{key:"loadWooCommerceData",value:(n=i().m(function e(){var t,r,n,o=arguments;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:if(t=o.length>0&&void 0!==o[0]?o[0]:null,!this.testMode&&t){e.n=1;break}return e.a(2,this.getAllTestData());case 1:return e.p=1,e.n=2,fetch("/wp-json/pdf-builder/v1/woocommerce-data/".concat(t),{method:"GET",headers:{"Content-Type":"application/json","X-WP-Nonce":wpApiSettings?wpApiSettings.nonce:""}});case 2:if((r=e.v).ok){e.n=3;break}throw new Error("Erreur HTTP: ".concat(r.status));case 3:return e.n=4,r.json();case 4:return n=e.v,e.a(2,n);case 5:return e.p=5,e.v,e.a(2,this.getAllTestData())}},e,this,[[1,5]])}),o=function(){var e=this,t=arguments;return new Promise(function(r,i){var o=n.apply(e,t);function s(e){a(o,r,i,s,c,"next",e)}function c(e){a(o,r,i,s,c,"throw",e)}s(void 0)})},function(){return o.apply(this,arguments)})},{key:"getAllTestData",value:function(){var e=this,t={};return["woocommerce-invoice-number","woocommerce-invoice-date","woocommerce-order-number","woocommerce-order-date","woocommerce-billing-address","woocommerce-shipping-address","woocommerce-customer-name","woocommerce-customer-email","woocommerce-payment-method","woocommerce-order-status","woocommerce-products-table","woocommerce-subtotal","woocommerce-discount","woocommerce-shipping","woocommerce-taxes","woocommerce-total","woocommerce-refund","woocommerce-fees","woocommerce-quote-number","woocommerce-quote-date","woocommerce-quote-validity","woocommerce-quote-notes"].forEach(function(r){t[r]=e.getTestData(r)}),t}},{key:"validateElement",value:function(e,t){var r=this,n={"woocommerce-invoice-number":function(e){return"string"==typeof e&&e.length>0},"woocommerce-invoice-date":function(e){return r.isValidDate(e)},"woocommerce-order-number":function(e){return"string"==typeof e&&e.length>0},"woocommerce-order-date":function(e){return r.isValidDate(e)},"woocommerce-billing-address":function(e){return"string"==typeof e&&e.length>0},"woocommerce-shipping-address":function(e){return"string"==typeof e&&e.length>0},"woocommerce-customer-name":function(e){return"string"==typeof e&&e.length>0},"woocommerce-customer-email":function(e){return r.isValidEmail(e)},"woocommerce-payment-method":function(e){return"string"==typeof e},"woocommerce-order-status":function(e){return"string"==typeof e},"woocommerce-products-table":function(e){return"string"==typeof e},"woocommerce-subtotal":function(e){return"string"==typeof e},"woocommerce-discount":function(e){return"string"==typeof e},"woocommerce-shipping":function(e){return"string"==typeof e},"woocommerce-taxes":function(e){return"string"==typeof e},"woocommerce-total":function(e){return"string"==typeof e},"woocommerce-refund":function(e){return"string"==typeof e},"woocommerce-fees":function(e){return"string"==typeof e},"woocommerce-quote-number":function(e){return"string"==typeof e&&e.length>0},"woocommerce-quote-date":function(e){return r.isValidDate(e)},"woocommerce-quote-validity":function(e){return"string"==typeof e},"woocommerce-quote-notes":function(e){return"string"==typeof e}}[e];return!n||n(t)}},{key:"isValidDate",value:function(e){if("string"!=typeof e)return!1;var t=new Date(e);return!isNaN(t.getTime())}},{key:"isValidEmail",value:function(e){return"string"==typeof e&&/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)}},{key:"getDefaultProperties",value:function(e){var t={width:200,height:60,fontSize:14,fontFamily:"Arial, sans-serif",color:"#333333",backgroundColor:"#ffffff",borderColor:"#dddddd",borderWidth:1,borderRadius:4,padding:8};switch(e){case"woocommerce-billing-address":case"woocommerce-shipping-address":t.height=100;break;case"woocommerce-products-table":t.width=400,t.height=150;break;case"woocommerce-invoice-number":case"woocommerce-order-number":case"woocommerce-quote-number":t.width=150,t.height=40}return t}},{key:"dispose",value:function(){this.elements.clear()}}],t&&h(e.prototype,t),r&&h(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,r,n,o}(),f=new d},901:function(e,t,r){r.d(t,{$d:function(){return n},Qn:function(){return o}});var n={special:{backgroundColor:{disabled:!1,default:"transparent"},borderColor:{disabled:!1},borderWidth:{disabled:!1}},layout:{backgroundColor:{disabled:!1,default:"#f8fafc"},borderColor:{disabled:!1},borderWidth:{disabled:!1}},text:{backgroundColor:{disabled:!1,default:"transparent"},borderColor:{disabled:!1},borderWidth:{disabled:!1}},shape:{backgroundColor:{disabled:!1,default:"#e5e7eb"},borderColor:{disabled:!1},borderWidth:{disabled:!1}},media:{backgroundColor:{disabled:!1,default:"#f3f4f6"},borderColor:{disabled:!1},borderWidth:{disabled:!1}},dynamic:{backgroundColor:{disabled:!1,default:"transparent"},borderColor:{disabled:!1},borderWidth:{disabled:!1}}},i={product_table:"special",customer_info:"special",company_logo:"special",company_info:"special",order_number:"special",document_type:"special","progress-bar":"special","layout-header":"layout","layout-footer":"layout","layout-sidebar":"layout","layout-section":"layout","layout-container":"layout","layout-section-divider":"layout","layout-spacer":"layout","layout-two-column":"layout","layout-three-column":"layout",text:"text","dynamic-text":"text","conditional-text":"text",counter:"text","date-dynamic":"text",currency:"text",formula:"text",rectangle:"shape",line:"shape","shape-rectangle":"shape","shape-circle":"shape","shape-line":"shape","shape-arrow":"shape","shape-triangle":"shape","shape-star":"shape",divider:"shape",image:"media","image-upload":"media",logo:"media",barcode:"media",qrcode:"media","qrcode-dynamic":"media",icon:"media","table-dynamic":"dynamic","gradient-box":"dynamic","shadow-box":"dynamic","rounded-box":"dynamic","border-box":"dynamic","background-pattern":"dynamic",watermark:"dynamic","invoice-header":"layout","invoice-address-block":"layout","invoice-info-block":"layout","invoice-products-table":"special","invoice-totals-block":"layout","invoice-payment-terms":"layout","invoice-legal-footer":"layout","invoice-signature-block":"layout"},o=function(e,t){var r=n[i[e]||"text"];return!r||!r[t]||!r[t].disabled}}},t={};function r(n){var i=t[n];if(void 0!==i)return i.exports;var o=t[n]={id:n,loaded:!1,exports:{}};return e[n](o,o.exports,r),o.loaded=!0,o.exports}r.d=function(e,t){for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.hmd=function(e){return(e=Object.create(e)).children||(e.children=[]),Object.defineProperty(e,"exports",{enumerable:!0,set:function(){throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+e.id)}}),e},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)};var n={};r.d(n,{default:function(){return E}});var i=r(287),o=r(483),a=r(57),s=r(52),c=r(557),l=r(718),h=r(730),u=r(878),d=r(351),f=r(349),y=r(501);function p(e){return function(e){if(Array.isArray(e))return m(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return m(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?m(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function m(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}var v={special:[{type:"product_table",label:"Tableau Produits",icon:"",description:"Tableau des produits commands avec quantits et prix",category:"special",defaultProps:{x:50,y:100,width:500,height:200,showHeaders:!0,showBorders:!0,fontSize:12,backgroundColor:"#ffffff",borderColor:"#e5e7eb",borderWidth:1}},{type:"customer_info",label:"Fiche Client",icon:"",description:"Informations dtailles du client (nom, adresse, email)",category:"special",defaultProps:{x:50,y:50,width:250,height:120,showHeaders:!0,showBorders:!1,fontSize:12,backgroundColor:"transparent",layout:"vertical"}},{type:"company_info",label:"Informations Entreprise",icon:"[D]",description:"Nom, adresse, contact et TVA de l'entreprise",category:"special",defaultProps:{x:320,y:50,width:250,height:120,showHeaders:!0,showBorders:!1,fontSize:12,backgroundColor:"transparent",layout:"vertical"}},{type:"company_logo",label:"Logo Entreprise",icon:"",description:"Logo et identit visuelle de l'entreprise",category:"special",defaultProps:{x:50,y:200,width:150,height:80,fit:"contain",alignment:"left"}},{type:"order_number",label:"Numro de Commande",icon:"",description:"Rfrence de commande avec date",category:"special",defaultProps:{x:450,y:20,width:100,height:30,fontSize:14,fontFamily:"Arial",textAlign:"right",backgroundColor:"transparent"}},{type:"dynamic-text",label:"Texte Dynamique",icon:"",description:"Texte avec variables dynamiques",category:"special",defaultProps:{x:50,y:320,width:200,height:40,template:"Commande #{order_number}",fontSize:14,fontFamily:"Arial",backgroundColor:"transparent"}},{type:"mentions",label:"Mentions lgales",icon:"",description:"Informations lgales (email, SIRET, tlphone, etc.)",category:"special",defaultProps:{x:50,y:380,width:500,height:60,fontSize:10,fontFamily:"Arial",textAlign:"left",backgroundColor:"transparent"}}]},g=function(){return v},b=function(e){return v[e]||[]},w=function(e){for(var t in v){var r=v[t].find(function(t){return t.type===e});if(r)return r}return null},x=function(){var e=[];for(var t in v)e.push.apply(e,p(v[t]));return e},S=function(e){var t=x(),r=e.toLowerCase();return t.filter(function(e){return e.label.toLowerCase().includes(r)||e.description.toLowerCase().includes(r)||e.type.toLowerCase().includes(r)})},k={VanillaCanvas:i.A,CanvasRenderer:o.A,CanvasEvents:a.A,CanvasSelection:s.A,CanvasProperties:c.A,CanvasLayers:l.A,CanvasExport:h.A,WooCommerceElementsManager:u.Z,wooCommerceElementsManager:u.p,ElementCustomizationService:d.J,elementCustomizationService:d.l,CanvasOptimizer:f.A,CanvasTests:y.A,ELEMENT_LIBRARY:v,getAllElements:g,getElementsByCategory:b,getElementByType:w,getAllElementsFlat:x,searchElements:S,PDFCanvasVanilla:i.A,ElementLibrary:v,ToolbarManager:a.A,PropertiesPanel:c.A,init:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{return i.A&&"function"==typeof i.A.init&&i.A.init(e),a.A&&"function"==typeof a.A.init&&a.A.init(),!0}catch(t){return!1}}};window.PDFBuilderPro=k,window.VanillaCanvas=i.A,window.CanvasRenderer=o.A,window.CanvasEvents=a.A,window.CanvasSelection=s.A,window.CanvasProperties=c.A,window.CanvasLayers=l.A,window.CanvasExport=h.A,window.WooCommerceElementsManager=u.Z,window.wooCommerceElementsManager=u.p,window.ElementCustomizationService=d.J,window.elementCustomizationService=d.l,window.CanvasOptimizer=f.A,window.CanvasTests=y.A,window.ELEMENT_LIBRARY=v,window.getAllElements=g,window.getElementsByCategory=b,window.getElementByType=w,window.getAllElementsFlat=x,window.searchElements=S,window.PDFCanvasVanilla=i.A,window.ElementLibrary=v,window.PDFBuilderPro={PDFCanvasVanilla:i.A,getAllElements:g,getElementsByCategory:b,getElementByType:w,getAllElementsFlat:x,searchElements:S,ELEMENT_LIBRARY:v},window.ToolbarManager=a.A,window.PropertiesPanel=c.A;var E=k;return n=n.default}()});