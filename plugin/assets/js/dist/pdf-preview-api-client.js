/*! For license information please see pdf-preview-api-client.js.LICENSE.txt */
!function(e,n){"object"==typeof exports&&"object"==typeof module?module.exports=n():"function"==typeof define&&define.amd?define([],n):"object"==typeof exports?exports.pdfBuilderReact=n():e.pdfBuilderReact=n()}(this,function(){return function(){var e={};function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function t(){var e,n,o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",a=o.toStringTag||"@@toStringTag";function d(t,o,i,a){var d=o&&o.prototype instanceof u?o:u,l=Object.create(d.prototype);return r(l,"_invoke",function(t,r,o){var i,a,d,u=0,l=o||[],s=!1,p={p:0,n:0,v:e,a:f,f:f.bind(e,4),d:function(n,t){return i=n,a=0,d=e,p.n=t,c}};function f(t,r){for(a=t,d=r,n=0;!s&&u&&!o&&n<l.length;n++){var o,i=l[n],f=p.p,v=i[2];t>3?(o=v===r)&&(d=i[(a=i[4])?5:(a=3,3)],i[4]=i[5]=e):i[0]<=f&&((o=t<2&&f<i[1])?(a=0,p.v=r,p.n=i[1]):f<v&&(o=t<3||i[0]>r||r>v)&&(i[4]=t,i[5]=r,p.n=v,a=0))}if(o||t>1)return c;throw s=!0,r}return function(o,l,v){if(u>1)throw TypeError("Generator is already running");for(s&&1===l&&f(l,v),a=l,d=v;(n=a<2?e:d)||!s;){i||(a?a<3?(a>1&&(p.n=-1),f(a,d)):p.n=d:p.v=d);try{if(u=2,i){if(a||(o="next"),n=i[o]){if(!(n=n.call(i,d)))throw TypeError("iterator result is not an object");if(!n.done)return n;d=n.value,a<2&&(a=0)}else 1===a&&(n=i.return)&&n.call(i),a<2&&(d=TypeError("The iterator does not provide a '"+o+"' method"),a=1);i=e}else if((n=(s=p.n<0)?d:t.call(r,p))!==c)break}catch(n){i=e,a=1,d=n}finally{u=1}}return{value:n,done:s}}}(t,i,a),!0),l}var c={};function u(){}function l(){}function s(){}n=Object.getPrototypeOf;var p=[][i]?n(n([][i]())):(r(n={},i,function(){return this}),n),f=s.prototype=u.prototype=Object.create(p);function v(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,s):(e.__proto__=s,r(e,a,"GeneratorFunction")),e.prototype=Object.create(f),e}return l.prototype=s,r(f,"constructor",s),r(s,"constructor",l),l.displayName="GeneratorFunction",r(s,a,"GeneratorFunction"),r(f),r(f,a,"Generator"),r(f,i,function(){return this}),r(f,"toString",function(){return"[object Generator]"}),(t=function(){return{w:d,m:v}})()}function r(e,n,t,o){var i=Object.defineProperty;try{i({},"",{})}catch(e){i=0}r=function(e,n,t,o){function a(n,t){r(e,n,function(e){return this._invoke(n,t,e)})}n?i?i(e,n,{value:t,enumerable:!o,configurable:!o,writable:!o}):e[n]=t:(a("next",0),a("throw",1),a("return",2))},r(e,n,t,o)}function o(e,n,t,r,o,i,a){try{var d=e[i](a),c=d.value}catch(e){return void t(e)}d.done?n(c):Promise.resolve(c).then(r,o)}function i(e){return function(){var n=this,t=arguments;return new Promise(function(r,i){var a=e.apply(n,t);function d(e){o(a,r,i,d,c,"next",e)}function c(e){o(a,r,i,d,c,"throw",e)}d(void 0)})}}function a(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,d(r.key),r)}}function d(e){var t=function(e,t){if("object"!=n(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var o=r.call(e,t||"default");if("object"!=n(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==n(t)?t:t+""}var c=function(){return e=function e(){var n,t;!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e),this.endpoint=(null===(n=pdfBuilderAjax)||void 0===n?void 0:n.ajaxurl)||"/wp-admin/admin-ajax.php",this.nonce=(null===(t=pdfBuilderAjax)||void 0===t?void 0:t.nonce)||"",this.isGenerating=!1,this.cache=new Map},n=[{key:"generateEditorPreview",value:(d=i(t().m(function e(n){var r,o,i,a,d,c=arguments;return t().w(function(e){for(;;)switch(e.p=e.n){case 0:if(r=c.length>1&&void 0!==c[1]?c[1]:{},!this.isGenerating){e.n=1;break}return console.warn("‚ö†Ô∏è G√©n√©ration d√©j√† en cours..."),e.a(2,null);case 1:return this.isGenerating=!0,this.showLoadingIndicator(),e.p=2,(o=new FormData).append("action","wp_pdf_preview_image"),o.append("nonce",this.nonce),o.append("context","editor"),o.append("template_data",JSON.stringify(n)),o.append("quality",r.quality||150),o.append("format",r.format||"png"),console.log("üì§ Envoi requ√™te preview √©diteur..."),e.n=3,fetch(this.endpoint,{method:"POST",body:o});case 3:return i=e.v,e.n=4,i.json();case 4:if(!(a=e.v).success){e.n=5;break}return console.log("‚úÖ Aper√ßu √©diteur g√©n√©r√©:",a.data),this.cachePreview(a.data),this.displayPreview(a.data.image_url,"editor"),e.a(2,a.data);case 5:return console.error("‚ùå Erreur g√©n√©ration √©diteur:",a.data),this.showError("Erreur lors de la g√©n√©ration de l'aper√ßu"),e.a(2,null);case 6:e.n=8;break;case 7:return e.p=7,d=e.v,console.error("‚ùå Erreur r√©seau:",d),this.showError("Erreur de connexion"),e.a(2,null);case 8:return e.p=8,this.isGenerating=!1,this.hideLoadingIndicator(),e.f(8);case 9:return e.a(2)}},e,this,[[2,7,8,9]])})),function(e){return d.apply(this,arguments)})},{key:"generateOrderPreview",value:(o=i(t().m(function e(n,r){var o,i,a,d,c,u=arguments;return t().w(function(e){for(;;)switch(e.p=e.n){case 0:if(o=u.length>2&&void 0!==u[2]?u[2]:{},!this.isGenerating){e.n=1;break}return console.warn("‚ö†Ô∏è G√©n√©ration d√©j√† en cours..."),e.a(2,null);case 1:return this.isGenerating=!0,this.showLoadingIndicator(),e.p=2,(i=new FormData).append("action","wp_pdf_preview_image"),i.append("nonce",this.nonce),i.append("context","metabox"),i.append("template_data",JSON.stringify(n)),i.append("order_id",r),i.append("quality",o.quality||150),i.append("format",o.format||"png"),console.log("üì§ Envoi requ√™te preview commande...",r),e.n=3,fetch(this.endpoint,{method:"POST",body:i});case 3:return a=e.v,e.n=4,a.json();case 4:if(!(d=e.v).success){e.n=5;break}return console.log("‚úÖ Aper√ßu commande g√©n√©r√©:",d.data),this.cachePreview(d.data),this.displayPreview(d.data.image_url,"metabox",r),e.a(2,d.data);case 5:return console.error("‚ùå Erreur g√©n√©ration commande:",d.data),this.showError("Erreur lors de la g√©n√©ration de l'aper√ßu de commande"),e.a(2,null);case 6:e.n=8;break;case 7:return e.p=7,c=e.v,console.error("‚ùå Erreur r√©seau:",c),this.showError("Erreur de connexion"),e.a(2,null);case 8:return e.p=8,this.isGenerating=!1,this.hideLoadingIndicator(),e.f(8);case 9:return e.a(2)}},e,this,[[2,7,8,9]])})),function(e,n){return o.apply(this,arguments)})},{key:"cachePreview",value:function(e){var n=e.cache_key||this.generateCacheKey(e);if(this.cache.set(n,{url:e.image_url,timestamp:Date.now(),context:e.context||"unknown"}),this.cache.size>10){var t=this.cache.keys().next().value;this.cache.delete(t)}}},{key:"generateCacheKey",value:function(e){return btoa(JSON.stringify({context:e.context,order_id:e.order_id,template_hash:this.hashString(JSON.stringify(e.template_data))})).slice(0,32)}},{key:"hashString",value:function(e){for(var n=0,t=0;t<e.length;t++)n=(n<<5)-n+e.charCodeAt(t),n&=n;return Math.abs(n).toString(36)}},{key:"displayPreview",value:function(e,n){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=document.getElementById("pdf-preview-modal");r||(r=this.createPreviewModal(),document.body.appendChild(r));var o=r.querySelector("#pdf-preview-image"),i=r.querySelector("#pdf-preview-title");o.src=e,o.style.maxWidth="100%",o.style.height="auto",i.textContent="editor"===n?"üëÅÔ∏è Aper√ßu du Template":"üìÑ Aper√ßu Commande #".concat(t),this.addPreviewActions(r,e,n),r.style.display="block",console.log("üñºÔ∏è Aper√ßu affich√©:",e)}},{key:"createPreviewModal",value:function(){var e=document.createElement("div");return e.id="pdf-preview-modal",e.style.cssText="\n            position: fixed;\n            top: 0;\n            left: 0;\n            width: 100%;\n            height: 100%;\n            background: rgba(0,0,0,0.8);\n            z-index: 9999;\n            display: none;\n            justify-content: center;\n            align-items: center;\n        ",e.innerHTML='\n            <div style="\n                background: white;\n                border-radius: 8px;\n                padding: 20px;\n                max-width: 90%;\n                max-height: 90%;\n                overflow: auto;\n                position: relative;\n            ">\n                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">\n                    <h3 id="pdf-preview-title" style="margin: 0; color: #1d2327;">Aper√ßu PDF</h3>\n                    <button id="pdf-preview-close" style="\n                        background: none;\n                        border: none;\n                        font-size: 24px;\n                        cursor: pointer;\n                        color: #666;\n                    ">√ó</button>\n                </div>\n                <div id="pdf-preview-actions" style="margin-bottom: 15px;"></div>\n                <img id="pdf-preview-image" src="" alt="Aper√ßu PDF" style="max-width: 100%; height: auto; border: 1px solid #ddd;" />\n            </div>\n        ',e.querySelector("#pdf-preview-close").addEventListener("click",function(){e.style.display="none"}),e.addEventListener("click",function(n){n.target===e&&(e.style.display="none")}),e}},{key:"addPreviewActions",value:function(e,n,t){var r=this,o=e.querySelector("#pdf-preview-actions");o.innerHTML="";var i=document.createElement("button");i.textContent="üì• T√©l√©charger",i.style.cssText="\n            background: #007cba;\n            color: white;\n            border: none;\n            padding: 8px 16px;\n            border-radius: 4px;\n            cursor: pointer;\n            margin-right: 10px;\n        ",i.addEventListener("click",function(){r.downloadPreview(n)});var a=document.createElement("button");if(a.textContent="üñ®Ô∏è Imprimer",a.style.cssText="\n            background: #46b450;\n            color: white;\n            border: none;\n            padding: 8px 16px;\n            border-radius: 4px;\n            cursor: pointer;\n            margin-right: 10px;\n        ",a.addEventListener("click",function(){r.printPreview(n)}),"metabox"===t){var d=document.createElement("button");d.textContent="üîÑ R√©g√©n√©rer",d.style.cssText="\n                background: #f56e28;\n                color: white;\n                border: none;\n                padding: 8px 16px;\n                border-radius: 4px;\n                cursor: pointer;\n            ",d.addEventListener("click",function(){"function"==typeof window.regenerateOrderPreview&&window.regenerateOrderPreview()}),o.appendChild(d)}o.appendChild(i),o.appendChild(a)}},{key:"downloadPreview",value:function(e){var n=document.createElement("a");n.href=e,n.download="pdf-preview-".concat(Date.now(),".png"),n.style.display="none",document.body.appendChild(n),n.click(),document.body.removeChild(n),console.log("üì• T√©l√©chargement d√©marr√©:",e)}},{key:"printPreview",value:function(e){var n=window.open("","_blank");n.document.write('\n            <html>\n                <head>\n                    <title>Aper√ßu PDF</title>\n                    <style>\n                        body { margin: 0; padding: 20px; text-align: center; }\n                        img { max-width: 100%; height: auto; }\n                        @media print {\n                            body { margin: 0; }\n                            img { max-width: 100%; height: auto; }\n                        }\n                    </style>\n                </head>\n                <body>\n                    <img src="'.concat(e,'" alt="Aper√ßu PDF" onload="window.print(); window.close();" />\n                </body>\n            </html>\n        ')),n.document.close(),console.log("üñ®Ô∏è Impression d√©marr√©e")}},{key:"showLoadingIndicator",value:function(){var e=document.getElementById("pdf-preview-loader");e||((e=document.createElement("div")).id="pdf-preview-loader",e.style.cssText="\n                position: fixed;\n                top: 50%;\n                left: 50%;\n                transform: translate(-50%, -50%);\n                background: rgba(255,255,255,0.9);\n                border: 1px solid #ccc;\n                border-radius: 8px;\n                padding: 20px;\n                z-index: 10000;\n                display: none;\n                text-align: center;\n            ",e.innerHTML='\n                <div style="border: 4px solid #f3f3f3; border-top: 4px solid #007cba; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin: 0 auto 10px;"></div>\n                <div>G√©n√©ration de l\'aper√ßu...</div>\n                <style>\n                    @keyframes spin {\n                        0% { transform: rotate(0deg); }\n                        100% { transform: rotate(360deg); }\n                    }\n                </style>\n            ',document.body.appendChild(e)),e.style.display="block"}},{key:"hideLoadingIndicator",value:function(){var e=document.getElementById("pdf-preview-loader");e&&(e.style.display="none")}},{key:"showError",value:function(e){"undefined"!=typeof toastr?toastr.error(e):alert(e)}}],n&&a(e.prototype,n),r&&a(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,n,r,o,d}();return window.pdfPreviewAPI=new c,window.generateEditorPreview=function(e,n){return window.pdfPreviewAPI.generateEditorPreview(e,n)},window.generateOrderPreview=function(e,n,t){return window.pdfPreviewAPI.generateOrderPreview(e,n,t)},console.log("üéØ API Preview 1.4 initialis√©e et pr√™te √† l'emploi !"),console.log("üìñ Utilisation:"),console.log("   - generateEditorPreview(templateData)"),console.log("   - generateOrderPreview(templateData, orderId)"),e=e.default}()});