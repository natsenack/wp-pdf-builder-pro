/*! For license information please see pdf-preview-integration.js.LICENSE.txt */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.pdfBuilderReact=t():e.pdfBuilderReact=t()}(this,function(){return function(){var e={};function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t(e)}function n(){var e,t,o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",a=o.toStringTag||"@@toStringTag";function u(n,o,i,a){var u=o&&o.prototype instanceof d?o:d,l=Object.create(u.prototype);return r(l,"_invoke",function(n,r,o){var i,a,u,d=0,l=o||[],p=!1,s={p:0,n:0,v:e,a:f,f:f.bind(e,4),d:function(t,n){return i=t,a=0,u=e,s.n=n,c}};function f(n,r){for(a=n,u=r,t=0;!p&&d&&!o&&t<l.length;t++){var o,i=l[t],f=s.p,v=i[2];n>3?(o=v===r)&&(u=i[(a=i[4])?5:(a=3,3)],i[4]=i[5]=e):i[0]<=f&&((o=n<2&&f<i[1])?(a=0,s.v=r,s.n=i[1]):f<v&&(o=n<3||i[0]>r||r>v)&&(i[4]=n,i[5]=r,s.n=v,a=0))}if(o||n>1)return c;throw p=!0,r}return function(o,l,v){if(d>1)throw TypeError("Generator is already running");for(p&&1===l&&f(l,v),a=l,u=v;(t=a<2?e:u)||!p;){i||(a?a<3?(a>1&&(s.n=-1),f(a,u)):s.n=u:s.v=u);try{if(d=2,i){if(a||(o="next"),t=i[o]){if(!(t=t.call(i,u)))throw TypeError("iterator result is not an object");if(!t.done)return t;u=t.value,a<2&&(a=0)}else 1===a&&(t=i.return)&&t.call(i),a<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),a=1);i=e}else if((t=(p=s.n<0)?u:n.call(r,s))!==c)break}catch(t){i=e,a=1,u=t}finally{d=1}}return{value:t,done:p}}}(n,i,a),!0),l}var c={};function d(){}function l(){}function p(){}t=Object.getPrototypeOf;var s=[][i]?t(t([][i]())):(r(t={},i,function(){return this}),t),f=p.prototype=d.prototype=Object.create(s);function v(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,p):(e.__proto__=p,r(e,a,"GeneratorFunction")),e.prototype=Object.create(f),e}return l.prototype=p,r(f,"constructor",p),r(p,"constructor",l),l.displayName="GeneratorFunction",r(p,a,"GeneratorFunction"),r(f),r(f,a,"Generator"),r(f,i,function(){return this}),r(f,"toString",function(){return"[object Generator]"}),(n=function(){return{w:u,m:v}})()}function r(e,t,n,o){var i=Object.defineProperty;try{i({},"",{})}catch(e){i=0}r=function(e,t,n,o){function a(t,n){r(e,t,function(e){return this._invoke(t,n,e)})}t?i?i(e,t,{value:n,enumerable:!o,configurable:!o,writable:!o}):e[t]=n:(a("next",0),a("throw",1),a("return",2))},r(e,t,n,o)}function o(e,t,n,r,o,i,a){try{var u=e[i](a),c=u.value}catch(e){return void n(e)}u.done?t(c):Promise.resolve(c).then(r,o)}function i(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var a=e.apply(t,n);function u(e){o(a,r,i,u,c,"next",e)}function c(e){o(a,r,i,u,c,"throw",e)}u(void 0)})}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function u(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,d(r.key),r)}}function c(e,t,n){return t&&u(e.prototype,t),n&&u(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function d(e){var n=function(e,n){if("object"!=t(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var o=r.call(e,n||"default");if("object"!=t(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==t(n)?n:n+""}var l=function(){return c(function e(t){a(this,e),this.canvasEditor=t,this.previewBtn=null,this.init()},[{key:"init",value:function(){this.createPreviewButton(),this.bindEvents()}},{key:"createPreviewButton",value:function(){this.previewBtn=document.createElement("button"),this.previewBtn.id="pdf-editor-preview-btn",this.previewBtn.innerHTML="üëÅÔ∏è Aper√ßu",this.previewBtn.title="G√©n√©rer un aper√ßu PDF",this.previewBtn.style.cssText="\n            background: #007cba;\n            color: white;\n            border: none;\n            padding: 8px 16px;\n            border-radius: 4px;\n            cursor: pointer;\n            font-size: 14px;\n            margin-left: 10px;\n        ";var e=document.querySelector(".pdf-editor-toolbar")||document.querySelector("#pdf-editor-toolbar")||document.querySelector(".toolbar");e?e.appendChild(this.previewBtn):(this.previewBtn.style.position="fixed",this.previewBtn.style.top="10px",this.previewBtn.style.right="10px",this.previewBtn.style.zIndex="1000",document.body.appendChild(this.previewBtn))}},{key:"bindEvents",value:function(){var e=this;this.previewBtn&&this.previewBtn.addEventListener("click",function(){e.generatePreview()}),document.addEventListener("keydown",function(t){(t.ctrlKey||t.metaKey)&&"p"===t.key&&(t.preventDefault(),e.generatePreview())})}},{key:"generatePreview",value:(e=i(n().m(function e(){var t,r;return n().w(function(e){for(;;)switch(e.p=e.n){case 0:if(e.p=0,t=this.getTemplateData()){e.n=1;break}return alert("Aucune donn√©e de template trouv√©e. Veuillez cr√©er un template d'abord."),e.a(2);case 1:return e.n=2,window.generateEditorPreview(t,{quality:150,format:"png"});case 2:e.v&&console.log("‚úÖ Aper√ßu √©diteur g√©n√©r√© avec succ√®s"),e.n=4;break;case 3:e.p=3,r=e.v,console.error("‚ùå Erreur g√©n√©ration aper√ßu √©diteur:",r),alert("Erreur lors de la g√©n√©ration de l'aper√ßu. V√©rifiez la console pour plus de d√©tails.");case 4:return e.a(2)}},e,this,[[0,3]])})),function(){return e.apply(this,arguments)})},{key:"getTemplateData",value:function(){return this.canvasEditor&&"function"==typeof this.canvasEditor.getTemplateData?this.canvasEditor.getTemplateData():window.pdfEditorTemplate?window.pdfEditorTemplate:localStorage.getItem("pdf-builder-template")?JSON.parse(localStorage.getItem("pdf-builder-template")):{template:{elements:[{type:"text",content:"APER√áU PDF BUILDER PRO",x:50,y:50,width:300,height:40,fontSize:18,fontFamily:"Arial",color:"#000000",textAlign:"center"},{type:"text",content:"Template de d√©monstration",x:50,y:100,width:300,height:30,fontSize:14,color:"#666666"}]}}}}]);var e}(),p=function(){return c(function e(t){a(this,e),this.metaboxContainer=t,this.orderId=this.getOrderId(),this.previewBtn=null,this.init()},[{key:"init",value:function(){this.createPreviewButtons(),this.bindEvents()}},{key:"createPreviewButtons",value:function(){var e=document.createElement("div");e.id="pdf-metabox-preview-buttons",e.style.cssText="\n            margin: 15px 0;\n            padding: 15px;\n            background: #f8f9fa;\n            border: 1px solid #dee2e6;\n            border-radius: 4px;\n        ",e.innerHTML='\n            <h4 style="margin: 0 0 10px 0; color: #495057;">üìÑ Aper√ßu PDF</h4>\n            <p style="margin: 0 0 15px 0; color: #6c757d; font-size: 13px;">\n                G√©n√©rez un aper√ßu du PDF avec les donn√©es r√©elles de cette commande.\n            </p>\n            <div style="display: flex; gap: 10px; flex-wrap: wrap;">\n                <button id="pdf-metabox-preview-btn" class="button button-secondary">\n                    üëÅÔ∏è Aper√ßu Image\n                </button>\n                <button id="pdf-metabox-generate-btn" class="button button-primary">\n                    üìÑ G√©n√©rer PDF\n                </button>\n            </div>\n        ',this.metaboxContainer&&this.metaboxContainer.appendChild(e),this.previewBtn=document.getElementById("pdf-metabox-preview-btn")}},{key:"bindEvents",value:function(){var e=this;this.previewBtn&&this.previewBtn.addEventListener("click",function(){e.generatePreview()}),window.regenerateOrderPreview=function(){e.generatePreview()}}},{key:"generatePreview",value:(e=i(n().m(function e(){var t,r;return n().w(function(e){for(;;)switch(e.p=e.n){case 0:if(e.p=0,this.orderId){e.n=1;break}return alert("ID de commande non trouv√©."),e.a(2);case 1:if(t=this.getTemplateData()){e.n=2;break}return alert("Aucune donn√©e de template trouv√©e. Veuillez s√©lectionner un template."),e.a(2);case 2:return e.n=3,window.generateOrderPreview(t,this.orderId,{quality:150,format:"png"});case 3:e.v&&console.log("‚úÖ Aper√ßu commande g√©n√©r√© avec succ√®s"),e.n=5;break;case 4:e.p=4,r=e.v,console.error("‚ùå Erreur g√©n√©ration aper√ßu commande:",r),alert("Erreur lors de la g√©n√©ration de l'aper√ßu. V√©rifiez la console pour plus de d√©tails.");case 5:return e.a(2)}},e,this,[[0,4]])})),function(){return e.apply(this,arguments)})},{key:"getOrderId",value:function(){var e=new URLSearchParams(window.location.search);if(e.get("post"))return parseInt(e.get("post"));if(window.wpApiSettings&&window.wpApiSettings.postId)return window.wpApiSettings.postId;var t=document.getElementById("pdf-order-id")||document.querySelector("[data-order-id]");if(t)return parseInt(t.dataset.orderId||t.value);var n=document.querySelector(".wp-heading-inline")||document.querySelector("h1");if(n){var r=n.textContent.match(/#(\d+)/);if(r)return parseInt(r[1])}return console.warn("‚ö†Ô∏è ID de commande non trouv√© automatiquement"),null}},{key:"getTemplateData",value:function(){var e=document.getElementById("pdf-template-data")||document.querySelector("[data-template-data]");if(e)try{return JSON.parse(e.value||e.dataset.templateData)}catch(t){console.warn("Donn√©es template mal format√©es:",t)}return window.pdfCurrentTemplate?window.pdfCurrentTemplate:{template:{elements:[{type:"text",content:"FACTURE",x:50,y:30,width:200,height:40,fontSize:24,fontWeight:"bold",color:"#000000"},{type:"text",content:"Commande #{{order_number}}",x:50,y:80,width:200,height:30,fontSize:16,color:"#333333"},{type:"text",content:"Client: {{customer_name}}",x:50,y:120,width:200,height:25,fontSize:14,color:"#666666"},{type:"text",content:"Total: {{order_total}} ‚Ç¨",x:50,y:150,width:200,height:25,fontSize:14,fontWeight:"bold",color:"#000000"}]}}}}]);var e}();return document.addEventListener("DOMContentLoaded",function(){(document.querySelector("#pdf-editor-canvas")||document.querySelector(".pdf-canvas-editor")||window.location.href.includes("pdf-builder-editor"))&&(console.log("üé® Initialisation int√©gration √©diteur..."),window.pdfEditorPreview=new l(window.pdfCanvasEditor)),(document.querySelector(".woocommerce-order-data")||document.querySelector("#woocommerce-order-data")||window.location.href.includes("post.php?post=")&&window.location.href.includes("action=edit"))&&setTimeout(function(){var e=document.querySelector("#pdf-builder-metabox")||document.querySelector(".pdf-builder-metabox")||document.querySelector(".postbox");e&&(console.log("üõí Initialisation int√©gration metabox..."),window.pdfMetaboxPreview=new p(e))},1e3)}),window.generateQuickPreview=i(n().m(function e(){var t,r,o,i,a,u,c,d,l,p,s,f=arguments;return n().w(function(e){for(;;)switch(e.p=e.n){case 0:if(t=f.length>0&&void 0!==f[0]?f[0]:null,r=f.length>1&&void 0!==f[1]?f[1]:null,e.p=1,o=document.querySelector("#pdf-editor-canvas")||document.querySelector(".pdf-canvas-editor")||window.location.href.includes("pdf-builder-editor"),i=document.querySelector(".woocommerce-order-data")||document.querySelector("#woocommerce-order-data")||window.location.href.includes("post.php")&&window.location.href.includes("action=edit"),!o){e.n=3;break}return console.log("üé® Mode √©diteur d√©tect√©"),u=t||(null===(a=window.pdfEditorPreview)||void 0===a?void 0:a.getTemplateData()),e.n=2,window.generateEditorPreview(u);case 2:case 4:return e.a(2,e.v);case 3:if(!i){e.n=5;break}return console.log("üõí Mode metabox d√©tect√©"),l=t||(null===(c=window.pdfMetaboxPreview)||void 0===c?void 0:c.getTemplateData()),p=r||(null===(d=window.pdfMetaboxPreview)||void 0===d?void 0:d.getOrderId()),e.n=4,window.generateOrderPreview(l,p);case 5:return console.warn("‚ö†Ô∏è Contexte non reconnu pour l'aper√ßu"),e.a(2,null);case 6:return e.p=6,s=e.v,console.error("‚ùå Erreur g√©n√©ration aper√ßu rapide:",s),e.a(2,null)}},e,null,[[1,6]])})),console.log("üöÄ Int√©grations API Preview 1.4 charg√©es !"),console.log("üí° Raccourcis:"),console.log("   - Ctrl+P (Cmd+P) : Aper√ßu rapide"),console.log("   - generateQuickPreview() : D√©tection automatique du contexte"),e=e.default}()});