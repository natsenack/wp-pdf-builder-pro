!function(){function e(e,n){return function(e){if(Array.isArray(e))return e}(e)||function(e,a){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var o,r,t,l,c=[],i=!0,d=!1;try{if(t=(n=n.call(e)).next,0===a){if(Object(n)!==n)return;i=!1}else for(;!(i=(o=t.call(n)).done)&&(c.push(o.value),c.length!==a);i=!0);}catch(e){d=!0,r=e}finally{try{if(!i&&null!=n.return&&(l=n.return(),Object(l)!==l))return}finally{if(d)throw r}}return c}}(e,n)||a(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function a(e,a){if(e){if("string"==typeof e)return n(e,a);var o={}.toString.call(e).slice(8,-1);return"Object"===o&&e.constructor&&(o=e.constructor.name),"Map"===o||"Set"===o?Array.from(e):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?n(e,a):void 0}}function n(e,a){(null==a||a>e.length)&&(a=e.length);for(var n=0,o=Array(a);n<a;n++)o[n]=e[n];return o}function o(e){return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o(e)}!function(){"use strict";jQuery(document).ready(function(){!function(){function n(e){try{return document.querySelectorAll(e)}catch(a){return console.warn("Invalid selector:",e),[]}}function r(e){e&&(e.style.display="flex",e.classList.add("canvas-modal-visible"),document.body.classList.add("canvas-modal-open"))}function t(e){e&&(e.style.display="none",e.classList.remove("canvas-modal-visible"),document.body.classList.remove("canvas-modal-open"))}function l(e,a){var n="canvas-".concat(e,"-modal"),o=document.getElementById(n);if(o)switch(e){case"grille":s(o,a);break;case"dimensions":i(o,a);break;case"zoom":d(o,a);break;case"apparence":c(o,a);break;case"interactions":u(o,a);break;case"export":f(o,a);break;case"performance":v(o,a);break;case"autosave":p(o,a);break;case"debug":_(o,a);break;default:console.warn("âš ï¸ Unknown category:",e)}}function c(e,a){console.log("ðŸŽ¨ Updating apparence modal with values:",a);var n=e.querySelector("#canvas_bg_color");n&&a.canvas_bg_color&&(n.value=a.canvas_bg_color,console.log("âœ… Updated canvas_bg_color:",a.canvas_bg_color));var o=e.querySelector("#canvas_container_bg_color");o&&a.canvas_container_bg_color&&(o.value=a.canvas_container_bg_color,console.log("âœ… Updated canvas_container_bg_color:",a.canvas_container_bg_color));var r=e.querySelector("#canvas_border_color");r&&a.canvas_border_color&&(r.value=a.canvas_border_color,console.log("âœ… Updated canvas_border_color:",a.canvas_border_color));var t=e.querySelector("#canvas_border_width");t&&void 0!==a.canvas_border_width&&(t.value=a.canvas_border_width,console.log("âœ… Updated canvas_border_width:",a.canvas_border_width));var l=e.querySelector("#canvas_shadow_enabled");if(l){var c="1"===a.canvas_shadow_enabled||!0===a.canvas_shadow_enabled;l.checked=c,console.log("âœ… Updated canvas_shadow_enabled:",c)}}function i(e,a){}function d(e,a){}function s(e,a){}function u(e,a){}function f(e,a){}function v(e,a){}function p(e,a){}function _(e,a){}console.log("ðŸŽ›ï¸ Initializing canvas modals for React editor..."),n(".canvas-modal-trigger").forEach(function(e){e.addEventListener("click",function(e){e.preventDefault();var a=this.getAttribute("data-modal"),n=document.getElementById(a);n&&r(n)})}),n(".canvas-modal-close").forEach(function(e){e.addEventListener("click",function(e){e.preventDefault(),t(this.closest(".canvas-modal"))})}),document.addEventListener("click",function(e){var a=e.target;(a.classList.contains("canvas-modal")||a.classList.contains("canvas-modal-overlay"))&&t(a.closest(".canvas-modal"))},!0),document.addEventListener("keydown",function(e){"Escape"===e.key&&n('.canvas-modal[style*="display: flex"]').forEach(t)}),n(".canvas-modal-save").forEach(function(n){n.addEventListener("click",function(n){var r=this;n.preventDefault(),console.log("ðŸ’¾ Save button clicked for category:",this.getAttribute("data-category"));var l=this.closest(".canvas-modal"),c=this.getAttribute("data-category"),i=l?l.querySelector("form"):null;if(console.log("ðŸ“‹ Modal found:",!!l,"Form found:",!!i,"Category:",c),i){var d,s=null;if("undefined"!=typeof pdf_builder_ajax?s=pdf_builder_ajax:"undefined"!=typeof pdfBuilderAjax?s=pdfBuilderAjax:"undefined"!=typeof ajaxurl&&(s={ajax_url:ajaxurl,nonce:""}),!s||!s.ajax_url)return alert("Erreur de configuration AJAX: variables AJAX non trouvÃ©es"),void console.error("Available globals:",{pdf_builder_ajax:"undefined"==typeof pdf_builder_ajax?"undefined":o(pdf_builder_ajax),pdfBuilderAjax:"undefined"==typeof pdfBuilderAjax?"undefined":o(pdfBuilderAjax),ajaxurl:"undefined"==typeof ajaxurl?"undefined":o(ajaxurl)});try{(d=new FormData(i)).append("action","pdf_builder_save_canvas_settings"),d.append("category",c||""),d.append("nonce",s.nonce||""),console.log("ðŸ“¤ Sending AJAX save request for category:",c),console.log("ðŸ“¦ Form data keys:",Array.from(d.keys()))}catch(p){return console.error("âŒ Error creating form data:",p),void alert("Erreur lors de la prÃ©paration des donnÃ©es")}var u=this.textContent;this.textContent="Sauvegarde...",this.disabled=!0;var f=new AbortController,v=setTimeout(function(){return f.abort()},3e4);fetch(s.ajax_url,{method:"POST",body:d,credentials:"same-origin",signal:f.signal}).then(function(e){if(clearTimeout(v),!e.ok)throw new Error("HTTP "+e.status);return e.json()}).then(function(n){var o,i;if(console.log("ðŸ’¾ Save AJAX response received:",n),!n.success)throw console.error("âŒ Save failed:",(null===(o=n.data)||void 0===o?void 0:o.message)||"Unknown error"),new Error((null===(i=n.data)||void 0===i?void 0:i.message)||"Erreur inconnue");if(console.log("âœ… Save successful for category:",c),t(l),r.textContent=u,r.disabled=!1,"function"==typeof updateCanvasPreviews&&(console.log("ðŸ”„ Calling updateCanvasPreviews after save"),updateCanvasPreviews(c)),"apparence"===c){if(console.log("ðŸŽ¨ Dispatching appearance settings update event"),void 0!==window.pdfBuilderCanvasSettings){var s,f={},v=function(e,n){var o="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!o){if(Array.isArray(e)||(o=a(e))||n&&e&&"number"==typeof e.length){o&&(e=o);var r=0,t=function(){};return{s:t,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:t}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var l,c=!0,i=!1;return{s:function(){o=o.call(e)},n:function(){var e=o.next();return c=e.done,e},e:function(e){i=!0,l=e},f:function(){try{c||null==o.return||o.return()}finally{if(i)throw l}}}}(d.entries());try{for(v.s();!(s=v.n()).done;){var p=e(s.value,2),_=p[0],b=p[1];"canvas_shadow_enabled"===_?f.shadow_enabled="1"===b:"canvas_border_width"===_?f.border_width=parseInt(b)||1:"canvas_bg_color"===_?f.canvas_background_color=b:"canvas_container_bg_color"===_?f.container_background_color=b:"canvas_border_color"===_&&(f.border_color=b)}}catch(g){v.e(g)}finally{v.f()}Object.assign(window.pdfBuilderCanvasSettings,f),console.log("ðŸ”„ Updated window.pdfBuilderCanvasSettings:",f)}var y=new CustomEvent("pdfBuilderCanvasSettingsUpdated",{detail:{category:"apparence"}});window.dispatchEvent(y)}}).catch(function(e){clearTimeout(v),console.error("Save error:",e),r.textContent=u,r.disabled=!1,"AbortError"===e.name?alert("Erreur: Timeout de la requÃªte (30 secondes)"):alert("Erreur lors de la sauvegarde: "+e.message)})}else alert("Erreur: Formulaire non trouvÃ©")})}),window.updateCanvasPreviews=function(e){var a=null;console.log("Available globals in updateCanvasPreviews:",{pdf_builder_ajax:"undefined"==typeof pdf_builder_ajax?"undefined":o(pdf_builder_ajax),pdfBuilderAjax:"undefined"==typeof pdfBuilderAjax?"undefined":o(pdfBuilderAjax),ajaxurl:"undefined"==typeof ajaxurl?"undefined":o(ajaxurl)}),"undefined"!=typeof pdf_builder_ajax?(a=pdf_builder_ajax,console.log("Using pdf_builder_ajax in updateCanvasPreviews:",a)):"undefined"!=typeof pdfBuilderAjax?(a=pdfBuilderAjax,console.log("Using pdfBuilderAjax in updateCanvasPreviews:",a)):"undefined"!=typeof ajaxurl&&(a={ajax_url:ajaxurl,nonce:""},console.log("Using fallback ajaxurl in updateCanvasPreviews:",a)),a&&a.ajax_url&&fetch(a.ajax_url,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({action:"pdf_builder_get_canvas_settings",category:e,nonce:a.nonce||""})}).then(function(e){return e.json()}).then(function(a){a.success&&a.data&&l(e,a.data)}).catch(function(e){console.error("Error updating previews:",e)})},console.log("âœ… Canvas modals initialized successfully for React editor")}()})}()}();