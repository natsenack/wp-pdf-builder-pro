"use strict";(this.webpackChunkwp_pdf_builder_pro=this.webpackChunkwp_pdf_builder_pro||[]).push([[125],{558:function(e,t,n){n.d(t,{H:function(){return A}});var i=n(594),o=n.n(i),r=n(75),a=n(49),l=n(339),c=n(711),s=n(980),d=n(908),f=n(662),u=n(303),h=n(262),m=n(848);function g(e){return g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},g(e)}function p(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function b(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?p(Object(n),!0).forEach(function(t){y(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):p(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function y(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=g(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!=g(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==g(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function v(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=S(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,o=function(){};return{s:o,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,a=!0,l=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){l=!0,r=e},f:function(){try{a||null==n.return||n.return()}finally{if(l)throw r}}}}function w(e){return function(e){if(Array.isArray(e))return T(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||S(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function x(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var i,o,r,a,l=[],c=!0,s=!1;try{if(r=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;c=!1}else for(;!(c=(i=r.call(n)).done)&&(l.push(i.value),l.length!==t);c=!0);}catch(e){s=!0,o=e}finally{try{if(!c&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(s)throw o}}return l}}(e,t)||S(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function S(e,t){if(e){if("string"==typeof e)return T(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?T(e,t):void 0}}function T(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=Array(t);n<t;n++)i[n]=e[n];return i}var k=function(e){return e&&"transparent"!==e?e:"rgba(0,0,0,0)"},C=function(e,t,n,i,o,r){e.beginPath(),e.moveTo(t+r,n),e.lineTo(t+i-r,n),e.quadraticCurveTo(t+i,n,t+i,n+r),e.lineTo(t+i,n+o-r),e.quadraticCurveTo(t+i,n+o,t+i-r,n+o),e.lineTo(t+r,n+o),e.quadraticCurveTo(t,n+o,t,n+o-r),e.lineTo(t,n+r),e.quadraticCurveTo(t,n,t+r,n),e.closePath()},E=function(e,t,n){var i=t,o=i.src||"";if(!o)return e.fillStyle="#f0f0f0",e.fillRect(0,0,t.width,t.height),e.strokeStyle="#cccccc",e.lineWidth=1,e.strokeRect(0,0,t.width,t.height),e.fillStyle="#999999",e.font="14px Arial",e.textAlign="center",e.textBaseline="middle",void e.fillText("Image",t.width/2,t.height/2);var r=n.current.get(o);if(!r){var a=document.createElement("img");return a.crossOrigin="anonymous",a.src=o,a.onload=function(){var e=function(e){return e.naturalWidth*e.naturalHeight*4}(a);n.current.set(o,{image:a,size:e,lastUsed:Date.now()}),function(e){var t=e.current;t.size<=100||Array.from(t.entries()).sort(function(e,t){var n=x(e,2)[1],i=x(t,2)[1];return n.lastUsed-i.lastUsed}).slice(0,Math.ceil(.2*t.size)).forEach(function(e){var n=x(e,1)[0];return t.delete(n)})}(n)},void(a.onerror=function(){})}var l=r.image;if(r.lastUsed=Date.now(),l.complete&&0!==l.naturalHeight){var c=i.objectFit||"cover",s=0,d=0,f=t.width,u=t.height,h=0,m=0,g=l.naturalWidth,p=l.naturalHeight;if("contain"===c){var b=Math.min(t.width/l.naturalWidth,t.height/l.naturalHeight);f=l.naturalWidth*b,u=l.naturalHeight*b,s=(t.width-f)/2,d=(t.height-u)/2}else if("cover"===c){var y=Math.max(t.width/l.naturalWidth,t.height/l.naturalHeight);g=t.width/y,p=t.height/y,h=(l.naturalWidth-g)/2,m=(l.naturalHeight-p)/2}else if("fill"===c);else if("scale-down"===c&&(l.naturalWidth>t.width||l.naturalHeight>t.height)){var v=Math.min(t.width/l.naturalWidth,t.height/l.naturalHeight);f=l.naturalWidth*v,u=l.naturalHeight*v,s=(t.width-f)/2,d=(t.height-u)/2}e.drawImage(l,h,m,g,p,s,d,f,u)}else e.fillStyle="#e0e0e0",e.fillRect(0,0,t.width,t.height),e.strokeStyle="#999999",e.lineWidth=1,e.strokeRect(0,0,t.width,t.height),e.fillStyle="#666666",e.font="12px Arial",e.textAlign="center",e.textBaseline="middle",e.fillText(l.complete?"Erreur":"Chargement...",t.width/2,t.height/2)},A=function(e){var t,n=e.width,g=e.height,p=e.className,y=(0,i.useRef)(null),S=((0,i.useRef)(""),(0,i.useRef)(0)),T=(0,r.nY)(),A=T.state,M=T.dispatch,R=(0,a.h)(),F=x((0,i.useState)({}),2)[1];(0,i.useEffect)(function(){F({})},[R.canvasBackgroundColor,R.borderColor,R.borderWidth,R.shadowEnabled,R.containerBackgroundColor]);var D=x(o().useState({isVisible:!1,position:{x:0,y:0}}),2),W=D[0],P=D[1],O=x(o().useState(0),2),L=O[0],z=O[1],I=(0,l.I7)("memory_limit_js",256),U=R.lazyLoadingEditor,B=x((0,i.useState)(new Set),2),_=(B[0],B[1],x((0,i.useState)({x:0,y:0,width:n,height:g}),2)),H=_[0],j=_[1],N=(0,i.useCallback)(function(e,t){var n=e.x,i=e.y,o=e.width,r=e.height,a=100;return!(n+o<H.x-a||n>H.x+H.width+a||i+r<H.y-a||i>H.y+H.height+a)},[H]),q=(0,i.useMemo)(function(){if(!U)return A.elements;var e=A.elements.slice(0,5),t=A.elements.slice(5).filter(function(e){return N(e,H)});return[].concat(w(e),w(t))},[A.elements,U,H,N]),V=(0,i.useRef)(new Map);(0,i.useEffect)(function(){if(y.current){var e=function(){var e=y.current;if(e){var t=e.getBoundingClientRect();j({x:-t.left,y:-t.top,width:window.innerWidth,height:window.innerHeight})}};return e(),window.addEventListener("scroll",e),window.addEventListener("resize",e),function(){window.removeEventListener("scroll",e),window.removeEventListener("resize",e)}}},[]);var J=(0,i.useRef)(new Map),G=(0,i.useRef)(!1),Q=(0,i.useCallback)(function(e){return e.naturalWidth*e.naturalHeight*4+1024},[]),K=(0,i.useCallback)(function(){var e,t=0,n=v(V.current);try{for(n.s();!(e=n.n()).done;){t+=x(e.value,2)[1].size}}catch(i){n.e(i)}finally{n.f()}return t/1048576},[]),X=(0,i.useCallback)(function(){var e=K(),t=I;if("memory"in performance){var n=performance.memory;if(n.usedJSHeapSize/1048576>.8*(n.jsHeapSizeLimit/1048576))return!0}return e>.8*t},[K,I]),Y=(0,i.useCallback)(function(){var e=V.current,t=K(),n=I;if(X()||e.size>100){var i,o=Array.from(e.entries()).sort(function(e,t){var n=x(e,2)[1],i=x(t,2)[1];return n.lastUsed-i.lastUsed}),r=.7*n,a=Math.max(0,t-r),l=Math.min(20,Math.ceil(.2*e.size)),c=0,s=0,d=v(o);try{for(d.s();!(i=d.n()).done;){var f=x(i.value,2),u=f[0],h=f[1];if(c>=l&&s>=a)break;e.delete(u),s+=h.size/1048576,c++}}catch(m){d.e(m)}finally{d.f()}}},[K,I,X]),$=(0,i.useCallback)(function(){Y()},[Y]);(0,i.useEffect)(function(){return window.canvasMemoryDebug={getCacheStats:function(){return{itemCount:V.current.size,memoryUsage:K(),memoryLimit:I,items:Array.from(V.current.entries()).map(function(e){var t=x(e,2),n=t[0],i=t[1];return{url:n.split("/").pop(),size:(i.size/1048576).toFixed(2)+"MB",lastUsed:new Date(i.lastUsed).toLocaleTimeString()}})}},forceCleanup:$,getBrowserMemory:function(){if("memory"in performance){var e=performance.memory;return{used:(e.usedJSHeapSize/1048576).toFixed(1)+"MB",total:(e.totalJSHeapSize/1048576).toFixed(1)+"MB",limit:(e.jsHeapSizeLimit/1048576).toFixed(1)+"MB"}}return{error:"Performance.memory not available"}}},function(){delete window.canvasMemoryDebug}},[K,I,$]),(0,i.useEffect)(function(){var e=setInterval(function(){if("memory"in performance){var e=performance.memory,t=e.usedJSHeapSize/1048576,n=e.jsHeapSizeLimit/1048576;K();R.debugMode,t>.9*n&&Y()}},1e4);return function(){return clearInterval(e)}},[K,I,Y,R.debugMode]),(0,i.useEffect)(function(){var e=function(e){S.current+=1};return window.addEventListener("pdfBuilderCanvasBgColorChanged",e),function(){window.removeEventListener("pdfBuilderCanvasBgColorChanged",e)}},[]);var Z=(0,c.T)({canvasRef:y,canvasWidth:n,canvasHeight:g,elements:A.elements||[],dragEnabled:null===(t=null==R?void 0:R.selectionDragEnabled)||void 0===t||t}),ee=Z.handleDrop,te=Z.handleDragOver,ne=Z.handleDragLeave,ie=Z.isDragOver,oe=(0,s.g)({canvasRef:y,canvasWidth:n,canvasHeight:g}),re=oe.handleCanvasClick,ae=oe.handleMouseDown,le=oe.handleMouseMove,ce=oe.handleMouseUp,se=oe.handleContextMenu,de=oe.selectionState,fe=((0,d.K)(),(0,i.useCallback)(function(e,t,n,i){var o=Math.min(t.width-20,120),r=Math.min(t.height-20,60),a=10;"center"===n?a=(t.width-o)/2:"right"===n&&(a=t.width-o-10);var l=(t.height-r)/2;e.fillStyle="#f0f0f0",e.strokeStyle="#ccc",e.lineWidth=1,e.fillRect(a,l,o,r),e.strokeRect(a,l,o,r),e.fillStyle="#666",e.font="12px Arial",e.textAlign="center",e.fillText(i,a+o/2,l+r/2+4)},[])),ue=(0,i.useCallback)(function(e,t){var n=t,i=n.src||n.logoUrl||"";if(i){var o=n.alignment||"left",r=J.current.get(t.id);if(i!==r&&J.current.set(t.id,i),e.fillStyle="transparent",e.fillRect(0,0,t.width,t.height),i){var a=V.current.get(i);if(!a){var l=document.createElement("img");return l.crossOrigin="anonymous",l.src=i,l.onerror=function(){},void(l.onload=function(){var e=Q(l);V.current.set(i,{image:l,size:e,lastUsed:Date.now()}),Y(),z(function(e){return e+1})})}var c=a.image;if(a.lastUsed=Date.now(),i&&""!==i.trim())try{var s,d=t.rotation||0,f=void 0!==t.opacity?t.opacity:1,u=t.borderRadius||0,h=t.objectFit||"contain",m=t.width-20,g=t.height-20;s=c.naturalWidth>0&&c.naturalHeight>0?c.naturalWidth/c.naturalHeight:2;var p,b,y=m/g,v=0,w=0;switch(h){case"contain":default:y>s?p=(b=g)*s:b=(p=m)/s;break;case"cover":y>s?w=(g-(b=(p=m)/s))/2:v=(m-(p=(b=g)*s))/2;break;case"fill":p=m,b=g;break;case"none":c.naturalWidth>0&&c.naturalHeight>0?(p=c.naturalWidth,b=c.naturalHeight):(p=Math.min(m,120),b=Math.min(g,60));break;case"scale-down":var x=c.naturalWidth||120,S=c.naturalHeight||60;x<=m&&S<=g?(p=x,b=S):y>s?p=(b=g)*s:b=(p=m)/s}var T=10;"center"===o?T=(t.width-m)/2:"right"===o&&(T=t.width-m-10);var k=(t.height-g)/2,E=T+(m-p)/2+v,A=k+(g-b)/2+w;if(e.save(),f<1&&(e.globalAlpha=f),0!==d){var M=T+p/2,R=k+b/2;e.translate(M,R),e.rotate(d*Math.PI/180),e.translate(-M,-R)}u>0&&(e.beginPath(),C(e,T,k,p,b,u),e.clip()),e.drawImage(c,E,A,p,b),e.restore()}catch(F){fe(e,t,o,"Erreur de chargement")}else fe(e,t,o,"URL manquante")}else fe(e,t,o,"Company_logo")}else fe(e,t,"center","Configurez le logo entreprise")},[fe,Y,Q]),he=(0,i.useCallback)(function(e,t){var n=t,i=n.text||"Texte personnalisable",o=n.fontSize||14,r=n.fontFamily||"Arial",a=n.fontWeight||"normal",l=n.fontStyle||"normal",c=!1!==n.autoWrap;!1!==n.showBackground&&(e.fillStyle=n.backgroundColor||"#e5e7eb",e.fillRect(0,0,t.width,t.height)),e.fillStyle="#000000",e.font="".concat(l," ").concat(a," ").concat(o,"px ").concat(r),e.textAlign="left";var s=i.replace(/\[date\]/g,(new Date).toLocaleDateString("fr-FR")).replace(/\[nom\]/g,"Dupont").replace(/\[prenom\]/g,"Marie").replace(/\[entreprise\]/g,"Ma Soci√©t√©").replace(/\[telephone\]/g,"+33 1 23 45 67 89").replace(/\[email\]/g,"contact@masociete.com").replace(/\[site\]/g,"www.masociete.com").replace(/\[ville\]/g,"Paris").replace(/\[siret\]/g,"123 456 789 00012").replace(/\[tva\]/g,"FR 12 345 678 901").replace(/\[capital\]/g,"10 000").replace(/\[rcs\]/g,"Paris B 123 456 789");if(c){var d=s.split("\n"),f=25;d.forEach(function(n){if(n.trim()){var i=function(t,n){var i,o=[],r="",a=v(t.split(" "));try{for(a.s();!(i=a.n()).done;){var l=i.value,c=r+(r?" ":"")+l;e.measureText(c).width>n&&r?(o.push(r),r=l):r=c}}catch(s){a.e(s)}finally{a.f()}return r&&o.push(r),o}(n,t.width-20);i.forEach(function(t){e.fillText(t,10,f),f+=o+4})}else f+=o+4})}else{var u=s.split("\n"),h=25;u.forEach(function(t){e.fillText(t,10,h),h+=o+4})}},[]),me=(0,i.useCallback)(function(e,t){var n,i=t,o=i.fontSize||10;if("number"==typeof o)n=o;else if("string"==typeof o){var r=o.replace(/px|em|rem|pt|%/g,"").trim();n=parseFloat(r)||10,(o.includes("em")||o.includes("rem"))&&(n*=16)}else n=10;n=Math.max(6,Math.min(72,n));var a=i.fontFamily||"Arial",l=i.fontWeight||"normal",c=i.fontStyle||"normal",s=i.textAlign||"left",d=i.text||"SARL au capital de 10 000‚Ç¨ - RCS Lyon 123 456 789\nTVA FR 12 345 678 901 - SIRET 123 456 789 00012\ncontact@maboutique.com - +33 4 12 34 56 78",f=!1!==i.showSeparator,u=i.separatorStyle||"solid",h={legal:{backgroundColor:"#ffffff",borderColor:"#6b7280",textColor:"#374151",headerTextColor:"#111827"},subtle:{backgroundColor:"#f9fafb",borderColor:"#e5e7eb",textColor:"#6b7280",headerTextColor:"#374151"},minimal:{backgroundColor:"#ffffff",borderColor:"#f3f4f6",textColor:"#9ca3af",headerTextColor:"#6b7280"}},m=h[i.theme||"legal"]||h.legal,g=k(i.backgroundColor||m.backgroundColor),p=k(i.textColor||m.textColor);!1!==i.showBackground&&(e.fillStyle=g,e.fillRect(0,0,t.width,t.height)),e.fillStyle=p;var b=15;f&&(e.strokeStyle=p,e.lineWidth=1,"double"===u?(e.beginPath(),e.moveTo(10,b-5),e.lineTo(t.width-10,b-5),e.stroke(),e.beginPath(),e.moveTo(10,b-2),e.lineTo(t.width-10,b-2),e.stroke()):(e.setLineDash("dashed"===u?[5,5]:"dotted"===u?[2,2]:[]),e.beginPath(),e.moveTo(10,b-5),e.lineTo(t.width-10,b-5),e.stroke(),e.setLineDash([])),b+=10),e.font="".concat(c," ").concat(l," ").concat(n,"px ").concat(a),e.textAlign=s;var y=function(t,n){if(!t)return[""];var i,o=[],r=v(t.split("\n"));try{for(r.s();!(i=r.n()).done;){var a=i.value;if(""!==a.trim()){var l,c=a.split(" "),s=[],d="",f=v(c);try{for(f.s();!(l=f.n()).done;){var u=l.value,h=d?d+" "+u:u;e.measureText(h).width>n&&d?(s.push(d),d=u):d=h}}catch(m){f.e(m)}finally{f.f()}d&&s.push(d),o.push.apply(o,s)}else o.push("")}}catch(m){r.e(m)}finally{r.f()}return o}(d,t.width-20),w=n+2,x=Math.floor((t.height-(f?25:15))/w);y.slice(0,x).forEach(function(n,i){var o="center"===s?t.width/2:"right"===s?t.width-10:10,r=(f?25:15)+i*w;e.fillText(n,o,r)})},[]),ge=(0,i.useCallback)(function(e,t,n){if(!1!==t.visible){if(e.save(),t.rotation){var i=t.width/2,o=t.height/2;e.translate(t.x+i,t.y+o),e.rotate(t.rotation*Math.PI/180),e.translate(-i,-o)}else e.translate(t.x,t.y);switch(t.type){case"rectangle":!function(e,t){var n=t,i=k(n.fillColor||"#ffffff"),o=k(n.strokeColor||"#000000"),r=n.strokeWidth||1,a=n.borderRadius||0;e.fillStyle=i,e.strokeStyle=o,e.lineWidth=r,a>0?(C(e,0,0,t.width,t.height,a),e.fill(),e.stroke()):(e.fillRect(0,0,t.width,t.height),e.strokeRect(0,0,t.width,t.height))}(e,t);break;case"circle":!function(e,t){var n=t,i=k(n.fillColor||"#ffffff"),o=k(n.strokeColor||"#000000"),r=n.strokeWidth||1,a=t.width/2,l=t.height/2,c=Math.min(a,l);e.fillStyle=i,e.strokeStyle=o,e.lineWidth=r,e.beginPath(),e.arc(a,l,c,0,2*Math.PI),e.fill(),e.stroke()}(e,t);break;case"text":!function(e,t){var n=t,i=n.text||"Text",o=n.fontSize||16,r=k(n.color||"#000000"),a=n.align||"left";e.fillStyle=r,e.font="".concat(o,"px Arial"),e.textAlign=a;var l="center"===a?t.width/2:"right"===a?t.width:0;e.fillText(i,l,o)}(e,t);break;case"line":!function(e,t){var n=t,i=k(n.strokeColor||"#000000"),o=n.strokeWidth||2;e.strokeStyle=i,e.lineWidth=o,e.beginPath(),e.moveTo(0,t.height/2),e.lineTo(t.width,t.height/2),e.stroke()}(e,t);break;case"product_table":!function(e,t,n){var i,o=t;if(t.width<100||t.height<50)return e.fillStyle="#f0f0f0",e.fillRect(0,0,t.width,t.height),e.fillStyle="#999999",e.font="12px Arial",e.textAlign="center",void e.fillText("Trop petit",t.width/2,t.height/2);var r,a,l,c,s,d,u=!1!==o.showHeaders,h=!1!==o.showBorders,m=!1!==o.showAlternatingRows,g=o.fontSize||11,p=o.fontFamily||"Arial",b=o.fontWeight||"normal",y=o.fontStyle||"normal",v=!1!==o.showSku,w=!1!==o.showDescription,x=!1!==o.showQuantity,S=!1!==o.showShipping,T=!1!==o.showTax,E=!1!==o.showGlobalDiscount,A=k(o.textColor||"#000000"),M=o.borderRadius||0;if("command"===n.previewMode&&null!==f.U&&void 0!==f.U&&null!==(i=f.U.getOrderData)&&void 0!==i&&i.call(f.U)){var R=f.U.getOrderData();if(R){var F,D,W=(null===(F=f.U.getOrderItems)||void 0===F?void 0:F.call(f.U))||[],P=(null===(D=f.U.getOrderTotals)||void 0===D?void 0:D.call(f.U))||{shipping:0,tax:0,subtotal:0,discount:0};r=W,a=P.shipping,l=P.tax>0?P.tax/P.subtotal*100:20,c=P.discount,s=0,d=R.currency||"‚Ç¨"}else a=o.shippingCost||8.5,l=o.taxRate||20,c=o.globalDiscount||5,s=o.orderFees||2.5,d="‚Ç¨",r=[{sku:"DEMO-001",name:"Sample Product",description:"Demo product",qty:1,price:29.99,discount:0,total:29.99}]}else a=o.shippingCost||8.5,l=o.taxRate||20,c=o.globalDiscount||5,s=o.orderFees||2.5,d="‚Ç¨",r=[{sku:"TSHIRT-001",name:"T-shirt Premium Bio",description:"T-shirt en coton biologique, coupe slim",qty:2,price:29.99,discount:0,total:59.98},{sku:"JEAN-045",name:"Jean Slim Fit Noir",description:"Jean stretch confort, taille haute",qty:1,price:89.99,discount:10,total:79.99},{sku:"SHOES-089",name:"Chaussures Running Pro",description:"Chaussures de running avec semelle amortissante",qty:1,price:129.99,discount:0,total:129.99},{sku:"HOODIE-112",name:"Sweat √† Capuche",description:"Sweat molletonn√©, capuche ajustable",qty:1,price:49.99,discount:5,total:44.99}];var O=r.reduce(function(e,t){return e+t.price*t.qty},0),L=r.reduce(function(e,t){return e+t.discount},0),z=O-L+s,I=c>0&&E?z*c/100:0,U=z-I+(S?a:0),B=l>0&&T?U*l/100:0,_=U+B,H=[];H.push({key:"name",label:"Produit",width:v&&w?.35:v||w?.45:.55,align:"left",x:0}),v&&H.push({key:"sku",label:"SKU",width:.15,align:"left",x:0}),w&&H.push({key:"description",label:"Description",width:.25,align:"left",x:0}),x&&H.push({key:"qty",label:"Qt√©",width:.08,align:"center",x:0}),H.push({key:"price",label:"Prix",width:.12,align:"right",x:0}),H.push({key:"total",label:"Total",width:.12,align:"right",x:0});var j=H.reduce(function(e,t){return e+t.width},0);H.forEach(function(e){return e.width=e.width/j});var N=8;H.forEach(function(e){e.x=N,N+=e.width*(t.width-16)});var q=o.verticalAlign||"top",V=w?50:35,J=(u?35:0)+r.length*(V+4)+60,G=0;"middle"===q?G=Math.max(0,(t.height-J)/2):"bottom"===q&&(G=Math.max(0,t.height-J-10)),e.fillStyle=o.backgroundColor||"#ffffff",e.fillRect(0,0,t.width,t.height),h&&(e.strokeStyle=o.borderColor||"#d1d5db",e.lineWidth=o.borderWidth||1,M>0?(C(e,0,0,t.width,t.height,M),e.stroke()):e.strokeRect(0,0,t.width,t.height)),e.textAlign="left";var Q=(u?25:15)+G;u?(e.fillStyle=o.headerBackgroundColor||"#f9fafb",M>0?(C(e,1,1+G,t.width-2,32,M),e.fill()):e.fillRect(1,1+G,t.width-2,32),e.fillStyle=o.headerTextColor||"#374151",e.font="".concat(y," ").concat(b," ").concat(g+1,"px ").concat(p),e.textBaseline="top",H.forEach(function(n){e.textAlign=n.align;var i="right"===n.align?n.x+n.width*(t.width-16)-4:"center"===n.align?n.x+n.width*(t.width-16)/2:n.x;e.fillText(n.label,i,10+G)}),e.strokeStyle="#e5e7eb",e.lineWidth=1,e.beginPath(),e.moveTo(4,34+G),e.lineTo(t.width-4,34+G),e.stroke(),Q=42+G):Q=15+G,e.font="".concat(y," ").concat(b," ").concat(g,"px ").concat(p),e.textBaseline="middle",r.forEach(function(n,i){var r=Q+i*(V+4);m&&i%2==1&&(e.fillStyle=o.alternateRowColor||"#f9fafb",M>0?(C(e,1,r,t.width-2,V,M),e.fill()):e.fillRect(1,r,t.width-2,V)),e.fillStyle=A,H.forEach(function(i){e.textAlign=i.align;var o="right"===i.align?i.x+i.width*(t.width-16)-4:"center"===i.align?i.x+i.width*(t.width-16)/2:i.x,a="";switch(i.key){case"name":a=n.name;break;case"sku":a=n.sku;break;case"description":a=n.description;break;case"qty":a=n.qty.toString();break;case"price":a="".concat(n.price.toFixed(2)).concat(d);break;case"discount":a=n.discount>0?"".concat(n.discount.toFixed(2)).concat(d):"-";break;case"total":a="".concat(n.total.toFixed(2)).concat(d)}var l=i.width*(t.width-16)-8;if(e.measureText(a).width>l&&"name"===i.key){for(var c=a;e.measureText(c+"...").width>l&&c.length>0;)c=c.slice(0,-1);a=c+"..."}e.fillText(a,o,r+V/2)})}),Q=55+r.length*(V+4)+8,e.strokeStyle="#d1d5db",e.lineWidth=1,e.beginPath(),e.moveTo(t.width-200,Q),e.lineTo(t.width-8,Q),e.stroke(),Q+=20,e.font="bold ".concat(g,"px Arial"),e.fillStyle=A,e.textAlign="left";var K=Q;e.fillText("Sous-total:",t.width-200,K),e.textAlign="right",e.fillText("".concat(z.toFixed(2)).concat(d),t.width-8,K),Q+=18;var X=L+(E?I:0);X>0&&(e.textAlign="left",e.fillStyle="#059669",e.fillText("Coupon:",t.width-200,Q),e.textAlign="right",e.fillText("-".concat(X.toFixed(2)).concat(d),t.width-8,Q),Q+=18),a>0&&S&&(e.textAlign="left",e.fillStyle=A,e.fillText("Frais de port:",t.width-200,Q),e.textAlign="right",e.fillText("".concat(a.toFixed(2)).concat(d),t.width-8,Q),Q+=18),B>0&&T&&(e.textAlign="left",e.fillStyle=A,e.fillText("TVA (".concat(l,"%):"),t.width-200,Q),e.textAlign="right",e.fillText("".concat(B.toFixed(2)).concat(d),t.width-8,Q),Q+=18),Q+=8,e.strokeStyle=A,e.lineWidth=2,e.beginPath(),e.moveTo(t.width-200,Q-5),e.lineTo(t.width-8,Q-5),e.stroke(),Q+=8,e.font="".concat(y," bold ").concat(g+2,"px ").concat(p),e.fillStyle=A,e.textAlign="left",e.fillText("TOTAL:",t.width-200,Q),e.textAlign="right",e.fillText("".concat(_.toFixed(2)).concat(d),t.width-8,Q)}(e,t,n);break;case"customer_info":!function(e,t,n){var i=t,o=i.fontSize||12,r=i.fontFamily||"Arial",a=i.fontWeight||"normal",l=i.fontStyle||"normal",c=i.headerFontSize||o+2,s=i.headerFontFamily||r,d=i.headerFontWeight||a,u=i.headerFontStyle||l,h=i.bodyFontSize||o,m=i.bodyFontFamily||r,g=i.bodyFontWeight||a,p=i.bodyFontStyle||l,b=i.layout||"vertical",y=!1!==i.showHeaders,v=!1!==i.showBorders,w=!1!==i.showFullName,x=!1!==i.showAddress,S=!1!==i.showEmail,T=!1!==i.showPhone,C=!1!==i.showPaymentMethod,E=!1!==i.showTransactionId;!1!==i.showBackground&&(e.fillStyle=i.backgroundColor||"#ffffff",e.fillRect(0,0,t.width,t.height)),v&&(e.strokeStyle=i.borderColor||"#e5e7eb",e.lineWidth=1,e.strokeRect(0,0,t.width,t.height)),e.fillStyle=k(i.textColor||"#000000"),e.font="".concat(u," ").concat(d," ").concat(c,"px ").concat(s),e.textAlign="left";var A,M=y?25:15;if(y&&(e.fillStyle=k(i.headerTextColor||"#111827"),e.fillText("Informations Client",10,M),M+=20,e.fillStyle=k(i.textColor||"#000000")),A="command"===n.previewMode?f.U.getCustomerInfo():{name:"Marie Dupont",address:"15 rue des Lilas, 75001 Paris",email:"marie.dupont@email.com",phone:"+33 6 12 34 56 78"},e.font="".concat(p," ").concat(g," ").concat(h,"px ").concat(m),"vertical"===b)w&&(e.fillText(A.name,10,M),M+=18),x&&(e.fillText(A.address,10,M),M+=18),S&&(e.fillText(A.email,10,M),M+=18),T&&(e.fillText(A.phone,10,M),M+=18),C&&(e.fillText("Paiement: Carte bancaire",10,M),M+=18),E&&e.fillText("ID: TXN123456789",10,M);else if("horizontal"===b){var R="";w&&(R+=A.name),S&&(R+=(R?" - ":"")+A.email),R&&e.fillText(R,10,M),T&&e.fillText(A.phone,t.width-e.measureText(A.phone).width-10,M)}else if("compact"===b){var F="";w&&(F+=A.name),x&&(F+=(F?" ‚Ä¢ ":"")+A.address.split(",")[0]),S&&(F+=(F?" ‚Ä¢ ":"")+A.email),T&&(F+=(F?" ‚Ä¢ ":"")+A.phone);for(var D=t.width-20,W=F.split(" "),P="",O=M,L=0;L<W.length;L++){var z=P+W[L]+" ";e.measureText(z).width>D&&L>0?(e.fillText(P,10,O),P=W[L]+" ",O+=16):P=z}e.fillText(P,10,O)}}(e,t,n);break;case"company_info":!function(e,t){var n=t,i=n.fontSize||12,o=n.fontFamily||"Arial",r=n.fontWeight||"normal",a=n.fontStyle||"normal",l=n.headerFontSize||Math.round(1.2*i),c=n.headerFontFamily||o,s=n.headerFontWeight||"bold",d=n.headerFontStyle||a,f=n.bodyFontSize||i,u=n.bodyFontFamily||o,h=n.bodyFontWeight||r,m=n.bodyFontStyle||a,g=n.theme||"corporate",p=!1!==n.showBackground,b=!1!==n.showBorders,y=!1!==n.showCompanyName,v=!1!==n.showAddress,w=!1!==n.showPhone,x=!1!==n.showEmail,S=!1!==n.showSiret,T=!1!==n.showVat,C=!1!==n.showRcs,E=!1!==n.showCapital,A={corporate:{backgroundColor:"#ffffff",borderColor:"#1f2937",textColor:"#374151",headerTextColor:"#111827"},modern:{backgroundColor:"#ffffff",borderColor:"#3b82f6",textColor:"#1e40af",headerTextColor:"#1e3a8a"},elegant:{backgroundColor:"#ffffff",borderColor:"#8b5cf6",textColor:"#6d28d9",headerTextColor:"#581c87"},minimal:{backgroundColor:"#ffffff",borderColor:"#e5e7eb",textColor:"#374151",headerTextColor:"#111827"},professional:{backgroundColor:"#ffffff",borderColor:"#059669",textColor:"#047857",headerTextColor:"#064e3b"}},M=A[g]||A.corporate,R=k(n.backgroundColor||M.backgroundColor),F=k(n.borderColor||M.borderColor),D=k(n.textColor||M.textColor),W=k(n.headerTextColor||M.headerTextColor);p&&(e.fillStyle=R,e.fillRect(0,0,t.width,t.height)),b&&(e.strokeStyle=F,e.lineWidth=n.borderWidth||1,e.strokeRect(0,0,t.width,t.height)),e.fillStyle=D,e.textAlign="left";var P=10,O=20,L={name:n.companyName||"Ma Boutique En Ligne",address:n.companyAddress||"25 avenue des Commer√ßants",city:n.companyCity||"69000 Lyon",siret:n.companySiret||"SIRET: 123 456 789 00012",tva:n.companyTva||"TVA: FR 12 345 678 901",rcs:n.companyRcs||"RCS: Lyon B 123 456 789",capital:n.companyCapital||"Capital social: 10 000 ‚Ç¨",email:n.companyEmail||"contact@maboutique.com",phone:n.companyPhone||"+33 4 12 34 56 78"};y&&(e.fillStyle=W,e.font="".concat(d," ").concat(s," ").concat(l,"px ").concat(c),e.fillText(L.name,P,O),O+=Math.round(1.5*i),e.fillStyle=D),e.font="".concat(m," ").concat(h," ").concat(f,"px ").concat(u),v&&(e.fillText(L.address,P,O),O+=Math.round(1.2*i),e.fillText(L.city,P,O),O+=Math.round(1.5*i)),S&&(e.fillText(L.siret,P,O),O+=Math.round(1.2*i)),T&&(e.fillText(L.tva,P,O),O+=Math.round(1.2*i)),C&&(e.fillText(L.rcs,P,O),O+=Math.round(1.2*i)),E&&(e.fillText(L.capital,P,O),O+=Math.round(1.2*i)),x&&(e.fillText(L.email,P,O),O+=Math.round(1.2*i)),w&&e.fillText(L.phone,P,O)}(e,t);break;case"company_logo":ue(e,t);break;case"order_number":!function(e,t,n){try{var i,o,r=t,a=r.fontSize||14,l=r.fontFamily||"Arial",c=r.fontWeight||"normal",s=r.fontStyle||"normal",d=r.labelFontSize||a,u=r.labelFontFamily||l,h=r.labelFontWeight||"bold",m=r.labelFontStyle||s,g=r.numberFontSize||a,p=r.numberFontFamily||l,b=r.numberFontWeight||c,y=r.numberFontStyle||s,v=r.dateFontSize||a-2,w=r.dateFontFamily||l,x=r.dateFontWeight||c,S=r.dateFontStyle||s,T=r.contentAlign||"left",k=!1!==r.showLabel,C=!1!==r.showDate,E=r.labelPosition||"above",A=r.labelText||"N¬∞ de commande:";!1!==r.showBackground&&(e.fillStyle=r.backgroundColor||"#e5e7eb",e.fillRect(0,0,t.width,t.height)),e.fillStyle="#000000","command"===n.previewMode?(i=f.U.getOrderNumber(),o=f.U.getOrderDate()):(i=f.U.getOrderNumber()||"CMD-2024-01234",o=f.U.getOrderDate()||"27/10/2024");var M=20,R=0;if(k)if("above"===E||"below"===E){e.font="".concat(m," ").concat(h," ").concat(d,"px ").concat(u);var F=e.measureText(A).width;e.font="".concat(y," ").concat(b," ").concat(g,"px ").concat(p);var D=e.measureText(i).width;R=Math.max(F,D)}else{e.font="".concat(m," ").concat(h," ").concat(d,"px ").concat(u);var W=e.measureText(A).width;e.font="".concat(y," ").concat(b," ").concat(g,"px ").concat(p),R=W+e.measureText(i).width+15}else e.font="".concat(y," ").concat(b," ").concat(g,"px ").concat(p),R=e.measureText(i).width;var P=0;if("center"===T?P=(t.width-R)/2-10:"right"===T&&(P=t.width-R-20),k){if("above"===E){e.font="".concat(m," ").concat(h," ").concat(d,"px ").concat(u),e.textAlign=T;var O="left"===T?10+P:"center"===T?t.width/2:t.width-10;e.fillText(A,O,M),M+=18,e.font="".concat(y," ").concat(b," ").concat(g,"px ").concat(p),e.textAlign=T;var L="left"===T?10+P:"center"===T?t.width/2:t.width-10;e.fillText(i,L,M)}else if("below"===E){e.font="".concat(y," ").concat(b," ").concat(g,"px ").concat(p),e.textAlign=T;var z="left"===T?10+P:"center"===T?t.width/2:t.width-10;e.fillText(i,z,M),M+=18,e.font="".concat(m," ").concat(h," ").concat(d,"px ").concat(u),e.textAlign=T;var I="left"===T?10+P:"center"===T?t.width/2:t.width-10;e.fillText(A,I,M)}else if("left"===E){e.font="".concat(m," ").concat(h," ").concat(d,"px ").concat(u),e.textAlign="left";var U=10+P;e.fillText(A,U,M);var B=U+e.measureText(A).width+15;e.font="".concat(y," ").concat(b," ").concat(g,"px ").concat(p),e.textAlign="left",e.fillText(i,B,M)}else if("right"===E){e.font="".concat(y," ").concat(b," ").concat(g,"px ").concat(p),e.textAlign="left";var _=10+P;e.fillText(i,_,M);var H=_+e.measureText(i).width+15;e.font="".concat(m," ").concat(h," ").concat(d,"px ").concat(u),e.textAlign="left",e.fillText(A,H,M)}}else e.font="".concat(y," ").concat(b," ").concat(g,"px ").concat(p),e.textAlign=T,"left"===T?e.fillText(i,10,M):"center"===T?e.fillText(i,t.width/2,M):e.fillText(i,t.width-10,M);C&&(e.font="".concat(S," ").concat(x," ").concat(v,"px ").concat(w),e.textAlign=T,"left"===T?e.fillText("Date: ".concat(o),10,M+20):"center"===T?e.fillText("Date: ".concat(o),t.width/2,M+20):e.fillText("Date: ".concat(o),t.width-10,M+20))}catch(j){}}(e,t,n);break;case"document_type":!function(e,t,n){var i,o=t,r=o.fontSize||18,a=o.fontFamily||"Arial",l=o.fontWeight||"bold",c=o.fontStyle||"normal",s=o.textAlign||"left",d=o.textColor||"#000000";!1!==o.showBackground&&(e.fillStyle=o.backgroundColor||"#e5e7eb",e.fillRect(0,0,t.width,t.height)),e.fillStyle=d,e.font="".concat(c," ").concat(l," ").concat(r,"px ").concat(a),e.textAlign=s,i={FACTURE:"FACTURE",DEVIS:"DEVIS",BON_COMMANDE:"BON DE COMMANDE",AVOIR:"AVOIR",RELEVE:"RELEVE",CONTRAT:"CONTRAT"}[(n.previewMode,i=o.documentType||"FACTURE")]||i;var f="center"===s?t.width/2:"right"===s?t.width-10:10,u=t.height/2+r/3;e.fillText(i,f,u)}(e,t,n);break;case"dynamic-text":he(e,t);break;case"mentions":me(e,t);break;case"image":E(e,t,V);break;default:e.strokeStyle="#000000",e.lineWidth=1,e.strokeRect(0,0,t.width,t.height)}e.restore()}},[ue,he,me,R]),pe=(0,i.useCallback)(function(e,t,n){var i=n.filter(function(e){return t.includes(e.id)});if(0!==i.length){var o=1/0,r=1/0,a=-1/0,l=-1/0;if(i.forEach(function(e){o=Math.min(o,e.x),r=Math.min(r,e.y),a=Math.max(a,e.x+e.width),l=Math.max(l,e.y+e.height)}),e.strokeStyle="#007acc",e.lineWidth=1,e.setLineDash([5,5]),e.strokeRect(o-2,r-2,a-o+4,l-r+4),null!=R&&R.selectionShowHandles){e.fillStyle="#007acc",e.setLineDash([]),e.fillRect(o-3,r-3,6,6),e.fillRect(a-3,r-3,6,6),e.fillRect(o-3,l-3,6,6),e.fillRect(a-3,l-3,6,6);var c=(o+a)/2,s=(r+l)/2;e.fillRect(c-3,r-3,6,6),e.fillRect(c-3,l-3,6,6),e.fillRect(o-3,s-3,6,6),e.fillRect(a-3,s-3,6,6)}if(null!=R&&R.selectionRotationEnabled){var d=i.some(function(e){var t=(e.rotation||0)%360;return t>180&&(t-=360),t<-180&&(t+=360),Math.abs(t-0)<=10})?"#00cc44":"#007acc";e.fillStyle=d,e.strokeStyle=d,e.lineWidth=2,e.setLineDash([]);var f=(o+a)/2,u=(r+l)/2,h=f,m=r-20;e.beginPath(),e.arc(h,m,4,0,2*Math.PI),e.fill(),e.beginPath(),e.moveTo(f,u),e.lineTo(h,m),e.stroke()}i.forEach(function(n){if(t.includes(n.id)){var i=n.x,o=n.y,r=n.width,a=n.height;e.font="11px Arial",e.fillStyle="#007acc",e.textAlign="right",e.textBaseline="top";var l="".concat((1*r).toFixed(1),"√ó").concat((1*a).toFixed(1),"px"),c=e.measureText(l).width;e.fillStyle="white",e.fillRect(i+r-c-8,o-20,c+8,18),e.fillStyle="#007acc",e.font="bold 11px Arial",e.fillText(l,i+r-4,o-16)}})}},[R]),be=(0,i.useCallback)(function(e,t,n){P({isVisible:!0,position:{x:e,y:t},elementId:n})},[]),ye=(0,i.useCallback)(function(){P(function(e){return b(b({},e),{},{isVisible:!1})})},[]),ve=(0,i.useCallback)(function(e,t){if(t)switch(e){case"bring-to-front":var n=A.elements.findIndex(function(e){return e.id===t});if(-1!==n){var i=A.elements[n],o=[].concat(w(A.elements.slice(0,n)),w(A.elements.slice(n+1)),[i]);M({type:"SET_ELEMENTS",payload:o})}break;case"send-to-back":var r=A.elements.findIndex(function(e){return e.id===t});if(-1!==r){var a=[A.elements[r]].concat(w(A.elements.slice(0,r)),w(A.elements.slice(r+1)));M({type:"SET_ELEMENTS",payload:a})}break;case"bring-forward":var l=A.elements.findIndex(function(e){return e.id===t});if(-1!==l&&l<A.elements.length-1){var c=w(A.elements),s=[c[l+1],c[l]];c[l]=s[0],c[l+1]=s[1],M({type:"SET_ELEMENTS",payload:c})}break;case"send-backward":var d=A.elements.findIndex(function(e){return e.id===t});if(d>0){var f=w(A.elements),u=[f[d-1],f[d]];f[d]=u[0],f[d-1]=u[1],M({type:"SET_ELEMENTS",payload:f})}break;case"duplicate":var h=A.elements.find(function(e){return e.id===t});if(h){var m=b(b({},h),{},{id:"element_".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9)),x:h.x+10,y:h.y+10,createdAt:new Date,updatedAt:new Date});M({type:"ADD_ELEMENT",payload:m})}break;case"copy":A.elements.find(function(e){return e.id===t});break;case"cut":A.elements.find(function(e){return e.id===t});break;case"reset-size":var g=A.elements.find(function(e){return e.id===t});if(g){var p={rectangle:{width:100,height:100},circle:{width:100,height:100},text:{width:100,height:30},line:{width:100,height:2},product_table:{width:400,height:200},customer_info:{width:300,height:80},company_info:{width:300,height:120},company_logo:{width:150,height:80},order_number:{width:200,height:40},document_type:{width:150,height:30},"dynamic-text":{width:200,height:60},mentions:{width:400,height:80}}[g.type]||{width:100,height:100};M({type:"UPDATE_ELEMENT",payload:{id:t,updates:{width:p.width,height:p.height}}})}break;case"fit-to-content":var y=A.elements.find(function(e){return e.id===t});if(y&&("text"===y.type||"dynamic-text"===y.type)){var v=document.createElement("canvas").getContext("2d");if(v){var x=y,S=x.fontSize||14,T=x.fontFamily||"Arial",k=x.fontWeight||"normal",C=x.fontStyle||"normal";v.font="".concat(C," ").concat(k," ").concat(S,"px ").concat(T);var E=S+4,R=(x.text||"Texte").split("\n").length*E+20;M({type:"UPDATE_ELEMENT",payload:{id:t,updates:{height:Math.max(R,30)}}})}}break;case"delete":M({type:"REMOVE_ELEMENT",payload:t});break;case"lock":var F=A.elements.find(function(e){return e.id===t});F&&M({type:"UPDATE_ELEMENT",payload:{id:t,updates:{locked:!F.locked}}})}},[A.elements,M]),we=(0,i.useCallback)(function(e){if(!e)return[{id:"section-edit",section:"√âDITION"},{id:"paste",label:"Coller",icon:"üìã",shortcut:"Ctrl+V",action:function(){},disabled:!0},{id:"select-all",label:"Tout s√©lectionner",icon:"‚òëÔ∏è",shortcut:"Ctrl+A",action:function(){var e=A.elements.map(function(e){return e.id});M({type:"SET_SELECTION",payload:e})}}];var t=A.elements.find(function(t){return t.id===e}),n=(null==t?void 0:t.locked)||!1;return[{id:"section-layers",section:"CALQUES"},{id:"layer-order",label:"Ordre des calques",icon:"üìö",children:[{id:"bring-to-front",label:"Premier plan",icon:"‚¨ÜÔ∏è",shortcut:"Ctrl+‚Üë",action:function(){return ve("bring-to-front",e)},disabled:n},{id:"send-to-back",label:"Arri√®re plan",icon:"‚¨áÔ∏è",shortcut:"Ctrl+‚Üì",action:function(){return ve("send-to-back",e)},disabled:n},{id:"bring-forward",label:"Avancer d'un plan",icon:"‚ÜóÔ∏è",shortcut:"Ctrl+Shift+‚Üë",action:function(){return ve("bring-forward",e)},disabled:n},{id:"send-backward",label:"Reculer d'un plan",icon:"‚ÜôÔ∏è",shortcut:"Ctrl+Shift+‚Üì",action:function(){return ve("send-backward",e)},disabled:n}]},{id:"separator1",separator:!0},{id:"section-edit",section:"√âDITION"},{id:"duplicate",label:"Dupliquer",icon:"üìã",shortcut:"Ctrl+D",action:function(){return ve("duplicate",e)},disabled:n,children:[{id:"duplicate-here",label:"Dupliquer ici",icon:"üìã",action:function(){return ve("duplicate",e)},disabled:n},{id:"duplicate-multiple",label:"Dupliquer plusieurs...",icon:"üìãüìã",action:function(){return ve("duplicate-multiple",e)},disabled:n}]},{id:"clipboard",label:"Presse-papiers",icon:"üìÑ",children:[{id:"copy",label:"Copier",icon:"üìÑ",shortcut:"Ctrl+C",action:function(){return ve("copy",e)},disabled:!1},{id:"cut",label:"Couper",icon:"‚úÇÔ∏è",shortcut:"Ctrl+X",action:function(){return ve("cut",e)},disabled:n}]},{id:"separator2",separator:!0},{id:"section-size",section:"TAILLE"},{id:"reset-size",label:"Taille par d√©faut",icon:"üìè",shortcut:"Ctrl+0",action:function(){return ve("reset-size",e)},disabled:n},{id:"fit-to-content",label:"Ajuster au contenu",icon:"üìê",shortcut:"Ctrl+Shift+F",action:function(){return ve("fit-to-content",e)},disabled:n||!("text"===(null==t?void 0:t.type)||"dynamic-text"===(null==t?void 0:t.type))},{id:"separator3",separator:!0},{id:"section-state",section:"√âTAT"},{id:"lock",label:n?"D√©verrouiller":"Verrouiller",icon:n?"üîì":"üîí",shortcut:n?"Ctrl+Shift+L":"Ctrl+L",action:function(){return ve("lock",e)}},{id:"separator4",separator:!0},{id:"section-danger",section:"SUPPRESSION"},{id:"delete",label:"Supprimer",icon:"üóëÔ∏è",shortcut:"Suppr",action:function(){return ve("delete",e)},disabled:!1}]},[A.elements,ve,M]),xe=(0,i.useCallback)(function(e,t,n,i,o){e.strokeStyle=o,e.lineWidth=1;for(var r=0;r<=t;r+=i)e.beginPath(),e.moveTo(r,0),e.lineTo(r,n),e.stroke();for(var a=0;a<=n;a+=i)e.beginPath(),e.moveTo(0,a),e.lineTo(t,a),e.stroke()},[]),Se=(0,i.useCallback)(function(e,t,n){e.save(),e.strokeStyle="#007acc",e.lineWidth=1,e.setLineDash([5,5]),e.beginPath(),e.moveTo(0,n/2),e.lineTo(t,n/2),e.stroke(),e.beginPath(),e.moveTo(t/2,0),e.lineTo(t/2,n),e.stroke(),e.restore()},[]),Te=(0,i.useCallback)(function(e){e.preventDefault(),se(e,function(e,t,n){be(e,t,n)})},[se,be]),ke=(0,i.useCallback)(function(){var e=y.current;if(e){var t=e.getContext("2d");if(t){var i=k((null==R?void 0:R.canvasBackgroundColor)||"#ffffff");if(t.fillStyle=i,t.fillRect(0,0,n,g),A.elements.length,t.save(),t.translate(A.canvas.pan.x,A.canvas.pan.y),null!=R&&R.gridShow&&A.canvas.showGrid&&xe(t,n,g,(null==R?void 0:R.gridSize)||20,(null==R?void 0:R.gridColor)||"#e0e0e0"),null!=R&&R.guidesEnabled&&A.template.showGuides&&Se(t,n,g),q.forEach(function(e){ge(t,e,A)}),null!=de&&de.isSelecting)if("rectangle"===de.selectionMode&&de.selectionRect.width>0&&de.selectionRect.height>0)t.save(),t.strokeStyle="#0066cc",t.lineWidth=1,t.setLineDash([5,5]),t.strokeRect(de.selectionRect.x,de.selectionRect.y,de.selectionRect.width,de.selectionRect.height),t.fillStyle="rgba(0, 102, 204, 0.1)",t.fillRect(de.selectionRect.x,de.selectionRect.y,de.selectionRect.width,de.selectionRect.height),t.restore();else if("lasso"===de.selectionMode&&de.selectionPoints.length>1){t.save(),t.strokeStyle="#0066cc",t.lineWidth=1,t.setLineDash([5,5]),t.beginPath(),t.moveTo(de.selectionPoints[0].x,de.selectionPoints[0].y);for(var o=1;o<de.selectionPoints.length;o++)t.lineTo(de.selectionPoints[o].x,de.selectionPoints[o].y);t.closePath(),t.stroke(),t.fillStyle="rgba(0, 102, 204, 0.1)",t.fill(),t.restore()}A.selection.selectedElements.length>0&&pe(t,A.selection.selectedElements,A.elements),t.restore()}}},[n,g,R,A,ge,xe,Se,de,pe,q]);(0,i.useEffect)(function(){ke()},[ke,L,null==de?void 0:de.updateTrigger]),(0,i.useEffect)(function(){ke()},[ke]),(0,i.useEffect)(function(){if(A.elements.length>0&&!G.current){G.current=!0;var e=setTimeout(function(){z(function(e){return e+1})},100),t=setTimeout(function(){z(function(e){return e+1})},500),n=setTimeout(function(){z(function(e){return e+1})},1e3),i=setTimeout(function(){z(function(e){return e+1})},2e3);return function(){clearTimeout(e),clearTimeout(t),clearTimeout(n),clearTimeout(i)}}},[A.elements.length]),(0,i.useEffect)(function(){var e=function(e){A.template.isModified&&e.preventDefault()};return window.addEventListener("beforeunload",e),function(){return window.removeEventListener("beforeunload",e)}},[A.template.isModified]),(0,i.useEffect)(function(){u.d.initialize()},[]);var Ce=ie?"2px solid #007acc":null!=R&&R.borderWidth&&R.borderWidth>0?"".concat(R.borderWidth,"px solid ").concat((null==R?void 0:R.borderColor)||"#cccccc"):"none",Ee=A.canvas.zoom/100,Ae=n*Ee,Me=g*Ee;return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)("canvas",{ref:y,width:n,height:g,className:p,onClick:re,onMouseDown:ae,onMouseMove:le,onMouseUp:ce,onContextMenu:Te,onDrop:ee,onDragOver:te,onDragLeave:ne,style:{width:"".concat(Ae,"px"),height:"".concat(Me,"px"),border:Ce,cursor:"crosshair",backgroundColor:(null==R?void 0:R.canvasBackgroundColor)||"#ffffff",boxShadow:null!=R&&R.shadowEnabled?"2px 8px 16px rgba(0, 0, 0, 0.3), 0 4px 8px rgba(0, 0, 0, 0.2)":"none",transition:"border-color 0.2s ease, box-shadow 0.2s ease"}}),W.isVisible&&(0,m.jsx)(h.t,{items:we(W.elementId),position:W.position,onClose:ye,isVisible:W.isVisible})]})}}}]);