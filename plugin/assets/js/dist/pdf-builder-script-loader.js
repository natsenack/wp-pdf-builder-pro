class ScriptLoader{static loadingScripts=new Map;static loadedScripts=new Set;static dependencyQueues=new Map;static defaultConfig={criticalScripts:["jquery","jquery-core"],deferThreshold:2e3,preloadCritical:!0,enableIntersectionObserver:!0};static init(e={}){const t={...this.defaultConfig,...e};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{setTimeout(()=>this.optimizeLoading(t),t.deferThreshold)}):setTimeout(()=>this.optimizeLoading(t),t.deferThreshold),t.preloadCritical&&this.preloadCriticalResources()}static optimizeLoading(e){const t=document.querySelectorAll("script[src]"),i=[];t.forEach(t=>{const r=t.getAttribute("src");r&&!this.isCriticalScript(r,e.criticalScripts)&&i.push(t)}),i.forEach(e=>{this.deferScript(e)})}static isCriticalScript(e,t){return t.some(t=>e.includes(t))}static deferScript(e){const t=e.getAttribute("src"),i=e.parentNode,r=document.createComment(`Deferred script: ${t}`);i.replaceChild(r,e),this.loadScriptAsync(t,e).then(()=>{i.replaceChild(e,r)}).catch(t=>{i.replaceChild(e,r)})}static loadScriptAsync(e,t){return new Promise((i,r)=>{if(this.loadingScripts.has(e))return void this.loadingScripts.get(e).push({resolve:i,reject:r});if(this.loadedScripts.has(e))return void i();this.loadingScripts.set(e,[{resolve:i,reject:r}]);const c=document.createElement("script");c.src=e,c.async=!0,t.hasAttribute("integrity")&&(c.integrity=t.getAttribute("integrity")),t.hasAttribute("crossorigin")&&(c.crossOrigin=t.getAttribute("crossorigin")),c.onload=()=>{this.loadedScripts.add(e);(this.loadingScripts.get(e)||[]).forEach(({resolve:e})=>e()),this.loadingScripts.delete(e)},c.onerror=t=>{(this.loadingScripts.get(e)||[]).forEach(({reject:e})=>e(t)),this.loadingScripts.delete(e)},document.head.appendChild(c)})}static preloadCriticalResources(){[].forEach(e=>{const t=document.createElement("link");t.rel="preload",t.href=e,t.as="font",t.crossOrigin="anonymous",document.head.appendChild(t)});document.querySelectorAll('link[rel="stylesheet"]').forEach(e=>{e.href&&e.href.includes("pdf-builder-admin")&&(e.rel="preload",e.as="style",e.onload=function(){this.rel="stylesheet"},document.head.appendChild(e.cloneNode()))})}static loadScriptWithDeps(e,t=[],i={}){return new Promise((i,r)=>{const c=t.filter(e=>!this.loadedScripts.has(e));if(c.length>0)return this.dependencyQueues.has(e)||this.dependencyQueues.set(e,[]),this.dependencyQueues.get(e).push({resolve:i,reject:r,dependencies:c}),void c.forEach(t=>{this.loadScriptAsync(t,document.createElement("script")).then(()=>this.checkDependencyQueue(e)).catch(r)});this.loadScriptAsync(e,document.createElement("script")).then(i).catch(r)})}static checkDependencyQueue(e){const t=this.dependencyQueues.get(e);if(!t)return;const i=t.filter(e=>e.dependencies.every(e=>this.loadedScripts.has(e)));i.forEach(t=>{this.loadScriptAsync(e,document.createElement("script")).then(t.resolve).catch(t.reject)}),t.splice(0,i.length),0===t.length&&this.dependencyQueues.delete(e)}static getPerformanceMetrics(){const e={scriptsLoaded:this.loadedScripts.size,scriptsLoading:this.loadingScripts.size,dependencyQueues:this.dependencyQueues.size,totalScripts:document.querySelectorAll("script[src]").length};if(window.performance&&window.performance.getEntriesByType){const t=window.performance.getEntriesByType("navigation")[0];t&&(e.domContentLoaded=t.domContentLoadedEventEnd-t.domContentLoadedEventStart,e.loadComplete=t.loadEventEnd-t.loadEventStart)}return e}static cleanup(){this.loadingScripts.clear(),this.loadedScripts.clear(),this.dependencyQueues.clear()}}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>ScriptLoader.init()):ScriptLoader.init(),"undefined"!=typeof module&&module.exports&&(module.exports=ScriptLoader),window.ScriptLoader=ScriptLoader;