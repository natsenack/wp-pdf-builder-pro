{"version":3,"file":"js/settings-global-save.bundle.js","mappings":";;;;;;;;AAAA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;;AAEA;AACA;AAEA;AACA;AACA;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAAA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AAEA","sources":["webpack://wp-pdf-builder-pro/./assets/js/settings-global-save.js"],"sourcesContent":["/**\r\n * PDF Builder Settings Global Save System\r\n * Handles global save functionality for all settings tabs\r\n */\r\n\r\n(function($) {\r\n    'use strict';\r\n\r\n    // Global settings save system\r\n    window.PDFBuilderSettingsSaver = {\r\n\r\n        /**\r\n         * Collect all settings from a specific tab\r\n         * @param {string} tabId - The tab ID to collect settings from\r\n         * @returns {Object} Collected settings data\r\n         */\r\n        collectTabSettings: function(tabId) {\r\n            const settings = {};\r\n            const tabContainer = document.getElementById('pdf-builder-tab-' + tabId);\r\n\r\n            if (!tabContainer) {\r\n                console.warn('[PDF Builder] Tab container not found:', tabId);\r\n                return settings;\r\n            }\r\n\r\n            // Find all input, select, and textarea elements within the tab\r\n            const inputs = tabContainer.querySelectorAll('input, select, textarea');\r\n\r\n            inputs.forEach(function(element) {\r\n                const name = element.name;\r\n                if (!name) return;\r\n\r\n                let value;\r\n\r\n                // Handle different input types\r\n                switch (element.type) {\r\n                    case 'checkbox':\r\n                        value = element.checked ? '1' : '0';\r\n                        break;\r\n                    case 'radio':\r\n                        if (element.checked) {\r\n                            value = element.value;\r\n                        } else {\r\n                            return; // Skip unchecked radio buttons\r\n                        }\r\n                        break;\r\n                    case 'number':\r\n                    case 'range':\r\n                        value = element.value ? parseFloat(element.value) : '';\r\n                        break;\r\n                    default:\r\n                        value = element.value || '';\r\n                }\r\n\r\n                // Remove 'pdf_builder_' prefix if present and add tab prefix\r\n                const cleanName = name.replace(/^pdf_builder_/, '');\r\n                const prefixedName = tabId + '_' + cleanName;\r\n\r\n                settings[prefixedName] = value;\r\n            });\r\n\r\n            return settings;\r\n        },\r\n\r\n        /**\r\n         * Collect all settings from all tabs\r\n         * @returns {Object} All collected settings data\r\n         */\r\n        collectAllSettings: function() {\r\n            const allSettings = {};\r\n            const tabs = ['general', 'appearance', 'security', 'advanced'];\r\n\r\n            tabs.forEach(function(tabId) {\r\n                const tabSettings = this.collectTabSettings(tabId);\r\n                Object.assign(allSettings, tabSettings);\r\n            }.bind(this));\r\n\r\n            return allSettings;\r\n        },\r\n\r\n        /**\r\n         * Save settings for a specific tab\r\n         * @param {string} tabId - The tab ID to save\r\n         * @param {Object} settings - Settings data to save\r\n         * @returns {Promise} Promise that resolves with the AJAX response\r\n         */\r\n        saveTabSettings: function(tabId, settings) {\r\n            return new Promise(function(resolve, reject) {\r\n                const nonce = window.pdfBuilderAjax ? window.pdfBuilderAjax.nonce : '';\r\n\r\n                $.ajax({\r\n                    url: window.ajaxurl || window.pdfBuilderAjax.ajaxUrl,\r\n                    type: 'POST',\r\n                    data: {\r\n                        action: 'pdf_builder_save_' + tabId,\r\n                        _wpnonce: nonce,\r\n                        ...settings\r\n                    },\r\n                    success: function(response) {\r\n                        if (response.success) {\r\n                            resolve(response);\r\n                        } else {\r\n                            reject(new Error(response.data || 'Unknown error'));\r\n                        }\r\n                    },\r\n                    error: function(xhr, status, error) {\r\n                        reject(new Error('AJAX Error: ' + error));\r\n                    }\r\n                });\r\n            });\r\n        },\r\n\r\n        /**\r\n         * Save all settings globally across all tabs\r\n         * @returns {Promise} Promise that resolves when all saves are complete\r\n         */\r\n        saveAllSettingsGlobally: function() {\r\n            const self = this;\r\n            const tabs = ['general', 'licence', 'systeme', 'securite', 'pdf', 'contenu', 'templates', 'developpeur'];\r\n            const promises = [];\r\n\r\n            // Show loading state\r\n            this.showGlobalSaveLoading();\r\n\r\n            tabs.forEach(function(tabId) {\r\n                const settings = self.collectTabSettings(tabId);\r\n                if (Object.keys(settings).length > 0) {\r\n                    promises.push(self.saveTabSettings(tabId, settings));\r\n                }\r\n            });\r\n\r\n            return Promise.all(promises)\r\n                .then(function(results) {\r\n                    self.hideGlobalSaveLoading();\r\n                    self.showGlobalSaveSuccess();\r\n                    return results;\r\n                })\r\n                .catch(function(error) {\r\n                    self.hideGlobalSaveLoading();\r\n                    self.showGlobalSaveError(error.message);\r\n                    throw error;\r\n                });\r\n        },\r\n\r\n        /**\r\n         * Show global save loading state\r\n         */\r\n        showGlobalSaveLoading: function() {\r\n            const button = document.getElementById('pdf-builder-global-save-btn');\r\n            if (button) {\r\n                button.disabled = true;\r\n                button.innerHTML = '<span class=\"spinner is-active\"></span> Sauvegarde...';\r\n            }\r\n        },\r\n\r\n        /**\r\n         * Hide global save loading state\r\n         */\r\n        hideGlobalSaveLoading: function() {\r\n            const button = document.getElementById('pdf-builder-global-save-btn');\r\n            if (button) {\r\n                button.disabled = false;\r\n                button.innerHTML = 'Sauvegarder Tout';\r\n            }\r\n        },\r\n\r\n        /**\r\n         * Show global save success message\r\n         */\r\n        showGlobalSaveSuccess: function() {\r\n            this.showGlobalSaveMessage('Paramètres sauvegardés avec succès!', 'success');\r\n        },\r\n\r\n        /**\r\n         * Show global save error message\r\n         */\r\n        showGlobalSaveError: function(message) {\r\n            this.showGlobalSaveMessage('Erreur lors de la sauvegarde: ' + message, 'error');\r\n        },\r\n\r\n        /**\r\n         * Show global save message\r\n         */\r\n        showGlobalSaveMessage: function(message, type) {\r\n            // Remove existing messages\r\n            const existingMessages = document.querySelectorAll('.pdf-builder-global-save-message');\r\n            existingMessages.forEach(function(msg) {\r\n                msg.remove();\r\n            });\r\n\r\n            // Create new message\r\n            const messageDiv = document.createElement('div');\r\n            messageDiv.className = 'pdf-builder-global-save-message notice notice-' + type + ' is-dismissible';\r\n            messageDiv.innerHTML = '<p>' + message + '</p>';\r\n\r\n            // Add close button functionality\r\n            const closeBtn = document.createElement('button');\r\n            closeBtn.type = 'button';\r\n            closeBtn.className = 'notice-dismiss';\r\n            closeBtn.addEventListener('click', function() {\r\n                messageDiv.remove();\r\n            });\r\n            messageDiv.appendChild(closeBtn);\r\n\r\n            // Insert after the global save button\r\n            const button = document.getElementById('pdf-builder-global-save-btn');\r\n            if (button && button.parentNode) {\r\n                button.parentNode.insertBefore(messageDiv, button.nextSibling);\r\n            }\r\n\r\n            // Auto-hide success messages after 5 seconds\r\n            if (type === 'success') {\r\n                setTimeout(function() {\r\n                    if (messageDiv.parentNode) {\r\n                        messageDiv.remove();\r\n                    }\r\n                }, 5000);\r\n            }\r\n        },\r\n\r\n        /**\r\n         * Initialize the global save system\r\n         */\r\n        init: function() {\r\n            const self = this;\r\n\r\n            // Bind global save button\r\n            const globalSaveBtn = document.getElementById('pdf-builder-global-save-btn');\r\n            if (globalSaveBtn) {\r\n                globalSaveBtn.addEventListener('click', function(e) {\r\n                    e.preventDefault();\r\n                    self.saveAllSettingsGlobally().catch(function(error) {\r\n                        console.error('[PDF Builder] Global save failed:', error);\r\n                    });\r\n                });\r\n            }\r\n\r\n            // Bind individual tab save buttons (if they exist)\r\n            const tabs = ['general', 'licence', 'systeme', 'securite', 'pdf', 'contenu', 'templates', 'developpeur'];\r\n            tabs.forEach(function(tabId) {\r\n                const tabSaveBtn = document.getElementById('pdf-builder-save-' + tabId + '-btn');\r\n                if (tabSaveBtn) {\r\n                    tabSaveBtn.addEventListener('click', function(e) {\r\n                        e.preventDefault();\r\n                        const settings = self.collectTabSettings(tabId);\r\n                        self.saveTabSettings(tabId, settings)\r\n                            .then(function() {\r\n                                self.showTabSaveSuccess(tabId);\r\n                            })\r\n                            .catch(function(error) {\r\n                                self.showTabSaveError(tabId, error.message);\r\n                            });\r\n                    });\r\n                }\r\n            });\r\n        },\r\n\r\n        /**\r\n         * Show tab-specific save success\r\n         */\r\n        showTabSaveSuccess: function(tabId) {\r\n            this.showTabSaveMessage(tabId, 'Paramètres sauvegardés!', 'success');\r\n        },\r\n\r\n        /**\r\n         * Show tab-specific save error\r\n         */\r\n        showTabSaveError: function(tabId, message) {\r\n            this.showTabSaveMessage(tabId, 'Erreur: ' + message, 'error');\r\n        },\r\n\r\n        /**\r\n         * Show tab-specific save message\r\n         */\r\n        showTabSaveMessage: function(tabId, message, type) {\r\n            const tabContainer = document.getElementById('pdf-builder-tab-' + tabId);\r\n            if (!tabContainer) return;\r\n\r\n            // Remove existing messages in this tab\r\n            const existingMessages = tabContainer.querySelectorAll('.pdf-builder-tab-save-message');\r\n            existingMessages.forEach(function(msg) {\r\n                msg.remove();\r\n            });\r\n\r\n            // Create new message\r\n            const messageDiv = document.createElement('div');\r\n            messageDiv.className = 'pdf-builder-tab-save-message notice notice-' + type;\r\n            messageDiv.innerHTML = '<p>' + message + '</p>';\r\n\r\n            // Insert at the top of the tab\r\n            const firstElement = tabContainer.firstElementChild;\r\n            tabContainer.insertBefore(messageDiv, firstElement);\r\n\r\n            // Auto-hide success messages after 3 seconds\r\n            if (type === 'success') {\r\n                setTimeout(function() {\r\n                    if (messageDiv.parentNode) {\r\n                        messageDiv.remove();\r\n                    }\r\n                }, 3000);\r\n            }\r\n        }\r\n    };\r\n\r\n    // Initialize when DOM is ready\r\n    $(document).ready(function() {\r\n        window.PDFBuilderSettingsSaver.init();\r\n    });\r\n\r\n})(jQuery);"],"names":[],"sourceRoot":""}