(()=>{"use strict";var e,t={};function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach(function(t){o(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function o(e,t,r){return(t=function(e){var t=function(e){if("object"!=n(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=n(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==n(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}(e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})})(t),e=jQuery,window.PDFBuilderSettingsSaver={collectTabSettings:function(e){var t={},n=document.getElementById("pdf-builder-tab-"+e);return n?(n.querySelectorAll("input, select, textarea").forEach(function(n){var r=n.name;if(r){var a;switch(n.type){case"checkbox":a=n.checked?"1":"0";break;case"radio":if(!n.checked)return;a=n.value;break;case"number":case"range":a=n.value?parseFloat(n.value):"";break;default:a=n.value||""}var o=r.replace(/^pdf_builder_/,"");t[e+"_"+o]=a}}),t):(console.warn("[PDF Builder] Tab container not found:",e),t)},collectAllSettings:function(){var e={};return["general","appearance","security","advanced"].forEach(function(t){var n=this.collectTabSettings(t);Object.assign(e,n)}.bind(this)),e},saveTabSettings:function(t,n){return new Promise(function(r,o){var i=window.pdfBuilderAjax?window.pdfBuilderAjax.nonce:"";e.ajax({url:window.ajaxurl||window.pdfBuilderAjax.ajaxUrl,type:"POST",data:a({action:"pdf_builder_save_"+t,_wpnonce:i},n),success:function(e){e.success?r(e):o(new Error(e.data||"Unknown error"))},error:function(e,t,n){o(new Error("AJAX Error: "+n))}})})},saveAllSettingsGlobally:function(){var e=this,t=[];return this.showGlobalSaveLoading(),["general","licence","systeme","securite","pdf","contenu","templates","developpeur"].forEach(function(n){var r=e.collectTabSettings(n);Object.keys(r).length>0&&t.push(e.saveTabSettings(n,r))}),Promise.all(t).then(function(t){return e.hideGlobalSaveLoading(),e.showGlobalSaveSuccess(),t}).catch(function(t){throw e.hideGlobalSaveLoading(),e.showGlobalSaveError(t.message),t})},showGlobalSaveLoading:function(){var e=document.getElementById("pdf-builder-global-save-btn");e&&(e.disabled=!0,e.innerHTML='<span class="spinner is-active"></span> Sauvegarde...')},hideGlobalSaveLoading:function(){var e=document.getElementById("pdf-builder-global-save-btn");e&&(e.disabled=!1,e.innerHTML="Sauvegarder Tout")},showGlobalSaveSuccess:function(){this.showGlobalSaveMessage("Paramètres sauvegardés avec succès!","success")},showGlobalSaveError:function(e){this.showGlobalSaveMessage("Erreur lors de la sauvegarde: "+e,"error")},showGlobalSaveMessage:function(e,t){document.querySelectorAll(".pdf-builder-global-save-message").forEach(function(e){e.remove()});var n=document.createElement("div");n.className="pdf-builder-global-save-message notice notice-"+t+" is-dismissible",n.innerHTML="<p>"+e+"</p>";var r=document.createElement("button");r.type="button",r.className="notice-dismiss",r.addEventListener("click",function(){n.remove()}),n.appendChild(r);var a=document.getElementById("pdf-builder-global-save-btn");a&&a.parentNode&&a.parentNode.insertBefore(n,a.nextSibling),"success"===t&&setTimeout(function(){n.parentNode&&n.remove()},5e3)},init:function(){var e=this,t=document.getElementById("pdf-builder-global-save-btn");t&&t.addEventListener("click",function(t){t.preventDefault(),e.saveAllSettingsGlobally().catch(function(e){console.error("[PDF Builder] Global save failed:",e)})}),["general","licence","systeme","securite","pdf","contenu","templates","developpeur"].forEach(function(t){var n=document.getElementById("pdf-builder-save-"+t+"-btn");n&&n.addEventListener("click",function(n){n.preventDefault();var r=e.collectTabSettings(t);e.saveTabSettings(t,r).then(function(){e.showTabSaveSuccess(t)}).catch(function(n){e.showTabSaveError(t,n.message)})})})},showTabSaveSuccess:function(e){this.showTabSaveMessage(e,"Paramètres sauvegardés!","success")},showTabSaveError:function(e,t){this.showTabSaveMessage(e,"Erreur: "+t,"error")},showTabSaveMessage:function(e,t,n){var r=document.getElementById("pdf-builder-tab-"+e);if(r){r.querySelectorAll(".pdf-builder-tab-save-message").forEach(function(e){e.remove()});var a=document.createElement("div");a.className="pdf-builder-tab-save-message notice notice-"+n,a.innerHTML="<p>"+t+"</p>";var o=r.firstElementChild;r.insertBefore(a,o),"success"===n&&setTimeout(function(){a.parentNode&&a.remove()},3e3)}}},e(document).ready(function(){window.PDFBuilderSettingsSaver.init()}),window.pdfBuilderReact=t})();