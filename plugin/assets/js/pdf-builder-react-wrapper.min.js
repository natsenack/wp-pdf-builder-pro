/**
 * PDF Builder React Wrapper - V1 Implementation with Working Properties Panel
 */
(function() {
  if (typeof window.React === 'undefined' || typeof window.ReactDOM === 'undefined') return;

  window.pdfBuilderReact = {
    initPDFBuilderReact: function(config) {
      const container = document.getElementById('pdf-builder-react-root');
      if (!container) return false;

      const canvasConfig = { format: 'A4', width: 794, height: 1123, dpi: 96, templateName: 'Nouveau Template', ...config };
      let draggedElement = null;
      let canvasElements = [];
      let selectedElementId = null;

      const Header = function() {
        return window.React.createElement('div', { style: { display: 'flex', alignItems: 'center', justifyContent: 'space-between', padding: '10px 16px', backgroundColor: '#fff', borderBottom: '1px solid #ddd', boxShadow: '0 1px 2px rgba(0,0,0,0.05)', zIndex: 1000 } },
          window.React.createElement('div', { style: { display: 'flex', alignItems: 'center', gap: '12px', flex: 1 } },
            window.React.createElement('h2', { style: { margin: 0, fontSize: '18px', fontWeight: '600', color: '#1a1a1a' } }, canvasConfig.templateName),
            window.React.createElement('span', { style: { fontSize: '11px', padding: '2px 8px', backgroundColor: '#d1ecf1', color: '#0c5460', borderRadius: '3px', border: '1px solid #bee5eb' } }, 'Nouveau')
          ),
          window.React.createElement('div', { style: { display: 'flex', gap: '8px' } },
            ['Nouveau', 'Aperçu', 'JSON', 'Paramètres'].map(btn => window.React.createElement('button', { key: btn, style: { padding: '6px 12px', border: '1px solid #ccc', borderRadius: '4px', backgroundColor: '#fff', cursor: 'pointer', fontSize: '12px' } }, btn)),
            window.React.createElement('button', { style: { padding: '6px 12px', borderRadius: '4px', backgroundColor: '#4CAF50', color: '#fff', border: 'none', cursor: 'pointer', fontSize: '12px' } }, 'Enregistrer')
          )
        );
      };

      const Toolbar = function() {
        const tools = [{ label: 'Sélection', icon: '' }, { label: 'Rectangle', icon: '' }, { label: 'Cercle', icon: '' }, { label: 'Texte', icon: 'T' }, { label: 'Ligne', icon: '' }, { label: 'Image', icon: '' }];
        return window.React.createElement('div', { style: { display: 'flex', gap: '16px', padding: '12px 16px', backgroundColor: '#fff', border: '1px solid #e1e5e9', overflowX: 'auto' } },
          window.React.createElement('section', { style: { display: 'flex', flexDirection: 'column', gap: '6px' } },
            window.React.createElement('div', { style: { fontSize: '10px', fontWeight: '700', color: '#666', borderLeft: '3px solid #3b82f6', paddingLeft: '6px' } }, 'OUTILS'),
            window.React.createElement('div', { style: { display: 'flex', gap: '4px' } }, tools.map(t => window.React.createElement('button', { key: t.label, style: { padding: '6px 10px', border: '1px solid #ccc', borderRadius: '3px', fontSize: '11px', cursor: 'pointer' } }, t.icon + ' ' + t.label.substring(0, 4))))
          ),
          window.React.createElement('section', { style: { display: 'flex', flexDirection: 'column', gap: '6px' } },
            window.React.createElement('div', { style: { fontSize: '10px', fontWeight: '700', color: '#666', borderLeft: '3px solid #10b981', paddingLeft: '6px' } }, 'ACTIONS'),
            window.React.createElement('div', { style: { display: 'flex', gap: '4px' } }, [' Undo', ' Redo', ' Grid', ' Guide'].map(a => window.React.createElement('button', { key: a, style: { padding: '6px 10px', border: '1px solid #ccc', borderRadius: '3px', fontSize: '11px', cursor: 'pointer' } }, a)))
          ),
          window.React.createElement('section', { style: { display: 'flex', flexDirection: 'column', gap: '6px', marginLeft: 'auto' } },
            window.React.createElement('div', { style: { fontSize: '10px', fontWeight: '700', color: '#666', borderLeft: '3px solid #8b5cf6', paddingLeft: '6px' } }, 'CANVAS'),
            window.React.createElement('div', { style: { fontSize: '11px', color: '#555' } }, canvasConfig.format + ' | ' + canvasElements.length + ' elem')
          )
        );
      };

      const ElementLibrary = function() {
        const elements = [{ icon: '', label: 'Texte Dynamique', type: 'dynamic_text' }, { icon: '', label: 'Tableau', type: 'product_table' }, { icon: '', label: 'Client', type: 'customer_info' }, { icon: '[D]', label: 'Entreprise', type: 'company_info' }, { icon: '', label: 'Logo', type: 'company_logo' }, { icon: '', label: 'Commande', type: 'order_number' }, { icon: '', label: 'Document', type: 'document_type' }, { icon: 'T', label: 'Texte', type: 'text' }, { icon: '', label: 'Rect', type: 'rectangle' }, { icon: '', label: 'Cercle', type: 'circle' }, { icon: '', label: 'Ligne', type: 'line' }, { icon: '', label: 'Image', type: 'image' }];
        return window.React.createElement('div', { style: { width: '200px', backgroundColor: '#fff', borderRight: '1px solid #ddd', overflow: 'auto', display: 'flex', flexDirection: 'column' } },
          window.React.createElement('div', { style: { padding: '10px', borderBottom: '1px solid #ddd', fontWeight: '600', fontSize: '12px', backgroundColor: '#f9f9f9' } }, ' Éléments'),
          window.React.createElement('div', { style: { flex: 1, overflow: 'auto', padding: '6px' } }, elements.map(el => window.React.createElement('div', { key: el.type, draggable: true, onDragStart: () => { draggedElement = el; }, onDragEnd: () => { draggedElement = null; }, style: { padding: '8px', marginBottom: '4px', backgroundColor: '#f8f9fa', border: '1px solid #ddd', borderRadius: '3px', cursor: 'move', fontSize: '10px' } }, el.icon + ' ' + el.label)))
        );
      };

      const Canvas = function() {
        return window.React.createElement('div', { style: { flex: 1, backgroundColor: '#d8d8d8', display: 'flex', alignItems: 'center', justifyContent: 'center', padding: '20px', overflow: 'auto' } },
          window.React.createElement('div', { id: 'pdf-canvas', onDragOver: (e) => { e.preventDefault(); e.currentTarget.style.backgroundColor = '#e0e0e0'; }, onDragLeave: (e) => { e.currentTarget.style.backgroundColor = '#d8d8d8'; }, onDrop: (e) => { e.preventDefault(); if(!draggedElement) return; const rect = e.currentTarget.getBoundingClientRect(); const elem = { id: 'elem_' + Date.now(), type: draggedElement.type, x: e.clientX - rect.left, y: e.clientY - rect.top, w: 100, h: 50 }; canvasElements.push(elem); selectedElementId = elem.id; }, style: { width: canvasConfig.width + 'px', height: canvasConfig.height + 'px', backgroundColor: '#fff', boxShadow: '0 4px 12px rgba(0,0,0,0.2)', border: '1px solid #999', position: 'relative', flexShrink: 0 } },
            canvasElements.length === 0 ? window.React.createElement('div', { style: { position: 'absolute', top: '50%', left: '50%', transform: 'translate(-50%, -50%)', textAlign: 'center', color: '#bbb', pointerEvents: 'none' } }, window.React.createElement('div', { style: { fontSize: '40px', marginBottom: '10px' } }, ''), window.React.createElement('div', { style: { fontSize: '12px' } }, canvasConfig.format)) : null
          )
        );
      };

      const PropertiesPanel = function() {
        const sel = canvasElements.find(e => e.id === selectedElementId);
        return window.React.createElement('div', { style: { width: '250px', backgroundColor: '#fff', borderLeft: '1px solid #ddd', overflow: 'auto', display: 'flex', flexDirection: 'column' } },
          window.React.createElement('div', { style: { padding: '10px', borderBottom: '1px solid #ddd', fontWeight: '600', fontSize: '12px', backgroundColor: '#f9f9f9' } }, ' Propriétés'),
          window.React.createElement('div', { style: { flex: 1, padding: '10px', overflow: 'auto' } },
            sel ? window.React.createElement('div', null,
              window.React.createElement('div', { style: { fontSize: '11px', fontWeight: '600', marginBottom: '8px' } }, sel.type.toUpperCase()),
              window.React.createElement('div', { style: { display: 'grid', gap: '6px' } },
                ['X:', 'Y:', 'W:', 'H:'].map(l => window.React.createElement('div', { key: l, style: { fontSize: '10px' } }, window.React.createElement('label', { style: { display: 'block', marginBottom: '2px', fontWeight: '600' } }, l), window.React.createElement('input', { type: 'number', style: { width: '100%', padding: '4px', border: '1px solid #ccc', borderRadius: '3px', fontSize: '11px' }, placeholder: '0' })))
              )
            ) : window.React.createElement('div', { style: { textAlign: 'center', color: '#999', paddingTop: '20px' } }, ' Sélectionnez')
          )
        );
      };

      try {
        const App = window.React.createElement('div', { style: { display: 'flex', flexDirection: 'column', height: '100vh', backgroundColor: '#fff' } },
          window.React.createElement(Header, null),
          window.React.createElement(Toolbar, null),
          window.React.createElement('div', { style: { display: 'flex', flex: 1, overflow: 'hidden' } },
            window.React.createElement(ElementLibrary, null),
            window.React.createElement(Canvas, null),
            window.React.createElement(PropertiesPanel, null)
          )
        );

        if (typeof window.ReactDOM.render === 'function') {
          window.ReactDOM.render(App, container);
        } else if (typeof window.ReactDOM.createRoot === 'function') {
          window.ReactDOM.createRoot(container).render(App);
        }
        return true;
      } catch(e) { console.error('[PDF Builder]', e); return false; }
    },
    _isLoaded: true
  };
  window.initPDFBuilderReact = config => window.pdfBuilderReact.initPDFBuilderReact(config);
})();
