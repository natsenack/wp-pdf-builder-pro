/**
 * PDF Builder React Wrapper - V2 FIXED
 * Interface entre WordPress et React
 */

(function() {
  'use strict';

  console.log('[PDF Builder] React Wrapper initializing (FIXED)');

  // Debug: Check what was here before
  if (typeof window.pdfBuilderReact !== 'undefined') {
    console.log('[PDF Builder] WARNING: window.pdfBuilderReact already exists:', typeof window.pdfBuilderReact, window.pdfBuilderReact);
  }

  // Créer l'objet pdfBuilderReact qui contient la fonction d'initialisation
  window.pdfBuilderReact = {
    initPDFBuilderReact: function(config) {
      console.log('[PDF Builder] initPDFBuilderReact called', config);
      
      // Vérifier si le container existe
      const container = document.getElementById('pdf-builder-react-root');
      if (!container) {
        console.error('[PDF Builder] Container #pdf-builder-react-root not found');
        return false;
      }

      console.log('[PDF Builder] Container found');

      // Vérifier si React est disponible
      if (typeof window.React === 'undefined' || typeof window.ReactDOM === 'undefined') {
        console.error('[PDF Builder] React or ReactDOM not available');
        console.log('[PDF Builder] window.React:', typeof window.React);
        console.log('[PDF Builder] window.ReactDOM:', typeof window.ReactDOM);
        return false;
      }

      console.log('[PDF Builder] React is available, initializing editor');

      // Configuration par défaut
      const finalConfig = Object.assign({ templateId: 0, isNew: true }, config || {});
      
      // Créer un composant React simple pour tester
      const TestComponent = window.React.createElement('div', {
        style: { padding: '20px', backgroundColor: '#f5f5f5', borderRadius: '4px', fontFamily: 'Arial, sans-serif' }
      }, 
        window.React.createElement('h2', { style: { marginTop: 0 } }, ' PDF Builder Editor Loaded'),
        window.React.createElement('p', null, 'React component initialized successfully'),
        window.React.createElement('pre', { style: { backgroundColor: '#fff', padding: '10px', borderRadius: '3px' } }, 
          'Template ID: ' + finalConfig.templateId
        )
      );

      // Renderer le composant
      try {
        if (typeof window.ReactDOM.render === 'function') {
          window.ReactDOM.render(TestComponent, container);
          console.log('[PDF Builder] Component rendered using React 16-17');
        } else if (typeof window.ReactDOM.createRoot === 'function') {
          const root = window.ReactDOM.createRoot(container);
          root.render(TestComponent);
          console.log('[PDF Builder] Component rendered using React 18+');
        } else {
          console.error('[PDF Builder] No React render method available');
          return false;
        }
        
        return true;
      } catch (error) {
        console.error('[PDF Builder] Error rendering component:', error);
        return false;
      }
    },

    init: function(rootElement, config) {
      console.log('[PDF Builder] React Wrapper init called');
      return this.initPDFBuilderReact(config);
    },

    render: function(component, container) {
      console.log('[PDF Builder] Rendering component');
      return true;
    },

    _isLoaded: true
  };

  // Rétrocompatibilité
  window.initPDFBuilderReact = function(config) {
    return window.pdfBuilderReact.initPDFBuilderReact(config);
  };

  console.log('[PDF Builder] React Wrapper loaded');
  console.log('[PDF Builder] pdfBuilderReact type:', typeof window.pdfBuilderReact);
  console.log('[PDF Builder] initPDFBuilderReact function:', typeof window.pdfBuilderReact.initPDFBuilderReact === 'function');
})();