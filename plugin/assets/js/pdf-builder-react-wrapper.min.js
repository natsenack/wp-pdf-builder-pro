/**
 * PDF Builder React Wrapper - FULL EDITOR V1 RECREATION
 * Éditeur complet avec Header, Toolbar, ElementLibrary, Canvas et PropertiesPanel
 */

(function() {
  'use strict';

  console.log('[PDF Builder] React Wrapper initializing - FULL EDITOR V1');

  if (typeof window.React === 'undefined' || typeof window.ReactDOM === 'undefined') {
    console.error('[PDF Builder] React or ReactDOM not available');
    return;
  }

  window.pdfBuilderReact = {
    initPDFBuilderReact: function(config) {
      console.log('[PDF Builder] initPDFBuilderReact called');
      
      const container = document.getElementById('pdf-builder-react-root');
      if (!container) {
        console.error('[PDF Builder] Container not found');
        return false;
      }

      const canvasConfig = {
        format: 'A4',
        width: 595,
        height: 842,
        dpi: 72,
        orientation: 'portrait',
        templateName: 'Nouveau Template',
        ...config
      };

      // ========== HEADER ==========
      const Header = function() {
        return window.React.createElement('div', {
          style: {
            position: 'sticky',
            top: 0,
            zIndex: 1000,
            backgroundColor: '#2c3e50',
            color: 'white',
            padding: '12px 20px',
            borderBottom: '1px solid #1a252f',
            boxShadow: '0 2px 8px rgba(0,0,0,0.15)',
            display: 'flex',
            justifyContent: 'space-between',
            alignItems: 'center',
            gap: '16px'
          }
        },
          // Titre et infos
          window.React.createElement('div', { style: { display: 'flex', alignItems: 'center', gap: '12px', flex: 1 } },
            window.React.createElement('h1', { style: { margin: 0, fontSize: '18px', fontWeight: 600 } }, ' ' + canvasConfig.templateName),
            window.React.createElement('span', { style: { fontSize: '12px', color: '#bbb' } }, 'Format: ' + canvasConfig.format + ' (' + canvasConfig.width + 'x' + canvasConfig.height + 'px)')
          ),
          // Boutons d'actions
          window.React.createElement('div', { style: { display: 'flex', gap: '8px' } },
            window.React.createElement('button', {
              onClick: function() { console.log('Save clicked'); },
              style: {
                padding: '8px 16px',
                backgroundColor: '#27ae60',
                color: 'white',
                border: 'none',
                borderRadius: '4px',
                cursor: 'pointer',
                fontSize: '14px',
                fontWeight: 500
              }
            }, ' Enregistrer'),
            window.React.createElement('button', {
              onClick: function() { console.log('Preview clicked'); },
              style: {
                padding: '8px 16px',
                backgroundColor: '#3498db',
                color: 'white',
                border: 'none',
                borderRadius: '4px',
                cursor: 'pointer',
                fontSize: '14px',
                fontWeight: 500
              }
            }, ' Aperçu'),
            window.React.createElement('button', {
              onClick: function() { console.log('Settings clicked'); },
              style: {
                padding: '8px 16px',
                backgroundColor: '#95a5a6',
                color: 'white',
                border: 'none',
                borderRadius: '4px',
                cursor: 'pointer',
                fontSize: '14px',
                fontWeight: 500
              }
            }, ' Paramètres')
          )
        );
      };

      // ========== TOOLBAR HEADER (SOUS LE HEADER) ==========
      const ToolbarHeader = function() {
        return window.React.createElement('div', {
          style: {
            backgroundColor: '#ecf0f1',
            borderBottom: '1px solid #bdc3c7',
            padding: '8px 12px',
            display: 'flex',
            gap: '4px',
            alignItems: 'center',
            flexWrap: 'wrap'
          }
        },
          window.React.createElement('button', { title: 'Défaire (Ctrl+Z)', style: { padding: '6px 10px', backgroundColor: '#fff', border: '1px solid #bdc3c7', borderRadius: '3px', cursor: 'pointer', fontSize: '12px' } }, ' Défaire'),
          window.React.createElement('button', { title: 'Refaire (Ctrl+Y)', style: { padding: '6px 10px', backgroundColor: '#fff', border: '1px solid #bdc3c7', borderRadius: '3px', cursor: 'pointer', fontSize: '12px' } }, ' Refaire'),
          window.React.createElement('div', { style: { width: '1px', height: '20px', backgroundColor: '#bdc3c7', margin: '0 4px' } }),
          window.React.createElement('button', { title: 'Sélection', style: { padding: '6px 10px', backgroundColor: '#3498db', color: 'white', border: 'none', borderRadius: '3px', cursor: 'pointer', fontSize: '12px' } }, ' Sélection'),
          window.React.createElement('button', { title: 'Ajouter du texte', style: { padding: '6px 10px', backgroundColor: '#fff', border: '1px solid #bdc3c7', borderRadius: '3px', cursor: 'pointer', fontSize: '12px' } }, 'T Texte'),
          window.React.createElement('button', { title: 'Ajouter une image', style: { padding: '6px 10px', backgroundColor: '#fff', border: '1px solid #bdc3c7', borderRadius: '3px', cursor: 'pointer', fontSize: '12px' } }, ' Image'),
          window.React.createElement('button', { title: 'Dessiner un rectangle', style: { padding: '6px 10px', backgroundColor: '#fff', border: '1px solid #bdc3c7', borderRadius: '3px', cursor: 'pointer', fontSize: '12px' } }, ' Rectangle'),
          window.React.createElement('button', { title: 'Dessiner un cercle', style: { padding: '6px 10px', backgroundColor: '#fff', border: '1px solid #bdc3c7', borderRadius: '3px', cursor: 'pointer', fontSize: '12px' } }, ' Cercle'),
          window.React.createElement('button', { title: 'Tracer une ligne', style: { padding: '6px 10px', backgroundColor: '#fff', border: '1px solid #bdc3c7', borderRadius: '3px', cursor: 'pointer', fontSize: '12px' } }, ' Ligne'),
          window.React.createElement('div', { style: { width: '1px', height: '20px', backgroundColor: '#bdc3c7', margin: '0 4px' } }),
          window.React.createElement('label', { style: { display: 'flex', alignItems: 'center', gap: '6px', fontSize: '12px', cursor: 'pointer' } },
            window.React.createElement('input', { type: 'checkbox', defaultChecked: true, style: { cursor: 'pointer' } }),
            ' Afficher grille'
          ),
          window.React.createElement('label', { style: { display: 'flex', alignItems: 'center', gap: '6px', fontSize: '12px', cursor: 'pointer' } },
            window.React.createElement('input', { type: 'checkbox', defaultChecked: true, style: { cursor: 'pointer' } }),
            ' Repères'
          )
        );
      };

      // ========== ELEMENT LIBRARY ==========
      const ElementLibrary = function() {
        const elements = [
          { icon: '', label: 'Texte Dynamique', type: 'dynamic_text' },
          { icon: '', label: 'Tableau Produits', type: 'product_table' },
          { icon: '', label: 'Fiche Client', type: 'customer_info' },
          { icon: '[D]', label: 'Infos Entreprise', type: 'company_info' },
          { icon: '', label: 'Logo Entreprise', type: 'company_logo' },
          { icon: '', label: 'Numéro Commande', type: 'order_number' },
          { icon: '', label: 'Type Document', type: 'document_type' },
          { icon: 'T', label: 'Texte Simple', type: 'text' },
          { icon: '', label: 'Rectangle', type: 'rectangle' },
          { icon: '', label: 'Cercle', type: 'circle' },
          { icon: '', label: 'Ligne', type: 'line' },
          { icon: '', label: 'Image', type: 'image' }
        ];

        return window.React.createElement('div', {
          style: {
            width: '220px',
            backgroundColor: '#ffffff',
            borderRight: '1px solid #e0e0e0',
            overflow: 'auto',
            display: 'flex',
            flexDirection: 'column'
          }
        },
          window.React.createElement('div', { style: { padding: '12px', borderBottom: '1px solid #e0e0e0', fontWeight: 600, fontSize: '13px' } }, ' Éléments'),
          window.React.createElement('div', { style: { flex: 1, overflow: 'auto', padding: '8px' } },
            elements.map(function(el, idx) {
              return window.React.createElement('div', {
                key: idx,
                draggable: true,
                onDragStart: function(e) { e.dataTransfer.effectAllowed = 'copy'; },
                onClick: function() { console.log('Element clicked:', el.type); },
                style: {
                  padding: '10px',
                  marginBottom: '6px',
                  backgroundColor: '#f8f9fa',
                  border: '1px solid #e0e0e0',
                  borderRadius: '4px',
                  cursor: 'move',
                  fontSize: '12px',
                  transition: 'all 0.2s',
                  userSelect: 'none'
                }
              },
                window.React.createElement('div', { style: { fontSize: '16px', marginBottom: '4px' } }, el.icon),
                window.React.createElement('div', { style: { fontWeight: 500, color: '#333' } }, el.label),
                window.React.createElement('div', { style: { fontSize: '10px', color: '#999', marginTop: '2px' } }, 'Glisser sur canvas')
              );
            })
          )
        );
      };

      // ========== CANVAS ==========
      const Canvas = function() {
        return window.React.createElement('div', {
          style: {
            flex: 1,
            backgroundColor: '#d8d8d8',
            display: 'flex',
            flexDirection: 'column',
            alignItems: 'center',
            justifyContent: 'center',
            padding: '20px',
            overflow: 'auto'
          }
        },
          window.React.createElement('div', {
            id: 'pdf-canvas',
            style: {
              width: canvasConfig.width + 'px',
              height: canvasConfig.height + 'px',
              backgroundColor: 'white',
              boxShadow: '0 4px 12px rgba(0,0,0,0.2)',
              border: '1px solid #999',
              position: 'relative',
              cursor: 'default'
            }
          },
            window.React.createElement('div', {
              style: {
                position: 'absolute',
                top: '50%',
                left: '50%',
                transform: 'translate(-50%, -50%)',
                textAlign: 'center',
                color: '#bbb',
                pointerEvents: 'none',
                fontSize: '12px'
              }
            },
              window.React.createElement('div', { style: { fontSize: '48px', marginBottom: '12px' } }, ''),
              window.React.createElement('div', { style: { fontWeight: 500 } }, canvasConfig.format),
              window.React.createElement('div', { style: { marginTop: '4px', fontSize: '11px' } }, canvasConfig.width + 'x' + canvasConfig.height + 'px @ ' + canvasConfig.dpi + ' DPI'),
              window.React.createElement('div', { style: { marginTop: '12px', fontSize: '11px', color: '#ddd' } }, ' Glissez les éléments ici')
            )
          )
        );
      };

      // ========== PROPERTIES PANEL ==========
      const PropertiesPanel = function() {
        return window.React.createElement('div', {
          style: {
            width: '260px',
            backgroundColor: '#ffffff',
            borderLeft: '1px solid #e0e0e0',
            overflow: 'auto',
            display: 'flex',
            flexDirection: 'column'
          }
        },
          window.React.createElement('div', { style: { padding: '12px', borderBottom: '1px solid #e0e0e0', fontWeight: 600, fontSize: '13px' } }, ' Propriétés'),
          window.React.createElement('div', { style: { flex: 1, overflow: 'auto', padding: '12px' } },
            window.React.createElement('div', { style: { padding: '12px', backgroundColor: '#f9f9f9', border: '1px solid #e0e0e0', borderRadius: '4px', textAlign: 'center', color: '#999', fontSize: '12px' } },
              window.React.createElement('div', { style: { fontSize: '24px', marginBottom: '8px' } }, ''),
              'Sélectionnez un élément pour modifier ses propriétés'
            ),
            window.React.createElement('div', { style: { marginTop: '16px' } },
              window.React.createElement('label', { style: { display: 'block', fontSize: '11px', fontWeight: 600, color: '#666', marginBottom: '4px' } }, 'Format Canvas'),
              window.React.createElement('input', { type: 'text', value: canvasConfig.format, readOnly: true, style: { width: '100%', padding: '6px', border: '1px solid #e0e0e0', borderRadius: '3px', fontSize: '12px', boxSizing: 'border-box' } })
            ),
            window.React.createElement('div', { style: { marginTop: '12px' } },
              window.React.createElement('label', { style: { display: 'block', fontSize: '11px', fontWeight: 600, color: '#666', marginBottom: '4px' } }, 'Dimensions'),
              window.React.createElement('input', { type: 'text', value: canvasConfig.width + 'x' + canvasConfig.height + ' px', readOnly: true, style: { width: '100%', padding: '6px', border: '1px solid #e0e0e0', borderRadius: '3px', fontSize: '12px', boxSizing: 'border-box' } })
            ),
            window.React.createElement('div', { style: { marginTop: '12px' } },
              window.React.createElement('label', { style: { display: 'block', fontSize: '11px', fontWeight: 600, color: '#666', marginBottom: '4px' } }, 'Résolution (DPI)'),
              window.React.createElement('input', { type: 'number', value: canvasConfig.dpi, readOnly: true, style: { width: '100%', padding: '6px', border: '1px solid #e0e0e0', borderRadius: '3px', fontSize: '12px', boxSizing: 'border-box' } })
            ),
            window.React.createElement('div', { style: { marginTop: '12px' } },
              window.React.createElement('label', { style: { display: 'block', fontSize: '11px', fontWeight: 600, color: '#666', marginBottom: '4px' } }, 'Orientation'),
              window.React.createElement('select', { defaultValue: canvasConfig.orientation, style: { width: '100%', padding: '6px', border: '1px solid #e0e0e0', borderRadius: '3px', fontSize: '12px', boxSizing: 'border-box' } },
                window.React.createElement('option', { value: 'portrait' }, 'Portrait'),
                window.React.createElement('option', { value: 'landscape' }, 'Paysage')
              )
            )
          )
        );
      };

      // ========== MAIN LAYOUT ==========
      const EditorApp = window.React.createElement('div', {
        style: {
          display: 'flex',
          flexDirection: 'column',
          height: '100vh',
          backgroundColor: '#ffffff'
        }
      },
        window.React.createElement(Header, null),
        window.React.createElement(ToolbarHeader, null),
        window.React.createElement('div', {
          style: {
            display: 'flex',
            flex: 1,
            overflow: 'hidden',
            gap: '0px',
            backgroundColor: '#fff'
          }
        },
          window.React.createElement(ElementLibrary, null),
          window.React.createElement(Canvas, null),
          window.React.createElement(PropertiesPanel, null)
        )
      );

      // Rendu
      try {
        if (typeof window.ReactDOM.render === 'function') {
          window.ReactDOM.render(EditorApp, container);
          console.log('[PDF Builder] Editor rendered successfully (React 16-17)');
        } else if (typeof window.ReactDOM.createRoot === 'function') {
          const root = window.ReactDOM.createRoot(container);
          root.render(EditorApp);
          console.log('[PDF Builder] Editor rendered successfully (React 18+)');
        }
        return true;
      } catch (error) {
        console.error('[PDF Builder] Error rendering editor:', error);
        return false;
      }
    },

    init: function(rootElement, config) {
      console.log('[PDF Builder] React Wrapper init called');
      return this.initPDFBuilderReact(config);
    },

    _isLoaded: true
  };

  window.initPDFBuilderReact = function(config) {
    return window.pdfBuilderReact.initPDFBuilderReact(config);
  };

  console.log('[PDF Builder] React Wrapper loaded (FULL EDITOR V1)');
})();