/**
 * PDF Builder React Wrapper - V3 COMPLETE EDITOR
 * Interface complète avec header, toolbar, library, canvas et properties
 */

(function() {
  'use strict';

  console.log('[PDF Builder] React Wrapper initializing (EDITOR V3)');

  // Vérifier que React et ReactDOM sont disponibles
  if (typeof window.React === 'undefined' || typeof window.ReactDOM === 'undefined') {
    console.error('[PDF Builder] React or ReactDOM not available');
    return;
  }

  // Créer l'objet pdfBuilderReact
  window.pdfBuilderReact = {
    initPDFBuilderReact: function(config) {
      console.log('[PDF Builder] initPDFBuilderReact called');
      
      const container = document.getElementById('pdf-builder-react-root');
      if (!container) {
        console.error('[PDF Builder] Container not found');
        return false;
      }

      // Paramètres par défaut du canvas (A4, 72 DPI)
      const canvasConfig = {
        format: 'A4',
        width: 595,
        height: 842,
        dpi: 72,
        orientation: 'portrait',
        ...config
      };

      // Créer l'interface complète
      const EditorApp = window.React.createElement('div', {
        style: {
          display: 'flex',
          flexDirection: 'column',
          height: '100vh',
          backgroundColor: '#f5f5f5',
          fontFamily: '-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'
        }
      },
        // HEADER
        window.React.createElement('div', {
          style: {
            backgroundColor: '#2c3e50',
            color: 'white',
            padding: '16px 20px',
            borderBottom: '1px solid #1a252f',
            boxShadow: '0 2px 4px rgba(0,0,0,0.1)'
          }
        },
          window.React.createElement('h1', { style: { margin: 0, fontSize: '20px', fontWeight: 600 } }, ' PDF Builder Pro - Éditeur')
        ),

        // TOOLBAR
        window.React.createElement('div', {
          style: {
            backgroundColor: '#ffffff',
            borderBottom: '1px solid #e0e0e0',
            padding: '12px 16px',
            display: 'flex',
            gap: '8px',
            alignItems: 'center',
            boxShadow: '0 1px 3px rgba(0,0,0,0.05)'
          }
        },
          window.React.createElement('button', { 
            style: {
              padding: '8px 16px',
              backgroundColor: '#007cba',
              color: 'white',
              border: 'none',
              borderRadius: '4px',
              cursor: 'pointer',
              fontSize: '14px'
            }
          }, ' Enregistrer'),
          window.React.createElement('button', {
            style: {
              padding: '8px 16px',
              backgroundColor: '#f8f9fa',
              color: '#333',
              border: '1px solid #e0e0e0',
              borderRadius: '4px',
              cursor: 'pointer',
              fontSize: '14px'
            }
          }, ' Aperçu'),
          window.React.createElement('button', {
            style: {
              padding: '8px 16px',
              backgroundColor: '#f8f9fa',
              color: '#333',
              border: '1px solid #e0e0e0',
              borderRadius: '4px',
              cursor: 'pointer',
              fontSize: '14px'
            }
          }, ' Paramètres'),
          window.React.createElement('div', { style: { marginLeft: 'auto', fontSize: '12px', color: '#999' } },
            'Format: ' + canvasConfig.format + ' | ' + canvasConfig.width + 'x' + canvasConfig.height + 'px | ' + canvasConfig.dpi + ' DPI'
          )
        ),

        // MAIN CONTENT - 3 COLONNES
        window.React.createElement('div', {
          style: {
            display: 'flex',
            flex: 1,
            overflow: 'hidden',
            gap: '1px',
            backgroundColor: '#ddd'
          }
        },
          // ELEMENT LIBRARY (GAUCHE)
          window.React.createElement('div', {
            style: {
              width: '250px',
              backgroundColor: '#ffffff',
              borderRight: '1px solid #e0e0e0',
              overflow: 'auto',
              padding: '16px'
            }
          },
            window.React.createElement('h3', { style: { margin: '0 0 12px 0', fontSize: '14px', fontWeight: 600, color: '#333' } }, ' Éléments'),
            window.React.createElement('div', { style: { display: 'flex', flexDirection: 'column', gap: '8px' } },
              window.React.createElement('div', {
                style: {
                  padding: '12px',
                  backgroundColor: '#f8f9fa',
                  border: '1px solid #e0e0e0',
                  borderRadius: '4px',
                  cursor: 'move',
                  textAlign: 'center',
                  fontSize: '12px',
                  fontWeight: 500
                }
              }, ' Texte'),
              window.React.createElement('div', {
                style: {
                  padding: '12px',
                  backgroundColor: '#f8f9fa',
                  border: '1px solid #e0e0e0',
                  borderRadius: '4px',
                  cursor: 'move',
                  textAlign: 'center',
                  fontSize: '12px',
                  fontWeight: 500
                }
              }, ' Image'),
              window.React.createElement('div', {
                style: {
                  padding: '12px',
                  backgroundColor: '#f8f9fa',
                  border: '1px solid #e0e0e0',
                  borderRadius: '4px',
                  cursor: 'move',
                  textAlign: 'center',
                  fontSize: '12px',
                  fontWeight: 500
                }
              }, ' Rectangle'),
              window.React.createElement('div', {
                style: {
                  padding: '12px',
                  backgroundColor: '#f8f9fa',
                  border: '1px solid #e0e0e0',
                  borderRadius: '4px',
                  cursor: 'move',
                  textAlign: 'center',
                  fontSize: '12px',
                  fontWeight: 500
                }
              }, ' Ligne'),
              window.React.createElement('div', {
                style: {
                  padding: '12px',
                  backgroundColor: '#f8f9fa',
                  border: '1px solid #e0e0e0',
                  borderRadius: '4px',
                  cursor: 'move',
                  textAlign: 'center',
                  fontSize: '12px',
                  fontWeight: 500
                }
              }, ' Table')
            )
          ),

          // CANVAS (CENTER)
          window.React.createElement('div', {
            style: {
              flex: 1,
              backgroundColor: '#e8e8e8',
              display: 'flex',
              flexDirection: 'column',
              alignItems: 'center',
              justifyContent: 'center',
              padding: '20px',
              overflow: 'auto'
            }
          },
            window.React.createElement('div', {
              id: 'pdf-canvas',
              style: {
                width: canvasConfig.width + 'px',
                height: canvasConfig.height + 'px',
                backgroundColor: 'white',
                boxShadow: '0 2px 8px rgba(0,0,0,0.15)',
                border: '1px solid #d0d0d0',
                position: 'relative',
                cursor: 'default'
              }
            },
              window.React.createElement('div', {
                style: {
                  position: 'absolute',
                  top: '50%',
                  left: '50%',
                  transform: 'translate(-50%, -50%)',
                  textAlign: 'center',
                  color: '#999',
                  fontSize: '14px',
                  pointerEvents: 'none'
                }
              },
                window.React.createElement('div', null, ''),
                window.React.createElement('div', { style: { marginTop: '8px' } }, canvasConfig.format),
                window.React.createElement('div', { style: { fontSize: '12px', marginTop: '4px', color: '#bbb' } }, canvasConfig.width + 'x' + canvasConfig.height + 'px')
              )
            ),
            window.React.createElement('div', { style: { marginTop: '12px', fontSize: '12px', color: '#666' } },
              ' Glissez-déposez les éléments sur le canvas pour éditer'
            )
          ),

          // PROPERTIES PANEL (DROITE)
          window.React.createElement('div', {
            style: {
              width: '280px',
              backgroundColor: '#ffffff',
              borderLeft: '1px solid #e0e0e0',
              overflow: 'auto',
              padding: '16px'
            }
          },
            window.React.createElement('h3', { style: { margin: '0 0 12px 0', fontSize: '14px', fontWeight: 600, color: '#333' } }, ' Propriétés'),
            window.React.createElement('div', { style: { display: 'flex', flexDirection: 'column', gap: '12px' } },
              window.React.createElement('div', null,
                window.React.createElement('label', { style: { display: 'block', fontSize: '12px', fontWeight: 500, marginBottom: '4px', color: '#666' } }, 'Format'),
                window.React.createElement('input', {
                  type: 'text',
                  value: canvasConfig.format,
                  readOnly: true,
                  style: {
                    width: '100%',
                    padding: '6px 8px',
                    border: '1px solid #e0e0e0',
                    borderRadius: '3px',
                    fontSize: '12px',
                    boxSizing: 'border-box'
                  }
                })
              ),
              window.React.createElement('div', null,
                window.React.createElement('label', { style: { display: 'block', fontSize: '12px', fontWeight: 500, marginBottom: '4px', color: '#666' } }, 'Orientation'),
                window.React.createElement('select', {
                  value: canvasConfig.orientation,
                  style: {
                    width: '100%',
                    padding: '6px 8px',
                    border: '1px solid #e0e0e0',
                    borderRadius: '3px',
                    fontSize: '12px',
                    boxSizing: 'border-box'
                  }
                },
                  window.React.createElement('option', { value: 'portrait' }, 'Portrait'),
                  window.React.createElement('option', { value: 'landscape' }, 'Paysage')
                )
              ),
              window.React.createElement('div', null,
                window.React.createElement('label', { style: { display: 'block', fontSize: '12px', fontWeight: 500, marginBottom: '4px', color: '#666' } }, 'DPI'),
                window.React.createElement('input', {
                  type: 'number',
                  value: canvasConfig.dpi,
                  readOnly: true,
                  style: {
                    width: '100%',
                    padding: '6px 8px',
                    border: '1px solid #e0e0e0',
                    borderRadius: '3px',
                    fontSize: '12px',
                    boxSizing: 'border-box'
                  }
                })
              ),
              window.React.createElement('div', null,
                window.React.createElement('label', { style: { display: 'block', fontSize: '12px', fontWeight: 500, marginBottom: '4px', color: '#666' } }, 'Dimensions'),
                window.React.createElement('input', {
                  type: 'text',
                  value: canvasConfig.width + 'x' + canvasConfig.height + ' px',
                  readOnly: true,
                  style: {
                    width: '100%',
                    padding: '6px 8px',
                    border: '1px solid #e0e0e0',
                    borderRadius: '3px',
                    fontSize: '12px',
                    boxSizing: 'border-box'
                  }
                })
              )
            )
          )
        )
      );

      // Renderer l'application
      try {
        if (typeof window.ReactDOM.render === 'function') {
          window.ReactDOM.render(EditorApp, container);
          console.log('[PDF Builder] Editor rendered successfully (React 16-17)');
        } else if (typeof window.ReactDOM.createRoot === 'function') {
          const root = window.ReactDOM.createRoot(container);
          root.render(EditorApp);
          console.log('[PDF Builder] Editor rendered successfully (React 18+)');
        }
        return true;
      } catch (error) {
        console.error('[PDF Builder] Error rendering editor:', error);
        return false;
      }
    },

    init: function(rootElement, config) {
      console.log('[PDF Builder] React Wrapper init called');
      return this.initPDFBuilderReact(config);
    },

    render: function(component, container) {
      console.log('[PDF Builder] Rendering custom component');
      return true;
    },

    _isLoaded: true
  };

  // Rétrocompatibilité
  window.initPDFBuilderReact = function(config) {
    return window.pdfBuilderReact.initPDFBuilderReact(config);
  };

  console.log('[PDF Builder] React Wrapper loaded (COMPLETE EDITOR)');
  console.log('[PDF Builder] pdfBuilderReact type:', typeof window.pdfBuilderReact);
  console.log('[PDF Builder] initPDFBuilderReact function:', typeof window.pdfBuilderReact.initPDFBuilderReact === 'function');
})();