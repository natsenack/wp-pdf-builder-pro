/**
 * PDF Builder React Wrapper - V1 Toolbar & Properties Panel
 */
(function() {
  if (typeof window.React === 'undefined' || typeof window.ReactDOM === 'undefined') return;

  window.pdfBuilderReact = {
    initPDFBuilderReact: function(config) {
      const container = document.getElementById('pdf-builder-react-root');
      if (!container) return false;

      const canvasConfig = { format: 'A4', width: 794, height: 1123, dpi: 96, templateName: 'Nouveau Template', ...config };
      let draggedElement = null;
      let canvasElements = [];
      let selectedElementId = null;
      let draggingElementId = null;
      let resizingElementId = null;
      let renderKey = 0;
      let renderCount = 0;

      const triggerRender = (reason = 'manual') => {
        renderCount++;
        renderKey++;
        console.log(`Render #${renderCount} - Reason: ${reason} - Elements: ${canvasElements.length}`);
        renderApp();
      };

      const Header = function() {
        return window.React.createElement('div', { style: { display: 'flex', alignItems: 'center', justifyContent: 'space-between', padding: '12px 16px', backgroundColor: '#fff', borderBottom: '1px solid #e0e0e0', boxShadow: '0 2px 4px rgba(0,0,0,0.08)', zIndex: 1000 } },
          window.React.createElement('div', { style: { display: 'flex', alignItems: 'center', gap: '12px', flex: 1 } },
            window.React.createElement('h2', { style: { margin: 0, fontSize: '20px', fontWeight: '600', color: '#1a1a1a' } }, canvasConfig.templateName),
            window.React.createElement('span', { style: { fontSize: '11px', padding: '4px 8px', backgroundColor: '#d1ecf1', color: '#0c5460', borderRadius: '3px', border: '1px solid #bee5eb', fontWeight: '500' } }, 'Nouveau')
          ),
          window.React.createElement('div', { style: { display: 'flex', gap: '8px', alignItems: 'center' } },
            window.React.createElement('button', { style: { padding: '8px 14px', border: '1px solid #d0d0d0', borderRadius: '4px', backgroundColor: '#fff', color: '#333', cursor: 'pointer', fontSize: '13px', fontWeight: '500' } }, 'Nouveau'),
            window.React.createElement('button', { style: { padding: '8px 14px', border: '1px solid #d0d0d0', borderRadius: '4px', backgroundColor: '#fff', color: '#333', cursor: 'pointer', fontSize: '13px', fontWeight: '500' } }, 'Aperçu'),
            window.React.createElement('div', { style: { width: '1px', height: '20px', backgroundColor: '#e0e0e0' } }),
            window.React.createElement('button', { style: { padding: '8px 14px', border: '1px solid #d0d0d0', borderRadius: '4px', backgroundColor: '#fff', color: '#333', cursor: 'pointer', fontSize: '13px', fontWeight: '500' } }, 'JSON'),
            window.React.createElement('button', { style: { padding: '8px 14px', border: '1px solid #d0d0d0', borderRadius: '4px', backgroundColor: '#fff', color: '#333', cursor: 'pointer', fontSize: '13px', fontWeight: '500' } }, 'Paramètres'),
            window.React.createElement('button', { style: { padding: '8px 14px', borderRadius: '4px', backgroundColor: '#4CAF50', color: '#fff', border: 'none', cursor: 'pointer', fontSize: '13px', fontWeight: '500' } }, 'Enregistrer')
          )
        );
      };

      const Toolbar = function() {
        return window.React.createElement('div', { style: { display: 'flex', gap: '20px', padding: '14px 16px', backgroundColor: '#fff', border: '1px solid #e1e5e9', borderRadius: '0px', boxShadow: '0 1px 3px rgba(0,0,0,0.05)', overflowX: 'auto' } },
          window.React.createElement('section', { style: { display: 'flex', flexDirection: 'column', gap: '8px', minWidth: 'fit-content' } },
            window.React.createElement('div', { style: { fontSize: '11px', fontWeight: '700', color: '#666', textTransform: 'uppercase', letterSpacing: '0.5px', borderLeft: '3px solid #3b82f6', paddingLeft: '8px' } }, 'Outils'),
            window.React.createElement('div', { style: { display: 'flex', flexWrap: 'wrap', gap: '6px' } },
              [{ label: 'Sélection', icon: '' }, { label: 'Rectangle', icon: '' }, { label: 'Cercle', icon: '' }, { label: 'Texte', icon: 'T' }, { label: 'Ligne', icon: '' }, { label: 'Image', icon: '' }].map(t =>
                window.React.createElement('button', { key: t.label, style: { padding: '8px 12px', border: '1px solid #d1d5db', borderRadius: '4px', backgroundColor: '#fff', color: '#374151', cursor: 'pointer', fontSize: '12px', fontWeight: '500', display: 'flex', alignItems: 'center', gap: '4px', minWidth: '85px', justifyContent: 'center', transition: 'all 0.2s' } },
                  window.React.createElement('span', { style: { fontSize: '13px' } }, t.icon),
                  window.React.createElement('span', null, t.label.substring(0, 6))
                )
              )
            )
          ),
          window.React.createElement('section', { style: { display: 'flex', flexDirection: 'column', gap: '8px', minWidth: 'fit-content' } },
            window.React.createElement('div', { style: { fontSize: '11px', fontWeight: '700', color: '#666', textTransform: 'uppercase', letterSpacing: '0.5px', borderLeft: '3px solid #10b981', paddingLeft: '8px' } }, 'Actions'),
            window.React.createElement('div', { style: { display: 'flex', gap: '6px' } },
              [{ label: 'Annuler', icon: '' }, { label: 'Rétablir', icon: '' }, { label: 'Grille', icon: '' }, { label: 'Repères', icon: '' }].map(a =>
                window.React.createElement('button', { key: a.label, style: { padding: '8px 12px', border: '1px solid #d1d5db', borderRadius: '4px', backgroundColor: '#fff', color: '#374151', cursor: 'pointer', fontSize: '12px', fontWeight: '500', display: 'flex', alignItems: 'center', gap: '4px', minWidth: '80px', justifyContent: 'center' } },
                  window.React.createElement('span', { style: { fontSize: '13px' } }, a.icon),
                  window.React.createElement('span', null, a.label.substring(0, 6))
                )
              )
            )
          ),
          window.React.createElement('section', { style: { display: 'flex', flexDirection: 'column', gap: '8px', marginLeft: 'auto', minWidth: 'fit-content' } },
            window.React.createElement('div', { style: { fontSize: '11px', fontWeight: '700', color: '#666', textTransform: 'uppercase', letterSpacing: '0.5px', borderLeft: '3px solid #8b5cf6', paddingLeft: '8px' } }, 'Canvas'),
            window.React.createElement('div', { style: { display: 'flex', gap: '16px', fontSize: '12px', color: '#555', alignItems: 'center' } },
              window.React.createElement('div', null, 'Format: ' + canvasConfig.format),
              window.React.createElement('div', null, 'Taille: ' + canvasConfig.width + 'x' + canvasConfig.height + 'px'),
              window.React.createElement('div', null, 'DPI: ' + canvasConfig.dpi),
              window.React.createElement('div', null, 'Éléments: ' + canvasElements.length)
            )
          )
        );
      };

      const ElementLibrary = function() {
        const elements = [{ icon: '', label: 'Texte Dynamique', type: 'dynamic_text' }, { icon: '', label: 'Tableau Produits', type: 'product_table' }, { icon: '', label: 'Fiche Client', type: 'customer_info' }, { icon: '[D]', label: 'Infos Entreprise', type: 'company_info' }, { icon: '', label: 'Logo', type: 'company_logo' }, { icon: '', label: 'Numéro Commande', type: 'order_number' }, { icon: '', label: 'Type Document', type: 'document_type' }, { icon: 'T', label: 'Texte Simple', type: 'text' }, { icon: '', label: 'Rectangle', type: 'rectangle' }, { icon: '', label: 'Cercle', type: 'circle' }, { icon: '', label: 'Ligne', type: 'line' }, { icon: '', label: 'Image', type: 'image' }];
        return window.React.createElement('div', { style: { width: '220px', backgroundColor: '#fff', borderRight: '1px solid #e0e0e0', overflow: 'auto', display: 'flex', flexDirection: 'column' } },
          window.React.createElement('div', { style: { padding: '12px', borderBottom: '1px solid #e0e0e0', fontWeight: '600', fontSize: '12px', backgroundColor: '#f9f9f9' } }, ' Éléments'),
          window.React.createElement('div', { style: { flex: 1, overflow: 'auto', padding: '8px' } }, elements.map(el => window.React.createElement('div', { key: el.type, draggable: true, onDragStart: (e) => { draggedElement = el; e.dataTransfer.effectAllowed = 'copy'; }, onDragEnd: () => { draggedElement = null; }, style: { padding: '10px', marginBottom: '6px', backgroundColor: '#f8f9fa', border: '1px solid #e0e0e0', borderRadius: '4px', cursor: 'move', fontSize: '11px', userSelect: 'none', transition: 'all 0.15s' } },
            window.React.createElement('div', { style: { fontSize: '16px', marginBottom: '4px', lineHeight: '1' } }, el.icon),
            window.React.createElement('div', { style: { fontWeight: '500', color: '#333', fontSize: '10px' } }, el.label),
            window.React.createElement('div', { style: { fontSize: '9px', color: '#999', marginTop: '2px' } }, 'Glisser sur canvas')
          )))
        );
      };

      const Canvas = function() {
        return window.React.createElement('div', { style: { flex: 1, backgroundColor: '#d8d8d8', display: 'flex', alignItems: 'center', justifyContent: 'center', padding: '20px', overflow: 'auto' } },
          window.React.createElement('div', { 
            key: renderKey,
            id: 'pdf-canvas',
            onDragOver: (e) => { e.preventDefault(); e.currentTarget.style.backgroundColor = '#e0e0e0'; },
            onDragLeave: (e) => { if(e.currentTarget === e.target) e.currentTarget.style.backgroundColor = '#d8d8d8'; },
            onDrop: (e) => {
              e.preventDefault();
              e.currentTarget.style.backgroundColor = '#d8d8d8';
              if (!draggedElement) return;
              const rect = e.currentTarget.getBoundingClientRect();
              let bgColor = '#ffffff';
              if (draggedElement.type === 'rectangle') bgColor = '#e8f4f8';
              else if (draggedElement.type === 'circle') bgColor = '#ffe8e8';
              else if (draggedElement.type === 'line') bgColor = 'transparent';
              
              const newElem = { id: 'elem_' + Date.now(), type: draggedElement.type, label: draggedElement.label, icon: draggedElement.icon, x: Math.max(0, e.clientX - rect.left - 50), y: Math.max(0, e.clientY - rect.top - 25), w: 100, h: 50, rotation: 0, opacity: 1, backgroundColor: bgColor, borderColor: '#999999', borderWidth: draggedElement.type === 'line' ? 0 : 1, borderRadius: 0, zIndex: 0, color: '#000000', fontSize: 16, fontWeight: 'normal', fontStyle: 'normal', textDecoration: 'none', textAlign: 'left', text: draggedElement.type === 'text' ? 'Texte' : '', src: draggedElement.type === 'image' ? '' : null };
              canvasElements.push(newElem);
              selectedElementId = newElem.id;
              triggerRender('drop-element');
            },
            style: { width: canvasConfig.width + 'px', height: canvasConfig.height + 'px', backgroundColor: '#fff', boxShadow: '0 4px 12px rgba(0,0,0,0.2)', border: '1px solid #999', position: 'relative', flexShrink: 0, cursor: 'default' }
          },
            canvasElements.length === 0 ?
              window.React.createElement('div', { style: { position: 'absolute', top: '50%', left: '50%', transform: 'translate(-50%, -50%)', textAlign: 'center', color: '#bbb', pointerEvents: 'none' } },
                window.React.createElement('div', { style: { fontSize: '48px', marginBottom: '10px' } }, ''),
                window.React.createElement('div', { style: { fontSize: '14px', fontWeight: '500' } }, canvasConfig.format),
                window.React.createElement('div', { style: { marginTop: '4px', fontSize: '11px' } }, canvasConfig.width + 'x' + canvasConfig.height + 'px @ ' + canvasConfig.dpi + ' DPI'),
                window.React.createElement('div', { style: { marginTop: '12px', fontSize: '11px', color: '#ddd' } }, ' Glissez les éléments ici')
              )
              : null,
            canvasElements.map((elem) => {
              const isSelected = elem.id === selectedElementId;
              const bgColor = elem.backgroundColor || '#ffffff';
              const borderColor = elem.borderColor || '#000000';
              const borderWidth = elem.borderWidth || 1;
              const borderRadius = elem.borderRadius || 0;
              const zIndex = elem.zIndex || 0;
              let contentStyle = {};
              let content = null;
              
              if (elem.type === 'text') {
                content = window.React.createElement('div', { style: { overflow: 'hidden', width: '100%', height: '100%', display: 'flex', alignItems: 'center', justifyContent: 'center', whiteSpace: 'pre-wrap', wordBreak: 'break-word', padding: '4px', boxSizing: 'border-box', color: elem.color || '#000000', fontSize: (elem.fontSize || 16) + 'px', fontWeight: elem.fontWeight || 'normal', fontStyle: elem.fontStyle || 'normal', textDecoration: elem.textDecoration || 'none', textAlign: elem.textAlign || 'left' } }, elem.text || 'Texte');
              } else if (elem.type === 'rectangle') {
                content = window.React.createElement('div', { style: { width: '100%', height: '100%', backgroundColor: elem.backgroundColor || '#e8f4f8', display: 'flex', alignItems: 'center', justifyContent: 'center', fontSize: '11px', color: '#999' } });
              } else if (elem.type === 'circle') {
                contentStyle = { borderRadius: '50%' };
                content = window.React.createElement('div', { style: { width: '100%', height: '100%', backgroundColor: elem.backgroundColor || '#ffe8e8', borderRadius: '50%', display: 'flex', alignItems: 'center', justifyContent: 'center' } });
              } else if (elem.type === 'line') {
                content = window.React.createElement('div', { style: { width: '100%', height: '100%', display: 'flex', alignItems: 'center' } }, window.React.createElement('div', { style: { width: '100%', height: '2px', backgroundColor: elem.borderColor || '#999999' } }));
              } else if (elem.type === 'image') {
                content = elem.src ? window.React.createElement('img', { src: elem.src, alt: 'Image', style: { width: '100%', height: '100%', objectFit: 'cover' }, onError: (e) => { e.target.src = ''; } }) : window.React.createElement('div', { style: { width: '100%', height: '100%', backgroundColor: '#f5f5f5', display: 'flex', alignItems: 'center', justifyContent: 'center', color: '#ccc', fontSize: '11px' } }, 'Image');
              } else {
                content = window.React.createElement('div', { style: { display: 'flex', flexDirection: 'column', alignItems: 'center', justifyContent: 'center', width: '100%', height: '100%', color: '#666', fontSize: '11px', overflow: 'hidden', textAlign: 'center' } },
                  window.React.createElement('div', { style: { fontSize: '16px', marginBottom: '2px' } }, elem.icon || ''),
                  window.React.createElement('div', null, elem.label.substring(0, 15))
                );
              }
              
              return window.React.createElement('div', { key: elem.id, 
                onMouseDown: (e) => { if(e.button === 0) { e.preventDefault(); selectedElementId = elem.id; draggingElementId = elem.id; const startX = e.clientX; const startY = e.clientY; const startLeft = elem.x; const startTop = elem.y; const move = (me) => { elem.x = Math.max(0, startLeft + (me.clientX - startX)); elem.y = Math.max(0, startTop + (me.clientY - startY)); triggerRender('element-drag'); }; const up = () => { document.removeEventListener('mousemove', move); document.removeEventListener('mouseup', up); draggingElementId = null; triggerRender('element-drag-end'); }; document.addEventListener('mousemove', move); document.addEventListener('mouseup', up); } },
                style: Object.assign({ position: 'absolute', left: elem.x + 'px', top: elem.y + 'px', width: elem.w + 'px', height: elem.h + 'px', backgroundColor: bgColor, border: borderWidth + 'px solid ' + (isSelected ? '#dc3545' : borderColor), borderRadius: borderRadius + 'px', boxSizing: 'border-box', cursor: draggingElementId === elem.id ? 'grabbing' : 'grab', overflow: 'hidden', userSelect: 'none', transform: 'rotate(' + (elem.rotation || 0) + 'deg)', opacity: (elem.opacity || 1), transition: draggingElementId === elem.id ? 'none' : 'border 0.1s', zIndex: zIndex }, contentStyle)
              },
                content,
                isSelected && window.React.createElement('div', null,
                  ['top-left', 'top-right', 'bottom-left', 'bottom-right'].map(corner =>
                    window.React.createElement('div', { key: corner,
                      onMouseDown: (e) => { e.stopPropagation(); e.preventDefault(); resizingElementId = elem.id; const startX = e.clientX; const startY = e.clientY; const startW = elem.w; const startH = elem.h; const startLeft = elem.x; const startTop = elem.y; const move = (me) => {
                        const deltaX = me.clientX - startX; const deltaY = me.clientY - startY;
                        if (corner.includes('right')) elem.w = Math.max(30, startW + deltaX);
                        if (corner.includes('bottom')) elem.h = Math.max(30, startH + deltaY);
                        if (corner.includes('left')) { elem.w = Math.max(30, startW - deltaX); elem.x = Math.min(startLeft + startW - 30, startLeft + deltaX); }
                        if (corner.includes('top')) { elem.h = Math.max(30, startH - deltaY); elem.y = Math.min(startTop + startH - 30, startTop + deltaY); }
                        triggerRender('element-resize');
                      };
                      const up = () => { document.removeEventListener('mousemove', move); document.removeEventListener('mouseup', up); resizingElementId = null; triggerRender('element-resize-end'); };
                      document.addEventListener('mousemove', move); document.addEventListener('mouseup', up);
                    },
                      style: { position: 'absolute', width: '8px', height: '8px', backgroundColor: '#dc3545', ...(corner === 'top-left' ? { top: '-4px', left: '-4px', cursor: 'nwse-resize' } : corner === 'top-right' ? { top: '-4px', right: '-4px', cursor: 'nesw-resize' } : corner === 'bottom-left' ? { bottom: '-4px', left: '-4px', cursor: 'nesw-resize' } : { bottom: '-4px', right: '-4px', cursor: 'nwse-resize' }) }
                    })
                  )
                )
              );
            })
          )
        );
      };

      let propertiesPanelTab = {};

      const PropertiesPanel = function() {
        const sel = canvasElements.find(e => e.id === selectedElementId);
        if (!sel) {
          return window.React.createElement('div', { style: { width: '280px', backgroundColor: '#fff', borderLeft: '1px solid #e0e0e0', overflow: 'auto', display: 'flex', flexDirection: 'column', alignItems: 'center', justifyContent: 'center', color: '#999', padding: '20px' } },
            window.React.createElement('div', { style: { fontSize: '32px', marginBottom: '12px' } }, '👆'),
            window.React.createElement('div', { style: { textAlign: 'center', fontSize: '12px' } }, 'Sélectionnez un élément')
          );
        }
        
        const currentTab = propertiesPanelTab[sel.id] || 'content';
        const setTab = function(tab) { propertiesPanelTab[sel.id] = tab; triggerRender('property-edit'); };
        
        return window.React.createElement('div', { style: { width: '280px', backgroundColor: '#fff', borderLeft: '1px solid #e0e0e0', overflow: 'auto', display: 'flex', flexDirection: 'column' } },
          window.React.createElement('div', { style: { padding: '12px', borderBottom: '1px solid #e0e0e0', fontWeight: '600', fontSize: '13px', backgroundColor: '#f9f9f9' } },
            window.React.createElement('div', null, sel.type.charAt(0).toUpperCase() + sel.type.slice(1) + ' - ' + sel.id.substring(0, 8))
          ),
          window.React.createElement('div', { style: { display: 'flex', gap: '2px', borderBottom: '2px solid #e0e0e0', backgroundColor: '#f9f9f9', padding: '4px', overflowX: 'auto', flexWrap: 'wrap' } },
            window.React.createElement('button', { onClick: () => setTab('content'), style: { flex: '0 0 auto', padding: '5px 4px', backgroundColor: currentTab === 'content' ? '#007bff' : '#f0f0f0', color: currentTab === 'content' ? '#fff' : '#333', border: 'none', cursor: 'pointer', fontSize: '9px', fontWeight: 'bold', borderRadius: '3px 3px 0 0', minWidth: '45px' } }, '📝'),
            window.React.createElement('button', { onClick: () => setTab('appearance'), style: { flex: '0 0 auto', padding: '5px 4px', backgroundColor: currentTab === 'appearance' ? '#007bff' : '#f0f0f0', color: currentTab === 'appearance' ? '#fff' : '#333', border: 'none', cursor: 'pointer', fontSize: '9px', fontWeight: 'bold', borderRadius: '3px 3px 0 0', minWidth: '45px' } }, '🎨'),
            window.React.createElement('button', { onClick: () => setTab('position'), style: { flex: '0 0 auto', padding: '5px 4px', backgroundColor: currentTab === 'position' ? '#007bff' : '#f0f0f0', color: currentTab === 'position' ? '#fff' : '#333', border: 'none', cursor: 'pointer', fontSize: '9px', fontWeight: 'bold', borderRadius: '3px 3px 0 0', minWidth: '45px' } }, '📐'),
            window.React.createElement('button', { onClick: () => setTab('advanced'), style: { flex: '0 0 auto', padding: '5px 4px', backgroundColor: currentTab === 'advanced' ? '#007bff' : '#f0f0f0', color: currentTab === 'advanced' ? '#fff' : '#333', border: 'none', cursor: 'pointer', fontSize: '9px', fontWeight: 'bold', borderRadius: '3px 3px 0 0', minWidth: '45px' } }, '⚙️')
          ),
          window.React.createElement('div', { style: { flex: 1, overflow: 'auto', padding: '12px' } },
            currentTab === 'content' ? window.React.createElement('div', { style: { display: 'flex', flexDirection: 'column', gap: '10px' } },
              sel.type === 'text' ? window.React.createElement('div', null,
                window.React.createElement('label', { style: { display: 'block', fontSize: '11px', fontWeight: 'bold', marginBottom: '3px', color: '#555' } }, 'Contenu du texte:'),
                window.React.createElement('textarea', { value: sel.text || '', onChange: (e) => { sel.text = e.target.value; triggerRender('property-edit'); }, style: { width: '100%', minHeight: '50px', padding: '5px', border: '1px solid #ccc', borderRadius: '3px', fontSize: '11px', boxSizing: 'border-box', fontFamily: 'monospace', resize: 'vertical' }, placeholder: 'Entrez votre texte ici...' })
              ) : null,
              sel.type === 'text' ? window.React.createElement('div', null,
                window.React.createElement('label', { style: { display: 'block', fontSize: '11px', fontWeight: 'bold', marginBottom: '3px', color: '#555' } }, 'Alignement horizontal:'),
                window.React.createElement('select', { value: sel.textAlign || 'left', onChange: (e) => { sel.textAlign = e.target.value; triggerRender('property-edit'); }, style: { width: '100%', padding: '5px', border: '1px solid #ccc', borderRadius: '3px', fontSize: '11px', boxSizing: 'border-box' } },
                  window.React.createElement('option', { value: 'left' }, 'Gauche'),
                  window.React.createElement('option', { value: 'center' }, 'Centre'),
                  window.React.createElement('option', { value: 'right' }, 'Droite'),
                  window.React.createElement('option', { value: 'justify' }, 'Justifié')
                )
              ) : null,
              sel.type === 'image' ? window.React.createElement('div', null,
                window.React.createElement('label', { style: { display: 'block', fontSize: '11px', fontWeight: 'bold', marginBottom: '3px', color: '#555' } }, 'URL de l\'image:'),
                window.React.createElement('input', { type: 'text', value: sel.src || '', onChange: (e) => { sel.src = e.target.value; triggerRender('property-edit'); }, style: { width: '100%', padding: '5px', border: '1px solid #ccc', borderRadius: '3px', fontSize: '11px', boxSizing: 'border-box' }, placeholder: 'https://...' })
              ) : null
            ) : currentTab === 'position' ? window.React.createElement('div', { style: { display: 'flex', flexDirection: 'column', gap: '10px' } },
              window.React.createElement('div', null,
                window.React.createElement('label', { style: { display: 'block', fontSize: '11px', fontWeight: 'bold', marginBottom: '3px', color: '#555' } }, 'X (px):'),
                window.React.createElement('input', { type: 'number', value: Math.round(sel.x || 0), onChange: (e) => { sel.x = Math.max(0, parseInt(e.target.value) || 0); triggerRender('property-edit'); }, style: { width: '100%', padding: '5px', border: '1px solid #ccc', borderRadius: '3px', fontSize: '11px', boxSizing: 'border-box' } })
              ),
              window.React.createElement('div', null,
                window.React.createElement('label', { style: { display: 'block', fontSize: '11px', fontWeight: 'bold', marginBottom: '3px', color: '#555' } }, 'Position Y (px):'),
                window.React.createElement('input', { type: 'number', value: Math.round(sel.y), onChange: (e) => { sel.y = parseFloat(e.target.value) || 0; triggerRender('property-edit'); }, style: { width: '100%', padding: '5px', border: '1px solid #ccc', borderRadius: '3px', fontSize: '11px', boxSizing: 'border-box' } })
              ),
              window.React.createElement('hr', { style: { margin: '8px 0', border: 'none', borderTop: '1px solid #eee' } }),
              window.React.createElement('div', null,
                window.React.createElement('label', { style: { display: 'block', fontSize: '11px', fontWeight: 'bold', marginBottom: '3px', color: '#555' } }, 'Largeur (px):'),
                window.React.createElement('input', { type: 'number', value: Math.round(sel.w), onChange: (e) => { sel.w = Math.max(30, parseFloat(e.target.value) || 30); triggerRender('property-edit'); }, style: { width: '100%', padding: '5px', border: '1px solid #ccc', borderRadius: '3px', fontSize: '11px', boxSizing: 'border-box' } })
              ),
              window.React.createElement('div', null,
                window.React.createElement('label', { style: { display: 'block', fontSize: '11px', fontWeight: 'bold', marginBottom: '3px', color: '#555' } }, 'Hauteur (px):'),
                window.React.createElement('input', { type: 'number', value: Math.round(sel.h), onChange: (e) => { sel.h = Math.max(30, parseFloat(e.target.value) || 30); triggerRender('property-edit'); }, style: { width: '100%', padding: '5px', border: '1px solid #ccc', borderRadius: '3px', fontSize: '11px', boxSizing: 'border-box' } })
              ),
              window.React.createElement('hr', { style: { margin: '8px 0', border: 'none', borderTop: '1px solid #eee' } }),
              window.React.createElement('div', null,
                window.React.createElement('label', { style: { display: 'block', fontSize: '11px', fontWeight: 'bold', marginBottom: '3px', color: '#555' } }, 'Rotation (°):'),
                window.React.createElement('input', { type: 'number', min: '0', max: '360', value: Math.round(sel.rotation || 0), onChange: (e) => { sel.rotation = parseFloat(e.target.value) || 0; triggerRender('property-edit'); }, style: { width: '100%', padding: '5px', border: '1px solid #ccc', borderRadius: '3px', fontSize: '11px', boxSizing: 'border-box' } })
              )
            ) : currentTab === 'appearance' ? window.React.createElement('div', { style: { display: 'flex', flexDirection: 'column', gap: '10px' } },
              window.React.createElement('div', null,
                window.React.createElement('label', { style: { display: 'block', fontSize: '11px', fontWeight: 'bold', marginBottom: '3px', color: '#555' } }, 'Opacité:'),
                window.React.createElement('input', { type: 'range', min: '0', max: '1', step: '0.1', value: sel.opacity || 1, onChange: (e) => { sel.opacity = Math.max(0, Math.min(1, parseFloat(e.target.value))); triggerRender('property-edit'); }, style: { width: '100%', cursor: 'pointer' } }),
                window.React.createElement('span', { style: { fontSize: '10px', color: '#888' } }, Math.round((sel.opacity || 1) * 100) + '%')
              ),
              sel.type === 'text' ? window.React.createElement('div', null,
                window.React.createElement('label', { style: { display: 'block', fontSize: '11px', fontWeight: 'bold', marginBottom: '3px', color: '#555' } }, 'Taille police (px):'),
                window.React.createElement('input', { type: 'number', min: '6', max: '72', value: sel.fontSize || '16', onChange: (e) => { sel.fontSize = Math.max(6, Math.min(72, parseInt(e.target.value) || 16)); triggerRender('property-edit'); }, style: { width: '100%', padding: '5px', border: '1px solid #ccc', borderRadius: '3px', fontSize: '11px', boxSizing: 'border-box' } })
              ) : null,
              sel.type === 'text' ? window.React.createElement('div', null,
                window.React.createElement('label', { style: { display: 'block', fontSize: '11px', fontWeight: 'bold', marginBottom: '3px', color: '#555' } }, 'Style de texte:'),
                window.React.createElement('div', { style: { display: 'flex', gap: '4px' } },
                  window.React.createElement('button', { onClick: () => { sel.fontWeight = sel.fontWeight === 'bold' ? 'normal' : 'bold'; triggerRender('property-edit'); }, style: { flex: 1, padding: '5px', backgroundColor: sel.fontWeight === 'bold' ? '#28a745' : '#f0f0f0', color: sel.fontWeight === 'bold' ? '#fff' : '#333', border: 'none', cursor: 'pointer', fontSize: '11px', fontWeight: 'bold', borderRadius: '3px' } }, 'B'),
                  window.React.createElement('button', { onClick: () => { sel.fontStyle = sel.fontStyle === 'italic' ? 'normal' : 'italic'; triggerRender('property-edit'); }, style: { flex: 1, padding: '5px', backgroundColor: sel.fontStyle === 'italic' ? '#28a745' : '#f0f0f0', color: sel.fontStyle === 'italic' ? '#fff' : '#333', border: 'none', cursor: 'pointer', fontSize: '11px', fontStyle: 'italic', borderRadius: '3px' } }, 'I'),
                  window.React.createElement('button', { onClick: () => { sel.textDecoration = sel.textDecoration === 'underline' ? 'none' : 'underline'; triggerRender('property-edit'); }, style: { flex: 1, padding: '5px', backgroundColor: sel.textDecoration === 'underline' ? '#28a745' : '#f0f0f0', color: sel.textDecoration === 'underline' ? '#fff' : '#333', border: 'none', cursor: 'pointer', fontSize: '11px', textDecoration: 'underline', borderRadius: '3px' } }, 'U')
                )
              ) : null,
              window.React.createElement('div', null,
                window.React.createElement('label', { style: { display: 'block', fontSize: '11px', fontWeight: 'bold', marginBottom: '3px', color: '#555' } }, 'Couleur de texte:'),
                window.React.createElement('input', { type: 'color', value: sel.color || '#000000', onChange: (e) => { sel.color = e.target.value; triggerRender('property-edit'); }, style: { width: '100%', height: '30px', border: '1px solid #ccc', borderRadius: '3px', cursor: 'pointer', boxSizing: 'border-box' } })
              ),
              window.React.createElement('div', null,
                window.React.createElement('label', { style: { display: 'block', fontSize: '11px', fontWeight: 'bold', marginBottom: '3px', color: '#555' } }, 'Couleur fond:'),
                window.React.createElement('input', { type: 'color', value: sel.backgroundColor || '#ffffff', onChange: (e) => { sel.backgroundColor = e.target.value; triggerRender('property-edit'); }, style: { width: '100%', height: '30px', border: '1px solid #ccc', borderRadius: '3px', cursor: 'pointer', boxSizing: 'border-box' } })
              ),
              window.React.createElement('div', null,
                window.React.createElement('label', { style: { display: 'block', fontSize: '11px', fontWeight: 'bold', marginBottom: '3px', color: '#555' } }, 'Couleur bordure:'),
                window.React.createElement('input', { type: 'color', value: sel.borderColor || '#cccccc', onChange: (e) => { sel.borderColor = e.target.value; triggerRender('property-edit'); }, style: { width: '100%', height: '30px', border: '1px solid #ccc', borderRadius: '3px', cursor: 'pointer', boxSizing: 'border-box' } })
              ),
              window.React.createElement('div', null,
                window.React.createElement('label', { style: { display: 'block', fontSize: '11px', fontWeight: 'bold', marginBottom: '3px', color: '#555' } }, 'Épaisseur bordure (px):'),
                window.React.createElement('input', { type: 'number', min: '0', max: '10', value: sel.borderWidth || '1', onChange: (e) => { sel.borderWidth = Math.max(0, parseInt(e.target.value) || 1); triggerRender('property-edit'); }, style: { width: '100%', padding: '5px', border: '1px solid #ccc', borderRadius: '3px', fontSize: '11px', boxSizing: 'border-box' } })
              )
            ) : currentTab === 'position' ? window.React.createElement('div', { style: { display: 'flex', flexDirection: 'column', gap: '10px' } },
              window.React.createElement('div', null,
                window.React.createElement('label', { style: { display: 'block', fontSize: '11px', fontWeight: 'bold', marginBottom: '3px', color: '#555' } }, 'X (px):'),
                window.React.createElement('input', { type: 'number', value: Math.round(sel.x || 0), onChange: (e) => { sel.x = Math.max(0, parseInt(e.target.value) || 0); triggerRender('property-edit'); }, style: { width: '100%', padding: '5px', border: '1px solid #ccc', borderRadius: '3px', fontSize: '11px', boxSizing: 'border-box' } })
              ),
              window.React.createElement('div', null,
                window.React.createElement('label', { style: { display: 'block', fontSize: '11px', fontWeight: 'bold', marginBottom: '3px', color: '#555' } }, 'Y (px):'),
                window.React.createElement('input', { type: 'number', value: Math.round(sel.y || 0), onChange: (e) => { sel.y = Math.max(0, parseInt(e.target.value) || 0); triggerRender('property-edit'); }, style: { width: '100%', padding: '5px', border: '1px solid #ccc', borderRadius: '3px', fontSize: '11px', boxSizing: 'border-box' } })
              ),
              window.React.createElement('div', null,
                window.React.createElement('label', { style: { display: 'block', fontSize: '11px', fontWeight: 'bold', marginBottom: '3px', color: '#555' } }, 'Largeur (px):'),
                window.React.createElement('input', { type: 'number', value: Math.round(sel.w || 100), onChange: (e) => { sel.w = Math.max(30, parseInt(e.target.value) || 100); triggerRender('property-edit'); }, style: { width: '100%', padding: '5px', border: '1px solid #ccc', borderRadius: '3px', fontSize: '11px', boxSizing: 'border-box' } })
              ),
              window.React.createElement('div', null,
                window.React.createElement('label', { style: { display: 'block', fontSize: '11px', fontWeight: 'bold', marginBottom: '3px', color: '#555' } }, 'Hauteur (px):'),
                window.React.createElement('input', { type: 'number', value: Math.round(sel.h || 50), onChange: (e) => { sel.h = Math.max(30, parseInt(e.target.value) || 50); triggerRender('property-edit'); }, style: { width: '100%', padding: '5px', border: '1px solid #ccc', borderRadius: '3px', fontSize: '11px', boxSizing: 'border-box' } })
              ),
              window.React.createElement('div', null,
                window.React.createElement('label', { style: { display: 'block', fontSize: '11px', fontWeight: 'bold', marginBottom: '3px', color: '#555' } }, 'Rotation (°):'),
                window.React.createElement('input', { type: 'number', min: '0', max: '360', value: Math.round(sel.rotation || 0), onChange: (e) => { sel.rotation = parseFloat(e.target.value) || 0; triggerRender('property-edit'); }, style: { width: '100%', padding: '5px', border: '1px solid #ccc', borderRadius: '3px', fontSize: '11px', boxSizing: 'border-box' } })
              )
            ) : window.React.createElement('div', { style: { display: 'flex', flexDirection: 'column', gap: '10px' } },
              window.React.createElement('div', null,
                window.React.createElement('label', { style: { display: 'block', fontSize: '11px', fontWeight: 'bold', marginBottom: '3px', color: '#555' } }, 'Rayon bordure (px):'),
                window.React.createElement('input', { type: 'number', value: sel.borderRadius || 0, onChange: (e) => { sel.borderRadius = Math.max(0, parseInt(e.target.value) || 0); triggerRender('property-edit'); }, style: { width: '100%', padding: '5px', border: '1px solid #ccc', borderRadius: '3px', fontSize: '11px', boxSizing: 'border-box' }, min: '0' })
              ),
              window.React.createElement('div', null,
                window.React.createElement('label', { style: { display: 'block', fontSize: '11px', fontWeight: 'bold', marginBottom: '3px', color: '#555' } }, 'Z-index:'),
                window.React.createElement('input', { type: 'number', value: sel.zIndex || 0, onChange: (e) => { sel.zIndex = parseInt(e.target.value) || 0; triggerRender('property-edit'); }, style: { width: '100%', padding: '5px', border: '1px solid #ccc', borderRadius: '3px', fontSize: '11px', boxSizing: 'border-box' } })
              ),
              window.React.createElement('hr', { style: { margin: '8px 0', border: 'none', borderTop: '1px solid #eee' } }),
              window.React.createElement('button', { onClick: () => { canvasElements = canvasElements.filter(e => e.id !== selectedElementId); selectedElementId = null; triggerRender('element-delete'); }, style: { padding: '6px', backgroundColor: '#dc3545', color: '#fff', border: 'none', borderRadius: '3px', cursor: 'pointer', fontWeight: 'bold', fontSize: '11px' } }, '🗑️ Supprimer')
            )
          )
        );
      };

      const renderApp = function() {
        try {
          const App = window.React.createElement('div', { style: { display: 'flex', flexDirection: 'column', height: '100vh', backgroundColor: '#fff' }, key: renderKey },
            window.React.createElement(Header, null),
            window.React.createElement(Toolbar, null),
            window.React.createElement('div', { style: { display: 'flex', flex: 1, overflow: 'hidden' } },
              window.React.createElement(ElementLibrary, null),
              window.React.createElement(Canvas, null),
              window.React.createElement(PropertiesPanel, null)
            )
          );

          if (typeof window.ReactDOM.render === 'function') {
            window.ReactDOM.render(App, container);
          } else if (typeof window.ReactDOM.createRoot === 'function') {
            window.ReactDOM.createRoot(container).render(App);
          }
        } catch(e) { console.error('[PDF Builder]', e); }
      };

      renderApp();
      return true;
    },
    _isLoaded: true
  };
  window.initPDFBuilderReact = config => window.pdfBuilderReact.initPDFBuilderReact(config);
})();
