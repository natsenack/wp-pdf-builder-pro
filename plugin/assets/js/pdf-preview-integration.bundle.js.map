{"version":3,"file":"js/pdf-preview-integration.bundle.js","mappings":";AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACVA;AACA;AACA;AACA;AACA;;AAEA;AACA;AAAA;AACA;AACA;AAEA;AAEA;AACA;AAAA;AAGA;AAAA;AACA;AACA;AACA;AAEA;AAAA;AACA;AACA;AACA;;AAEA;AACA;AACA;AAAA;AAGA;AAAA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAGA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAGA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAWA;AACA;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AAAA;AACA;AAAA;AAGA;AACA;AAAA;AAEA;AAAA;AAAA;AACA;AACA;AAAA;AAAA;AAIA;;AAEA;AAAA;AAAA;AAEA;AACA;AACA;AAAA;AAHA;AAKA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAGA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AA7BA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAgCA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAAA;AAAA;AAIA;AACA;AAAA;AAGA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAGA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAGA;;AAEA;AACA;AACA;AACA;AAQA;;AAeA;AACA;AACA;AACA;AAEA;AACA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAGA;AAAA;AAAA;AACA;AACA;AAAA;AAAA;AAIA;;AAEA;AACA;AAAA;AAEA;AAAA;AAAA;AACA;AACA;AAAA;AAAA;AAIA;;AAEA;AAAA;AAAA;AAEA;AACA;AACA;AAAA;AAHA;AAKA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAGA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AArCA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAwCA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AAEA;AACA;AACA;;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAAA;AAAA;AAAA;AAGA;;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAAA;AAAA;AAIA;AACA;AAEA;AACA;AACA;AAIA;AACA;AACA;;AAEA;AACA;AAKA;AACA;AACA;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAGA;AACA;AAIA;AAKA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AACA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAGA;AAAA;AAAA;AACA;AACA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AAGA;AAAA;AACA;AAAA;AAAA;AAGA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAIA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AAAA;AAAA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;;AAEA;AACA;AACA;AACA;AAEA","sources":["webpack://PDFBuilder/webpack/universalModuleDefinition","webpack://PDFBuilder/./assets/js/pdf-preview-integration.js"],"sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"PDFBuilder\"] = factory();\n\telse\n\t\troot[\"PDFBuilder\"] = factory();\n})(self, () => {\nreturn ","/* eslint-disable no-undef */\r\n/**\r\n * Exemple d'int√©gration de l'API Preview 1.4 dans l'interface\r\n * √Ä int√©grer dans votre √©diteur ou metabox WooCommerce\r\n */\r\n\r\n// Fonctions de debug conditionnel - ACTIV√âES pour le syst√®me d'aper√ßu\r\nfunction isDebugEnabled() {\r\n    // Debug activ√© si explicitement forc√© ou si activ√© dans les param√®tres\r\n    return window.location.search.includes('debug=force') ||\r\n           (typeof window.pdfBuilderDebugSettings !== 'undefined' && window.pdfBuilderDebugSettings?.javascript);\r\n}\r\n\r\nfunction debugLog(...args) {\r\n    // Debug logging disabled for production\r\n}\r\n\r\nfunction debugError(...args) {\r\n    // TEMP: Always log for debugging\r\n    console.error(...args);\r\n}\r\n\r\nfunction debugWarn(...args) {\r\n    // TEMP: Always log for debugging\r\n    console.warn(...args);\r\n}\r\n\r\n// ==========================================\r\n// INT√âGRATION DANS L'√âDITEUR (Canvas)\r\n// ==========================================\r\n\r\nclass PDFEditorPreviewIntegration {\r\n    constructor(canvasEditor) {\r\n        this.canvasEditor = canvasEditor;\r\n        this.previewBtn = null;\r\n        this.init();\r\n    }\r\n\r\n    init() {\r\n        debugLog('üé® Initialisation int√©gration √©diteur...');\r\n        this.createPreviewButton();\r\n        this.bindEvents();\r\n        debugLog('‚úÖ Int√©gration √©diteur initialis√©e');\r\n    }\r\n\r\n    createPreviewButton() {\r\n        debugLog('üîò Cr√©ation bouton aper√ßu √©diteur...');\r\n\r\n        // Cr√©er le bouton d'aper√ßu dans la barre d'outils\r\n        this.previewBtn = document.createElement('button');\r\n        this.previewBtn.id = 'pdf-editor-preview-btn';\r\n        this.previewBtn.innerHTML = 'üëÅÔ∏è Aper√ßu';\r\n        this.previewBtn.title = 'G√©n√©rer un aper√ßu PDF';\r\n        this.previewBtn.style.cssText = `\r\n            background: #007cba;\r\n            color: white;\r\n            border: none;\r\n            padding: 8px 16px;\r\n            border-radius: 4px;\r\n            cursor: pointer;\r\n            font-size: 14px;\r\n            margin-left: 10px;\r\n        `;\r\n\r\n        // L'ajouter √† la barre d'outils existante\r\n        const toolbar = document.querySelector('.pdf-editor-toolbar') ||\r\n                       document.querySelector('#pdf-editor-toolbar') ||\r\n                       document.querySelector('.toolbar');\r\n\r\n        if (toolbar) {\r\n            toolbar.appendChild(this.previewBtn);\r\n            debugLog('‚úÖ Bouton aper√ßu ajout√© √† la toolbar');\r\n        } else {\r\n            // Fallback: l'ajouter au body avec position fixe\r\n            this.previewBtn.style.position = 'fixed';\r\n            this.previewBtn.style.top = '10px';\r\n            this.previewBtn.style.right = '10px';\r\n            this.previewBtn.style.zIndex = '1000';\r\n            document.body.appendChild(this.previewBtn);\r\n            debugLog('‚ö†Ô∏è Toolbar non trouv√©e, bouton ajout√© en position fixe');\r\n        }\r\n    }\r\n\r\n    bindEvents() {\r\n        if (this.previewBtn) {\r\n            this.previewBtn.addEventListener('click', () => {\r\n                this.generatePreview();\r\n            });\r\n        }\r\n\r\n        // Raccourci clavier Ctrl+P (ou Cmd+P sur Mac)\r\n        document.addEventListener('keydown', (e) => {\r\n            if ((e.ctrlKey || e.metaKey) && e.key === 'p') {\r\n                e.preventDefault();\r\n                this.generatePreview();\r\n            }\r\n        });\r\n    }\r\n\r\n    async generatePreview() {\r\n        debugLog('üöÄ D√©marrage g√©n√©ration aper√ßu √©diteur...');\r\n\r\n        try {\r\n            // R√©cup√©rer les donn√©es du template depuis l'√©diteur\r\n            const templateData = this.getTemplateData();\r\n\r\n            if (!templateData) {\r\n                debugWarn('‚ö†Ô∏è Aucune donn√©e de template trouv√©e');\r\n                alert('Aucune donn√©e de template trouv√©e. Veuillez cr√©er un template d\\'abord.');\r\n                return;\r\n            }\r\n\r\n            debugLog('üìÑ Donn√©es template r√©cup√©r√©es:', templateData);\r\n\r\n            // G√©n√©rer l'aper√ßu\r\n            const result = await window.generateEditorPreview(templateData, {\r\n                quality: 150,\r\n                format: 'png'\r\n            });\r\n\r\n            if (result) {\r\n                debugLog('‚úÖ Aper√ßu √©diteur g√©n√©r√© avec succ√®s');\r\n            }\r\n\r\n        } catch (error) {\r\n            debugError('‚ùå Erreur g√©n√©ration aper√ßu √©diteur:', error);\r\n            alert('Erreur lors de la g√©n√©ration de l\\'aper√ßu. V√©rifiez la console pour plus de d√©tails.');\r\n        }\r\n    }\r\n\r\n    getTemplateData() {\r\n        debugLog('üîç Recherche donn√©es template...');\r\n\r\n        // Adapter selon votre structure de donn√©es d'√©diteur\r\n        if (this.canvasEditor && typeof this.canvasEditor.getTemplateData === 'function') {\r\n            const data = this.canvasEditor.getTemplateData();\r\n            debugLog('‚úÖ Donn√©es r√©cup√©r√©es depuis canvasEditor');\r\n            return data;\r\n        }\r\n\r\n        // Fallback: chercher dans les variables globales uniquement (pas de cache)\r\n        if (window.pdfEditorTemplate) {\r\n            debugLog('‚úÖ Donn√©es r√©cup√©r√©es depuis window.pdfEditorTemplate');\r\n            return window.pdfEditorTemplate;\r\n        }\r\n\r\n        // Template par d√©faut pour les tests\r\n        return {\r\n            template: {\r\n                elements: [\r\n                    {\r\n                        type: 'text',\r\n                        content: 'APER√áU PDF BUILDER PRO',\r\n                        x: 50,\r\n                        y: 50,\r\n                        width: 300,\r\n                        height: 40,\r\n                        fontSize: 18,\r\n                        fontFamily: 'Arial',\r\n                        color: '#000000',\r\n                        textAlign: 'center'\r\n                    },\r\n                    {\r\n                        type: 'text',\r\n                        content: 'Template de d√©monstration',\r\n                        x: 50,\r\n                        y: 100,\r\n                        width: 300,\r\n                        height: 30,\r\n                        fontSize: 14,\r\n                        color: '#666666'\r\n                    }\r\n                ]\r\n            }\r\n        };\r\n    }\r\n}\r\n\r\n// ==========================================\r\n// INT√âGRATION DANS LA METABOX WOOCOMMERCE\r\n// ==========================================\r\n\r\nclass PDFMetaboxPreviewIntegration {\r\n    constructor(metaboxContainer) {\r\n        this.metaboxContainer = metaboxContainer;\r\n        this.orderId = this.getOrderId();\r\n        this.previewBtn = null;\r\n        this.init();\r\n    }\r\n\r\n    init() {\r\n        debugLog('üõí Initialisation int√©gration metabox...');\r\n        this.createPreviewButtons();\r\n        this.bindEvents();\r\n        debugLog('‚úÖ Int√©gration metabox initialis√©e');\r\n    }\r\n\r\n    createPreviewButtons() {\r\n        debugLog('üîò Cr√©ation boutons aper√ßu metabox...');\r\n\r\n        // Cr√©er un conteneur pour les boutons d'aper√ßu\r\n        const buttonContainer = document.createElement('div');\r\n        buttonContainer.id = 'pdf-metabox-preview-buttons';\r\n        buttonContainer.style.cssText = `\r\n            margin: 15px 0;\r\n            padding: 15px;\r\n            background: #f8f9fa;\r\n            border: 1px solid #dee2e6;\r\n            border-radius: 4px;\r\n        `;\r\n\r\n        buttonContainer.innerHTML = `\r\n            <h4 style=\"margin: 0 0 10px 0; color: #495057;\">üìÑ Aper√ßu PDF</h4>\r\n            <p style=\"margin: 0 0 15px 0; color: #6c757d; font-size: 13px;\">\r\n                G√©n√©rez un aper√ßu du PDF avec les donn√©es r√©elles de cette commande.\r\n            </p>\r\n            <div style=\"display: flex; gap: 10px; flex-wrap: wrap;\">\r\n                <button id=\"pdf-metabox-preview-btn\" class=\"button button-secondary\">\r\n                    üëÅÔ∏è Aper√ßu Image\r\n                </button>\r\n                <button id=\"pdf-metabox-generate-btn\" class=\"button button-primary\">\r\n                    üìÑ G√©n√©rer PDF\r\n                </button>\r\n            </div>\r\n        `;\r\n\r\n        // L'ins√©rer dans la metabox\r\n        if (this.metaboxContainer) {\r\n            this.metaboxContainer.appendChild(buttonContainer);\r\n        }\r\n\r\n        this.previewBtn = document.getElementById('pdf-metabox-preview-btn');\r\n    }\r\n\r\n    bindEvents() {\r\n        if (this.previewBtn) {\r\n            this.previewBtn.addEventListener('click', () => {\r\n                this.generatePreview();\r\n            });\r\n        }\r\n\r\n        // Bouton de r√©g√©n√©ration globale\r\n        window.regenerateOrderPreview = () => {\r\n            this.generatePreview();\r\n        };\r\n    }\r\n\r\n    async generatePreview() {\r\n        debugLog('üöÄ D√©marrage g√©n√©ration aper√ßu commande...');\r\n\r\n        try {\r\n            if (!this.orderId) {\r\n                debugError('‚ùå ID de commande non trouv√©');\r\n                alert('ID de commande non trouv√©.');\r\n                return;\r\n            }\r\n\r\n            debugLog('üì¶ ID commande:', this.orderId);\r\n\r\n            // R√©cup√©rer les donn√©es du template depuis la metabox\r\n            const templateData = this.getTemplateData();\r\n\r\n            if (!templateData) {\r\n                debugWarn('‚ö†Ô∏è Aucune donn√©e de template trouv√©e');\r\n                alert('Aucune donn√©e de template trouv√©e. Veuillez s√©lectionner un template.');\r\n                return;\r\n            }\r\n\r\n            debugLog('üìÑ Donn√©es template r√©cup√©r√©es:', templateData);\r\n\r\n            // G√©n√©rer l'aper√ßu\r\n            const result = await window.generateOrderPreview(templateData, this.orderId, {\r\n                quality: 150,\r\n                format: 'png'\r\n            });\r\n\r\n            if (result) {\r\n                debugLog('‚úÖ Aper√ßu commande g√©n√©r√© avec succ√®s');\r\n            }\r\n\r\n        } catch (error) {\r\n            debugError('‚ùå Erreur g√©n√©ration aper√ßu commande:', error);\r\n            alert('Erreur lors de la g√©n√©ration de l\\'aper√ßu. V√©rifiez la console pour plus de d√©tails.');\r\n        }\r\n    }\r\n\r\n    getOrderId() {\r\n        // Essayer diff√©rentes m√©thodes pour r√©cup√©rer l'ID de commande\r\n\r\n        // Depuis l'URL\r\n        const urlParams = new URLSearchParams(window.location.search);\r\n        if (urlParams.get('post')) {\r\n            return parseInt(urlParams.get('post'));\r\n        }\r\n\r\n        // Depuis les variables globales WordPress\r\n        if (window.wpApiSettings && window.wpApiSettings.postId) {\r\n            return window.wpApiSettings.postId;\r\n        }\r\n\r\n        // Depuis un √©l√©ment cach√© dans la page\r\n        const orderIdElement = document.getElementById('pdf-order-id') ||\r\n                              document.querySelector('[data-order-id]');\r\n        if (orderIdElement) {\r\n            return parseInt(orderIdElement.dataset.orderId || orderIdElement.value);\r\n        }\r\n\r\n        // Depuis le titre de la page (parsing du DOM)\r\n        const titleElement = document.querySelector('.wp-heading-inline') ||\r\n                           document.querySelector('h1');\r\n        if (titleElement) {\r\n            const titleMatch = titleElement.textContent.match(/#(\\d+)/);\r\n            if (titleMatch) {\r\n                return parseInt(titleMatch[1]);\r\n            }\r\n        }\r\n\r\n        debugWarn('‚ö†Ô∏è ID de commande non trouv√© automatiquement');\r\n        return null;\r\n    }\r\n\r\n    getTemplateData() {\r\n        // R√©cup√©rer les donn√©es du template s√©lectionn√©\r\n\r\n        // Depuis un champ cach√©\r\n        const templateDataElement = document.getElementById('pdf-template-data') ||\r\n                                   document.querySelector('[data-template-data]');\r\n        if (templateDataElement) {\r\n            try {\r\n                return JSON.parse(templateDataElement.value || templateDataElement.dataset.templateData);\r\n            } catch (e) {\r\n                debugWarn('Donn√©es template mal format√©es:', e);\r\n            }\r\n        }\r\n\r\n        // Depuis les variables globales\r\n        if (window.pdfCurrentTemplate) {\r\n            return window.pdfCurrentTemplate;\r\n        }\r\n\r\n        // Template par d√©faut avec variables WooCommerce\r\n        return {\r\n            template: {\r\n                elements: [\r\n                    {\r\n                        type: 'text',\r\n                        content: 'FACTURE',\r\n                        x: 50,\r\n                        y: 30,\r\n                        width: 200,\r\n                        height: 40,\r\n                        fontSize: 24,\r\n                        fontWeight: 'bold',\r\n                        color: '#000000'\r\n                    },\r\n                    {\r\n                        type: 'text',\r\n                        content: 'Commande #{{order_number}}',\r\n                        x: 50,\r\n                        y: 80,\r\n                        width: 200,\r\n                        height: 30,\r\n                        fontSize: 16,\r\n                        color: '#333333'\r\n                    },\r\n                    {\r\n                        type: 'text',\r\n                        content: 'Client: {{customer_name}}',\r\n                        x: 50,\r\n                        y: 120,\r\n                        width: 200,\r\n                        height: 25,\r\n                        fontSize: 14,\r\n                        color: '#666666'\r\n                    },\r\n                    {\r\n                        type: 'text',\r\n                        content: 'Total: {{order_total}} ‚Ç¨',\r\n                        x: 50,\r\n                        y: 150,\r\n                        width: 200,\r\n                        height: 25,\r\n                        fontSize: 14,\r\n                        fontWeight: 'bold',\r\n                        color: '#000000'\r\n                    }\r\n                ]\r\n            }\r\n        };\r\n    }\r\n}\r\n\r\n// ==========================================\r\n// INITIALISATION AUTOMATIQUE\r\n// ==========================================\r\n\r\ndocument.addEventListener('DOMContentLoaded', function() {\r\n    // Initialiser l'int√©gration √©diteur si on est dans l'√©diteur\r\n    if (document.querySelector('#pdf-editor-canvas') ||\r\n        document.querySelector('.pdf-canvas-editor') ||\r\n        window.location.href.includes('pdf-builder-editor')) {\r\n\r\n        debugLog('üé® Initialisation int√©gration √©diteur...');\r\n        window.pdfEditorPreview = new PDFEditorPreviewIntegration(window.pdfCanvasEditor);\r\n    }\r\n\r\n    // Initialiser l'int√©gration metabox si on est dans une commande WooCommerce\r\n    if (document.querySelector('.woocommerce-order-data') ||\r\n        document.querySelector('#woocommerce-order-data') ||\r\n        window.location.href.includes('post.php?post=') &&\r\n        window.location.href.includes('action=edit')) {\r\n\r\n        // Attendre que la metabox soit charg√©e\r\n        setTimeout(() => {\r\n            const metabox = document.querySelector('#pdf-builder-metabox') ||\r\n                           document.querySelector('.pdf-builder-metabox') ||\r\n                           document.querySelector('.postbox');\r\n\r\n            if (metabox) {\r\n                debugLog('üõí Initialisation int√©gration metabox...');\r\n                window.pdfMetaboxPreview = new PDFMetaboxPreviewIntegration(metabox);\r\n            }\r\n        }, 1000);\r\n    }\r\n});\r\n\r\n// ==========================================\r\n// FONCTIONS GLOBALES D'AIDE\r\n// ==========================================\r\n\r\n/**\r\n * G√©n√®re un aper√ßu rapide (d√©tection automatique du contexte)\r\n */\r\nwindow.generateQuickPreview = async function(templateData = null, orderId = null) {\r\n    debugLog('‚ö° G√©n√©ration aper√ßu rapide d√©marr√©e...');\r\n\r\n    try {\r\n        // D√©tection automatique du contexte\r\n        const isEditor = document.querySelector('#pdf-editor-canvas') ||\r\n                        document.querySelector('.pdf-canvas-editor') ||\r\n                        window.location.href.includes('pdf-builder-editor');\r\n\r\n        const isMetabox = document.querySelector('.woocommerce-order-data') ||\r\n                         document.querySelector('#woocommerce-order-data') ||\r\n                         (window.location.href.includes('post.php') &&\r\n                          window.location.href.includes('action=edit'));\r\n\r\n        debugLog('üîç Contexte d√©tect√©:', { isEditor, isMetabox });\r\n\r\n        if (isEditor) {\r\n            debugLog('üé® Mode √©diteur d√©tect√©');\r\n            const data = templateData || window.pdfEditorPreview?.getTemplateData();\r\n            return await window.generateEditorPreview(data);\r\n        }\r\n\r\n        if (isMetabox) {\r\n            debugLog('üõí Mode metabox d√©tect√©');\r\n            const data = templateData || window.pdfMetaboxPreview?.getTemplateData();\r\n            const id = orderId || window.pdfMetaboxPreview?.getOrderId();\r\n            return await window.generateOrderPreview(data, id);\r\n        }\r\n\r\n        debugWarn('‚ö†Ô∏è Contexte non reconnu pour l\\'aper√ßu');\r\n        return null;\r\n\r\n    } catch (error) {\r\n        debugError('‚ùå Erreur g√©n√©ration aper√ßu rapide:', error);\r\n        return null;\r\n    }\r\n};\r\n\r\ndebugLog('üöÄ Int√©grations API Preview 1.4 charg√©es !');\r\ndebugLog('üí° Raccourcis:');\r\ndebugLog('   - Ctrl+P (Cmd+P) : Aper√ßu rapide');\r\ndebugLog('   - generateQuickPreview() : D√©tection automatique du contexte');\r\n\r\n// ==========================================\r\n// CANVAS PREVIEW MANAGER POUR SETTINGS\r\n// ==========================================\r\n\r\n/**\r\n * Gestionnaire centralis√© des previews canvas pour la page des param√®tres\r\n */\r\nwindow.CanvasPreviewManager = {\r\n    /**\r\n     * Met √† jour les previews pour une cat√©gorie donn√©e\r\n     */\r\n    updatePreviews: function(category) {\r\n        debugLog('üîÑ Mise √† jour previews pour cat√©gorie:', category);\r\n\r\n        try {\r\n            switch (category) {\r\n                case 'dimensions':\r\n                    if (typeof updateDimensionsCardPreview === 'function') {\r\n                        updateDimensionsCardPreview();\r\n                    }\r\n                    break;\r\n                case 'apparence':\r\n                    if (typeof updateApparenceCardPreview === 'function') {\r\n                        updateApparenceCardPreview();\r\n                    }\r\n                    break;\r\n                case 'performance':\r\n                    if (typeof updatePerformanceCardPreview === 'function') {\r\n                        updatePerformanceCardPreview();\r\n                    }\r\n                    break;\r\n                case 'autosave':\r\n                    if (typeof updateAutosaveCardPreview === 'function') {\r\n                        updateAutosaveCardPreview();\r\n                    }\r\n                    break;\r\n                case 'zoom':\r\n                    if (typeof updateZoomCardPreview === 'function') {\r\n                        updateZoomCardPreview();\r\n                    }\r\n                    break;\r\n                case 'grille':\r\n                    if (typeof updateGrilleCardPreview === 'function') {\r\n                        updateGrilleCardPreview();\r\n                    }\r\n                    break;\r\n                case 'interactions':\r\n                    if (typeof updateInteractionsCardPreview === 'function') {\r\n                        updateInteractionsCardPreview();\r\n                    }\r\n                    break;\r\n                case 'export':\r\n                    if (typeof updateExportCardPreview === 'function') {\r\n                        updateExportCardPreview();\r\n                    }\r\n                    break;\r\n                case 'all':\r\n                    // Mettre √† jour toutes les previews\r\n                    this.updatePreviews('dimensions');\r\n                    this.updatePreviews('apparence');\r\n                    this.updatePreviews('performance');\r\n                    this.updatePreviews('autosave');\r\n                    this.updatePreviews('zoom');\r\n                    this.updatePreviews('grille');\r\n                    this.updatePreviews('interactions');\r\n                    this.updatePreviews('export');\r\n                    break;\r\n                default:\r\n                    debugWarn('‚ö†Ô∏è Cat√©gorie inconnue:', category);\r\n            }\r\n        } catch (error) {\r\n            debugError('‚ùå Erreur mise √† jour preview:', error);\r\n        }\r\n    },\r\n\r\n    /**\r\n     * R√©cup√®re les valeurs actuelles d'une carte\r\n     */\r\n    getCardValues: function(category) {\r\n        debugLog('üìä R√©cup√©ration valeurs pour carte:', category);\r\n\r\n        try {\r\n            const settings = window.pdfBuilderCanvasSettings || {};\r\n\r\n            switch (category) {\r\n                case 'performance':\r\n                    return {\r\n                        fps_target: settings.fps_target || 60,\r\n                        memory_limit_js: settings.memory_limit_js || 128,\r\n                        memory_limit_php: settings.memory_limit_php || 256\r\n                    };\r\n                case 'apparence':\r\n                    return {\r\n                        canvas_bg_color: settings.canvas_background_color || '#ffffff',\r\n                        canvas_border_color: settings.border_color || '#cccccc',\r\n                        canvas_border_width: settings.border_width || 1,\r\n                        canvas_shadow_enabled: settings.shadow_enabled || false,\r\n                        canvas_container_bg_color: settings.container_background_color || '#f8f9fa'\r\n                    };\r\n                case 'grille':\r\n                    return {\r\n                        grid_enabled: settings.show_grid || false,\r\n                        grid_size: settings.grid_size || 20,\r\n                        snap_to_grid: settings.snap_to_grid || false\r\n                    };\r\n                case 'interactions':\r\n                    return {\r\n                        drag_enabled: settings.drag_enabled !== false,\r\n                        resize_enabled: settings.resize_enabled !== false,\r\n                        rotate_enabled: settings.rotate_enabled !== false,\r\n                        multi_select: settings.multi_select !== false,\r\n                        selection_mode: settings.selection_mode || 'rectangle',\r\n                        keyboard_shortcuts: settings.keyboard_shortcuts !== false\r\n                    };\r\n                case 'export':\r\n                    return {\r\n                        canvas_export_format: settings.export_format || 'pdf',\r\n                        canvas_export_quality: settings.export_quality || 90,\r\n                        canvas_export_transparent: settings.export_transparent || false\r\n                    };\r\n                case 'zoom':\r\n                    return {\r\n                        canvas_zoom_min: settings.min_zoom || 10,\r\n                        canvas_zoom_max: settings.max_zoom || 500,\r\n                        canvas_zoom_default: settings.default_zoom || 100,\r\n                        canvas_zoom_step: settings.zoom_step || 25\r\n                    };\r\n                case 'autosave':\r\n                    return {\r\n                        canvas_autosave_enabled: settings.autosave_enabled !== false,\r\n                        canvas_autosave_interval: settings.autosave_interval || 5,\r\n                        canvas_history_max: settings.versions_limit || 10\r\n                    };\r\n                default:\r\n                    debugWarn('‚ö†Ô∏è Cat√©gorie inconnue pour getCardValues:', category);\r\n                    return {};\r\n            }\r\n        } catch (error) {\r\n            debugError('‚ùå Erreur r√©cup√©ration valeurs carte:', error);\r\n            return {};\r\n        }\r\n    },\r\n\r\n    /**\r\n     * R√©cup√®re un √©l√©ment DOM d'une carte\r\n     */\r\n    getCardElement: function(category, selector) {\r\n        debugLog('üîç Recherche √©l√©ment pour carte:', category, 's√©lecteur:', selector);\r\n\r\n        try {\r\n            const card = document.querySelector(`.canvas-card[data-category=\"${category}\"]`);\r\n            if (!card) {\r\n                debugWarn('‚ö†Ô∏è Carte non trouv√©e:', category);\r\n                return null;\r\n            }\r\n\r\n            return card.querySelector(selector);\r\n        } catch (error) {\r\n            debugError('‚ùå Erreur recherche √©l√©ment:', error);\r\n            return null;\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Met √† jour une propri√©t√© d'un √©l√©ment\r\n     */\r\n    updateElement: function(element, property, value) {\r\n        if (!element) {\r\n            debugWarn('‚ö†Ô∏è √âl√©ment null pass√© √† updateElement');\r\n            return;\r\n        }\r\n\r\n        try {\r\n            debugLog('üîß Mise √† jour √©l√©ment:', property, '=', value);\r\n\r\n            // G√©rer les propri√©t√©s imbriqu√©es (ex: style.backgroundColor)\r\n            if (property.includes('.')) {\r\n                const parts = property.split('.');\r\n                let obj = element;\r\n                for (let i = 0; i < parts.length - 1; i++) {\r\n                    obj = obj[parts[i]];\r\n                    if (!obj) {\r\n                        debugWarn('‚ö†Ô∏è Propri√©t√© parent non trouv√©e:', parts.slice(0, i+1).join('.'));\r\n                        return;\r\n                    }\r\n                }\r\n                obj[parts[parts.length - 1]] = value;\r\n            } else {\r\n                element[property] = value;\r\n            }\r\n        } catch (error) {\r\n            debugError('‚ùå Erreur mise √† jour √©l√©ment:', error);\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Met √† jour la pr√©visualisation de la carte export\r\n     */\r\n    updateExportCardPreview: function() {\r\n        try {\r\n            const values = this.getCardValues('export');\r\n            const { export_quality: exportQuality } = values;\r\n\r\n            const qualityFill = this.getCardElement('export', '.quality-fill');\r\n            const qualityText = this.getCardElement('export', '.quality-text');\r\n\r\n            this.updateElement(qualityFill, 'style.width', `${exportQuality}%`);\r\n            this.updateElement(qualityText, 'textContent', `${exportQuality}%`);\r\n\r\n            debugLog('‚úÖ Export preview updated:', exportQuality);\r\n        } catch (error) {\r\n            debugError('‚ùå Error updating export preview:', error);\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Met √† jour la pr√©visualisation de la carte grille\r\n     */\r\n    updateGrilleCardPreview: function() {\r\n        try {\r\n            const values = this.getCardValues('grille');\r\n            const { show_grid: gridEnabled, snap_to_grid: snapToGrid, show_guides: showGuides } = values;\r\n\r\n            const gridContainer = this.getCardElement('grille', '.grid-preview-container');\r\n            if (!gridContainer) return;\r\n\r\n            // Activer/d√©sactiver la grille\r\n            gridContainer.classList.toggle('grid-enabled', gridEnabled);\r\n            gridContainer.classList.toggle('grid-disabled', !gridEnabled);\r\n\r\n            // Afficher/cacher les guides\r\n            const guideLines = gridContainer.querySelectorAll('.guide-line');\r\n            guideLines.forEach(guide => guide.classList.toggle('active', showGuides));\r\n\r\n            // Mettre √† jour l'indicateur de snap\r\n            const snapIndicator = gridContainer.querySelector('.snap-indicator');\r\n            if (snapIndicator) {\r\n                const isActive = snapToGrid && gridEnabled;\r\n                snapIndicator.textContent = isActive ? 'üîó Snap activ√©' : 'üîó Snap d√©sactiv√©';\r\n                snapIndicator.style.color = isActive ? '#28a745' : '#6c757d';\r\n            }\r\n\r\n            debugLog('‚úÖ Grille preview updated:', { gridEnabled, snapToGrid, showGuides });\r\n        } catch (error) {\r\n            debugError('‚ùå Error updating grille preview:', error);\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Initialise les mises √† jour en temps r√©el pour une cat√©gorie\r\n     */\r\n    initializeRealTimeUpdates: function(modal) {\r\n        if (!modal) return;\r\n\r\n        debugLog('‚ö° Initialisation mises √† jour temps r√©el pour modal:', modal.getAttribute('data-category'));\r\n\r\n        // Les mises √† jour temps r√©el sont g√©r√©es dans settings-main.php\r\n        // Cette m√©thode est appel√©e pour compatibilit√©\r\n    }\r\n};\r\n\r\ndebugLog('‚úÖ CanvasPreviewManager initialis√©');\r\n"],"names":[],"sourceRoot":""}