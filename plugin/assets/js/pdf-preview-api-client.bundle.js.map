{"version":3,"file":"js/pdf-preview-api-client.bundle.js","mappings":";AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;ACTA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;;AAEA;AACA;AAAA;AACA;AACA;AACA;AAEA;AACA;AAAA;AAGA;AAAA;AACA;AACA;AACA;AAEA;AAAA;AACA;AACA;AACA;AAAA;AAGA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AAFA;AAAA;AAAA;AAAA;AAGA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AACA;AAGA;AACA;AAAA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAAA;AAAA;AAGA;AACA;AACA;AAAA;AAHA;AAAA;AAAA;AAKA;AAAA;AAAA;AAEA;AAAA;AAAA;AACA;AACA;AACA;AAAA;AACA;AAEA;AACA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAGA;AACA;AAAA;AACA;AAAA;AAEA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AA7CA;AAAA;AAAA;AAAA;AA+CA;AACA;AACA;AAFA;AAAA;AAAA;AAAA;AAAA;AAGA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AACA;AAGA;AACA;AAAA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAAA;AAAA;AAGA;AACA;AACA;AAAA;AAHA;AAAA;AAAA;AAKA;AAAA;AAAA;AAEA;AAAA;AAAA;AACA;AACA;AACA;AAAA;AACA;AAEA;AACA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAGA;AACA;AAAA;AACA;AAAA;AAEA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AA9CA;AAAA;AAAA;AAAA;AAgDA;AACA;AACA;AAFA;AAAA;AAAA;AAAA;AAIA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AAFA;AAAA;AAAA;AAIA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AAFA;AAAA;AAAA;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AAFA;AAAA;AAAA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AAEA;AACA;;AAEA;AACA;AACA;AAFA;AAAA;AAAA;AAIA;AACA;AACA;AACA;AACA;AAsCA;AAEA;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AAOA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAQA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;;AAEA;AACA;AACA;AAFA;AAAA;AAAA;AAGA;AACA;AACA;;AAEA;AACA;AACA;AACA;AASA;AACA;AACA;;AAEA;AACA;AACA;AACA;AASA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AAQA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;;AAEA;AACA;AACA;AAFA;AAAA;AAAA;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;;AAEA;AACA;AACA;AAFA;AAAA;AAAA;AAIA;AACA;AAkBA;AAEA;AACA;;AAEA;AACA;AACA;AAFA;AAAA;AAAA;AAIA;AACA;AACA;AACA;AACA;AAaA;AAUA;AACA;AACA;AACA;;AAEA;AACA;AACA;AAFA;AAAA;AAAA;AAIA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AAFA;AAAA;AAAA;AAIA;AACA;AACA;AAAA;AAAA;AAIA;;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA","sources":["webpack://pdfBuilderReact/webpack/universalModuleDefinition","webpack://pdfBuilderReact/./assets/js/pdf-preview-api-client.js"],"sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"pdfBuilderReact\"] = factory();\n\telse\n\t\troot[\"pdfBuilderReact\"] = factory();\n})(self, () => {\nreturn "," \r\n/**\r\n * PDF Builder Pro - Preview API Client\r\n * Int√©gration compl√®te de l'API Preview 1.4\r\n */\r\n\r\n// Fonctions de debug conditionnel\r\nfunction isDebugEnabled() {\r\n    // Debug activ√© si explicitement forc√© ou si activ√© dans les param√®tres\r\n    return window.location.search.includes('debug=force') || (typeof window.pdfBuilderDebugSettings !== 'undefined' && window.pdfBuilderDebugSettings?.javascript);\r\n}\r\n\r\nfunction debugLog(...args) {\r\n    // Debug logging disabled for production\r\n}\r\n\r\nfunction debugError(...args) {\r\n    // TEMP: Always log for debugging\r\n    console.error(...args);\r\n}\r\n\r\nfunction debugWarn(...args) {\r\n    // TEMP: Always log for debugging\r\n    console.warn(...args);\r\n}\r\n\r\nclass PDFPreviewAPI {\r\n    constructor() {\r\n        this.endpoint = pdfBuilderAjax.ajaxurl;\r\n        this.nonce = pdfBuilderAjax?.nonce || '';\r\n        this.isGenerating = false;\r\n        this.cache = new Map();\r\n    }\r\n\r\n    /**\r\n     * G√©n√®re un aper√ßu depuis l'√©diteur (donn√©es fictives)\r\n     */\r\n    async generateEditorPreview(templateData, options = {}) {\r\n        if (this.isGenerating) {\r\n            debugWarn('‚ö†Ô∏è G√©n√©ration d√©j√† en cours...');\r\n            return null;\r\n        }\r\n\r\n        this.isGenerating = true;\r\n        this.showLoadingIndicator();\r\n\r\n        try {\r\n            const formData = new FormData();\r\n            formData.append('action', 'wp_pdf_preview_image');\r\n            formData.append('nonce', this.nonce);\r\n            formData.append('context', 'editor');\r\n            formData.append('template_data', JSON.stringify(templateData));\r\n            formData.append('quality', options.quality || 150);\r\n            formData.append('format', options.format || 'png');\r\n\r\n            debugLog('üì§ Envoi requ√™te preview √©diteur...');\r\n\r\n            const response = await fetch(this.endpoint, {\r\n                method: 'POST',\r\n                body: formData\r\n            });\r\n\r\n            const result = await response.json();\r\n\r\n            if (result.success) {\r\n                debugLog('‚úÖ Aper√ßu √©diteur g√©n√©r√©:', result.data);\r\n                this.cachePreview(result.data);\r\n                this.displayPreview(result.data.image_url, 'editor');\r\n                return result.data;\r\n            } else {\r\n                debugError('‚ùå Erreur g√©n√©ration √©diteur:', result.data);\r\n                this.showError('Erreur lors de la g√©n√©ration de l\\'aper√ßu');\r\n                return null;\r\n            }\r\n        } catch (error) {\r\n            debugError('‚ùå Erreur r√©seau:', error);\r\n            this.showError('Erreur de connexion');\r\n            return null;\r\n        } finally {\r\n            this.isGenerating = false;\r\n            this.hideLoadingIndicator();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * G√©n√®re un aper√ßu depuis la metabox WooCommerce (donn√©es r√©elles)\r\n     */\r\n    async generateOrderPreview(templateData, orderId, options = {}) {\r\n        if (this.isGenerating) {\r\n            debugWarn('‚ö†Ô∏è G√©n√©ration d√©j√† en cours...');\r\n            return null;\r\n        }\r\n\r\n        this.isGenerating = true;\r\n        this.showLoadingIndicator();\r\n\r\n        try {\r\n            const formData = new FormData();\r\n            formData.append('action', 'wp_pdf_preview_image');\r\n            formData.append('nonce', this.nonce);\r\n            formData.append('context', 'metabox');\r\n            formData.append('template_data', JSON.stringify(templateData));\r\n            formData.append('order_id', orderId);\r\n            formData.append('quality', options.quality || 150);\r\n            formData.append('format', options.format || 'png');\r\n\r\n            debugLog('üì§ Envoi requ√™te preview commande...', orderId);\r\n\r\n            const response = await fetch(this.endpoint, {\r\n                method: 'POST',\r\n                body: formData\r\n            });\r\n\r\n            const result = await response.json();\r\n\r\n            if (result.success) {\r\n                debugLog('‚úÖ Aper√ßu commande g√©n√©r√©:', result.data);\r\n                this.cachePreview(result.data);\r\n                this.displayPreview(result.data.image_url, 'metabox', orderId);\r\n                return result.data;\r\n            } else {\r\n                debugError('‚ùå Erreur g√©n√©ration commande:', result.data);\r\n                this.showError('Erreur lors de la g√©n√©ration de l\\'aper√ßu de commande');\r\n                return null;\r\n            }\r\n        } catch (error) {\r\n            debugError('‚ùå Erreur r√©seau:', error);\r\n            this.showError('Erreur de connexion');\r\n            return null;\r\n        } finally {\r\n            this.isGenerating = false;\r\n            this.hideLoadingIndicator();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Met en cache les aper√ßus g√©n√©r√©s\r\n     */\r\n    cachePreview(data) {\r\n        const key = data.cache_key || this.generateCacheKey(data);\r\n        this.cache.set(key, {\r\n            url: data.image_url,\r\n            timestamp: Date.now(),\r\n            context: data.context || 'unknown'\r\n        });\r\n\r\n        // Nettoyer le cache ancien (garder seulement 10 derniers)\r\n        if (this.cache.size > 10) {\r\n            const oldestKey = this.cache.keys().next().value;\r\n            this.cache.delete(oldestKey);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * G√©n√®re une cl√© de cache\r\n     */\r\n    generateCacheKey(data) {\r\n        return btoa(JSON.stringify({\r\n            context: data.context,\r\n            order_id: data.order_id,\r\n            template_hash: this.hashString(JSON.stringify(data.template_data))\r\n        })).slice(0, 32);\r\n    }\r\n\r\n    /**\r\n     * Hash simple pour les cl√©s de cache\r\n     */\r\n    hashString(str) {\r\n        let hash = 0;\r\n        for (let i = 0; i < str.length; i++) {\r\n            const char = str.charCodeAt(i);\r\n            hash = ((hash << 5) - hash) + char;\r\n            hash = hash & hash; // Convertir en 32 bits\r\n        }\r\n        return Math.abs(hash).toString(36);\r\n    }\r\n\r\n    /**\r\n     * Affiche l'aper√ßu g√©n√©r√©\r\n     */\r\n    displayPreview(imageUrl, context, orderId = null) {\r\n        // Cr√©er ou mettre √† jour la modal d'aper√ßu\r\n        let previewModal = document.getElementById('pdf-preview-modal');\r\n        if (!previewModal) {\r\n            previewModal = this.createPreviewModal();\r\n            document.body.appendChild(previewModal);\r\n        }\r\n\r\n        const img = previewModal.querySelector('#pdf-preview-image');\r\n        const title = previewModal.querySelector('#pdf-preview-title');\r\n\r\n        img.src = imageUrl;\r\n        img.style.maxWidth = '100%';\r\n        img.style.height = 'auto';\r\n\r\n        if (context === 'editor') {\r\n            title.textContent = 'üëÅÔ∏è Aper√ßu du Template';\r\n        } else {\r\n            title.textContent = `üìÑ Aper√ßu Commande #${orderId}`;\r\n        }\r\n\r\n        // Ajouter des boutons d'action\r\n        this.addPreviewActions(previewModal, imageUrl, context);\r\n\r\n        // Afficher la modal en togglant la classe\r\n        previewModal.classList.add('visible');\r\n\r\n        debugLog('üñºÔ∏è Aper√ßu affich√©:', imageUrl);\r\n    }\r\n\r\n    /**\r\n     * Cr√©e la modal d'aper√ßu - FIXED CENTERING v3.3\r\n     */\r\n    createPreviewModal() {\r\n        // Ajouter une vraie feuille CSS pour le modal si elle n'existe pas\r\n        if (!document.getElementById('pdf-preview-modal-styles')) {\r\n            const styleSheet = document.createElement('style');\r\n            styleSheet.id = 'pdf-preview-modal-styles';\r\n            styleSheet.textContent = `\r\n                #pdf-preview-modal {\r\n                    position: fixed !important;\r\n                    top: 0 !important;\r\n                    left: 0 !important;\r\n                    width: 100% !important;\r\n                    height: 100% !important;\r\n                    background-color: rgba(0,0,0,0.8) !important;\r\n                    display: none !important;\r\n                    z-index: 99999 !important;\r\n                    align-items: center !important;\r\n                    justify-content: center !important;\r\n                    flex-direction: column !important;\r\n                    visibility: visible !important;\r\n                    gap: 0 !important;\r\n                    padding: 0 !important;\r\n                    margin: 0 !important;\r\n                }\r\n                \r\n                #pdf-preview-modal.visible {\r\n                    display: flex !important;\r\n                }\r\n                \r\n                #pdf-preview-modal-wrapper {\r\n                    background: white !important;\r\n                    border-radius: 8px !important;\r\n                    padding: 20px !important;\r\n                    max-width: 90vw !important;\r\n                    max-height: 90vh !important;\r\n                    overflow-y: auto !important;\r\n                    box-shadow: 0 10px 40px rgba(0,0,0,0.3) !important;\r\n                    flex-shrink: 0 !important;\r\n                    min-width: 300px !important;\r\n                    position: relative !important;\r\n                    width: 500px !important;\r\n                    align-self: center !important;\r\n                }\r\n            `;\r\n            document.head.appendChild(styleSheet);\r\n\r\n        }\r\n        \r\n        const modal = document.createElement('div');\r\n        modal.id = 'pdf-preview-modal';\r\n        \r\n        // Wrapper blanc centr√©\r\n        const wrapper = document.createElement('div');\r\n        wrapper.id = 'pdf-preview-modal-wrapper';\r\n\r\n        // Header avec titre et bouton fermer\r\n        const header = document.createElement('div');\r\n        header.style.cssText = `\r\n            display: flex;\r\n            justify-content: space-between;\r\n            align-items: center;\r\n            margin-bottom: 15px;\r\n        `;\r\n\r\n        const title = document.createElement('h3');\r\n        title.id = 'pdf-preview-title';\r\n        title.textContent = 'Aper√ßu PDF';\r\n        title.style.cssText = 'margin: 0; color: #1d2327;';\r\n\r\n        const closeBtn = document.createElement('button');\r\n        closeBtn.id = 'pdf-preview-close';\r\n        closeBtn.textContent = '√ó';\r\n        closeBtn.style.cssText = `\r\n            background: none;\r\n            border: none;\r\n            font-size: 24px;\r\n            cursor: pointer;\r\n            color: #666;\r\n        `;\r\n\r\n        header.appendChild(title);\r\n        header.appendChild(closeBtn);\r\n\r\n        // Actions container\r\n        const actions = document.createElement('div');\r\n        actions.id = 'pdf-preview-actions';\r\n        actions.style.cssText = 'margin-bottom: 15px;';\r\n\r\n        // Image container\r\n        const img = document.createElement('img');\r\n        img.id = 'pdf-preview-image';\r\n        img.alt = 'Aper√ßu PDF';\r\n        img.style.cssText = 'max-width: 100%; height: auto; border: 1px solid #ddd;';\r\n\r\n        wrapper.appendChild(header);\r\n        wrapper.appendChild(actions);\r\n        wrapper.appendChild(img);\r\n        modal.appendChild(wrapper);\r\n\r\n        // Gestionnaire de fermeture\r\n        closeBtn.addEventListener('click', () => {\r\n            modal.classList.remove('visible');\r\n        });\r\n\r\n        // Fermeture en cliquant en dehors\r\n        modal.addEventListener('click', (e) => {\r\n            if (e.target === modal) {\r\n                modal.classList.remove('visible');\r\n            }\r\n        });\r\n\r\n        return modal;\r\n    }\r\n\r\n    /**\r\n     * Ajoute les boutons d'action √† l'aper√ßu\r\n     */\r\n    addPreviewActions(modal, imageUrl, context) {\r\n        const actionsContainer = modal.querySelector('#pdf-preview-actions');\r\n        actionsContainer.innerHTML = '';\r\n\r\n        // Bouton de t√©l√©chargement\r\n        const downloadBtn = document.createElement('button');\r\n        downloadBtn.textContent = 'üì• T√©l√©charger';\r\n        downloadBtn.style.cssText = `\r\n            background: #007cba;\r\n            color: white;\r\n            border: none;\r\n            padding: 8px 16px;\r\n            border-radius: 4px;\r\n            cursor: pointer;\r\n            margin-right: 10px;\r\n        `;\r\n        downloadBtn.addEventListener('click', () => {\r\n            this.downloadPreview(imageUrl);\r\n        });\r\n\r\n        // Bouton d'impression\r\n        const printBtn = document.createElement('button');\r\n        printBtn.textContent = 'üñ®Ô∏è Imprimer';\r\n        printBtn.style.cssText = `\r\n            background: #46b450;\r\n            color: white;\r\n            border: none;\r\n            padding: 8px 16px;\r\n            border-radius: 4px;\r\n            cursor: pointer;\r\n            margin-right: 10px;\r\n        `;\r\n        printBtn.addEventListener('click', () => {\r\n            this.printPreview(imageUrl);\r\n        });\r\n\r\n        // Bouton de r√©g√©n√©ration (pour metabox seulement)\r\n        if (context === 'metabox') {\r\n            const regenerateBtn = document.createElement('button');\r\n            regenerateBtn.textContent = 'üîÑ R√©g√©n√©rer';\r\n            regenerateBtn.style.cssText = `\r\n                background: #f56e28;\r\n                color: white;\r\n                border: none;\r\n                padding: 8px 16px;\r\n                border-radius: 4px;\r\n                cursor: pointer;\r\n            `;\r\n            regenerateBtn.addEventListener('click', () => {\r\n                // Cette fonction devra √™tre appel√©e depuis le contexte parent\r\n                if (typeof window.regenerateOrderPreview === 'function') {\r\n                    window.regenerateOrderPreview();\r\n                }\r\n            });\r\n            actionsContainer.appendChild(regenerateBtn);\r\n        }\r\n\r\n        actionsContainer.appendChild(downloadBtn);\r\n        actionsContainer.appendChild(printBtn);\r\n    }\r\n\r\n    /**\r\n     * T√©l√©charge l'aper√ßu\r\n     */\r\n    downloadPreview(imageUrl) {\r\n        const link = document.createElement('a');\r\n        link.href = imageUrl;\r\n        link.download = `pdf-preview-${Date.now()}.png`;\r\n        link.style.display = 'none';\r\n        document.body.appendChild(link);\r\n        link.click();\r\n        document.body.removeChild(link);\r\n\r\n        debugLog('üì• T√©l√©chargement d√©marr√©:', imageUrl);\r\n    }\r\n\r\n    /**\r\n     * Imprime l'aper√ßu\r\n     */\r\n    printPreview(imageUrl) {\r\n        const printWindow = window.open('', '_blank');\r\n        printWindow.document.write(`\r\n            <html>\r\n                <head>\r\n                    <title>Aper√ßu PDF</title>\r\n                    <style>\r\n                        body { margin: 0; padding: 20px; text-align: center; }\r\n                        img { max-width: 100%; height: auto; }\r\n                        @media print {\r\n                            body { margin: 0; }\r\n                            img { max-width: 100%; height: auto; }\r\n                        }\r\n                    </style>\r\n                </head>\r\n                <body>\r\n                    <img src=\"${imageUrl}\" alt=\"Aper√ßu PDF\" onload=\"window.print(); window.close();\" />\r\n                </body>\r\n            </html>\r\n        `);\r\n        printWindow.document.close();\r\n\r\n        debugLog('üñ®Ô∏è Impression d√©marr√©e');\r\n    }\r\n\r\n    /**\r\n     * Affiche l'indicateur de chargement\r\n     */\r\n    showLoadingIndicator() {\r\n        let loader = document.getElementById('pdf-preview-loader');\r\n        if (!loader) {\r\n            loader = document.createElement('div');\r\n            loader.id = 'pdf-preview-loader';\r\n            loader.style.cssText = `\r\n                position: fixed;\r\n                top: 50%;\r\n                left: 50%;\r\n                transform: translate(-50%, -50%);\r\n                background: rgba(255,255,255,0.9);\r\n                border: 1px solid #ccc;\r\n                border-radius: 8px;\r\n                padding: 20px;\r\n                z-index: 10000;\r\n                display: none;\r\n                text-align: center;\r\n            `;\r\n            loader.innerHTML = `\r\n                <div style=\"border: 4px solid #f3f3f3; border-top: 4px solid #007cba; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin: 0 auto 10px;\"></div>\r\n                <div>G√©n√©ration de l'aper√ßu...</div>\r\n                <style>\r\n                    @keyframes spin {\r\n                        0% { transform: rotate(0deg); }\r\n                        100% { transform: rotate(360deg); }\r\n                    }\r\n                </style>\r\n            `;\r\n            document.body.appendChild(loader);\r\n        }\r\n        loader.style.display = 'block';\r\n    }\r\n\r\n    /**\r\n     * Cache l'indicateur de chargement\r\n     */\r\n    hideLoadingIndicator() {\r\n        const loader = document.getElementById('pdf-preview-loader');\r\n        if (loader) {\r\n            loader.style.display = 'none';\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Affiche un message d'erreur\r\n     */\r\n    showError(message) {\r\n        // Notification system removed - log to console instead\r\n        debugError('PDF Preview Error:', message);\r\n    }\r\n}\r\n\r\n// Initialisation globale\r\nwindow.pdfPreviewAPI = new PDFPreviewAPI();\r\n\r\n// Fonctions d'aide pour une utilisation facile\r\nwindow.generateEditorPreview = (templateData, options) => {\r\n    return window.pdfPreviewAPI.generateEditorPreview(templateData, options);\r\n};\r\n\r\nwindow.generateOrderPreview = (templateData, orderId, options) => {\r\n    return window.pdfPreviewAPI.generateOrderPreview(templateData, orderId, options);\r\n};\r\n\r\ndebugLog('üéØ API Preview 1.4 initialis√©e et pr√™te √† l\\'emploi !');\r\ndebugLog('üìñ Utilisation:');\r\ndebugLog('   - generateEditorPreview(templateData)');\r\ndebugLog('   - generateOrderPreview(templateData, orderId)');\r\n"],"names":[],"sourceRoot":""}