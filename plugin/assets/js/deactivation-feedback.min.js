!function($){"use strict";$(document).ready(function(){const PLUGIN_SLUG="pdf-builder-pro";const $body=$("body");const modalHTML=`<div id="pdf-builder-deactivation-modal"><div class="modal-content"><div class="modal-header"><h2>Nous serions tristes de vous voir partir üò¢</h2><p style="margin:5px 0 0 0;font-size:14px;opacity:0.9;">Aidez-nous √† am√©liorer PDF Builder Pro</p></div><div class="modal-body"><p style="margin:0 0 15px 0;font-size:14px;">Dites-nous pourquoi vous d√©sactivez le plugin:</p><div class="feedback-group"><div class="feedback-option"><input type="radio" id="reason_dont_need" name="deactivation_reason" value="dont_need"><label for="reason_dont_need">Je n'en ai plus besoin</label></div><div class="feedback-option"><input type="radio" id="reason_not_working" name="deactivation_reason" value="not_working"><label for="reason_not_working">Le plugin ne fonctionne pas correctement</label></div><div class="feedback-option"><input type="radio" id="reason_slow" name="deactivation_reason" value="slow_performance"><label for="reason_slow">Le plugin ralentit mon site</label></div><div class="feedback-option"><input type="radio" id="reason_confusing" name="deactivation_reason" value="confusing"><label for="reason_confusing">Le plugin est difficile √† utiliser</label></div><div class="feedback-option"><input type="radio" id="reason_expensive" name="deactivation_reason" value="expensive"><label for="reason_expensive">C'est trop cher pour les fonctionnalit√©s</label></div><div class="feedback-option"><input type="radio" id="reason_alternative" name="deactivation_reason" value="found_alternative"><label for="reason_alternative">J'ai trouv√© une meilleure alternative</label></div><div class="feedback-option"><input type="radio" id="reason_temporary" name="deactivation_reason" value="temporary"><label for="reason_temporary">D√©sactivation temporaire</label></div><div class="feedback-option"><input type="radio" id="reason_other" name="deactivation_reason" value="autre"><label for="reason_other">Autre raison</label></div></div><div class="email-field"><label for="pdf_builder_feedback_email">Votre email (pour vous recontacter):</label><input type="email" id="pdf_builder_feedback_email" placeholder="votre@email.com"></div><textarea id="pdf_builder_feedback_message" placeholder="Parlez-nous de votre exp√©rience... (optionnel)"></textarea></div><div class="modal-footer"><button class="skip-button" id="pdf_builder_skip_feedback">Passer et d√©sactiver</button><button class="deactivate-button" id="pdf_builder_send_feedback">Envoyer et d√©sactiver</button></div></div></div>`;$body.append(modalHTML);const $modal=$("#pdf-builder-deactivation-modal");const $skipBtn=$("#pdf_builder_skip_feedback");const $sendBtn=$("#pdf_builder_send_feedback");const $textarea=$("#pdf_builder_feedback_message");const $emailField=$(".email-field");let pluginDeactivateUrl=null;$("input[name=deactivation_reason]").on("change",function(){const value=$(this).val();if(value){$textarea.addClass("show");$emailField.addClass("show")}});$(document).on("click","a.submitdelete[href*=pdf-builder-pro]",function(e){if(!$(this).attr("href").includes("action=deactivate")){return}e.preventDefault();pluginDeactivateUrl=this.href;console.log("[PDF Builder] Intercept√© d√©sactivation:",pluginDeactivateUrl);$modal.addClass("show");$("input[name=deactivation_reason]").first().focus()});if(!pluginDeactivateUrl){$(document).on("click",'a[href*="action=deactivate"][href*="pdf-builder"]',function(e){e.preventDefault();pluginDeactivateUrl=this.href;console.log("[PDF Builder] Intercept√© (fallback):",pluginDeactivateUrl);$modal.addClass("show");$("input[name=deactivation_reason]").first().focus()})}$skipBtn.on("click",function(){console.log("[PDF Builder] Skip clicked, redirecting to:",pluginDeactivateUrl);if(pluginDeactivateUrl){window.location.href=pluginDeactivateUrl}});$sendBtn.on("click",function(){const reason=$("input[name=deactivation_reason]:checked").val();const message=$textarea.val();const email=$("#pdf_builder_feedback_email").val();console.log("[PDF Builder] Send feedback:",{reason,email,messageLength:message.length});$sendBtn.prop("disabled",!0).addClass("loading");$.ajax({url:pdfBuilderDeactivation.ajaxUrl,type:"POST",data:{action:"pdf_builder_send_deactivation_feedback",nonce:pdfBuilderDeactivation.nonce,reason:reason||"autre",message:message,email:email},success:function(response){console.log("[PDF Builder] Feedback sent successfully:",response)},error:function(xhr,status,error){console.error("[PDF Builder] Feedback error:",error)},complete:function(){console.log("[PDF Builder] Redirecting to deactivation URL:",pluginDeactivateUrl);if(pluginDeactivateUrl){window.location.href=pluginDeactivateUrl}}})})})}(jQuery);
