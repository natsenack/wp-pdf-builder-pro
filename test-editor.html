<!DOCTYPE html>
<html lang='fr'>
<head>
    <meta charset='UTF-8'>
    <meta name='viewport' content='width=device-width, initial-scale=1.0'>
    <title>Test PDF Editor</title>
    <script src='https://unpkg.com/react@18.2.0/umd/react.production.min.js'></script>
    <script src='https://unpkg.com/react-dom@18.2.0/umd/react-dom.production.min.js'></script>
    <style>
        body { margin: 0; font-family: Arial, sans-serif; background: #f5f5f5; }
        #editor-container { height: 100vh; }
        #debug-info { position: fixed; top: 10px; right: 10px; background: rgba(0,0,0,0.8); color: white; padding: 10px; border-radius: 5px; font-size: 12px; max-width: 300px; z-index: 1000; }
        .error { color: #ff6b6b; }
        .success { color: #51cf66; }
    </style>
</head>
<body>
    <div id='debug-info'>Chargement...</div>
    <div id='editor-container'></div>

    <script src='assets/js/dist/pdf-builder-admin.js'></script>
    <script>
        const debugInfo = document.getElementById('debug-info');
        const container = document.getElementById('editor-container');

        function updateDebug(message, type = 'info') {
            debugInfo.innerHTML += '<br>' + message;
            if (type === 'error') debugInfo.classList.add('error');
            if (type === 'success') debugInfo.classList.add('success');
            console.log(message);
        }

        updateDebug('Script chargé, vérification de React...');

        if (typeof React === 'undefined' || typeof ReactDOM === 'undefined') {
            updateDebug('❌ React non chargé', 'error');
            return;
        }
        updateDebug('✅ React chargé');

        // Simuler l'initialisation WordPress
        window.wp = window.wp || {};
        window.wp.hooks = window.wp.hooks || { addAction: () => {}, doAction: () => {} };

        updateDebug('WordPress simulé');

        // Attendre que le script se charge
        let attempts = 0;
        const maxAttempts = 10;
        const checkInterval = setInterval(() => {
            attempts++;
            updateDebug(`Tentative ${attempts}/${maxAttempts}...`);

            if (typeof window.PDFBuilder !== 'undefined') {
                clearInterval(checkInterval);
                updateDebug('✅ window.PDFBuilder trouvé après ' + attempts + ' tentatives', 'success');

                if (window.PDFBuilder.PDFEditor) {
                    updateDebug('✅ PDFEditor trouvé', 'success');

                    try {
                        const root = ReactDOM.createRoot(container);
                        root.render(React.createElement(window.PDFBuilder.PDFEditor, {
                            initialElements: [],
                            templateName: 'Test Template',
                            onSave: (elements) => {
                                updateDebug('Éléments sauvegardés: ' + elements.length, 'success');
                                console.log('Saved:', elements);
                            }
                        }));
                        updateDebug('✅ Éditeur rendu avec succès !', 'success');
                        debugInfo.style.background = 'rgba(81, 207, 102, 0.9)'; // vert
                    } catch (error) {
                        updateDebug('❌ Erreur lors du rendu: ' + error.message, 'error');
                        console.error('Render error:', error);
                        debugInfo.style.background = 'rgba(255, 107, 107, 0.9)'; // rouge
                    }
                } else {
                    updateDebug('❌ PDFEditor non trouvé dans PDFBuilder', 'error');
                    updateDebug('Contenu de PDFBuilder: ' + JSON.stringify(Object.keys(window.PDFBuilder)));
                    debugInfo.style.background = 'rgba(255, 107, 107, 0.9)'; // rouge
                }
            } else if (attempts >= maxAttempts) {
                clearInterval(checkInterval);
                updateDebug('❌ Échec: PDFBuilder toujours non trouvé après ' + maxAttempts + ' tentatives', 'error');
                updateDebug('Objets globaux disponibles: ' + JSON.stringify(Object.keys(window).filter(k => k.toLowerCase().includes('pdf') || k.toLowerCase().includes('builder'))));
                debugInfo.style.background = 'rgba(255, 107, 107, 0.9)'; // rouge
            }
        }, 500);
    </script>
</body>
</html>