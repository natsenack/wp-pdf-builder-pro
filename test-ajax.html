<!DOCTYPE html>
<html>
<head>
    <title>Test AJAX PDF Builder</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <h1>Test du syst√®me AJAX PDF Builder</h1>

    <button id="test-diagnostic">Tester le handler de diagnostic</button>
    <button id="test-backup-list">Tester la liste des sauvegardes</button>

    <div id="results" style="margin-top: 20px; padding: 10px; border: 1px solid #ccc; background: #f9f9f9;">
        <p>R√©sultats des tests appara√Ætront ici...</p>
    </div>

    <script>
    jQuery(document).ready(function($) {
        $('#test-diagnostic').on('click', function() {
            $('#results').html('<p>üß™ Test du handler de diagnostic en cours...</p>');

            $.ajax({
                url: '/wp-admin/admin-ajax.php',
                type: 'POST',
                data: {
                    action: 'pdf_builder_diagnostic',
                    test: 'diagnostic'
                },
                success: function(response) {
                    console.log('Diagnostic response:', response);
                    if (response.success) {
                        $('#results').html('<div style="color: green;">‚úÖ Handler de diagnostic fonctionne !<br>Message: ' + response.data.message + '<br>User ID: ' + response.data.user_id + '</div>');
                    } else {
                        $('#results').html('<div style="color: red;">‚ùå Handler de diagnostic a √©chou√©: ' + JSON.stringify(response) + '</div>');
                    }
                },
                error: function(xhr, status, error) {
                    console.error('Diagnostic AJAX error:', xhr, status, error);
                    $('#results').html('<div style="color: red;">‚ùå Erreur AJAX: ' + error + '<br>Status: ' + status + '<br>Response: ' + xhr.responseText.substring(0, 200) + '...</div>');
                }
            });
        });

        $('#test-backup-list').on('click', function() {
            $('#results').html('<p>üß™ Test de la liste des sauvegardes en cours...</p>');

            $.ajax({
                url: '/wp-admin/admin-ajax.php',
                type: 'POST',
                data: {
                    action: 'pdf_builder_list_backups',
                    nonce: 'test-nonce' // On utilisera un vrai nonce si n√©cessaire
                },
                success: function(response) {
                    console.log('Backup list response:', response);
                    if (response.success) {
                        $('#results').html('<div style="color: green;">‚úÖ Liste des sauvegardes fonctionne !<br>Sauvegardes trouv√©es: ' + (response.data.backups ? response.data.backups.length : 'N/A') + '</div>');
                    } else {
                        $('#results').html('<div style="color: orange;">‚ö†Ô∏è Liste des sauvegardes a r√©pondu mais avec une erreur: ' + JSON.stringify(response) + '</div>');
                    }
                },
                error: function(xhr, status, error) {
                    console.error('Backup list AJAX error:', xhr, status, error);
                    $('#results').html('<div style="color: red;">‚ùå Erreur AJAX liste sauvegardes: ' + error + '<br>Status: ' + status + '<br>Response: ' + xhr.responseText.substring(0, 200) + '...</div>');
                }
            });
        });
    });
    </script>
</body>
</html>